<!DOCTYPE html><html lang="ru-RU" prefix="og: http://ogp.me/ns#"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1' /><link media="all" href="https://rublogtrader.rar.su/wp-content/cache/autoptimize/css/autoptimize_a956534720ee1514d6564ed8c0f433d5.css" rel="stylesheet" /><title>Дополнительные возможности MQL4 в разработке советников</title><meta name="description" content="Рассмотрим дополнительные функции и возможности в MQL4, которые помогут вам программировать и настраивать работу советников." /><meta property="og:locale" content="ru_RU" /><meta property="og:type" content="article" /><meta property="og:title" content="Дополнительные возможности MQL4 в разработке советников" /><meta property="og:description" content="Рассмотрим дополнительные функции и возможности в MQL4, которые помогут вам программировать и настраивать работу советников." /><meta property="og:url" content="https://rublogtrader.rar.su/dopolnitelnye-vozmozhnosti-mql4/" /><meta property="og:site_name" content="Блог трейдера" /><meta property="article:published_time" content="2020-06-28T10:05:22+00:00" /><meta property="article:modified_time" content="2020-06-28T10:13:11+00:00" /><meta property="og:image" content="https://rublogtrader.rar.su/wp-content/uploads/2020/06/dopolnitelnye-vozmozhnosti-mql4-v-razrabotke-sovetnikov.jpg" /><meta property="og:image:width" content="1200" /><meta property="og:image:height" content="630" /><meta property="og:image:type" content="image/jpeg" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:creator" content="@traderblog_net" /><meta name="twitter:site" content="@traderblog_net" /><meta name="twitter:label1" content="Написано автором" /><meta name="twitter:data1" content="Александр Паркер" /><meta name="twitter:label2" content="Примерное время для чтения" /><meta name="twitter:data2" content="1 минута" /> <script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://rublogtrader.rar.su/#website","url":"https://rublogtrader.rar.su/","name":"\u0411\u043b\u043e\u0433 \u0442\u0440\u0435\u0439\u0434\u0435\u0440\u0430","description":"My WordPress Blog","publisher":{"@id":"https://rublogtrader.rar.su/#/schema/person/28382f0e81820f364e345a97d4203238"},"potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://rublogtrader.rar.su/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"ru-RU"},{"@type":"ImageObject","@id":"https://rublogtrader.rar.su/dopolnitelnye-vozmozhnosti-mql4/#primaryimage","inLanguage":"ru-RU","url":"https://rublogtrader.rar.su/wp-content/uploads/2020/06/dopolnitelnye-vozmozhnosti-mql4-v-razrabotke-sovetnikov.jpg","contentUrl":"https://rublogtrader.rar.su/wp-content/uploads/2020/06/dopolnitelnye-vozmozhnosti-mql4-v-razrabotke-sovetnikov.jpg","width":1200,"height":630,"caption":"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 MQL4 \u0432 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0435 \u0441\u043e\u0432\u0435\u0442\u043d\u0438\u043a\u043e\u0432"},{"@type":"WebPage","@id":"https://rublogtrader.rar.su/dopolnitelnye-vozmozhnosti-mql4/#webpage","url":"https://rublogtrader.rar.su/dopolnitelnye-vozmozhnosti-mql4/","name":"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 MQL4 \u0432 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0435 \u0441\u043e\u0432\u0435\u0442\u043d\u0438\u043a\u043e\u0432","isPartOf":{"@id":"https://rublogtrader.rar.su/#website"},"primaryImageOfPage":{"@id":"https://rublogtrader.rar.su/dopolnitelnye-vozmozhnosti-mql4/#primaryimage"},"datePublished":"2020-06-28T10:05:22+00:00","dateModified":"2020-06-28T10:13:11+00:00","description":"\u0420\u0430\u0441\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0438 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u0432 MQL4, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043f\u043e\u043c\u043e\u0433\u0443\u0442 \u0432\u0430\u043c \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0438 \u043d\u0430\u0441\u0442\u0440\u0430\u0438\u0432\u0430\u0442\u044c \u0440\u0430\u0431\u043e\u0442\u0443 \u0441\u043e\u0432\u0435\u0442\u043d\u0438\u043a\u043e\u0432.","breadcrumb":{"@id":"https://rublogtrader.rar.su/dopolnitelnye-vozmozhnosti-mql4/#breadcrumb"},"inLanguage":"ru-RU","potentialAction":[{"@type":"ReadAction","target":["https://rublogtrader.rar.su/dopolnitelnye-vozmozhnosti-mql4/"]}]},{"@type":"BreadcrumbList","@id":"https://rublogtrader.rar.su/dopolnitelnye-vozmozhnosti-mql4/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"\u0413\u043b\u0430\u0432\u043d\u0430\u044f \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0430","item":"https://rublogtrader.rar.su/"},{"@type":"ListItem","position":2,"name":"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 MQL4 \u0432 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0435 \u0441\u043e\u0432\u0435\u0442\u043d\u0438\u043a\u043e\u0432"}]},{"@type":"Article","@id":"https://rublogtrader.rar.su/dopolnitelnye-vozmozhnosti-mql4/#article","isPartOf":{"@id":"https://rublogtrader.rar.su/dopolnitelnye-vozmozhnosti-mql4/#webpage"},"author":{"@id":"https://rublogtrader.rar.su/#/schema/person/28382f0e81820f364e345a97d4203238"},"headline":"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 MQL4 \u0432 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0435 \u0441\u043e\u0432\u0435\u0442\u043d\u0438\u043a\u043e\u0432","datePublished":"2020-06-28T10:05:22+00:00","dateModified":"2020-06-28T10:13:11+00:00","mainEntityOfPage":{"@id":"https://rublogtrader.rar.su/dopolnitelnye-vozmozhnosti-mql4/#webpage"},"wordCount":411,"commentCount":0,"publisher":{"@id":"https://rublogtrader.rar.su/#/schema/person/28382f0e81820f364e345a97d4203238"},"image":{"@id":"https://rublogtrader.rar.su/dopolnitelnye-vozmozhnosti-mql4/#primaryimage"},"thumbnailUrl":"https://rublogtrader.rar.su/wp-content/uploads/2020/06/dopolnitelnye-vozmozhnosti-mql4-v-razrabotke-sovetnikov.jpg","articleSection":["MQL4"],"inLanguage":"ru-RU","potentialAction":[{"@type":"CommentAction","name":"Comment","target":["https://rublogtrader.rar.su/dopolnitelnye-vozmozhnosti-mql4/#respond"]}]},{"@type":["Person","Organization"],"@id":"https://rublogtrader.rar.su/#/schema/person/28382f0e81820f364e345a97d4203238","name":"\u0410\u043b\u0435\u043a\u0441\u0430\u043d\u0434\u0440 \u041f\u0430\u0440\u043a\u0435\u0440","image":{"@type":"ImageObject","@id":"https://rublogtrader.rar.su/#personlogo","inLanguage":"ru-RU","url":"https://rublogtrader.rar.su/wp-content/uploads/2019/06/cosmopolis-100x100.png","contentUrl":"https://rublogtrader.rar.su/wp-content/uploads/2019/06/cosmopolis-100x100.png","width":100,"height":100,"caption":"\u0410\u043b\u0435\u043a\u0441\u0430\u043d\u0434\u0440 \u041f\u0430\u0440\u043a\u0435\u0440"},"logo":{"@id":"https://rublogtrader.rar.su/#personlogo"},"description":"\u0421\u043e\u0437\u0434\u0430\u0442\u0435\u043b\u044c \u0438 \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440 \u0441\u0430\u0439\u0442\u0430 rublogtrader.rar.su.","sameAs":["https://rublogtrader.rar.su/"]}]}</script> <link rel="alternate" type="application/rss+xml" title="Блог трейдера &raquo; Лента" href="https://rublogtrader.rar.su/feed/" /> <script type='text/javascript' src='https://rublogtrader.rar.su/wp-includes/js/jquery/jquery.min.js' id='jquery-core-js'></script> <link rel="https://api.w.org/" href="https://rublogtrader.rar.su/wp-json/" /><link rel="alternate" type="application/json" href="https://rublogtrader.rar.su/wp-json/wp/v2/posts/14353" />   <link rel="icon" type="image/png" sizes="32x32" href="/favicon32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon16.png"><link rel="apple-touch-icon" sizes="180x180" href="/appleicon.png">  <!-- Yandex.Metrika counter --><script type="text/javascript" > (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)}; m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)}) (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym"); ym(87171221, "init", { clickmap:true, trackLinks:true, accurateTrackBounce:true, webvisor:true });</script><noscript><div><img src="https://mc.yandex.ru/watch/87171221" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter --></head><body ><div id="page" class="site"><header id="masthead" class="site-header"><div class="row"><div class="col-xs-12 site-header-col"><div class="site-branding"><p class="site-title"><a href="/" rel="home">Блог трейдера</a></p></div><nav id="site-navigation" class="main-navigation"> <button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">Меню</button><div class="menu-menu-container"><ul id="primary-menu" class="menu"><li id="menu-item-14443" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-14443"><a href="https://rublogtrader.rar.su/forex/">Форекс</a></li><li id="menu-item-14444" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-14444"><a href="https://rublogtrader.rar.su/trading/">Трейдинг</a></li><li id="menu-item-12561" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12561"><a href="https://rublogtrader.rar.su/technical-analysis/">Технический анализ</a></li><li id="menu-item-12560" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12560"><a href="https://rublogtrader.rar.su/indicators/">Индикаторы</a></li><li id="menu-item-12559" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12559"><a href="https://rublogtrader.rar.su/prajs-jekshen/">Прайс экшен</a></li><li id="menu-item-15892" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-15892"><a href="https://rublogtrader.rar.su/investing/">Инвестиции</a></li><li id="menu-item-16239" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-16239"><a href="https://rublogtrader.rar.su/crypto/">Крипто</a></li></ul></div></nav></div></div></header><div class='code-block code-block-center code-block-2 ai-viewport-1'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader1" rel="nofollow" target="_blank"><img src="https://advertising-blog.qqit.ru/rublogtrader.rar.su/468x60.gif"/></a></div><div id="content" class="site-content"><div class="row row--index"><div class="col-xs-12"><div id="primary" class="content-area"><main id="main" class="site-main" role="main"><article id="post-14353" class="post-14353 post type-post status-publish format-standard has-post-thumbnail hentry category-mql4"><div class="row no-pad"><div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 no-pad"><header class="entry-header"><h1 class="entry-title">Дополнительные возможности MQL4 в разработке советников</h1><div class="entry-meta"><a href="https://rublogtrader.rar.su/mql4/" rel="category tag">MQL4</a> | 28.06.2020 | <i class="icon-07"></i> 1303</div></header><div class="entry-content"> <img src="" style="float:right;" align="right"><p>Рассмотрим дополнительные функции и возможности MQL4, которые могут быть полезны в программировании советников.<br> <span id="more-14353"></span></p><div class="lwptoc lwptoc-autoWidth lwptoc-baseItems lwptoc-transparent lwptoc-notInherit" data-smooth-scroll="1" data-smooth-scroll-offset="24"><div class="lwptoc_i"><div class="lwptoc_items lwptoc_items-visible"><div class="lwptoc_itemWrap"><div class="lwptoc_item"> <a href="#Escape_simvoly"> <span class="lwptoc_item_label">Escape символы</span> </a></div><div class="lwptoc_item"> <a href="#Ispolzovanie_kommentariev_na_grafike"> <span class="lwptoc_item_label">Использование комментариев на графике</span> </a></div><div class="lwptoc_item"> <a href="#Proverka_nastroek"> <span class="lwptoc_item_label">Проверка настроек</span> </a></div><div class="lwptoc_item"> <a href="#Ogracenia_akkauntov"> <span class="lwptoc_item_label">Ограчения аккаунтов</span> </a></div><div class="lwptoc_item"> <a href="#MessageBox"> <span class="lwptoc_item_label">MessageBox()</span> </a></div><div class="lwptoc_item"> <a href="#Uvedomlenia_po_E-mail"> <span class="lwptoc_item_label">Уведомления по E-mail</span> </a></div><div class="lwptoc_item"> <a href="#Povtor_posle_osibki"> <span class="lwptoc_item_label">Повтор после ошибки</span> </a></div><div class="lwptoc_item"> <a href="#Ispolzovanie_kommentariev_k_orderu_v_kacestve_identifikatora"> <span class="lwptoc_item_label">Использование комментариев к ордеру в качестве идентификатора</span> </a></div><div class="lwptoc_item"> <a href="#Proverka_marzinalnyh_trebovanij"> <span class="lwptoc_item_label">Проверка маржинальных требований</span> </a></div><div class="lwptoc_item"> <a href="#Proverka_spreda"> <span class="lwptoc_item_label">Проверка спреда</span> </a></div><div class="lwptoc_item"> <a href="#Razmesenie_neskolkih_orderov"> <span class="lwptoc_item_label">Размещение нескольких ордеров</span> </a></div><div class="lwptoc_item"> <a href="#Globalnye_peremennye"> <span class="lwptoc_item_label">Глобальные переменные</span> </a></div><div class="lwptoc_item"> <a href="#Proverka_pribyli_ordera"> <span class="lwptoc_item_label">Проверка прибыли ордера</span> </a></div><div class="lwptoc_item"> <a href="#Martingejl"> <span class="lwptoc_item_label">Мартингейл</span> </a></div><div class="lwptoc_item"> <a href="#Otladka_raboty_vasego_sovetnika"> <span class="lwptoc_item_label">Отладка работы вашего советника</span> </a></div><div class="lwptoc_item"> <a href="#Ustranenie_osibok_v_slucae_preryvania_torgovli"> <span class="lwptoc_item_label">Устранение ошибок в случае прерывания торговли</span> </a></div><div class="lwptoc_item"> <a href="#Obrabotka_osibok_kompilacii"> <span class="lwptoc_item_label">Обработка ошибок компиляции</span> </a></div></div></div></div></div><div class='code-block code-block-center code-block-3 ai-viewport-1'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader2" rel="nofollow" target="_blank"><img src="https://advertising-blog.qqit.ru/rublogtrader.rar.su/pamm_landing_banner_970x250_ru_1.gif"/></a></div><h2><span id="Escape_simvoly">Escape символы</span></h2><p>Если вы хотите добавить кавычки или символ обратной черты в строку, вам нужно экранировать символ, используя обратную косую черту (\). Например, если вам нужно вставить двойную кавычку, escape-символ будет \». Для одиночной кавычки escape-символ — \’. Для обратной косой черты в качестве escape-символа используйте две обратные косые черты: \\</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">string EscQuotes <span class="sy0">=</span> <span class="st0">&quot;Эта строка содержит <span class="es1">\&quot;</span>двойные кавычки<span class="es1">\&quot;</span>&quot;</span><span class="sy0">;</span> <span class="co1">// Эта строка содержит &quot;двойные кавычки&quot;</span>string EscQuote <span class="sy0">=</span> <span class="st0">&quot;Эта строка содержит <span class="es1">\'</span>одинарные кавчки<span class="es1">\'</span>&quot;</span><span class="sy0">;</span> <span class="co1">// Эта строка содержит 'одинарные кавычки'</span>string EscSlash <span class="sy0">=</span> <span class="st0">&quot;Эта строка содержит обратную черту <span class="es1">\\</span>&quot;</span><span class="sy0">;</span> <span class="co1">// Эта строка содержит обратную черту \</span></pre></div></div></div></div></div></div></div><p>Если вам нужно, чтобы строка занимала несколько строк, используйте escape-символ \n для добавления новой строки:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">string NewLine <span class="sy0">=</span> <span class="st0">&quot;Эта строка <span class="es1">\n</span> новая строка&quot;</span><span class="sy0">;</span> <span class="co1">// Output: Эта строка</span>новая строка</pre></div></div></div></div></div></div></div><h2><span id="Ispolzovanie_kommentariev_na_grafike">Использование комментариев на графике</span></h2><p>Вы можете напечатать текст в верхнем левом углу графика, используя функцию Comment(). Это можно использовать для вывода информации о состоянии, настроек индикатора или любой другой информации, которая может оказаться полезной.</p><p>Один из способов отображения комментариев к графику — объявить несколько строковых переменных и объединить их вместе с символами новой строки. Одна строка может использоваться для отображения настроек, другая — для отображения информационных сообщений или статуса ордера и т. д. Строка будет передана в функцию Comment().</p><p>Поместите функцию Comment() в конец функции start(), чтобы обновить комментарий на графике:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">string SettingsComment <span class="sy0">=</span> <span class="st0">&quot;FastMAPeriod: &quot;</span><span class="sy0">+</span>FastMAPeriod<span class="sy0">+</span><span class="st0">&quot; SlowMAPeriod: &quot;</span><span class="sy0">+</span>SlowMAPeriod<span class="sy0">;</span> string StatusComment <span class="sy0">=</span> <span class="st0">&quot;Размещен ордер на покупку&quot;</span><span class="sy0">;</span>Comment<span class="br0">(</span>SettingsComment<span class="sy0">+</span><span class="st0">&quot;<span class="es1">\n</span>&quot;</span><span class="sy0">+</span>StatusComment<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Мы объявляем и устанавливаем значения строк SettingsComment и StatusComment внутри функции start(). В конце функции start мы вызываем функцию Comment() и используем ее для вывода наших комментариев на графике. Мы используем символ новой строки (\n), чтобы разделить комментарий на две строки.</p><h2><span id="Proverka_nastroek">Проверка настроек</span></h2><p>Существует несколько настроек советника, которые должны быть проверены, прежде чем советнику будет разрешено торговать. Эти настройки находятся на вкладке «Общие» в диалоговом окне «Свойства эксперта».</p><p>Параметр Allow live trading должен быть включен до начала торговли. Если он не включен, в правом верхнем углу графика рядом с именем советника появится эмоция недовольство. Вы можете проверить это условие в своем советнике, используя функцию IsTradeAllowed(). Если она возвращает false, настройка Allow live trading отключена.</p><p>Если вы хотите отобразить пользователю сообщение о том, что этот параметр должен быть активирован, вы можете сделать следующее:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">if</span><span class="br0">(</span>IsTradeAllowed<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> <span class="kw2">false</span><span class="br0">)</span> Alert<span class="br0">(</span><span class="st0">&quot;Активируйте настройку <span class="es1">\'</span>Allow live trading<span class="es1">\'</span> в свойствах советника!&quot;</span><span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Если ваш эксперт использует внешнюю библиотеку .ex4, в свойствах эксперта должен быть включен параметр Разрешить импорт внешних экспертов. Вы можете проверить это с помощью функции IsLibrariesAllowed():</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">if</span><span class="br0">(</span>IsLibrariesAllowed<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> <span class="kw2">false</span><span class="br0">)</span> Alert<span class="br0">(</span><span class="st0">&quot;Активруйте настройку <span class="es1">\'</span>Allow import of external experts<span class="es1">\'</span> в свойствах советника!&quot;</span><span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>То же самое можно сделать для DLL, используя функцию IsDllsAllowed():</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">if</span><span class="br0">(</span>IsDllsAllowed<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> <span class="kw2">false</span><span class="br0">)</span> Alert<span class="br0">(</span><span class="st0">&quot;Активруйте настройку <span class="es1">\'</span>Allow DLL imports<span class="es1">\'</span> в свойствах советника!&quot;</span><span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p><img loading="lazy" src="https://rublogtrader.rar.su/wp-content/uploads/2020/06/settings.png" alt="настройки советника" width="450" height="233" class="alignnone size-full wp-image-14354" srcset="https://rublogtrader.rar.su/wp-content/uploads/2020/06/settings.png 450w, https://rublogtrader.rar.su/wp-content/uploads/2020/06/settings-300x155.png 300w" sizes="(max-width: 450px) 100vw, 450px"></p><h2><span id="Ogracenia_akkauntov">Ограчения аккаунтов</span></h2><p>В какой-то момент вы можете решить продать своего советника другим трейдерам. Вы также можете предоставить демо-версию для потенциальных покупателей. Чтобы ваш советник не мог свободно распространяться посторонними лицами, вы должны включить некоторые ограничения учетной записи, которые ограничивают использование советника покупателям или брокером.</p><p>Чтобы ограничить использование советника только для демо-счета, используйте функцию IsDemo(), чтобы проверить, является ли текущий активный аккаунт демо-счетом. Если текущий счет не является демо-счетом, мы выведем предупреждение и остановим выполнение работы советника.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">if</span><span class="br0">(</span>IsDemo<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> <span class="kw2">false</span><span class="br0">)</span> <span class="br0">{</span>Alert<span class="br0">(</span><span class="st0">&quot;Этот советник работает только на демо-аккаунте!&quot;</span><span class="br0">)</span><span class="sy0">;</span><span class="kw1">return</span><span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Вы можете использовать функции учетной записи AccountName(), AccountNumber() и AccountBroker(), чтобы проверить имя учетной записи, номер аккаунта и брокера соответственно. Ограничение использования по номеру счета является распространенным и простым в реализации способом защиты:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">int</span> CustomerAccount <span class="sy0">=</span> <span class="nu0">123456</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>AccountNumber<span class="br0">(</span><span class="br0">)</span> <span class="sy0">!=</span> CustomerAccount<span class="br0">)</span> <span class="br0">{</span>Alert<span class="br0">(</span><span class="st0">&quot;Номер аккаунта не совпадает!&quot;</span><span class="br0">)</span><span class="sy0">;</span><span class="kw1">return</span><span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Вы можете использовать AccountName() или AccountBroker() аналогичным образом. Для AccountBroker() вам сначала нужно использовать Print(), чтобы получить правильное возвращаемое имя брокера. Это значение будет напечатано в журнале экспертов.</p><p>Если вы решили продавать советник на коммерческой основе, имейте в виду, что файлы MQL легко декомпилировать. Существуют различные методы, которые могут использовать хакеры для взлома вашего советника, например, размещение функций во внешних библиотеках или DLL.</p><h2><span id="MessageBox">MessageBox()</span></h2><p>До сих пор в этой книге мы использовали встроенную функцию Alert() для отображения сообщений об ошибках. Но что, если вы хотите настроить диалоги оповещений или запросить ввод данных у пользователя? Функция MessageBox() позволит вам создать собственный всплывающий диалог с помощью Windows API.</p><p>Чтобы использовать функцию MessageBox(), мы должны сначала выполнить #include файл WinUser32.mqh, который устанавливается вместе с MetaTrader. Этот файл импортирует функции из файла Windows user32.dll и определяет константы, необходимые для работы функции MessageBox(). Вот синтаксис функции MessageBox():</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">int</span> MessageBox<span class="br0">(</span>string Text<span class="sy0">,</span> string Title<span class="sy0">,</span> <span class="kw4">int</span> Flags<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Чтобы использовать функцию MessageBox(), мы должны определить текст, который будет отображаться во всплывающем диалоговом окне, а также заголовок, отображаемый в строке заголовка. Нам также нужно будет указать флаги, которые указывают, какие кнопки и значки должны появляться в нашем всплывающем окне. Если флаги не указаны, кнопка ОК будет использоваться по умолчанию. Флаги должны быть разделены символом (|).</p><p>Вот пример окна сообщения с кнопками Да / Нет и значком вопросительного знака:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="co1">// #include &lt;WinUser32.mqh&gt;</span><span class="co1">// start() function</span><span class="kw4">int</span> YesNoBox <span class="sy0">=</span> MessageBox<span class="br0">(</span><span class="st0">&quot;Открыть сделку?&quot;</span><span class="sy0">,</span><span class="st0">&quot;Подтверждение торговли&quot;</span><span class="sy0">,</span>      MB_YESNO<span class="sy0">|</span>MB_ICONQUESTION<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>YesNoBox <span class="sy0">==</span> IDYES<span class="br0">)</span> <span class="br0">{</span>        <span class="co1">// Разместить ордер</span>      <span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Флаг MB_YESNO указывает, что мы будем использовать кнопки «Да / Нет» в нашем окне сообщений, в то время как флаг MB_ICONQUESTION помещает значок вопросительного знака в диалоговом окне. Переменная YesNoBox содержит возвращаемое значение функций MessageBox(), которое будет указывать, какая кнопка была нажата.</p><p>Если кнопка «Да» была нажата, значением YesNoBox будет IDYES, и будет размещен ордер. Если кнопка «Нет» была нажата, флаг возврата будет IDNO. Вы можете использовать возвращаемое значение MessageBox() в качестве входных данных, чтобы определить порядок действий, таких как размещение ордера.</p><p>Ниже приведен неполный список флагов, которые можно использовать в окнах сообщений.</p><h3>Флаги для кнопок</h3><p>Эти флаги указывают, какие кнопки появляются в вашем окне сообщения:</p><ul><li>MB_OKCANCEL — кнопки ОК и Отмена.</li><li>MB_YESNO — кнопки Да и Нет.</li><li>MB_YESNOCANCEL — кнопки Да, Нет и Отмена.</li></ul><h3>Флаги для иконок</h3><p>Эти флаги указывают на значки, которые появляются рядом с текстом в окне сообщения.</p><ul><li>MB_ICONSTOP — значок знака остановки.</li><li>MB_ICONQUESTION — значок знака вопроса.</li><li>MB_ICONEXCLAMATION — значок с восклицательным знаком.</li><li>MB_ICONINFORMATION — информационный значок.</li></ul><h3>Возвращаемые флаги</h3><p>Эти флаги являются возвращаемым значением функции MessageBox() и указывают, какая кнопка была нажата.</p><ul><li>IDOK — нажата кнопка «ОК».</li><li>IDCANCEL — была нажата кнопка «Отмена».</li><li>IDYES — была нажата кнопка «Да».</li><li>IDNO — была нажата кнопка «Нет».</li></ul><h2><span id="Uvedomlenia_po_E-mail">Уведомления по E-mail</span></h2><p>Ваш эксперт может уведомить вас по электронной почте о размещенных сделках, возможных настройках торговли и многом другом. Функция SendMail() отправит электронное письмо с выбранной темой и текстом на адрес электронной почты, указанный в диалоговом окне «Сервис — Параметры» на вкладке «Электронная почта».</p><p>На вкладке «Электронная почта» необходимо сначала указать почтовый сервер SMTP с номером порта, например, mail.yourdomain.com:25, а также имя пользователя и пароль, если это необходимо.</p><p>Вы можете использовать любой адрес электронной почты в поле От. Поле «Кому» — это адрес электронной почты, на который отправляются сообщения.</p><p>Функция SendMail() имеет два аргумента: первый — это строка темы письма, а второй — содержимое самого письма. Вы можете использовать новые строки, экранированные символы, переменные и константы в теле вашего письма.</p><p><img loading="lazy" src="https://rublogtrader.rar.su/wp-content/uploads/2020/06/email-settings.png" alt="настройки e-mail" width="450" height="264" class="alignnone size-full wp-image-14355" srcset="https://rublogtrader.rar.su/wp-content/uploads/2020/06/email-settings.png 450w, https://rublogtrader.rar.su/wp-content/uploads/2020/06/email-settings-300x176.png 300w" sizes="(max-width: 450px) 100vw, 450px"></p><p>Вот пример использования функции SendMail():</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">string EmailSubject <span class="sy0">=</span> <span class="st0">&quot;Ордер на покупку открыт&quot;</span><span class="sy0">;</span>string EmailBody <span class="sy0">=</span> Ордер на покупку <span class="st0">&quot;+Ticket+&quot;</span> открыт на <span class="st0">&quot;+Symbol()+&quot;</span> по цене <span class="st0">&quot;+Ask; // &quot;</span>Ордер на покупку <span class="nu0">12584</span> открыт на EURDUSD по цене <span class="nu16">1.4544</span><span class="st0">&quot;SendMail(EmailSubject,EmailBody);</span></pre></div></div></div></div></div></div></div><h2><span id="Povtor_posle_osibki">Повтор после ошибки</span></h2><p>Мы пытались проверить параметры ордера, прежде чем пытаться разместить ордер, чтобы избежать распространенных сообщений об ошибках из-за неправильных настроек или цены. Тем не менее, ошибки все еще могут возникать, к примеру, из-за реквот или проблем с сервером. Этих ошибок не всегда можно избежать, но мы можем попробовать разместить ордер снова, когда это произойдет.</p><p>Чтобы повторить ордер, мы поместим функцию OrderSend() в цикл while. Если OrderSend() не возвращает номер тикета, мы попробуем открыть ордер еще раз:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">int</span> Ticket <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="kw1">while</span><span class="br0">(</span>Ticket <span class="sy0">&lt;=</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>Ticket <span class="sy0">=</span> OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_BUY<span class="sy0">,</span>LotSize<span class="sy0">,</span>OpenPrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span>BuyStopLoss<span class="sy0">,</span>BuyTakeProfit<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Сначала мы объявляем переменную для номера тикета, в данном случае Ticket. Пока Ticket не больше 0, цикл while с функцией OrderSend() будет выполняться снова и снова.</p><p>В случае ошибки или какой-либо другой неисправленной торговой ошибки, цикл будет повторяться бесконечно, и ваш эксперт будет зависать. Мы можем исправить это, добавив максимальное количество повторов:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">int</span> Retries <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span><span class="kw4">int</span> MaxRetries <span class="sy0">=</span> <span class="nu0">5</span><span class="sy0">;</span><span class="kw4">int</span> Ticket <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="kw1">while</span><span class="br0">(</span>Ticket <span class="sy0">&lt;=</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>Ticket <span class="sy0">=</span> OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_BUY<span class="sy0">,</span>LotSize<span class="sy0">,</span>OpenPrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span>BuyStopLoss<span class="sy0">,</span>BuyTakeProfit<span class="br0">)</span><span class="sy0">;</span>        <span class="kw1">if</span><span class="br0">(</span>Retries <span class="sy0">&lt;=</span> MaxRetries<span class="br0">)</span> Retries<span class="sy0">++;</span><span class="kw1">else</span> <span class="kw2">break</span><span class="sy0">;</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Мы объявляем переменную для использования в качестве счетчика (Retries) и максимальной настройки повторов (MaxRetries). Пока мы не превысили MaxRetries, переменная Retries увеличивается, и цикл повторяется снова. Как только MaxRetries достигнут, цикл завершается. После этого вы можете при необходимости предупредить пользователя об ошибке.</p><p>Если вы хотите сделать цикл повторных попыток зависимым от определенного состояния ошибки, мы можем проверить код ошибки по списку и вернуть значение true, если оно совпадение. Эта функция содержит некоторые распространенные коды ошибок:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">    bool ErrorCheck<span class="br0">(</span><span class="kw4">int</span> ErrorCode<span class="br0">)</span>      <span class="br0">{</span><span class="kw1">switch</span><span class="br0">(</span>ErrorCode<span class="br0">)</span>  <span class="br0">{</span>    <span class="kw1">case</span> <span class="nu0">128</span><span class="sy0">:</span> <span class="co1">// Trade timeout</span>    <span class="kw1">return</span><span class="br0">(</span><span class="kw2">true</span><span class="br0">)</span><span class="sy0">;</span>&nbsp;    <span class="kw1">case</span> <span class="nu0">136</span><span class="sy0">:</span> <span class="co1">// Off quotes</span>    <span class="kw1">return</span><span class="br0">(</span><span class="kw2">true</span><span class="br0">)</span><span class="sy0">;</span>&nbsp;&nbsp;  <span class="kw1">case</span> <span class="nu0">138</span><span class="sy0">:</span> <span class="co1">// Requotes</span>  <span class="kw1">return</span><span class="br0">(</span><span class="kw2">true</span><span class="br0">)</span><span class="sy0">;</span>&nbsp;  <span class="kw1">case</span> <span class="nu0">146</span><span class="sy0">:</span> <span class="co1">// Trade context busy</span>  <span class="kw1">return</span><span class="br0">(</span><span class="kw2">true</span><span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="kw1">default</span><span class="sy0">:</span>  <span class="kw1">return</span><span class="br0">(</span><span class="kw2">false</span><span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Эта функция использует оператор switch. Мы ищем метку, значение которой соответствует выражению, назначенному оператору switch (в данном примере ErrorCode).</p><p>Когда совпадение наблюдений найдено, блок switch должен быть завершен с оператором прерывания или возврата. В этом примере мы используем оператор return для возврата значения true / false вызывающей функции.</p><p>Вот как мы используем ErrorCheck(), чтобы повторить попытку размещения ордера:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">int</span> Retries<span class="sy0">;</span><span class="kw4">int</span> MaxRetries <span class="sy0">=</span> <span class="nu0">5</span><span class="sy0">;</span><span class="kw4">int</span> Ticket<span class="sy0">;</span> <span class="kw1">while</span><span class="br0">(</span>Ticket <span class="sy0">&lt;=</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>Ticket <span class="sy0">=</span> OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_BUY<span class="sy0">,</span>LotSize<span class="sy0">,</span>OpenPrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span>BuyStopLoss<span class="sy0">,</span>BuyTakeProfit<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>Ticket <span class="sy0">==</span> <span class="sy0">-</span><span class="nu0">1</span><span class="br0">)</span> <span class="kw4">int</span> ErrCode <span class="sy0">=</span> GetLastError<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>Retries <span class="sy0">&lt;=</span> MaxRetries <span class="sy0">&amp;&amp;</span> ErrorCheck<span class="br0">(</span>ErrCode<span class="br0">)</span> <span class="sy0">==</span> <span class="kw2">true</span><span class="br0">)</span> Retries<span class="sy0">++;</span> <span class="kw1">else</span> <span class="kw2">break</span><span class="sy0">;</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Если Ticket возвращает -1, указывая на то, что произошла ошибка, мы получаем код ошибки с помощью GetLastError(). Мы передаем код ошибки в нашу функцию ErrorCheck(). Если код ошибки соответствует какой-либо из ошибок в функции проверки ошибок, ErrorCheck() вернет true, а функция OrderSend() будет повторена до 5 раз.</p><h2><span id="Ispolzovanie_kommentariev_k_orderu_v_kacestve_identifikatora">Использование комментариев к ордеру в качестве идентификатора</span></h2><p>Мы использовали «магическое число» в качестве идентификатора ордера, который однозначно идентифицирует ордера, размещаемые конкретным советником. Если ваш эксперт размещает несколько ордеров одновременно, и вы хотите иметь возможность обрабатывать каждый из этих ордеров, вы можете использовать комментарий к ордеру в качестве необязательного идентификатора.</p><p>Допустим, ваш эксперт разместит два типа ордеров. Вы хотите иметь возможность изменить или закрыть эти ордера по отдельности. Вы можете использовать две функции OrderSend() и разместить разные комментарии к каждому из них. Затем, при выборе ордеров с использованием цикла, вы можете использовать OrderComment() в качестве одного из условий для нахождения ордеров для их изменения или закрытия.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">string OrderComment1 <span class="sy0">=</span> <span class="st0">&quot;Первый ордер&quot;</span><span class="sy0">;</span> string OrderComment2 <span class="sy0">=</span> <span class="st0">&quot;Второй ордер&quot;</span><span class="sy0">;</span>&nbsp;<span class="co1">// Размещение ордеров</span><span class="kw4">int</span> Ticket1 <span class="sy0">=</span> OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_BUY<span class="sy0">,</span>LotSize<span class="sy0">,</span>OpenPrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span>BuyStopLoss<span class="sy0">,</span>BuyTakeProfit<span class="sy0">,</span>OrderComment1<span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Green<span class="br0">)</span><span class="sy0">;</span><span class="kw4">int</span> Ticket2 <span class="sy0">=</span> OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_BUY<span class="sy0">,</span>LotSize<span class="sy0">,</span>OpenPrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span>BuyStopLoss<span class="sy0">,</span>BuyTakeProfit<span class="sy0">,</span>OrderComment2<span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Green<span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Изменение ордера</span><span class="kw1">for</span><span class="br0">(</span><span class="kw4">int</span> Counter <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> Counter <span class="sy0">&lt;=</span> OrdersTotal<span class="br0">(</span><span class="br0">)</span><span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span> Counter<span class="sy0">++</span><span class="br0">)</span> <span class="br0">{</span>OrderSelect<span class="br0">(</span>Counter<span class="sy0">,</span>SELECT_BY_POS<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>OrderMagicNumber<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> MagicNumber <span class="sy0">&amp;&amp;</span> OrderSymbol<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> Symbol<span class="br0">(</span><span class="br0">)</span> <span class="sy0">&amp;&amp;</span> OrderComment<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OrderComment1<span class="br0">)</span><span class="br0">{</span>             <span class="co1">// Изменение первого ордера</span>          <span class="br0">}</span><span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>OrderMagicNumber<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> MagicNumber <span class="sy0">&amp;&amp;</span> OrderSymbol<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> Symbol<span class="br0">(</span><span class="br0">)</span> <span class="sy0">&amp;&amp;</span> OrderComment<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OrderComment2<span class="br0">)</span><span class="br0">{</span>             <span class="co1">// Изменение второго ордера</span>          <span class="br0">}</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Мы объявляем две строковые переменные для использования в качестве комментариев к ордеру. Функции OrderSend() размещают два ордера, каждый со своим комментарием. В следующем примере цикла модификации ордеров функция OrderComment() используется в качестве условия при выборе ордеров для модификации.</p><p>Вы можете использовать проверку OrderComment(), чтобы закрывать ордера независимо от других ордеров, использовать другие настройки трейлинг-стопа или что-либо другое, что требует ваша торговая система.</p><div class='code-block code-block-center code-block-4 ai-viewport-3'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader2" rel="nofollow" target="_blank"><img src="/b/pamm_landing_banner_300x250_ru_.gif"/></a></div><div class='code-block code-block-center code-block-8 ai-viewport-1'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader2" rel="nofollow" target="_blank"><img src="https://advertising-blog.qqit.ru/rublogtrader.rar.su/pamm_landing_banner_970x250_ru_1.gif"/></a></div><h2><span id="Proverka_marzinalnyh_trebovanij">Проверка маржинальных требований</span></h2><p>MetaTrader поставляется с функциями, которые позволяют вам проверить текущую свободную маржу или уровень стопов перед размещением ордера. Уровень Stop Out — это процент или сумма свободной маржи, ниже которой вы не сможете размещать ордера. Однако ручная проверка уровня свободной маржи или уровня стоп-ордера на самом деле не нужна, поскольку при попытке разместить ордер с слишком малым запасом маржипроизойдет ошибка.</p><p>Более полезная идея — определить собственный уровень стоп-аута и прекратить торговлю, если текущий капитал опустится ниже этого уровня. Давайте начнем с объявления внешней переменной MinimumEquity, которая является минимальной суммой капитала, необходимой на нашем счете, прежде чем мы сможем разместить ордер.</p><p>Мы сравним MinimumEquity с нашим текущим счетом. Если текущий эквити меньше нашего минимального эквити, ордер не будет размещен, и предупреждающее сообщение проинформирует пользователя о состоянии. Предположим, у нас есть баланс на счете 10000 долларов. Если мы потеряем более 20% этого капитала, мы не будет размещать ордера. Вот код для проверки минимального эквити:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="co1">// Внешние переменные</span><span class="kw2">extern</span> <span class="kw4">int</span> MinimumEquity <span class="sy0">=</span> <span class="nu0">8000</span><span class="sy0">;</span>&nbsp;    <span class="co1">// Размещение ордера</span>    <span class="kw1">if</span><span class="br0">(</span>AccountEquity<span class="br0">(</span><span class="br0">)</span> <span class="sy0">&gt;</span> MinimumEquity<span class="br0">)</span>      <span class="br0">{</span>        <span class="co1">// Открываем ордер</span><span class="br0">}</span><span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>AccountEquity<span class="br0">(</span><span class="br0">)</span> <span class="sy0">&lt;=</span> MinimumEquity<span class="br0">)</span><span class="br0">{</span>Alert<span class="br0">(</span><span class="st0">&quot;Размер эквити слишком низкий!&quot;</span><span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Внешняя переменная MinimumEquity помещается в начало файла. Если текущий капитал, как указано AccountEquity(), больше MinimumEquity, ордер будет размещен. В противном случае заказ не будет размещен, и будет отображено предупреждающее сообщение.</p><h2><span id="Proverka_spreda">Проверка спреда</span></h2><p>Возможно, вы захотите избегать размещения ордеров в периоды, когда спред значительно расширяется. Мы можем установить максимальный спред и проверить текущий спред перед торговлей. Мы объявим внешнюю переменную MaximumSpread и используем MarketInfo() для проверки текущего спреда.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">    <span class="co1">// внешние переменные</span><span class="kw2">extern</span> <span class="kw4">int</span> MaximumSpread <span class="sy0">=</span> <span class="nu0">5</span><span class="sy0">;</span><span class="kw2">extern</span> <span class="kw4">int</span> MinimumEquity <span class="sy0">=</span> <span class="nu0">8000</span><span class="sy0">;</span>&nbsp;<span class="kw1">if</span><span class="br0">(</span>AccountEquity<span class="br0">(</span><span class="br0">)</span> <span class="sy0">&gt;</span> MinimumEquity <span class="sy0">&amp;&amp;</span> MarketInfo<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MODE_SPREAD<span class="br0">)</span> <span class="sy0">&lt;</span> MaximumSpread<span class="br0">)</span> <span class="br0">{</span>        <span class="co1">// Place order</span>      <span class="br0">}</span><span class="kw1">else</span> <span class="br0">{</span><span class="br0">}</span><span class="kw1">if</span><span class="br0">(</span>AccountEquity<span class="br0">(</span><span class="br0">)</span> <span class="sy0">&lt;=</span> MinimumEquity<span class="br0">)</span> Alert<span class="br0">(</span><span class="st0">&quot;Размер эквити ниже минимального!&quot;</span><span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>MarketInfo<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MODE_SPREAD<span class="br0">)</span> <span class="sy0">&gt;</span> MaximumSpread<span class="br0">)</span> Alert<span class="br0">(</span><span class="st0">&quot;Размер спреда слишком большой!&quot;</span><span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Обратите внимание, что мы выполняем проверку минимального эквити и спреда перед размещением ордера. Если одно из условий ложно, мы переходим в блок else и проверяем, какое из условий привело к тому, что ордер не был размещен. Мы будем отображать одно или несколько предупреждений в зависимости от того, какое условие выполняется.</p><h2><span id="Razmesenie_neskolkih_orderov">Размещение нескольких ордеров</span></h2><p>Вы можете разместить несколько ордеров с разными уровнями стоп-лосс и тейк-профит, а также размерами лота. Есть несколько способов сделать это. Один из способов — просто использовать разные операторы OrderSend() для каждого ордера. Это предполагает, что вы планируете размещать одинаковое количество ордеров каждый раз.</p><p>Другой способ — использовать цикл for для размещения заказов. Таким образом, вы можете настроить несколько ордеров одновременно. Вы можете предварительно загрузить свой стоп-лосс и тейк-профит в массивы, а также увеличивать их в циклах for.</p><p>Начнем с определения внешних переменных для трех уровней стоп-лосс и тейк-профит. Любые дополнительные ордера выше трех не будут иметь стоп-лосс или тейк-профит. Мы также добавим внешнюю переменную, чтобы настроить количество размещаемых ордеров.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw2">extern</span> <span class="kw4">int</span> StopLoss1 <span class="sy0">=</span> <span class="nu0">20</span><span class="sy0">;</span> <span class="kw2">extern</span> <span class="kw4">int</span> StopLoss2 <span class="sy0">=</span> <span class="nu0">40</span><span class="sy0">;</span> <span class="kw2">extern</span> <span class="kw4">int</span> StopLoss3 <span class="sy0">=</span> <span class="nu0">60</span><span class="sy0">;</span>&nbsp;<span class="kw2">extern</span> <span class="kw4">int</span> TakeProfit1 <span class="sy0">=</span> <span class="nu0">40</span><span class="sy0">;</span> <span class="kw2">extern</span> <span class="kw4">int</span> TakeProfit2 <span class="sy0">=</span> <span class="nu0">80</span><span class="sy0">;</span> <span class="kw2">extern</span> <span class="kw4">int</span> TakeProfit3 <span class="sy0">=</span> <span class="nu0">120</span><span class="sy0">;</span>&nbsp;<span class="kw2">extern</span> <span class="kw4">int</span> MaxOrders <span class="sy0">=</span> <span class="nu0">3</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Далее мы объявим наши массивы, рассчитаем стоп-лосс и тейк-профит и загрузим рассчитанные цены в массив:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">double</span> BuyTakeProfit<span class="br0">[</span><span class="nu0">3</span><span class="br0">]</span><span class="sy0">;</span><span class="kw4">double</span> BuyStopLoss<span class="br0">[</span><span class="nu0">3</span><span class="br0">]</span><span class="sy0">;</span>&nbsp;BuyTakeProfit<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">=</span> CalcBuyTakeProfit<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>TakeProfit1<span class="sy0">,</span>Ask<span class="br0">)</span><span class="sy0">;</span> BuyTakeProfit<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> <span class="sy0">=</span> CalcBuyTakeProfit<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>TakeProfit2<span class="sy0">,</span>Ask<span class="br0">)</span><span class="sy0">;</span> BuyTakeProfit<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span> <span class="sy0">=</span> CalcBuyTakeProfit<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>TakeProfit3<span class="sy0">,</span>Ask<span class="br0">)</span><span class="sy0">;</span>&nbsp;BuyStopLoss<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">=</span> CalcBuyStopLoss<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>StopLoss1<span class="sy0">,</span>Ask<span class="br0">)</span><span class="sy0">;</span> BuyStopLoss<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span> <span class="sy0">=</span> CalcBuyStopLoss<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>StopLoss2<span class="sy0">,</span>Ask<span class="br0">)</span><span class="sy0">;</span> BuyStopLoss<span class="br0">[</span><span class="nu0">2</span><span class="br0">]</span> <span class="sy0">=</span> CalcBuyStopLoss<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>StopLoss3<span class="sy0">,</span>Ask<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Мы начнем с объявления массивов для хранения стоп-лосса и тейк-профита, BuyTakeProfit и BuyStopLoss. Количество элементов массива должно быть указано при объявлении массива. Индексы массива начинаются с нуля, поэтому, объявив размер измерения массива 3, наш начальный индекс равен 0, а наш самый большой индекс равен 2.</p><p>Далее мы рассчитываем цены стоп-лосс и тейк-профит, используя функции CalcBuyStopLoss() и CalcBuyTakeProfit(). Мы присваиваем рассчитанный стоп-лосс или тейк-профит соответствующему элементу массива. Обратите внимание, что первый индекс массива равен 0, а третий индекс массива равен 2.</p><p>Вот цикл for для размещения ордеров:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">for</span><span class="br0">(</span><span class="kw4">int</span> Count <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> Count <span class="sy0">&lt;=</span> MaxOrders <span class="sy0">-</span> <span class="nu0">1</span><span class="sy0">;</span> Count<span class="sy0">++</span><span class="br0">)</span> <span class="br0">{</span><span class="kw4">int</span> OrdInt <span class="sy0">=</span> Count <span class="sy0">+</span> <span class="nu0">1</span><span class="sy0">;</span>OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_BUY<span class="sy0">,</span>LotSize<span class="sy0">,</span>Ask<span class="sy0">,</span>UseSlippage<span class="sy0">,</span>BuyStopLoss<span class="br0">[</span>Count<span class="br0">]</span><span class="sy0">,</span> BuyTakeProfit<span class="br0">[</span>Count<span class="br0">]</span><span class="sy0">,</span><span class="st0">&quot;Buy Order &quot;</span><span class="sy0">+</span>OrdInt<span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Green<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Переменная Count начинается с 0 и соответствует первому элементу массива. Количество циклов (т.е. количество размещаемых ордеров) определяется MaxOrders — 1. Для каждой итерации цикла мы увеличиваем стоп-лосс и тейк-профит на единицу.</p><p>Мы используем переменную OrdInt для увеличения количества ордеров в комментарии к ордеру. Первым комментарием к ордеру будет «Ордер на покупку 1», следующим будет «Ордер на покупку 2» и так далее. Функция OrderSend() размещает ордер с соответствующим стоп-лоссом и значением тейк-профита, используя переменную Count для выбора соответствующего элемента массива.</p><p>Это всего лишь один из способов обработки нескольких ордеров. Основным недостатком этого подхода является то, что мы можем рассчитывать только стоп-лосс и тейк-профит цены для ограниченного числа ордеров. Кроме того, мы можем масштабировать значения тейк-профита и стоп-лосса на указанную сумму и размещать потенциально неограниченное количество ордеров:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw2">extern</span> <span class="kw4">int</span> StopLossStart <span class="sy0">=</span> <span class="nu0">20</span><span class="sy0">;</span> <span class="kw2">extern</span> <span class="kw4">int</span> StopLossIncr <span class="sy0">=</span> <span class="nu0">20</span><span class="sy0">;</span><span class="kw2">extern</span> <span class="kw4">int</span> TakeProfitStart <span class="sy0">=</span> <span class="nu0">40</span><span class="sy0">;</span> <span class="kw2">extern</span> <span class="kw4">int</span> TakeProfitIncr <span class="sy0">=</span> <span class="nu0">40</span><span class="sy0">;</span><span class="kw2">extern</span> <span class="kw4">int</span> MaxOrders <span class="sy0">=</span> <span class="nu0">5</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>В приведенном выше примере стоп-лосс для нашего первого ордера составит 20 пунктов. Мы будем увеличивать стоп-лосс на 20 пунктов за каждый дополнительный ордер. То же самое для тейк-профита, за исключением того, что мы начнем с 40 и увеличиваем на 40. Вместо использования массивов мы рассчитаем стоп-лосс и тейк-профит в цикле for:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">for</span><span class="br0">(</span><span class="kw4">int</span> Count <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> Count <span class="sy0">&lt;=</span> MaxOrders <span class="sy0">-</span> <span class="nu0">1</span><span class="sy0">;</span> Count<span class="sy0">++</span><span class="br0">)</span> <span class="br0">{</span><span class="kw4">int</span> OrdInt <span class="sy0">=</span> Count <span class="sy0">+</span> <span class="nu0">1</span><span class="sy0">;</span>&nbsp;<span class="kw4">int</span> UseStopLoss <span class="sy0">=</span>  StopLossStart <span class="sy0">+</span> <span class="br0">(</span>StopLossIncr <span class="sy0">*</span> Count<span class="br0">)</span><span class="sy0">;</span> <span class="kw4">int</span> UseTakeProfit <span class="sy0">=</span>  TakeProfitStart <span class="sy0">+</span> <span class="br0">(</span>TakeProfitIncr <span class="sy0">*</span> Count<span class="br0">)</span><span class="sy0">;</span><span class="kw4">double</span> BuyStopLoss <span class="sy0">=</span> CalcBuyStopLoss<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>UseStopLoss<span class="sy0">,</span>Ask<span class="br0">)</span><span class="sy0">;</span> <span class="kw4">double</span> BuyTakeProfit <span class="sy0">=</span> CalcBuyTakeProfit<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>UseTakeProfit<span class="sy0">,</span>Ask<span class="br0">)</span><span class="sy0">;</span>OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_BUY<span class="sy0">,</span>LotSize<span class="sy0">,</span>Ask<span class="sy0">,</span>UseSlippage<span class="sy0">,</span>BuyStopLoss<span class="sy0">,</span> BuyTakeProfit<span class="sy0">,</span><span class="st0">&quot;Buy Order &quot;</span><span class="sy0">+</span>OrdInt<span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Green<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Мы определяем уровень тейк-профита и стоп-лосса в пунктах, умножая переменную StopLossIncr или TakeProfitIncr на значение Count и добавляя его к значению StopLossStart или TakeProfitStart. Для первого ордера уровень стоп-лосса или тейк-профита будет равен StopLossStart или TakeProfitStart.</p><p>Далее мы рассчитываем стоп-лосс и цену тейк-профита для ордера. Наконец, мы размещаем ордер с помощью OrderSend().</p><p>Цикл продолжится до открытия количества ордеров, указанных в MaxOrders. Этот метод позволяет нам указать столько ордеров, сколько мы хотим, используя переменную MaxOrders, гарантируя, что каждый размещаемый нами ордер будет иметь стоп-лосс и тейк-профит.</p><h2><span id="Globalnye_peremennye">Глобальные переменные</span></h2><p>В этой книге мы упоминаем переменные с глобальной областью действия как «глобальные переменные». MetaTrader имеет набор функций для установки переменных на уровне терминала, что означает, что эти переменные доступны каждому работающему в данный момент советнику, при условии, что мы знаем имя переменной.</p><p>Текущий список глобальных переменных в терминале можно просмотреть, выбрав «Глобальные переменные» в меню «Инструменты» или нажав клавишу F3 на клавиатуре.</p><p>Одним из способов использования этих переменных является сохранение определенных глобальных или статических переменных в терминале, чтобы, если советник был закрыт, мы могли продолжить работу с того места, где остановились. Не все советники требуют этого, но более сложные советники будут поддерживать определенное состояние, которое, в случае прерывания, приведет к отказу в работе советника.</p><p>Лучший способ предотвратить это — избегать создания советников, требующих такого уровня сложности. Но если этого нельзя избежать, то использование функций глобальных переменных для сохранения текущего состояния в терминале может быть полезным в случае отключения.</p><p>Чтобы объявить глобальную переменную, используйте функцию GlobalVariableSet(). Первый аргумент — это строка, обозначающая имя глобальной переменной, а второй аргумент — это значение типа double, присваиваемое ей.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">GlobalVariableSet<span class="br0">(</span>GlobalVariableName<span class="sy0">,</span>DoubleValue<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Чтобы ваши имена переменных были уникальными, вы можете создать префикс глобальной переменной. Объявите глобальную переменную в своем эксперте и установите значение в функции init(), используя текущий символ, точку, имя советника и магический номер, чтобы создать уникальный префикс переменной.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">  <span class="co1">// Глобальные переменные</span>    string GlobalVariablePrefix<span class="sy0">;</span><span class="kw4">int</span> init<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>GlobalVariablePrefix <span class="sy0">=</span> Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">+</span>Period<span class="br0">(</span><span class="br0">)</span><span class="sy0">+</span><span class="st0">&quot;_&quot;</span><span class="sy0">+</span><span class="st0">&quot;ProfitBuster&quot;</span><span class="sy0">+</span><span class="st0">&quot;_&quot;</span><span class="sy0">+</span>MagicNumber<span class="sy0">+</span><span class="st0">&quot;_&quot;</span><span class="sy0">;</span> <span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Мы используем текущий символ и период, а также идентификатор советника и внешнюю переменную MagicNumber. Теперь, когда мы устанавливаем глобальную переменную с помощью GlobalVariableSet(), мы используем префикс, который мы определили выше вместе с фактическим именем переменной:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">GlobalVariableSet<span class="br0">(</span>GlobalVariablePrefix<span class="sy0">+</span>Counter<span class="sy0">,</span>Counter<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Поэтому, если мы торгуем на EURUSD на таймфрейме M15 с советником с именем «ProfitBuster», используя 11 в качестве магического числа и Counter в качестве имени переменной, именем нашей глобальной переменной будет EURUSD15_ProfitBuster_11_Counter.</p><p>Чтобы получить значение глобальной переменной, используйте функцию GlobalVariableGet() с именем переменной в качестве аргумента:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">Counter <span class="sy0">=</span> GlobalVariableGet<span class="br0">(</span>GlobalVariablePrefix<span class="sy0">+</span>Counter<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Чтобы удалить глобальную переменную, используйте функцию GlobalVariableDel() с именем переменной в качестве аргумента. Чтобы удалить все глобальные переменные, размещенные вашим советником, используйте функцию GlobalVariableDeleteAll() с префиксом в качестве аргумента.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">    GlobalVariableDel<span class="br0">(</span>GlobalVariablePrefix<span class="sy0">+</span>Counter<span class="br0">)</span><span class="sy0">;</span>    GlobalVariableDeleteAll<span class="br0">(</span>GlobalVariablePrefix<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><h2><span id="Proverka_pribyli_ordera">Проверка прибыли ордера</span></h2><p>Иногда может быть полезно проверить текущую прибыль по ордеру или проверить общую прибыль по ордеру, который уже закрыт. Есть два способа проверить прибыль. Чтобы получить прибыль в валюте депозита, используйте функцию OrderProfit(). Сначала вы должны выбрать ордер, используя OrderSelect().</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">OrderSelect<span class="br0">(</span>Ticket<span class="sy0">,</span>SELECT_BY_TICKET<span class="br0">)</span><span class="sy0">;</span> <span class="kw4">double</span> GetProfit <span class="sy0">=</span> OrderProfit<span class="br0">(</span>Ticket<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Результат функции OrderProfit() должен совпадать с общей прибылью или убытком, который указан в истории для выбранного ордеров.</p><p>Чтобы получить прибыль или убыток в пунктах, вам необходимо рассчитать разницу между ценой открытия ордера и ценой закрытия ордера. Вам также нужно будет использовать функцию OrderSelect() для получения цен открытия и закрытия.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">OrderSelect<span class="br0">(</span>Ticket<span class="sy0">,</span>SELECT_BY_TICKET<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_BUY<span class="br0">)</span> <span class="kw4">double</span> GetProfit <span class="sy0">=</span> OrderClosePrice<span class="br0">(</span><span class="br0">)</span> <span class="sy0">-</span> OrderOpenPrice<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_SELL<span class="br0">)</span> GetProfit <span class="sy0">=</span> OrderOpenPrice<span class="br0">(</span><span class="br0">)</span> <span class="sy0">-</span> OrderClosePrice<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>GetProfit <span class="sy0">/=</span> PipPoint<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Для заявок на покупку мы рассчитываем прибыль, вычитая цену открытия из цены закрытия. Для ордеров на продажу мы делаем наоборот. После того, как мы вычислили разницу, мы можем преобразовать прибыль или убыток в целое число, разделив его на пункт, используя нашу функцию PipPoint().</p><p>Например, если цена открытия ордера на покупку составляет 1,4650, а цена закрытия — 1,4700, разница между OrderClosePrice() и OrderOpenPrice() составляет 0,0050. Когда мы делим это на нашу функцию PipPoint(), результат равен 50. Таким образом, для этого ордера мы получаем 50 пунктов прибыли. Если бы цена закрытия ордера была 1.4600, то мы бы потеряли 50 пунктов.</p><h2><span id="Martingejl">Мартингейл</span></h2><p>Мартингейл — это система ставок, обычно используемая в рулетке и блэкджеке, где размер ставки удваивается после каждого последовательного проигрыша. Теория состоит в том, что одна выигрышная ставка вернет наш баланс к безубыточности. Недостатком мартингейла является то, что вам потребуется большой размер капитала, чтобы выдержать просадки.</p><p>Например, если размер вашего начального лота составляет 0,1 лота, то после 4 последовательных потерь ваш размер лота составит 1,6 лота — в 16 раз больше исходного размера лота. После 7 последовательных проигрышей размер вашего лота составит 12,8 лота — в 128 раз больше исходного размера лота! Долгая полоса неудач может легко уничтожить ваш аккаунт, прежде чем вы сможете вернуть его в безубыточность.</p><p>Тем не менее, вы можете включить систему увеличения размера лота при последовательных выигрышах или проигрышах, и это можно сделать, не уничтожая свой счет. Самый простой способ — установить ограничение на количество раз, чтобы увеличить размер лота. Надежная торговая система не должна иметь более 3 или 4 максимальных последовательных убытков. Вы можете определить это, изучив максимальное количество последовательных потерь на вкладке «Отчет» в окне «Тестер стратегий».</p><p>Другой способ — увеличить размер вашего лота на меньший множитель. Классическая стратегия Мартингейла удваивает размер лота после каждого последующего проигрыша. Возможно, вы захотите использовать множитель меньше 2. Существует также стратегия анти-мартингейл, где вы увеличиваете размер лота после каждого последовательного выигрыша.</p><p>Стратегия Мартингейла работает лучше всего, когда вы размещаете один ордер за раз, поэтому мы будем предполагать, что каждая позиция состоит из одной сделки.</p><p>Пользователь сможет выбирать между стратегией Мартингейл (проигрыш) или Анти-Мартингейл (выигрыш). Будет включена настройка ограничения максимального количества последовательных увеличений лота, и множитель лота будет настраиваться.</p><p>Сначала посчитаем количество последовательных побед или проигрышей. Нам нужно будет перебрать пул истории ордеров в обратном порядке, начиная с самого последнего закрытого ордера. Мы будем увеличивать счетчик для каждого выигрыша или проигрыша. Пока сохраняется схема последовательных выигрышей или проигрышей, мы продолжим цикл. Как только паттерн нарушается (выигрыш определяется после одного или нескольких проигрышей или наоборот), цикл завершается.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">int</span> WinCount<span class="sy0">;</span><span class="kw4">int</span> LossCount<span class="sy0">;</span><span class="kw1">for</span><span class="br0">(</span><span class="kw4">int</span> Count <span class="sy0">=</span> OrdersHistoryTotal<span class="br0">(</span><span class="br0">)</span><span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span> <span class="sy0">;</span> Count<span class="sy0">--</span><span class="br0">)</span> <span class="br0">{</span>OrderSelect<span class="br0">(</span>Count<span class="sy0">,</span>SELECT_BY_POS<span class="sy0">,</span>MODE_HISTORY<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>OrderSymbol<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> Symbol<span class="br0">(</span><span class="br0">)</span> <span class="sy0">&amp;&amp;</span> OrderMagicNumber<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> MagicNumber<span class="br0">)</span> <span class="br0">{</span><span class="kw1">if</span><span class="br0">(</span>OrderProfit<span class="br0">(</span><span class="br0">)</span> <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> LossCount <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span> WinCount<span class="sy0">++;</span><span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>OrderProfit<span class="br0">(</span><span class="br0">)</span> <span class="sy0">&lt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> WinCount <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span> LossCount<span class="sy0">++;</span> <span class="kw1">else</span> <span class="kw2">break</span><span class="sy0">;</span><span class="br0">}</span> <span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Мы начнем с объявления переменных для счетчиков выигрышей и проигрышей. Обратите внимание, что в операторе for мы используем OrdersHistoryTotal() для определения начальной позиции. OrdersHistoryTotal() возвращает количество ордеров в пуле истории. Вычитаем 1, чтобы определить позицию индекса для самого последнего ордера, который хранится в переменной Count.</p><p>Обратите внимание, что мы пропустили второе выражение в цикле for — то, которое определяет условие прекращения цикла. Мы будем уменьшать переменную Count на каждой итерации цикла.</p><p>Мы используем MODE_HISTORY в качестве третьего аргумента в функции OrderSelect(), чтобы указать, что мы перебираем закрытый пул истории ордеров. По умолчанию OrderSelect() использует пул открытых ордеров, поэтому мы должны указать MODE_HISTORY при проверке пула закрытых ордеров.</p><p>Мы проверяем, что текущий выбранный ордер соответствует нашему символу графика и нашему магическому номеру. Затем мы проверяем прибыль по ордеру с помощью функции OrderProfit(). Если возвращаемое значение указывает на прибыль (то есть больше нуля), то мы увеличиваем переменную WinCount. Если это потеря, мы увеличиваем LossCount.</p><p>Поскольку мы ищем последовательные выигрыши или проигрыши, нам нужно завершить цикл, как только будет найдено альтернативное условие. Для этого мы проверяем переменную WinCount или LossCount при проверке прибыли ордера.</p><p>Например, если у нас есть 2 последовательных убытка — это означает, что LossCount = 2 — и наш следующий ордер будет выигрышным, тогда оба наших оператора if будут ложными, и управление перейдет к оператору break, который завершит цикл.</p><p>Преимущество этого метода в том, что он не подведет, если советник случайно отключится. Советник продолжит свою работу прямо там, где остановился. Конечно, это означает, что при первом запуске советника он будет использовать любую предыдущую серию выигрышей / проигрышей при определении размера лота. Но, как вы можете видеть, преимущества перевешивают недостатки.</p><p>Переменная WinCount или LossCount будет содержать количество последовательных выигрышей или проигрышей. Если мы хотим реализовать стратегию Мартингейла, мы используем LossCount, чтобы определить фактор, с помощью которого можно увеличить размер лота. Если мы делаем анти-Мартингейл, вместо этого мы используем WinCount.</p><p>Мы будем использовать внешнюю целочисленную переменную с именем MartingaleType. Если MartingaleType установлен в 0, мы будем использовать стратегию Martingale. Если установлено значение 1, мы будем использовать стратегию анти-мартингейла.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="co1">// Внешние переменные</span><span class="kw2">extern</span> <span class="kw4">int</span> MartingaleType <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="co1">// 0: Martingale, 1: Anti-Martingale</span><span class="kw2">extern</span> <span class="kw4">int</span> LotMultiplier <span class="sy0">=</span> <span class="nu0">2</span><span class="sy0">;</span> <span class="kw2">extern</span> <span class="kw4">int</span> MaxMartingale <span class="sy0">=</span> <span class="nu0">4</span><span class="sy0">;</span> <span class="kw2">extern</span> <span class="kw4">double</span> BaseLotSize <span class="sy0">=</span> <span class="nu16">0.1</span><span class="sy0">;</span>&nbsp;<span class="co1">// Расчет размера лота</span><span class="kw1">if</span><span class="br0">(</span>MartingaleType <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">int</span> ConsecutiveCount <span class="sy0">=</span> LossCount<span class="sy0">;</span> <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>MartingaleType <span class="sy0">=</span> <span class="nu0">1</span><span class="br0">)</span> ConsecutiveCount <span class="sy0">=</span> WinCount<span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>ConsecutiveCount <span class="sy0">&gt;</span> MaxMartingale<span class="br0">)</span> ConsecutiveCount <span class="sy0">=</span> MaxMartingale<span class="sy0">;</span> <span class="kw4">double</span> LotSize <span class="sy0">=</span> BaseLotSize <span class="sy0">*</span> MathPow<span class="br0">(</span>LotMultiplier<span class="sy0">,</span>ConsecutiveCount<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Мы устанавливаем значение ConsecutiveCount либо в WinCount, либо в LossCount, в зависимости от настройки MartingaleType. Мы сравним это с нашей настройкой MaxMartingale. Если количество наших последовательных ордеров больше, чем MaxMartingale, мы изменим его размер, чтобы он был равен MaxMartingale. (Вы также можете изменить его размер до размера лота по умолчанию, если хотите). Размер лота будет оставаться на этом размере до тех пор, пока выигрыш или проигрыш не нарушат нашу последовательную серию ордеров.</p><p>Размер лота определяется умножением нашего BaseLotSize на LotMultiplier, который экспоненциально увеличивается на ConsecutiveCount. Функция MathPow() увеличивает число до указанной степени. Например, если размер нашего начального лота равен 0,1, множитель лота равен 2, и у нас есть четыре последовательных ордера, уравнение равно 0,1 * 24 = 1,6.</p><p>Настраивая LotMultiplier и используя стратегии как Мартингейл, так и Анти-Мартингейл, это даст вам достаточно возможностей для экспериментов с использованием экспоненциального размера лотов. Вы можете легко изменить код выше, чтобы использовать другие варианты. Например, вы можете масштабировать размеры лотов в обратном порядке, от самого большого до самого маленького. Или вы можете использовать внешний счетчик вместо ConsecutiveCount.</p><h2><span id="Otladka_raboty_vasego_sovetnika">Отладка работы вашего советника</span></h2><p>В отличие от большинства программных средств разработки, MetaEditor не поддерживает современные методы отладки. Поэтому вам придется использовать операторы Print() и журнал для отладки ваших экспертов.</p><p>Распечатав содержимое переменных и функций в журнал, вы можете проверить вывод вашего кода и исправить любые ошибки.</p><p>Вы можете использовать Тестер стратегий, чтобы запустить симуляцию торговли и проверить вывод логов. Журнал тестера стратегий отображается на вкладке «Журнал» в окне «Тестер стратегий». Существует ограничение на количество информации, которая указана на вкладке Журнал, поэтому вы можете захотеть просмотреть реальный журнал.</p><p>Журналы тестера стратегий хранятся в папке \tester\logs. Щелкните правой кнопкой мыши в любом месте окна журнала и выберите «Открыть» во всплывающем меню. Откроется окно проводника Windows, отображающее содержимое папки журнала. Имена файлов имеют формат yyyymmdd.log, где yyyy — год из четырех цифр, mm — месяц из двух цифр, а dd — дата из двух цифр. Вы можете просматривать журналы в блокноте или любом текстовом редакторе.</p><p>Давайте проиллюстрируем пример того, как вы можете использовать журнал, чтобы найти проблему. В приведенном ниже коде есть ошибка, и она не работает так, как мы ожидали. Чтобы иметь возможность диагностировать проблему, нам нужно проверить ввод или вывод функции. Давайте создадим оператор Print() и напечатаем содержимое всех соответствующих переменных в журнале.</p><p>Мы запустим советника в тестере стратегий, используя цены открытия в качестве модели тестирования. Убедитесь, что вы тестируете советника в течение достаточно длительного периода времени, чтобы он разместил достаточно сделок для анализа. Если вам нужно проверить цены на графике, нажмите кнопку «Открыть график», чтобы открыть график, показывающий симулированные сделки.</p><p>Далее мы перейдем на вкладку «Журнал» и проверим, какая информация нам нужна. Если нам нужно просмотреть весь журнал или если на вкладке «Журнал» не отображаются сделки, мы можем щелкнуть правой кнопкой мыши и выбрать «Открыть» во всплывающем меню, а затем напрямую открыть файл журнала.</p><p>Этот код дает нам ошибку 130: «недействительные стопы» каждый раз, когда мы размещаем заказ на покупку. Мы знаем, что ошибка 130 означает, что либо стоп-лосс, либо тейк-профит неверны.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">if</span><span class="br0">(</span>Close<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">&gt;</span> MA <span class="sy0">&amp;&amp;</span> BuyTicket <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span><span class="kw4">double</span> OpenPrice <span class="sy0">=</span> Ask<span class="sy0">;</span><span class="kw4">double</span> BuyStopLoss <span class="sy0">=</span> OpenPrice <span class="sy0">+</span> <span class="br0">(</span>StopLoss <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span> <span class="kw4">double</span> BuyTakeProfit <span class="sy0">=</span> OpenPrice <span class="sy0">+</span> <span class="br0">(</span>TakeProfit <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span>BuyTicket <span class="sy0">=</span> OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_BUY<span class="sy0">,</span>LotSize<span class="sy0">,</span>OpenPrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span> BuyStopLoss<span class="sy0">,</span>BuyTakeProfit<span class="sy0">,</span><span class="st0">&quot;Buy Order&quot;</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Green<span class="br0">)</span><span class="sy0">;</span>SellTicket <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Мы будем использовать функцию Print() для проверки параметров, передаваемых в функцию OrderSend(). Мы сосредоточимся на цене открытия ордера, стоп-лоссе и тейк-профите.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">Print<span class="br0">(</span><span class="st0">&quot;Price:&quot;</span><span class="sy0">+</span>OpenPrice<span class="sy0">+</span><span class="st0">&quot; Stop:&quot;</span><span class="sy0">+</span>BuyStopLoss<span class="sy0">+</span><span class="st0">&quot; Profit:&quot;</span><span class="sy0">+</span>BuyTakeProfit<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Вот вывод, когда мы запускаем советник в тестере стратегий. Стоп-лосс и тейк-профит в размере 50 пунктов:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="nu0">11</span><span class="sy0">:</span><span class="nu0">52</span><span class="sy0">:</span><span class="nu0">12</span> 2009.11.02 <span class="nu8">02</span><span class="sy0">:</span><span class="nu8">00</span> Example EURUSD<span class="sy0">,</span>H1<span class="sy0">:</span> OrderSend error <span class="nu0">130</span><span class="nu0">11</span><span class="sy0">:</span><span class="nu0">52</span><span class="sy0">:</span><span class="nu0">12</span> 2009.11.02 <span class="nu8">02</span><span class="sy0">:</span><span class="nu8">00</span> Example EURUSD<span class="sy0">,</span>H1<span class="sy0">:</span> Price<span class="sy0">:</span><span class="nu16">1.47340000</span> Stop<span class="sy0">:</span><span class="nu16">1.47840000</span>Profit<span class="sy0">:</span><span class="nu16">1.47840000</span></pre></div></div></div></div></div></div></div><p>Мы знаем, что стоп-лосс должен быть ниже цены открытия ордера на покупку. Здесь это значение выше цены. На самом деле это та же цена, что и тейк-профит. Беглый взгляд на наш код, и мы понимаем, что случайно вставили знак плюс в уравнение покупки стоп-лосса. Вот правильный код:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">double</span> BuyStopLoss <span class="sy0">=</span> OpenPrice <span class="sy0">-</span> <span class="br0">(</span>StopLoss <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Если вы получаете сообщение об ошибке при попытке разместить, закрыть или изменить ордер, сфокусируйте свои усилия на проблеме, указанной в сообщении об ошибке. Вот несколько наиболее распространенных сообщений об ошибках, вызванных ошибками программирования:</p><p><strong>Ошибка 129</strong>: недействительная цена — недействительная цена открытия. Для рыночных ордеров убедитесь, что текущая цена Bid или Ask передается в соответствии с типом ордера. Для отложенных ордеров убедитесь, что цена выше или ниже текущей цены, как того требует тип ордера. Также убедитесь, что цена отложенного ордера не слишком близка к текущей цене.</p><p><strong>Ошибка 130</strong>: недопустимые стопы — неверный стоп-лосс или тейк-профит. Убедитесь, что цены стоп-лосс и тейк-профит расположены выше или ниже текущей цены, в зависимости от того, является ли тип ордера покупкой или продажей. Также убедитесь, что цена стоп-лосса или тейк-профита не слишком близка к текущей цене.</p><p><strong>Ошибка 131</strong>: неверный объем сделки — неверный размер лота. Убедитесь, что размер лота не превышает минимального или максимального значения брокера и что размер лота нормализован до правильного значения шага (0,1 или 0,01 для большинства брокеров).</p><p>Описания всех сообщений об ошибках можно найти в справочнике по MQL в разделе Стандартные константы — коды ошибок.</p><h2><span id="Ustranenie_osibok_v_slucae_preryvania_torgovli">Устранение ошибок в случае прерывания торговли</span></h2><p>В то время как наиболее серьезные ошибки могут быть обнаружены просто путем бэк-тестирования, другие будут появляться только во время торговли в реальном времени. Ошибки могут привести к тому, что сделки будут размещены неправильно, и эти ошибки могут потребовать определенных усилий для их обнаружения.</p><p>Мы добавим дополнительную функцию для регистрации информации о сделках и статусе в режиме реального времени, чтобы у нас была запись об этом при устранении неполадок. Мы будем использовать операторы Print(), как и ранее, но мы будем регистрировать значения индикаторов цены — любую информацию, которая будет полезна при отладке.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="co1">// Внешние переменные </span><span class="kw2">extern</span> bool Debug <span class="sy0">=</span> <span class="kw2">true</span><span class="sy0">;</span>&nbsp;<span class="kw1">if</span><span class="br0">(</span>Debug <span class="sy0">==</span> <span class="kw2">true</span><span class="br0">)</span> Print<span class="br0">(</span>StringConcatenate<span class="br0">(</span><span class="st0">&quot;Bid:&quot;</span><span class="sy0">,</span>Bid<span class="sy0">,</span><span class="st0">&quot; Ask:&quot;</span><span class="sy0">,</span>Ask<span class="sy0">,</span><span class="st0">&quot; MA:&quot;</span><span class="sy0">,</span>MA<span class="sy0">,</span><span class="st0">&quot; BuyTicket:&quot;</span><span class="sy0">,</span>BuyTicket<span class="sy0">,</span><span class="st0">&quot; SellTicket:&quot;</span><span class="sy0">,</span>SellTicket<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Приведенный выше код будет регистрировать информацию о цене и индикаторе, а также содержимое переменных BuyTicket и SellTicket. Если есть какие-либо вопросы о том, как была открыта сделка или почему она не была открыта, журнал в этот конкретный момент покажет состояние всех соответствующих условий сделки. Вы можете включать и выключать вход в систему с помощью внешней переменной Debug.</p><p>Оператор отладки Print() должен быть помещен в конце функции start() после всех торговых функций. Если вы используете таймер, поместите оператор debug Print() в блок таймера, чтобы он работал только при необходимости. В противном случае строка отладки будет выводиться в журнал при каждом тике, что может привести к разрастанию файла журнала.</p><h2><span id="Obrabotka_osibok_kompilacii">Обработка ошибок компиляции</span></h2><p>Когда вы компилируете свой советник, компилятор проверит синтаксис вашего кода и убедится, что все пользовательские функции и переменные были правильно объявлены. Если вы что-то пропустили, компилятор остановится, и любые ошибки компиляции появятся на вкладке Errors в окне Toolbox.</p><p>Когда сталкиваешься с длинным списком ошибок компиляции, всегда начинайте с первой. Дважды щелкните ошибку в списке, и редактор перейдет непосредственно к строке с ошибкой. Исправьте ошибку и перекомпилируйте. Иногда простая синтаксическая ошибка приводит к нескольким несвязанным ошибкам.</p><p>Вот список распространенных ошибок компиляции и их решения:</p><p><strong>Variable not defined</strong> — вы забыли объявить переменную с типом данных. Если это глобальная или внешняя переменная, объявите ее в верхней части файла. Если это локальная переменная, найдите первое вхождение и поместите перед ним объявление типа данных. В противном случае проверьте правильность написания или регистр (верхний / нижний) имени переменной.</p><p><strong>Variable already defined</strong> — вы объявили одну и ту же переменную дважды. Удалите объявление типа данных из всех дублированных объявлений переменных.</p><p><strong>Function is not defined</strong> — если рассматриваемая функция находится в файле включения или библиотеки, убедитесь, что директива #include или #import находится в верхней части файла и является правильной. В противном случае проверьте правильность написания или регистр имени функции и убедитесь, что оно существует либо в текущем файле, либо в соответствующих файлах включений или библиотек.</p><p><strong>Illegal assignment used</strong> — обычно это относится к знаку равенства (=). Помните, что один знак равенства предназначен для присваивания переменной, а два знака равенства (==) — оператор сравнения. Исправьте оператор присваивания в соответствующем операторе сравнения.</p><p><strong>Assignment expected</strong> — обычно это относится к оператору сравнения «равно» (==). Вы использовали два знака равенства вместо одного в присваивании переменной. Исправьте оператор в один знак равенства.</p><p><strong>Unbalanced right parenthesis</strong> — обычно это происходит в операторе if при использовании вложенных скобок. Перейдите к строке, обозначенной первой ошибкой, и вставьте левую скобку в соответствующее место.</p><p><strong>Unbalanced left parenthesis</strong> — это сложная задача. Ошибка обычно указывает на конец строки программы. По сути, вы где-то забыли правильную скобку. Дважды проверьте код, который вы недавно редактировали, и найдите пропущенную правую скобку. Возможно, вам придется закомментировать строки кода, чтобы найти проблему.</p><p><strong>Wrong parameters count</strong> — у вас слишком мало или слишком много аргументов в функции. Дважды проверьте синтаксис функции в MQL Reference и исправьте аргументы.</p><p><strong>Semicolon expected</strong> — вы, вероятно, забыли поставить точку с запятой в конце строки. Поставьте точку с запятой в конце предыдущей строки. Обратите внимание, что пропущенная точка с запятой может вызвать любую из перечисленных выше ошибок, поэтому обязательно ставьте точки с запятой.</p></div><div class='code-block code-block-center code-block-5 ai-viewport-1'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader2" rel="nofollow" target="_blank"><img src="https://advertising-blog.qqit.ru/rublogtrader.rar.su/pamm_landing_banner_970x250_ru_1.gif"/></a></div><div class='code-block code-block-center code-block-6 ai-viewport-2 ai-viewport-3'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader2" rel="nofollow" target="_blank"><img src="/b/pamm_landing_banner_300x250_ru_.gif"/></a></div><div class="share"> Поделиться: <a href="https://telete.in/share/url?url=https://rublogtrader.rar.su/dopolnitelnye-vozmozhnosti-mql4/" target="_blank"><i class="icon-04"></i></a> <a href="http://vkontakte.ru/share.php?url=https://rublogtrader.rar.su/dopolnitelnye-vozmozhnosti-mql4/" target="_blank"><i class="icon-01"></i></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://rublogtrader.rar.su/dopolnitelnye-vozmozhnosti-mql4/" target="_blank"><i class="icon-09"></i></a> <a href="https://connect.ok.ru/offer?url=https://rublogtrader.rar.su/dopolnitelnye-vozmozhnosti-mql4/" target="_blank"><i class="icon-02"></i></a> <a href="https://twitter.com/intent/tweet?url=https://rublogtrader.rar.su/dopolnitelnye-vozmozhnosti-mql4/" target="_blank"><i class="icon-03"></i></a></div><div class="subsc4"> <a href="/torgovyj-algoritm-po-trejdingu-buy/">Мой торговый алгоритм по трейдингу</a></div><div class="subsc4"> <a href="/algoritm-torgovli-akcijami/">Мой алгоритм торговли акциями</a></div><div class="subsc4"> <a href="/moj-algoritm-vybora-akcij/">Мой алгоритм выбора акций по мультипликаторам</a></div><div class="subsc4"> Скачайте приложение Блог Трейдера в App Store<br><br> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader3" rel="nofollow" target="_blank"><img src="https://advertising-blog.qqit.ru/rublogtrader.rar.su/appstore.png" width="200"/></a></div><div class="title"><a href="https://rublogtrader.rar.su/mql4/" rel="category tag">MQL4</a></div><section YuzoPluginPro class="wp-yuzo yzp-wrapper  yzp-id-12792 yzp-template-list-default-l yzp-layout-list yzp-without-excerpt yzp-without-meta yzp-aspect-ratio-1-1 yzp-mobile-columns-2 yzp-tablet-columns-2 yzp-desktop-columns-2" data-version="6.2.3"  data-id="12792"  data-type="s" data-level="3" ><ul class='yzp-container' ><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='12040' data-n='1'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/magic-number/'   >Магическое число (Magic Number): как его использовать в MQL4?</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='10877' data-n='2'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/tipy-dannyh-v-mql4/'   >Типы данных в MQL4, которыми можно оперировать</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='10800' data-n='3'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/chto-takoe-tik/'   >Что такое тик на бирже? Что из себя представляет тиковый график?</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='11605' data-n='4'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/oscilljator-stohastik-pishem-kod-sovetnika-i-razbiraem-ego/'   >Осциллятор стохастик: пишем код советника и разбираем его</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='14296' data-n='5'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/'   >Размещение ордеров в MQL4: как открывать и закрывать ордера?</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='11321' data-n='6'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/kak-poluchit-tekushhuju-cenu-torgovogo-instrumenta-s-pomoshhju-mql4/'   >Как получить текущую цену торгового инструмента с помощью MQL4?</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='10922' data-n='7'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/bazovye-funkcii-i-struktura-koda/'   >Базовые функции и структура кода в программах на MQL4</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='11899' data-n='8'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/kak-ostanovit-torgovlju-sovetnika-esli-spred-uvelichivaetsja/'   >Как остановить торговлю советника, если спред увеличивается?</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='14305' data-n='9'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/prodvinutoe-razmeshhenie-orderov/'   >Продвинутое размещение ордеров и управление ордерами в MQL4</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='11334' data-n='10'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/kak-vypolnit-kakuju-libo-zadachu-pri-otkrytii-novoj-svechi-na-mql4/'   >Как выполнить какую–либо задачу при открытии новой свечи на MQL4?</a></div></div></li></ul></section></div></div></article><div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 no-pad"><div id="comments" class="comments-area"><div id="respond" class="comment-respond"> <span id="reply-title" class="h4 comment-reply-title">Добавить комментарий <small><a rel="nofollow" id="cancel-comment-reply-link" href="/dopolnitelnye-vozmozhnosti-mql4/#respond" style="display:none;">Отменить ответ</a></small></span><form action="https://rublogtrader.rar.su/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><p class="comment-notes"><span id="email-notes">Ваш адрес email не будет опубликован.</span></p><p class="comment-form-comment"><label for="comment">Комментарий</label><textarea style="display:none;" id="comment" name="comment" cols="45" rows="8" maxlength="65525" ></textarea><textarea id="real-comment" name="real-comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Имя</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p><p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Отправить комментарий" /> <input type='hidden' name='comment_post_ID' value='14353' id='comment_post_ID' /> <input type='hidden' name='comment_parent' id='comment_parent' value='0' /></p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="d59ed89b4d" /></p><p style="display: none !important;"><label>&#916;<textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100"></textarea></label><input type="hidden" id="ak_js" name="ak_js" value="119"/><script>document.getElementById( "ak_js" ).setAttribute( "value", ( new Date() ).getTime() );</script></p></form></div></div></div></main></div></div></div></div><div class="spu-bg" id="spu-bg-16205"></div><div class="spu-box  spu-centered spu-total- " id="spu-16205" data-box-id="16205" data-trigger="seconds" data-trigger-number="5" data-spuanimation="fade" data-tconvert-cookie="d" data-tclose-cookie="d" data-dconvert-cookie="999" data-dclose-cookie="30" data-nconvert-cookie="spu_conversion_16205" data-nclose-cookie="spu_closing_16205" data-test-mode="0" data-auto-hide="0" data-close-on-conversion="1" data-bgopa="0.5" data-total="" style="left:-99999px !important;right:auto;" data-width="600" ><div class="spu-content"><p><a href="https://www.instaglobe.net/ru/pamm_trading?x=trdblogpam&#038;utm_source=tradeblog.net&#038;utm_campaign=pamm" target="_blank" rel="noopener"><img src="https://rublogtrader.rar.su/wp-content/uploads/2021/12/700_400_Popup.jpg" alt="" width="700" height="400" class="alignnone size-full wp-image-16207" /></a></p></div> <span class="spu-close spu-close-popup top_right"><i class="spu-icon spu-icon-close"></i></span> <span class="spu-timer"></span></div><div id="fb-root" class=" fb_reset"></div><div id="shiftnav-toggle-main" class="shiftnav-toggle-main-align-center shiftnav-toggle-style-full_bar shiftnav-togglebar-gap-on shiftnav-toggle-edge-left shiftnav-toggle-icon-bars shiftnav--hide-scroll-down"   ><button id="shiftnav-toggle-main-button" class="shiftnav-toggle shiftnav-toggle-shiftnav-main shiftnav-toggle-burger" tabindex="1" data-shiftnav-target="shiftnav-main" aria-label="Toggle Menu"><i class="fa fa-bars"></i></button><div class="shiftnav-main-toggle-content shiftnav-toggle-main-block"><a href="https://rublogtrader.rar.su">Блог трейдера</a></div><div class="shiftnav-main-toggle-content-after"> <a class="shiftnav-searchbar-toggle  shiftnav-toggle-main-block shiftnav-toggle-main-ontop" tabindex="1"><i class="fa fa-search"></i></a><div class="shiftnav-searchbar-drop"><form role="search" method="get" class="shiftnav-searchform" action="https://rublogtrader.rar.su/"> <input type="text" placeholder="Search..." value="" name="s" class="shiftnav-search-input" /> <input type="submit" class="shiftnav-search-submit" value="&#xf002;" /></form></div></div></div><div class="shiftnav shiftnav-nojs shiftnav-shiftnav-main shiftnav-left-edge shiftnav-skin-none shiftnav-transition-standard" id="shiftnav-main" data-shiftnav-id="shiftnav-main"><div class="shiftnav-inner"><nav class="shiftnav-nav"><ul id="menu-menu-2" class="shiftnav-menu shiftnav-targets-default shiftnav-targets-text-default shiftnav-targets-icon-default"><li id="menu-item-14441" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-14441 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/forex/">Форекс</a></li><li id="menu-item-14442" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-14442 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/trading/">Трейдинг</a></li><li id="menu-item-10795" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-10795 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/technical-analysis/">Технический анализ</a></li><li id="menu-item-10797" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-10797 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/indicators/">Индикаторы</a></li><li id="menu-item-10798" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-10798 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/prajs-jekshen/">Прайс экшен</a></li><li id="menu-item-16043" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-16043 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/investing/">Инвестиции</a></li><li id="menu-item-16238" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-16238 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/crypto/">Крипто</a></li></ul></nav> <button class="shiftnav-sr-close shiftnav-sr-only shiftnav-sr-only-focusable"> &times; Close Panel </button></div></div><div style="display: none;" id="nxsFavNotice"><div id="nxsFavNoticeCnt">Posting....</div></div><div id="wpfront-scroll-top-container"> <img src="https://rublogtrader.rar.su/wp-content/uploads/2019/03/scroll-3.png" alt="" /></div> <script type="text/javascript">function wpfront_scroll_top_init() {                if (typeof wpfront_scroll_top === "function" && typeof jQuery !== "undefined") {                    wpfront_scroll_top({"scroll_offset":3000,"button_width":60,"button_height":60,"button_opacity":0.9,"button_fade_duration":200,"scroll_duration":400,"location":1,"marginX":250,"marginY":20,"hide_iframe":false,"auto_hide":false,"auto_hide_after":2,"button_action":"top","button_action_element_selector":"","button_action_container_selector":"html, body","button_action_element_offset":0});                } else {                    setTimeout(wpfront_scroll_top_init, 100);                }            }            wpfront_scroll_top_init();</script> <script type='text/javascript' id='yuzo-js-js-extra'>var yuzo_vars = {"ajaxurl":"https:\/\/rublogtrader.rar.su\/wp-admin\/admin-ajax.php","post_id":"14353","url":"https%3A%2F%2Frublogtrader.rar.su%2Fdopolnitelnye-vozmozhnosti-mql4%2F","where_is":"single|singular","nonce":"7e9956422c","nonce2":"98ebd05f15","off_views":"0","off_views_logged":"1","is_logged":"0","allows_to_count_visits":"1","disabled_counter":"0","level_article":"medium"};</script> <script type='text/javascript' id='spu-public-js-extra'>var spuvar = {"is_admin":"","disable_style":"","ajax_mode":"","ajax_url":"https:\/\/rublogtrader.rar.su\/wp-admin\/admin-ajax.php","ajax_mode_url":"https:\/\/rublogtrader.rar.su\/?spu_action=spu_load","pid":"14353","is_front_page":"","is_category":"","site_url":"https:\/\/rublogtrader.rar.su","is_archive":"","is_search":"","is_preview":"","seconds_confirmation_close":"5"};var spuvar_social = [];</script> <script type='text/javascript' id='shiftnav-js-extra'>var shiftnav_data = {"shift_body":"off","shift_body_wrapper":"","lock_body":"on","lock_body_x":"off","open_current":"off","collapse_accordions":"off","scroll_panel":"off","breakpoint":"1120","v":"1.7.0.1","pro":"1","touch_off_close":"on","scroll_offset":"100","disable_transforms":"off","close_on_target_click":"off","scroll_top_boundary":"50","process_uber_segments":"on"};</script> <script>ai_front = {"insertion_before":"BEFORE","insertion_after":"AFTER","insertion_prepend":"PREPEND CONTENT","insertion_append":"APPEND CONTENT","insertion_replace_content":"REPLACE CONTENT","insertion_replace_element":"REPLACE ELEMENT","visible":"VISIBLE","hidden":"HIDDEN","fallback":"FALLBACK","automatically_placed":"Automatically placed by AdSense Auto ads code","cancel":"Cancel","use":"Use","add":"Add","parent":"Parent","cancel_element_selection":"Cancel element selection","select_parent_element":"Select parent element","css_selector":"CSS selector","use_current_selector":"Use current selector","element":"ELEMENT","path":"PATH","selector":"SELECTOR"};function b2a(a){var b,c=0,l=0,f="",g=[];if(!a)return a;do{var e=a.charCodeAt(c++);var h=a.charCodeAt(c++);var k=a.charCodeAt(c++);var d=e<<16|h<<8|k;e=63&d>>18;h=63&d>>12;k=63&d>>6;d&=63;g[l++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)}while(c<a.length);return f=g.join(""),b=a.length%3,(b?f.slice(0,b-3):f)+"===".slice(b||3)}function a2b(a){var b,c,l,f={},g=0,e=0,h="",k=String.fromCharCode,d=a.length;for(b=0;64>b;b++)f["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(b)]=b;for(c=0;d>c;c++)for(b=f[a.charAt(c)],g=(g<<6)+b,e+=6;8<=e;)((l=255&g>>>(e-=8))||d-2>c)&&(h+=k(l));return h}b64e=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(b,a){return String.fromCharCode("0x"+a)}))};b64d=function(a){return decodeURIComponent(atob(a).split("").map(function(a){return"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)}).join(""))};(function(a){if("function"===typeof define&&define.amd){define(a);var c=!0}"object"===typeof exports&&(module.exports=a(),c=!0);if(!c){var d=window.Cookies,b=window.Cookies=a();b.noConflict=function(){window.Cookies=d;return b}}})(function(){function a(){for(var d=0,b={};d<arguments.length;d++){var f=arguments[d],e;for(e in f)b[e]=f[e]}return b}function c(d){function b(){}function f(h,k,g){if("undefined"!==typeof document){g=a({path:"/"},b.defaults,g);"number"===typeof g.expires&&(g.expires=new Date(1*new Date+864E5*g.expires));g.expires=g.expires?g.expires.toUTCString():"";try{var l=JSON.stringify(k);/^[\{\[]/.test(l)&&(k=l)}catch(p){}k=d.write?d.write(k,h):encodeURIComponent(String(k)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent);h=encodeURIComponent(String(h)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);l="";for(var n in g)g[n]&&(l+="; "+n,!0!==g[n]&&(l+="="+g[n].split(";")[0]));return document.cookie=h+"="+k+l}}function e(h,k){if("undefined"!==typeof document){for(var g={},l=document.cookie?document.cookie.split("; "):[],n=0;n<l.length;n++){var p=l[n].split("="),m=p.slice(1).join("=");k||'"'!==m.charAt(0)||(m=m.slice(1,-1));try{var q=p[0].replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent);m=(d.read||d)(m,q)||m.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent);if(k)try{m=JSON.parse(m)}catch(r){}g[q]=m;if(h===q)break}catch(r){}}return h?g[h]:g}}b.set=f;b.get=function(h){return e(h,!1)};b.getJSON=function(h){return e(h,!0)};b.remove=function(h,k){f(h,"",a(k,{expires:-1}))};b.defaults={};b.withConverter=c;return b}return c(function(){})});AiCookies=Cookies.noConflict();ai_check_block=function(a){if(null==a)return!0;var c=AiCookies.getJSON("aiBLOCKS");ai_debug_cookie_status="";null==c&&(c={});"undefined"!==typeof ai_delay_showing_pageviews&&(c.hasOwnProperty(a)||(c[a]={}),c[a].hasOwnProperty("d")||(c[a].d=ai_delay_showing_pageviews));if(c.hasOwnProperty(a))for(var d in c[a]){if("x"==d){var b="",f=document.querySelectorAll('span[data-ai-block="'+a+'"]')[0];"aiHash"in f.dataset&&(b=f.dataset.aiHash);f="";c[a].hasOwnProperty("h")&&(f=c[a].h);var e=new Date;e=c[a][d]-Math.round(e.getTime()/1E3);if(0<e&&f==b)return ai_debug_cookie_status=a="closed for "+e+" s = "+Math.round(1E4*e/3600/24)/1E4+" days",!1;ai_set_cookie(a,"x","");c[a].hasOwnProperty("i")||c[a].hasOwnProperty("c")||ai_set_cookie(a,"h","")}else if("d"==d){if(0!=c[a][d])return ai_debug_cookie_status=a="delayed for "+c[a][d]+" pageviews",!1}else if("i"==d){b="";f=document.querySelectorAll('span[data-ai-block="'+a+'"]')[0];"aiHash"in f.dataset&&(b=f.dataset.aiHash);f="";c[a].hasOwnProperty("h")&&(f=c[a].h);if(0==c[a][d]&&f==b)return ai_debug_cookie_status=a="max impressions reached",!1;if(0>c[a][d]&&f==b){e=new Date;e=-c[a][d]-Math.round(e.getTime()/1E3);if(0<e)return ai_debug_cookie_status=a="max imp. reached ("+Math.round(1E4*e/24/3600)/1E4+" days = "+e+" s)",!1;ai_set_cookie(a,"i","");c[a].hasOwnProperty("c")||c[a].hasOwnProperty("x")||ai_set_cookie(a,"h","")}}if("ipt"==d&&0==c[a][d]&&(e=new Date,b=Math.round(e.getTime()/1E3),e=c[a].it-b,0<e))return ai_debug_cookie_status=a="max imp. per time reached ("+Math.round(1E4*e/24/3600)/1E4+" days = "+e+" s)",!1;if("c"==d){b="";f=document.querySelectorAll('span[data-ai-block="'+a+'"]')[0];"aiHash"in f.dataset&&(b=f.dataset.aiHash);f="";c[a].hasOwnProperty("h")&&(f=c[a].h);if(0==c[a][d]&&f==b)return ai_debug_cookie_status=a="max clicks reached",!1;if(0>c[a][d]&&f==b){e=new Date;e=-c[a][d]-Math.round(e.getTime()/1E3);if(0<e)return ai_debug_cookie_status=a="max clicks reached ("+Math.round(1E4*e/24/3600)/1E4+" days = "+e+" s)",!1;ai_set_cookie(a,"c","");c[a].hasOwnProperty("i")||c[a].hasOwnProperty("x")||ai_set_cookie(a,"h","")}}if("cpt"==d&&0==c[a][d]&&(e=new Date,b=Math.round(e.getTime()/1E3),e=c[a].ct-b,0<e))return ai_debug_cookie_status=a="max clicks per time reached ("+Math.round(1E4*e/24/3600)/1E4+" days = "+e+" s)",!1}ai_debug_cookie_status="OK";return!0};ai_check_and_insert_block=function(a,c){if(null==a)return!0;var d=document.getElementsByClassName(c);if(d.length){d=d[0];var b=d.closest(".code-block");if(ai_check_block(a)){if(ai_insert_code(d),b){var f=b.querySelectorAll(".ai-debug-block");b&&f.length&&(b.classList.remove("ai-list-block"),b.classList.remove("ai-list-block-ip"),b.style.visibility="",b.classList.contains("ai-remove-position")&&(b.style.position=""))}}else{f=d.closest("div[data-ai]");if(null!=f&&"undefined"!=typeof f.getAttribute("data-ai")){var e=JSON.parse(b64d(f.getAttribute("data-ai")));"undefined"!==typeof e&&e.constructor===Array&&(e[1]="",f.setAttribute("data-ai",b64e(JSON.stringify(e))))}f=b.querySelectorAll(".ai-debug-block");b&&f.length&&(b.classList.remove("ai-list-block"),b.classList.remove("ai-list-block-ip"),b.style.visibility="",b.classList.contains("ai-remove-position")&&(b.style.position=""))}d.classList.remove(c)}d=document.querySelectorAll("."+c+"-dbg");b=0;for(f=d.length;b<f;b++)e=d[b],e.querySelector(".ai-status").textContent=ai_debug_cookie_status,e.querySelector(".ai-cookie-data").textContent=ai_get_cookie_text(a),e.classList.remove(c+"-dbg")};function ai_load_cookie(){var a=AiCookies.getJSON("aiBLOCKS");null==a&&(a={});return a}function ai_get_cookie(a,c){var d="",b=ai_load_cookie();b.hasOwnProperty(a)&&b[a].hasOwnProperty(c)&&(d=b[a][c]);return d}function ai_set_cookie(a,c,d){var b=ai_load_cookie();if(""===d){if(b.hasOwnProperty(a)){delete b[a][c];a:{c=b[a];for(f in c)if(c.hasOwnProperty(f)){var f=!1;break a}f=!0}f&&delete b[a]}}else b.hasOwnProperty(a)||(b[a]={}),b[a][c]=d;0===Object.keys(b).length&&b.constructor===Object?AiCookies.remove("aiBLOCKS"):AiCookies.set("aiBLOCKS",b,{expires:365,path:"/"});return b}ai_get_cookie_text=function(a){var c=AiCookies.getJSON("aiBLOCKS");null==c&&(c={});return c.hasOwnProperty(a)?JSON.stringify(c[a]).replace(/"/g,"").replace("{","").replace("}",""):""};ai_insert=function(d,l,v){for(var p=-1!=l.indexOf(":eq")?jQuery(l):document.querySelectorAll(l),t=0,y=p.length;t<y;t++){var b=p[t];selector_string=b.hasAttribute("id")?"#"+b.getAttribute("id"):b.hasAttribute("class")?"."+b.getAttribute("class").replace(RegExp(" ","g"),"."):"";var u=document.createElement("div");u.innerHTML=v;var m=u.getElementsByClassName("ai-selector-counter")[0];null!=m&&(m.innerText=t+1);m=u.getElementsByClassName("ai-debug-name ai-main")[0];if(null!=m){var k="";"before"==d?k=ai_front.insertion_before:"after"==d?k=ai_front.insertion_after:"prepend"==d?k=ai_front.insertion_prepend:"append"==d?k=ai_front.insertion_append:"replace-content"==d?k=ai_front.insertion_replace_content:"replace-element"==d&&(k=ai_front.insertion_replace_element);-1==selector_string.indexOf(".ai-viewports")&&(m.innerText=k+" "+l+" ("+b.tagName.toLowerCase()+selector_string+")")}m=document.createRange();k=!0;try{var w=m.createContextualFragment(u.innerHTML)}catch(r){k=!1}"before"==d?k?b.parentNode.insertBefore(w,b):jQuery(u.innerHTML).insertBefore(jQuery(b)):"after"==d?k?b.parentNode.insertBefore(w,b.nextSibling):jQuery(u.innerHTML).insertBefore(jQuery(b.nextSibling)):"prepend"==d?k?b.insertBefore(w,b.firstChild):jQuery(u.innerHTML).insertBefore(jQuery(b.firstChild)):"append"==d?k?b.insertBefore(w,null):jQuery(u.innerHTML).appendTo(jQuery(b)):"replace-content"==d?(b.innerHTML="",k?b.insertBefore(w,null):jQuery(u.innerHTML).appendTo(jQuery(b))):"replace-element"==d&&(k?b.parentNode.insertBefore(w,b):jQuery(u.innerHTML).insertBefore(jQuery(b)),b.parentNode.removeChild(b))}};ai_insert_code=function(d){function l(m,k){return null==m?!1:m.classList?m.classList.contains(k):-1<(" "+m.className+" ").indexOf(" "+k+" ")}function v(m,k){null!=m&&(m.classList?m.classList.add(k):m.className+=" "+k)}function p(m,k){null!=m&&(m.classList?m.classList.remove(k):m.className=m.className.replace(new RegExp("(^|\\b)"+k.split(" ").join("|")+"(\\b|$)","gi")," "))}if("undefined"!=typeof d){var t=!1;if(l(d,"no-visibility-check")||d.offsetWidth||d.offsetHeight||d.getClientRects().length){t=d.getAttribute("data-code");var y=d.getAttribute("data-insertion"),b=d.getAttribute("data-selector");if(null!=t)if(null!=y&&null!=b){if(-1!=b.indexOf(":eq")?jQuery(b).length:document.querySelectorAll(b).length)ai_insert(y,b,b64d(t)),p(d,"ai-viewports")}else{y=document.createRange();b=!0;try{var u=y.createContextualFragment(b64d(t))}catch(m){b=!1}b?d.parentNode.insertBefore(u,d.nextSibling):jQuery(b64d(t)).insertBefore(jQuery(d.nextSibling));p(d,"ai-viewports")}t=!0}else u=d.previousElementSibling,l(u,"ai-debug-bar")&&l(u,"ai-debug-script")&&(p(u,"ai-debug-script"),v(u,"ai-debug-viewport-invisible")),p(d,"ai-viewports");return t}};ai_insert_list_code=function(d){var l=document.getElementsByClassName(d)[0];if("undefined"!=typeof l){var v=ai_insert_code(l),p=l.closest("div.code-block");if(p){v||p.removeAttribute("data-ai");var t=p.querySelectorAll(".ai-debug-block");p&&t.length&&(p.classList.remove("ai-list-block"),p.classList.remove("ai-list-block-ip"),p.style.visibility="",p.classList.contains("ai-remove-position")&&(p.style.position=""))}l.classList.remove(d);v&&ai_process_elements()}};ai_insert_viewport_code=function(d){var l=document.getElementsByClassName(d)[0];"undefined"!=typeof l&&(ai_insert_code(l),l.classList.remove(d),ai_process_elements())};ai_insert_code_by_class=function(d){var l=document.getElementsByClassName(d)[0];"undefined"!=typeof l&&(ai_insert_code(l),l.classList.remove(d))};ai_insert_client_code=function(d,l){var v=document.getElementsByClassName(d)[0];if("undefined"!=typeof v){var p=v.getAttribute("data-code");null!=p&&ai_check_block()&&ai_check_and_insert_block()&&(v.setAttribute("data-code",p.substring(Math.floor(l/19))),ai_insert_code_by_class(d),v.remove())}};ai_process_elements_active=!1;function ai_process_elements(){ai_process_elements_active||setTimeout(function(){ai_process_elements_active=!1;"function"==typeof ai_process_rotations&&ai_process_rotations();"function"==typeof ai_process_lists&&ai_process_lists(jQuery(".ai-list-data"));"function"==typeof ai_process_ip_addresses&&ai_process_ip_addresses(jQuery(".ai-ip-data"));"function"==typeof ai_adb_process_blocks&&ai_adb_process_blocks()},5);ai_process_elements_active=!0}var Arrive=function(d,l,v){function p(r,c,e){b.addMethod(c,e,r.unbindEvent);b.addMethod(c,e,r.unbindEventWithSelectorOrCallback);b.addMethod(c,e,r.unbindEventWithSelectorAndCallback)}function t(r){r.arrive=k.bindEvent;p(k,r,"unbindArrive");r.leave=w.bindEvent;p(w,r,"unbindLeave")}if(d.MutationObserver&&"undefined"!==typeof HTMLElement){var y=0,b=function(){var r=HTMLElement.prototype.matches||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector;return{matchesSelector:function(c,e){return c instanceof HTMLElement&&r.call(c,e)},addMethod:function(c,e,f){var a=c[e];c[e]=function(){if(f.length==arguments.length)return f.apply(this,arguments);if("function"==typeof a)return a.apply(this,arguments)}},callCallbacks:function(c,e){e&&e.options.onceOnly&&1==e.firedElems.length&&(c=[c[0]]);for(var f=0,a;a=c[f];f++)a&&a.callback&&a.callback.call(a.elem,a.elem);e&&e.options.onceOnly&&1==e.firedElems.length&&e.me.unbindEventWithSelectorAndCallback.call(e.target,e.selector,e.callback)},checkChildNodesRecursively:function(c,e,f,a){for(var g=0,h;h=c[g];g++)f(h,e,a)&&a.push({callback:e.callback,elem:h}),0<h.childNodes.length&&b.checkChildNodesRecursively(h.childNodes,e,f,a)},mergeArrays:function(c,e){var f={},a;for(a in c)c.hasOwnProperty(a)&&(f[a]=c[a]);for(a in e)e.hasOwnProperty(a)&&(f[a]=e[a]);return f},toElementsArray:function(c){"undefined"===typeof c||"number"===typeof c.length&&c!==d||(c=[c]);return c}}}(),u=function(){var r=function(){this._eventsBucket=[];this._beforeRemoving=this._beforeAdding=null};r.prototype.addEvent=function(c,e,f,a){c={target:c,selector:e,options:f,callback:a,firedElems:[]};this._beforeAdding&&this._beforeAdding(c);this._eventsBucket.push(c);return c};r.prototype.removeEvent=function(c){for(var e=this._eventsBucket.length-1,f;f=this._eventsBucket[e];e--)c(f)&&(this._beforeRemoving&&this._beforeRemoving(f),(f=this._eventsBucket.splice(e,1))&&f.length&&(f[0].callback=null))};r.prototype.beforeAdding=function(c){this._beforeAdding=c};r.prototype.beforeRemoving=function(c){this._beforeRemoving=c};return r}(),m=function(r,c){var e=new u,f=this,a={fireOnAttributesModification:!1};e.beforeAdding(function(g){var h=g.target;if(h===d.document||h===d)h=document.getElementsByTagName("html")[0];var n=new MutationObserver(function(x){c.call(this,x,g)});var q=r(g.options);n.observe(h,q);g.observer=n;g.me=f});e.beforeRemoving(function(g){g.observer.disconnect()});this.bindEvent=function(g,h,n){h=b.mergeArrays(a,h);for(var q=b.toElementsArray(this),x=0;x<q.length;x++)e.addEvent(q[x],g,h,n)};this.unbindEvent=function(){var g=b.toElementsArray(this);e.removeEvent(function(h){for(var n=0;n<g.length;n++)if(this===v||h.target===g[n])return!0;return!1})};this.unbindEventWithSelectorOrCallback=function(g){var h=b.toElementsArray(this);e.removeEvent("function"===typeof g?function(n){for(var q=0;q<h.length;q++)if((this===v||n.target===h[q])&&n.callback===g)return!0;return!1}:function(n){for(var q=0;q<h.length;q++)if((this===v||n.target===h[q])&&n.selector===g)return!0;return!1})};this.unbindEventWithSelectorAndCallback=function(g,h){var n=b.toElementsArray(this);e.removeEvent(function(q){for(var x=0;x<n.length;x++)if((this===v||q.target===n[x])&&q.selector===g&&q.callback===h)return!0;return!1})};return this},k=new function(){function r(f,a,g){return b.matchesSelector(f,a.selector)&&(f._id===v&&(f._id=y++),-1==a.firedElems.indexOf(f._id))?(a.firedElems.push(f._id),!0):!1}var c={fireOnAttributesModification:!1,onceOnly:!1,existing:!1};k=new m(function(f){var a={attributes:!1,childList:!0,subtree:!0};f.fireOnAttributesModification&&(a.attributes=!0);return a},function(f,a){f.forEach(function(g){var h=g.addedNodes,n=g.target,q=[];null!==h&&0<h.length?b.checkChildNodesRecursively(h,a,r,q):"attributes"===g.type&&r(n,a,q)&&q.push({callback:a.callback,elem:n});b.callCallbacks(q,a)})});var e=k.bindEvent;k.bindEvent=function(f,a,g){"undefined"===typeof g?(g=a,a=c):a=b.mergeArrays(c,a);var h=b.toElementsArray(this);if(a.existing){for(var n=[],q=0;q<h.length;q++)for(var x=h[q].querySelectorAll(f),z=0;z<x.length;z++)n.push({callback:g,elem:x[z]});if(a.onceOnly&&n.length)return g.call(n[0].elem,n[0].elem);setTimeout(b.callCallbacks,1,n)}e.call(this,f,a,g)};return k},w=new function(){function r(f,a){return b.matchesSelector(f,a.selector)}var c={};w=new m(function(){return{childList:!0,subtree:!0}},function(f,a){f.forEach(function(g){g=g.removedNodes;var h=[];null!==g&&0<g.length&&b.checkChildNodesRecursively(g,a,r,h);b.callCallbacks(h,a)})});var e=w.bindEvent;w.bindEvent=function(f,a,g){"undefined"===typeof g?(g=a,a=c):a=b.mergeArrays(c,a);e.call(this,f,a,g)};return w};l&&t(l.fn);t(HTMLElement.prototype);t(NodeList.prototype);t(HTMLCollection.prototype);t(HTMLDocument.prototype);t(Window.prototype);l={};p(k,l,"unbindAllArrive");p(w,l,"unbindAllLeave");return l}}(window,"undefined"===typeof jQuery?null:jQuery,void 0);var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,k){a.raw=k;return a};$jscomp.arrayIteratorImpl=function(a){var k=0;return function(){return k<a.length?{done:!1,value:a[k++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var k="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return k?k.call(a):$jscomp.arrayIterator(a)};jQuery(function(a){function k(e){e=e.match(E);return null!=e&&1<e.length&&"string"===typeof e[1]&&0<e[1].length?e[1].toLowerCase():null}function z(e){try{var h=Date.parse(e);isNaN(h)&&(h=null)}catch(J){h=null}if(null==h&&e.includes(" ")){e=e.split(" ");try{h=Date.parse(e[0]);if(e[1].includes(":")){var F=e[1].split(":");h+=1E3*(3600*parseInt(F[0])+60*parseInt(F[1])+parseInt(F[2]))}isNaN(h)&&(h=null)}catch(J){h=null}}return h}function n(){(jQuery("#ai-iab-tcf-bar").length||jQuery(".ai-list-manual").length)&&"function"==typeof __tcfapi&&"function"==typeof ai_load_blocks&&"undefined"==typeof ai_iab_tcf_callback_installed&&(__tcfapi("addEventListener",2,function(e,h){h&&"useractioncomplete"===e.eventStatus&&(ai_tcData=e,ai_load_blocks(),jQuery("#ai-iab-tcf-status").text("DATA LOADED"),jQuery("#ai-iab-tcf-bar").addClass("status-ok").removeClass("status-error"))}),ai_iab_tcf_callback_installed=!0)}Array.prototype.includes||(Array.prototype.includes=function(e){return!!~this.indexOf(e)});var E=/:\/\/(.[^/:]+)/i;ai_process_lists=function(e){function h(d,b,g){if(0==d.length){if("!@!"==g)return!0;b!=g&&("true"==g.toLowerCase()?g=!0:"false"==g.toLowerCase()&&(g=!1));return b==g}if("object"!=typeof b&&"array"!=typeof b)return!1;var f=d[0];d=d.slice(1);if("*"==f)for(b=$jscomp.makeIterator(Object.entries(b)),f=b.next();!f.done;f=b.next()){if(f=$jscomp.makeIterator(f.value),f.next(),f=f.next().value,h(d,f,g))return!0}else if(f in b)return h(d,b[f],g);return!1}function F(d,b,g){if("object"!=typeof d||-1==b.indexOf("["))return!1;b=b.replace(/]| /gi,"").split("[");return h(b,d,g)}function J(){"function"==typeof __tcfapi&&(a("#ai-iab-tcf-status").text("DETECTED"),__tcfapi("getTCData",2,function(d,b){b?(a("#ai-iab-tcf-bar").addClass("status-ok"),"tcloaded"==d.eventStatus||"useractioncomplete"==d.eventStatus?(ai_tcData=d,d.gdprApplies?a("#ai-iab-tcf-status").text("DATA LOADED"):jQuery("#ai-iab-tcf-status").text("GDPR DOES NOT APPLY"),a("#ai-iab-tcf-bar").addClass("status-ok").removeClass("status-error"),setTimeout(function(){ai_process_lists()},10)):"cmpuishown"==d.eventStatus&&(ai_cmpuishown=!0,a("#ai-iab-tcf-status").text("CMP UI SHOWN"),a("#ai-iab-tcf-bar").addClass("status-ok").removeClass("status-error"))):(a("#ai-iab-tcf-status").text("__tcfapi getTCData failed"),a("#ai-iab-tcf-bar").removeClass("status-ok").addClass("status-error"))}))}function P(d){"function"==typeof __tcfapi?("undefined"==typeof ai_iab_tcf_callback_installed&&n(),"undefined"==typeof ai_tcData_requested&&(ai_tcData_requested=!0,J(),url_parameters_need_tcData=!0)):d&&(a("#ai-iab-tcf-bar").addClass("status-error").removeClass("status-ok"),a("#ai-iab-tcf-status").text("MISSING: __tcfapi function not found"))}e=null==e?a("div.ai-list-data, meta.ai-list-data"):e.filter(".ai-list-data");if(e.length){e.removeClass("ai-list-data");var G=document.cookie.split(";");G.forEach(function(d,b){G[b]=d.trim()});var Q=getAllUrlParams(window.location.search);if(null!=Q.referrer)var r=Q.referrer;else r=document.referrer,""!=r&&(r=k(r));var K=window.navigator.userAgent,L=K.toLowerCase();if("undefined"!==typeof MobileDetect)var R=new MobileDetect(K);e.each(function(){var d=a(this).closest("div.code-block"),b=!0,g=a(this).attr("referer-list");if("undefined"!=typeof g){g=b64d(g).split(",");var f=a(this).attr("referer-list-type"),l=!1;a.each(g,function(t,c){if(""==c)return!0;if("*"==c.charAt(0))if("*"==c.charAt(c.length-1)){if(c=c.substr(1,c.length-2),-1!=r.indexOf(c))return l=!0,!1}else{if(c=c.substr(1),r.substr(-c.length)==c)return l=!0,!1}else if("*"==c.charAt(c.length-1)){if(c=c.substr(0,c.length-1),0==r.indexOf(c))return l=!0,!1}else if("#"==c){if(""==r)return l=!0,!1}else if(c==r)return l=!0,!1});switch(f){case "B":l&&(b=!1);break;case "W":l||(b=!1)}}if(b&&(g=a(this).attr("client-list"),"undefined"!=typeof g&&"undefined"!==typeof R))switch(g=b64d(g).split(","),f=a(this).attr("client-list-type"),l=!1,a.each(g,function(t,c){if(""==c)return!0;if("*"==c.charAt(0))if("*"==c.charAt(c.length-1)){if(c=c.substr(1,c.length-2).toLowerCase(),-1!=L.indexOf(c))return l=!0,!1}else{if(c=c.substr(1).toLowerCase(),L.substr(-c.length)==c)return l=!0,!1}else if("*"==c.charAt(c.length-1)){if(c=c.substr(0,c.length-1).toLowerCase(),0==L.indexOf(c))return l=!0,!1}else if(R.is(c))return l=!0,!1}),f){case "B":l&&(b=!1);break;case "W":l||(b=!1)}var M=g=!1;if(b&&(f=a(this).attr("parameter-list"),"undefined"!=typeof f)){f=b64d(f).split(",");var u=a(this).attr("parameter-list-type"),S=[];G.forEach(function(t){t=t.split("=");try{var c=JSON.parse(decodeURIComponent(t[1]))}catch(T){c=decodeURIComponent(t[1])}S[t[0]]=c});var w=!1,H=a(this);a.each(f,function(t,c){var T=c.split("&&");a.each(T,function(X,m){var x=!0;m=m.trim();"!!"==m.substring(0,2)&&(x=!1,m=m.substring(2));var p=m,y="!@!",U=-1!=m.indexOf("["),V=(0==m.indexOf("tcf-v2")||0==m.indexOf("euconsent-v2"))&&-1!=m.indexOf("[");-1!=m.indexOf("=")&&(y=m.split("="),p=y[0],y=y[1],U=-1!=p.indexOf("["),V=(0==p.indexOf("tcf-v2")||0==p.indexOf("euconsent-v2"))&&-1!=p.indexOf("["));if(V)a("#ai-iab-tcf-bar").show(),"object"==typeof ai_tcData?(a("#ai-iab-tcf-bar").addClass("status-ok"),p=p.replace(/]| /gi,"").split("["),p.shift(),w=(p=h(p,ai_tcData,y))?x:!x):(H.addClass("ai-list-data"),M=!0,"function"==typeof __tcfapi?P(!1):"undefined"==typeof ai_tcData_retrying&&(ai_tcData_retrying=!0,setTimeout(function(){P(!0)},200)));else if(U)w=(p=F(S,p,y))?x:!x;else{var N=!1;"!@!"==y?G.every(function(W){return W.split("=")[0]==m?(N=!0,!1):!0}):N=-1!=G.indexOf(m);w=N?x:!x}if(!w)return!1});if(w)return!1});switch(u){case "B":w&&(b=!1);break;case "W":w||(b=!1)}a(this).hasClass("ai-list-manual")&&(b?(H.removeClass("ai-list-data"),H.removeClass("ai-list-manual")):(g=!0,H.addClass("ai-list-data")));if(!g&&!M&&(f=a(this).data("debug-info"),"undefined"!=typeof f&&(f=a("."+f),0!=f.length))){var q=f.parent();q.hasClass("ai-debug-info")&&q.remove()}}q=a(this).prevAll(".ai-debug-bar.ai-debug-lists");f=""==r?"#":r;q.find(".ai-debug-name.ai-list-info").text(f).attr("title",K);q.find(".ai-debug-name.ai-list-status").text(b?ai_front.visible:ai_front.hidden);f=!1;if(b){u=a(this).attr("scheduling-start");var A=a(this).attr("scheduling-end"),B=a(this).attr("scheduling-days");if("undefined"!=typeof u&&"undefined"!=typeof A&&"undefined"!=typeof B){f=!0;var O=parseInt(a(this).attr("scheduling-fallback")),v=parseInt(a(this).attr("gmt"));u=z(b64d(u))+v;A=z(b64d(A))+v;B=b64d(B).split(",");q=a(this).attr("scheduling-type");var C=(new Date).getTime()+v,I=new Date(C),D=I.getDay();0==D?D=6:D--;v=C>=u&&C<A&&B.includes(D.toString());switch(q){case "B":v=!v}v||(b=!1);I=I.toISOString().split(".")[0].replace("T"," ");q=a(this).prevAll(".ai-debug-bar.ai-debug-scheduling");q.find(".ai-debug-name.ai-scheduling-info").text(I+" "+D+" current_time:"+C.toString()+"  start_date:"+u.toString()+" ="+(C>=u).toString()+" end_date:"+A.toString()+" =:"+(C<A).toString()+" days:"+B.toString()+" =:"+B.includes(D.toString()).toString());q.find(".ai-debug-name.ai-scheduling-status").text(b?ai_front.visible:ai_front.hidden);b||0==O||(q.removeClass("ai-debug-scheduling").addClass("ai-debug-fallback"),q.find(".ai-debug-name.ai-scheduling-status").text(ai_front.fallback+"="+O))}}if(g||M)return!0;a(this).css({visibility:"",position:"",width:"",height:"","z-index":""});b?(d.css({visibility:""}),d.hasClass("ai-remove-position")&&d.css({position:""}),"undefined"!=typeof a(this).data("code")&&(b=b64d(a(this).data("code")),0!=a(this).closest("head").length?(a(this).after(b),a(this).remove()):a(this).append(b),ai_process_element(this))):f&&!v&&0!=O?(d.css({visibility:""}),d.hasClass("ai-remove-position")&&d.css({position:""}),a(this).next(".ai-fallback").removeClass("ai-fallback"),"undefined"!=typeof a(this).data("fallback-code")?(b=b64d(a(this).data("fallback-code")),a(this).append(b),ai_process_element(this)):(a(this).hide(),d.find(".ai-debug-block").length||d.hide()),b=d.attr("data-ai"),"undefined"!==typeof b&&!1!==b&&(b=a(this).attr("fallback-tracking"),"undefined"!==typeof b&&!1!==b&&d.attr("data-ai",b))):(a(this).hide(),d.find(".ai-debug-block").length||d.hide(),d.removeAttr("data-ai").removeClass("ai-track"),d.find(".ai-debug-block").length?(d.css({visibility:""}).removeClass("ai-close"),d.hasClass("ai-remove-position")&&d.css({position:""})):d.hide());a(this).attr("data-code","");a(this).attr("data-fallback-code","");d.removeClass("ai-list-block")})}};a(document).ready(function(e){setTimeout(function(){ai_process_lists();setTimeout(function(){n()},50);if("function"==typeof ai_load_blocks)jQuery(document).on("cmplzEnableScripts",function(h){"all"===h.consentLevel&&ai_load_blocks()});jQuery("#ai-iab-tcf-bar").click(function(){AiCookies.remove("euconsent-v2",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("__lxG__consent__v2",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("__lxG__consent__v2_daisybit",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("__lxG__consent__v2_gdaisybit",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("cmplz_marketing",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("cmplz_stats",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("complianz_consent_status",{path:"/",domain:"."+window.location.hostname});jQuery("#ai-iab-tcf-status").text("COOKIE DELETED")})},5)})});function ai_process_element(a){setTimeout(function(){"function"==typeof ai_process_rotations_in_element&&ai_process_rotations_in_element(a);"function"==typeof ai_process_lists&&ai_process_lists(jQuery(".ai-list-data",a));"function"==typeof ai_process_ip_addresses&&ai_process_ip_addresses(jQuery(".ai-ip-data",a));"function"==typeof ai_adb_process_blocks&&ai_adb_process_blocks(a)},5)}function getAllUrlParams(a){var k=a?a.split("?")[1]:window.location.search.slice(1);a={};if(k){k=k.split("#")[0];k=k.split("&");for(var z=0;z<k.length;z++){var n=k[z].split("="),E=void 0,e=n[0].replace(/\[\d*\]/,function(h){E=h.slice(1,-1);return""});n="undefined"===typeof n[1]?"":n[1];e=e.toLowerCase();n=n.toLowerCase();a[e]?("string"===typeof a[e]&&(a[e]=[a[e]]),"undefined"===typeof E?a[e].push(n):a[e][E]=n):a[e]=n}}return a};jQuery(function(a){function t(g,c){c||(c=window.location.href);g=g.replace(/[\[\]]/g,"\\$&");var e=(new RegExp("[?&]"+g+"(=([^&#]*)|&|#|$)")).exec(c);return e?e[2]?decodeURIComponent(e[2].replace(/\+/g," ")):"":null}function u(g){g.removeClass("ai-ip-data");var c=!1;if(""!=ai_ip_data){try{var e=JSON.parse(ai_ip_data),h=e[0],l=e[1],n=e[2],p=e[3]}catch(d){return}var q=h+", "+l;null!=n&&null!=p&&(q=q+":"+n+":"+p);null==n&&(n="");null==p&&(p="");null!=e&&g.each(function(){var d=a(this).closest("div.code-block");c=!0;var f=a(this).attr("ip-addresses");if("undefined"!=typeof f){f=f.split(",");var r=a(this).attr("ip-address-list"),k=!1;a.each(f,function(v,b){if("*"==b.charAt(0))if("*"==b.charAt(b.length-1)){if(b=b.substr(1,b.length-2),-1!=h.indexOf(b))return k=!0,!1}else{if(b=b.substr(1),h.substr(-b.length)==b)return k=!0,!1}else if("*"==b.charAt(b.length-1)){if(b=b.substr(0,b.length-1),0==h.indexOf(b))return k=!0,!1}else if("#"==b){if(""==h)return k=!0,!1}else if(b==h)return k=!0,!1});switch(r){case "B":k&&(c=!1);break;case "W":k||(c=!1)}}if(c&&(f=a(this).attr("countries"),"undefined"!=typeof f))switch(f=f.split(","),r=a(this).attr("country-list"),k=!1,a.each(f,function(v,b){var m=b.trim().split(":");if(null==m[1]||""==n)m[1]="";if(null==m[2]||""==p)m[2]="";var w=m.join(":").toUpperCase();m=(l+":"+(""==m[1]?"":n)+":"+(""==m[2]?"":p)).toUpperCase();if(w==m)return k=!0,!1}),r){case "B":k&&(c=!1);break;case "W":k||(c=!1)}a(this).css({visibility:"",position:"",width:"",height:"","z-index":""});f=a(this).prev(".ai-debug-bar");f.find(".ai-debug-name.ai-ip-country").text(q);f.find(".ai-debug-name.ai-ip-status").text(c?ai_front.visible:ai_front.hidden);c?(d.css({visibility:""}),d.hasClass("ai-remove-position")&&d.css({position:""}),"undefined"!=typeof a(this).data("code")&&(f=b64d(a(this).data("code")),0!=a(this).closest("head").length?(a(this).after(f),a(this).remove()):a(this).append(f),a(this).attr("data-code",""),ai_process_element(this))):(a(this).hide(),d.find(".ai-debug-block").length||d.hide(),d.removeAttr("data-ai"),d.find(".ai-debug-block")?(d.css({visibility:""}).removeClass("ai-close"),d.hasClass("ai-remove-position")&&d.css({position:""}),"undefined"!=typeof a(this).data("code")&&(d.removeClass("ai-list-block"),d.prev().hasClass("ai-debug-info")&&d.prev().remove())):d.hide());d.removeClass("ai-list-block-ip")})}}ai_process_ip_addresses=function(g){g=null==g?a("div.ai-ip-data, meta.ai-ip-data"):g.filter(".ai-ip-data");if(g.length)if("undefined"!=typeof ai_ip_data)u(g);else if("undefined"==typeof ai_ip_data_requested){ai_ip_data_requested=!0;var c="/wp-admin/admin-ajax.php?action=ai_ajax&ip-data=ip-address-country-city&ai_check=e25a7b7809&ver="+((new Date).getTime()+"-"+Math.round(1E5*Math.random())),e=t("ai-debug-ip-address");null!=e&&(c+="&ai-debug-ip-address="+e);e=t("ai-debug-country");null!=e&&(c+="&ai-debug-country="+e);a.get(c,function(h){ai_ip_data=h;if(""==h){var l="Ajax request returned empty data, geo-targeting disabled";console.error(l);"undefined"!=typeof ai_js_errors&&ai_js_errors.push([l,c,0])}else try{JSON.parse(h)}catch(n){l="Ajax call returned invalid data, geo-targeting disabled",console.error(l,h),"undefined"!=typeof ai_js_errors&&ai_js_errors.push([l,c,0])}u(g)}).fail(function(h,l,n){a("div.ai-ip-data").each(function(){a(this).css({display:"none",visibility:"",position:"",width:"",height:"","z-index":""}).removeClass("ai-ip-data").hide()})})}};a(document).ready(function(g){setTimeout(function(){ai_process_ip_addresses()},5)})});function ai_process_element(a){setTimeout(function(){"function"==typeof ai_process_rotations_in_element&&ai_process_rotations_in_element(a);"function"==typeof ai_process_lists&&ai_process_lists(jQuery(".ai-list-data",a));"function"==typeof ai_process_ip_addresses&&ai_process_ip_addresses(jQuery(".ai-ip-data",a));"function"==typeof ai_adb_process_blocks&&ai_adb_process_blocks(a)},5)};ai_run_123036630650 = function(){ai_document_write=document.write;document.write=function(a){"interactive"==document.readyState?(console.error("document.write called after page load: ",a),"undefined"!=typeof ai_js_errors&&ai_js_errors.push(["document.write called after page load",a,0])):ai_document_write.call(document,a)};ai_insert ('after', '.lwptoc', b64d ('PGRpdiBjbGFzcz0nY29kZS1ibG9jayBjb2RlLWJsb2NrLWRlZmF1bHQgY29kZS1ibG9jay0xMCBhaS12aWV3cG9ydC0zJz4KPGEgaHJlZj0iL2luc3RhLyIgcmVsPSJub2ZvbGxvdyIgdGFyZ2V0PSJfYmxhbmsiPjxpbWcgc3JjPSIvYi9wYW1tX2xhbmRpbmdfYmFubmVyXzMwMHgyNTBfcnVfLmdpZiIvPjwvYT4KPC9kaXY+Cg=='));};if (document.readyState === 'complete' || (document.readyState !== 'loading' && !document.documentElement.doScroll)) ai_run_123036630650 (); else document.addEventListener ('DOMContentLoaded', ai_run_123036630650);ai_js_code = true;</script> </body></html>