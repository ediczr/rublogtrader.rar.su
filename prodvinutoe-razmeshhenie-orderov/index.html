<!DOCTYPE html><html lang="ru-RU" prefix="og: http://ogp.me/ns#"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1' /><link media="all" href="https://rublogtrader.rar.su/wp-content/cache/autoptimize/css/autoptimize_a956534720ee1514d6564ed8c0f433d5.css" rel="stylesheet" /><title>Продвинутое размещение ордеров и управление ордерами в MQL4</title><meta name="description" content="Подробно разбираем, как можно управлять и модифицировать ордера после их создания, проверять размер лота, цены стоп-лосса и тейк-профита." /><meta property="og:locale" content="ru_RU" /><meta property="og:type" content="article" /><meta property="og:title" content="Продвинутое размещение ордеров и управление ордерами в MQL4" /><meta property="og:description" content="Подробно разбираем, как можно управлять и модифицировать ордера после их создания, проверять размер лота, цены стоп-лосса и тейк-профита." /><meta property="og:url" content="https://rublogtrader.rar.su/prodvinutoe-razmeshhenie-orderov/" /><meta property="og:site_name" content="Блог трейдера" /><meta property="article:published_time" content="2020-06-11T11:20:45+00:00" /><meta property="article:modified_time" content="2020-06-11T11:32:32+00:00" /><meta property="og:image" content="https://rublogtrader.rar.su/wp-content/uploads/2020/06/prodvinutoe-razmeshhenie-orderov-i-upravlenie-orderami-v-mql4.jpg" /><meta property="og:image:width" content="1200" /><meta property="og:image:height" content="630" /><meta property="og:image:type" content="image/jpeg" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:creator" content="@traderblog_net" /><meta name="twitter:site" content="@traderblog_net" /><meta name="twitter:label1" content="Написано автором" /><meta name="twitter:data1" content="Александр Паркер" /><meta name="twitter:label2" content="Примерное время для чтения" /><meta name="twitter:data2" content="6 минут" /> <script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://rublogtrader.rar.su/#website","url":"https://rublogtrader.rar.su/","name":"\u0411\u043b\u043e\u0433 \u0442\u0440\u0435\u0439\u0434\u0435\u0440\u0430","description":"My WordPress Blog","publisher":{"@id":"https://rublogtrader.rar.su/#/schema/person/28382f0e81820f364e345a97d4203238"},"potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://rublogtrader.rar.su/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"ru-RU"},{"@type":"ImageObject","@id":"https://rublogtrader.rar.su/prodvinutoe-razmeshhenie-orderov/#primaryimage","inLanguage":"ru-RU","url":"https://rublogtrader.rar.su/wp-content/uploads/2020/06/prodvinutoe-razmeshhenie-orderov-i-upravlenie-orderami-v-mql4.jpg","contentUrl":"https://rublogtrader.rar.su/wp-content/uploads/2020/06/prodvinutoe-razmeshhenie-orderov-i-upravlenie-orderami-v-mql4.jpg","width":1200,"height":630,"caption":"\u041f\u0440\u043e\u0434\u0432\u0438\u043d\u0443\u0442\u043e\u0435 \u0440\u0430\u0437\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u043e\u0440\u0434\u0435\u0440\u043e\u0432 \u0438 \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043e\u0440\u0434\u0435\u0440\u0430\u043c\u0438 \u0432 MQL4"},{"@type":"WebPage","@id":"https://rublogtrader.rar.su/prodvinutoe-razmeshhenie-orderov/#webpage","url":"https://rublogtrader.rar.su/prodvinutoe-razmeshhenie-orderov/","name":"\u041f\u0440\u043e\u0434\u0432\u0438\u043d\u0443\u0442\u043e\u0435 \u0440\u0430\u0437\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u043e\u0440\u0434\u0435\u0440\u043e\u0432 \u0438 \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043e\u0440\u0434\u0435\u0440\u0430\u043c\u0438 \u0432 MQL4","isPartOf":{"@id":"https://rublogtrader.rar.su/#website"},"primaryImageOfPage":{"@id":"https://rublogtrader.rar.su/prodvinutoe-razmeshhenie-orderov/#primaryimage"},"datePublished":"2020-06-11T11:20:45+00:00","dateModified":"2020-06-11T11:32:32+00:00","description":"\u041f\u043e\u0434\u0440\u043e\u0431\u043d\u043e \u0440\u0430\u0437\u0431\u0438\u0440\u0430\u0435\u043c, \u043a\u0430\u043a \u043c\u043e\u0436\u043d\u043e \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c \u0438 \u043c\u043e\u0434\u0438\u0444\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0440\u0434\u0435\u0440\u0430 \u043f\u043e\u0441\u043b\u0435 \u0438\u0445 \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f, \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u0440\u0430\u0437\u043c\u0435\u0440 \u043b\u043e\u0442\u0430, \u0446\u0435\u043d\u044b \u0441\u0442\u043e\u043f-\u043b\u043e\u0441\u0441\u0430 \u0438 \u0442\u0435\u0439\u043a-\u043f\u0440\u043e\u0444\u0438\u0442\u0430.","breadcrumb":{"@id":"https://rublogtrader.rar.su/prodvinutoe-razmeshhenie-orderov/#breadcrumb"},"inLanguage":"ru-RU","potentialAction":[{"@type":"ReadAction","target":["https://rublogtrader.rar.su/prodvinutoe-razmeshhenie-orderov/"]}]},{"@type":"BreadcrumbList","@id":"https://rublogtrader.rar.su/prodvinutoe-razmeshhenie-orderov/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"\u0413\u043b\u0430\u0432\u043d\u0430\u044f \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0430","item":"https://rublogtrader.rar.su/"},{"@type":"ListItem","position":2,"name":"\u041f\u0440\u043e\u0434\u0432\u0438\u043d\u0443\u0442\u043e\u0435 \u0440\u0430\u0437\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u043e\u0440\u0434\u0435\u0440\u043e\u0432 \u0438 \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043e\u0440\u0434\u0435\u0440\u0430\u043c\u0438 \u0432 MQL4"}]},{"@type":"Article","@id":"https://rublogtrader.rar.su/prodvinutoe-razmeshhenie-orderov/#article","isPartOf":{"@id":"https://rublogtrader.rar.su/prodvinutoe-razmeshhenie-orderov/#webpage"},"author":{"@id":"https://rublogtrader.rar.su/#/schema/person/28382f0e81820f364e345a97d4203238"},"headline":"\u041f\u0440\u043e\u0434\u0432\u0438\u043d\u0443\u0442\u043e\u0435 \u0440\u0430\u0437\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u043e\u0440\u0434\u0435\u0440\u043e\u0432 \u0438 \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043e\u0440\u0434\u0435\u0440\u0430\u043c\u0438 \u0432 MQL4","datePublished":"2020-06-11T11:20:45+00:00","dateModified":"2020-06-11T11:32:32+00:00","mainEntityOfPage":{"@id":"https://rublogtrader.rar.su/prodvinutoe-razmeshhenie-orderov/#webpage"},"wordCount":379,"commentCount":0,"publisher":{"@id":"https://rublogtrader.rar.su/#/schema/person/28382f0e81820f364e345a97d4203238"},"image":{"@id":"https://rublogtrader.rar.su/prodvinutoe-razmeshhenie-orderov/#primaryimage"},"thumbnailUrl":"https://rublogtrader.rar.su/wp-content/uploads/2020/06/prodvinutoe-razmeshhenie-orderov-i-upravlenie-orderami-v-mql4.jpg","articleSection":["MQL4"],"inLanguage":"ru-RU","potentialAction":[{"@type":"CommentAction","name":"Comment","target":["https://rublogtrader.rar.su/prodvinutoe-razmeshhenie-orderov/#respond"]}]},{"@type":["Person","Organization"],"@id":"https://rublogtrader.rar.su/#/schema/person/28382f0e81820f364e345a97d4203238","name":"\u0410\u043b\u0435\u043a\u0441\u0430\u043d\u0434\u0440 \u041f\u0430\u0440\u043a\u0435\u0440","image":{"@type":"ImageObject","@id":"https://rublogtrader.rar.su/#personlogo","inLanguage":"ru-RU","url":"https://rublogtrader.rar.su/wp-content/uploads/2019/06/cosmopolis-100x100.png","contentUrl":"https://rublogtrader.rar.su/wp-content/uploads/2019/06/cosmopolis-100x100.png","width":100,"height":100,"caption":"\u0410\u043b\u0435\u043a\u0441\u0430\u043d\u0434\u0440 \u041f\u0430\u0440\u043a\u0435\u0440"},"logo":{"@id":"https://rublogtrader.rar.su/#personlogo"},"description":"\u0421\u043e\u0437\u0434\u0430\u0442\u0435\u043b\u044c \u0438 \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440 \u0441\u0430\u0439\u0442\u0430 traderblog.net.","sameAs":["https://rublogtrader.rar.su/"]}]}</script> <link rel="alternate" type="application/rss+xml" title="Блог трейдера &raquo; Лента" href="https://rublogtrader.rar.su/feed/" /> <script type='text/javascript' src='https://rublogtrader.rar.su/wp-includes/js/jquery/jquery.min.js' id='jquery-core-js'></script> <link rel="https://api.w.org/" href="https://rublogtrader.rar.su/wp-json/" /><link rel="alternate" type="application/json" href="https://rublogtrader.rar.su/wp-json/wp/v2/posts/14305" />   <link rel="icon" type="image/png" sizes="32x32" href="/favicon32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon16.png"><link rel="apple-touch-icon" sizes="180x180" href="/appleicon.png">  <!-- Yandex.Metrika counter --><script type="text/javascript" > (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)}; m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)}) (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym"); ym(87171221, "init", { clickmap:true, trackLinks:true, accurateTrackBounce:true, webvisor:true });</script><noscript><div><img src="https://mc.yandex.ru/watch/87171221" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter --></head><body ><div id="page" class="site"><header id="masthead" class="site-header"><div class="row"><div class="col-xs-12 site-header-col"><div class="site-branding"><p class="site-title"><a href="/" rel="home">Блог трейдера</a></p></div><nav id="site-navigation" class="main-navigation"> <button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">Меню</button><div class="menu-menu-container"><ul id="primary-menu" class="menu"><li id="menu-item-14443" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-14443"><a href="https://rublogtrader.rar.su/forex/">Форекс</a></li><li id="menu-item-14444" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-14444"><a href="https://rublogtrader.rar.su/trading/">Трейдинг</a></li><li id="menu-item-12561" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12561"><a href="https://rublogtrader.rar.su/technical-analysis/">Технический анализ</a></li><li id="menu-item-12560" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12560"><a href="https://rublogtrader.rar.su/indicators/">Индикаторы</a></li><li id="menu-item-12559" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12559"><a href="https://rublogtrader.rar.su/prajs-jekshen/">Прайс экшен</a></li><li id="menu-item-15892" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-15892"><a href="https://rublogtrader.rar.su/investing/">Инвестиции</a></li><li id="menu-item-16239" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-16239"><a href="https://rublogtrader.rar.su/crypto/">Крипто</a></li></ul></div></nav></div></div></header><div class='code-block code-block-center code-block-2 ai-viewport-1'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader1" rel="nofollow" target="_blank"><img src="https://advertising-blog.qqit.ru/rublogtrader.rar.su/468x60.gif"/></a></div><div id="content" class="site-content"><div class="row row--index"><div class="col-xs-12"><div id="primary" class="content-area"><main id="main" class="site-main" role="main"><article id="post-14305" class="post-14305 post type-post status-publish format-standard has-post-thumbnail hentry category-mql4"><div class="row no-pad"><div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 no-pad"><header class="entry-header"><h1 class="entry-title">Продвинутое размещение ордеров и управление ордерами в MQL4</h1><div class="entry-meta"><a href="https://rublogtrader.rar.su/mql4/" rel="category tag">MQL4</a> | 11.06.2020 | <i class="icon-07"></i> 1181</div></header><div class="entry-content"> <img src="" style="float:right;" align="right"><p>По умолчанию метод размещения стоп-лосса и тейк-профита с помощью рыночного ордера заключается в размещении их с помощью функции OrderSend(). Однако это невозможно для ECN/STP-брокеров.<br> <span id="more-14305"></span><br> В этом случае нам нужно будет разместить стоп-лосс и тейк-профит после размещения ордера с помощью функции OrderModify(). Это относится только к рыночным ордерам — для отложенных ордеров вы все равно сможете разместить стоп-лосс и тейк-профит с помощью функции OrderSend().</p><div class="lwptoc lwptoc-autoWidth lwptoc-baseItems lwptoc-transparent lwptoc-notInherit" data-smooth-scroll="1" data-smooth-scroll-offset="24"><div class="lwptoc_i"><div class="lwptoc_items lwptoc_items-visible"><div class="lwptoc_itemWrap"><div class="lwptoc_item"> <a href="#Izmenenie_orderov"> <span class="lwptoc_item_label">Изменение ордеров</span> </a></div><div class="lwptoc_item"> <a href="#Dobavlenie_stop-lossa_i_tejk-profita_v_susestvuusij_order"> <span class="lwptoc_item_label">Добавление стоп-лосса и тейк-профита в существующий ордер</span> </a></div><div class="lwptoc_item"> <a href="#Izmenenie_ceny_dla_otlozennyh_orderov"> <span class="lwptoc_item_label">Изменение цены для отложенных ордеров</span> </a></div><div class="lwptoc_item"> <a href="#Proverka_cen_dla_orderov"> <span class="lwptoc_item_label">Проверка цен для ордеров</span> </a></div><div class="lwptoc_item"> <a href="#Urovni_stopov"> <span class="lwptoc_item_label">Уровни стопов</span> </a></div><div class="lwptoc_item"> <a href="#Proverka_cen_dla_stop-lossa_i_tejk-profita"> <span class="lwptoc_item_label">Проверка цен для стоп-лосса и тейк-профита</span> </a></div><div class="lwptoc_item"> <a href="#Proverka_ceny_dla_otlozennyh_orderov"> <span class="lwptoc_item_label">Проверка цены для отложенных ордеров</span> </a></div><div class="lwptoc_item"> <a href="#Rasscet_razmera_lota"> <span class="lwptoc_item_label">Рассчет размера лота</span> </a></div><div class="lwptoc_item"> <a href="#Upravlenie_kapitalom"> <span class="lwptoc_item_label">Управление капиталом</span> </a></div><div class="lwptoc_item"> <a href="#Proverka_razmera_lota"> <span class="lwptoc_item_label">Проверка размера лота</span> </a></div><div class="lwptoc_item"> <a href="#Kontekst_torgovli"> <span class="lwptoc_item_label">Контекст торговли</span> </a></div><div class="lwptoc_item"> <a href="#Obnovlenie_zadannyh_peremennyh"> <span class="lwptoc_item_label">Обновление заданных переменных</span> </a></div><div class="lwptoc_item"> <a href="#Obrabotka_osibok"> <span class="lwptoc_item_label">Обработка ошибок</span> </a></div><div class="lwptoc_item"> <a href="#Soedinaem_vse_vmeste"> <span class="lwptoc_item_label">Соединяем все вместе</span> </a></div></div></div></div></div><div class='code-block code-block-center code-block-3 ai-viewport-1'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader2" rel="nofollow" target="_blank"><img src="https://advertising-blog.qqit.ru/rublogtrader.rar.su/pamm_landing_banner_970x250_ru_1.gif"/></a></div><h2><span id="Izmenenie_orderov">Изменение ордеров</span></h2><p>После размещения ордера вы можете изменить тейк-профит, стоп-лосс, цену отложенного ордера или время истечения, используя функцию OrderModify(). Чтобы использовать OrderModify(), нам понадобится тикет ордера, который мы хотим изменить. Вот синтаксис функции OrderModify():</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">bool OrderModify<span class="br0">(</span><span class="kw4">int</span> Ticket<span class="sy0">,</span> <span class="kw4">double</span> Price<span class="sy0">,</span> <span class="kw4">double</span> StopLoss<span class="sy0">,</span> <span class="kw4">double</span> TakeProfit<span class="sy0">,</span> datetime Expiration<span class="sy0">,</span> color Arrow <span class="sy0">=</span> CLR_NONE<span class="br0">)</span></pre></div></div></div></div></div></div></div><ul><li><strong>Ticket</strong> — номер тикета ордера, который нужно изменить.</li><li><strong>Price</strong> — цена нового отложенного ордера.</li><li><strong>StopLoss</strong> — новая цена стоп-лосса.</li><li><strong>TakeProfit</strong> — новая цена тейк-профита.</li><li><strong>Expiration</strong> — новое время истечения для отложенных ордеров.</li><li><strong>Arrow</strong> — необязательный параметр цвета стрелки.</li></ul><p>Если изменение ордера выполнено успешно, OrderModify() вернет значение true. В противном случае будет возвращено false.</p><p>При изменении ордеров мы должны быть уверены, что значения, которые мы передаем функции, действительны. Например, ордер должен быть открытым — мы не можем изменить закрытый ордер. При изменении отложенных ордеров с помощью параметра Price, ордер не должен быть уже исполнен.</p><p>Измененная цена ордера также не должна быть слишком близкой к текущей цене Bid или Ask. Мы также должны проверить стоп-лосс и тейк-профит.</p><p>Если мы не изменяем определенный параметр, мы должны передать исходное значение в функцию OrderModify(). Например, если мы изменяем только стоп-лосс для отложенного ордера, мы должны извлечь текущую цену ордера и тейк-профит с помощью OrderSelect() и передать эти значения в функцию OrderModify().</p><p>Если вы попытаетесь изменить ордер без указания каких-либо измененных значений, вы получите ошибку 1: «нет результата».</p><h2><span id="Dobavlenie_stop-lossa_i_tejk-profita_v_susestvuusij_order">Добавление стоп-лосса и тейк-профита в существующий ордер</span></h2><p>Во-первых, нам нужно убедиться, что ордер был размещен правильно. Мы делаем это, проверяя возвращаемое значение функции OrderSend(), которая является номером тикета только что размещенного ордера. Если ордер не был создан из-за ошибки, номер тикета будет равен -1.</p><p>Затем мы используем функцию OrderSelect(), чтобы получить информацию о только что размещенном ордере. Мы будем использовать функции OrderOpenPrice(), OrderTakeProfit(), OrderStopLoss() и, опционально, функции OrderExpiration() при передаче неизменных значений в функцию OrderModify(). Наконец, мы будем использовать OrderModify(), чтобы добавить стоп-лосс и зафиксировать прибыль в ордере.</p><p>Разберем пример, где мы устанавливаем стоп-лосс и тейк-профит для ордера на покупку, используя функцию OrderModify().</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">int</span> BuyTicket <span class="sy0">=</span> OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_BUY<span class="sy0">,</span>LotSize<span class="sy0">,</span>Ask<span class="sy0">,</span>UseSlippage<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span> <span class="st0">&quot;Buy Order&quot;</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Green<span class="br0">)</span><span class="sy0">;</span>    <span class="kw1">if</span><span class="br0">(</span>BuyTicket <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>        OrderSelect<span class="br0">(</span>BuyTicket<span class="sy0">,</span>SELECT_BY_TICKET<span class="br0">)</span><span class="sy0">;</span>        <span class="kw4">double</span> OpenPrice <span class="sy0">=</span> OrderOpenPrice<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>        <span class="kw1">if</span><span class="br0">(</span>StopLoss <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> BuyStopLoss <span class="sy0">=</span> OpenPrice – <span class="br0">(</span>StopLoss <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span>        <span class="kw1">if</span><span class="br0">(</span>TakeProfit <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> BuyTakeProfit <span class="sy0">=</span> OpenPrice <span class="sy0">+</span> <span class="br0">(</span>TakeProfit <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span> <span class="kw1">if</span><span class="br0">(</span>BuyStopLoss <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">||</span> BuyTakeProfit <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>             bool TicketMod <span class="sy0">=</span> OrderModify<span class="br0">(</span>BuyTicket<span class="sy0">,</span>OrderOpenPrice<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>BuyStopLoss<span class="sy0">,</span>BuyTakeProfit<span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> <span class="br0">}</span></pre></div></div></div></div></div></div></div><p>В функции OrderSend() мы используем значение 0 для параметров стоп-лосса и тейк-профита. Нулевое значение означает, что стоп-лосс и тейк-профит не размещаются вместе с ордером. В переменной BuyTicket хранится номер тикета.</p><p>Мы используем оператор if, чтобы убедиться, что номер BuyTicket действителен, то есть больше нуля. Если это так, мы вызываем функцию OrderSelect(), используя BuyTicket. Мы извлекаем цену открытия для ордера, используя OrderOpenPrice(), и назначаем ее переменной OpenPrice.</p><p>Далее мы рассчитываем стоп-лосс и тейк-профит относительно цены открытия ордера, который мы только что разместили. Сначала мы проверяем, являются ли внешние переменные StopLoss и TakeProfit больше нуля.</p><p>Наконец, мы вызываем функцию OrderModify(), чтобы добавить наш стоп-лосс и зафиксировать прибыль в ордере. Сначала мы проверяем, чтобы переменные BuyStopLoss или BuyTakeProfit отличались от нуля. Если мы попытаемся изменить порядок с неизменными значениями, мы получим код ошибки 1 от функции OrderModify().</p><p>Первым параметром для OrderModify() является наш номер BuyTicket. Мы также можем использовать OrderTicket(). Второй параметр — цена нового ордера. Поскольку мы не изменяем цену ордера, мы используем функцию OrderOpenPrice(), чтобы указать, что цена ордера не изменилась.</p><p>Помните, что мы можем изменять цены только для отложенных ордеров. Если мы модифицируем рыночный ордер, мы можем передать любое значение параметра Price, поскольку вы не можете изменить цену рыночного ордера.</p><p>Переменные BuyStopLoss и BuyTakeProfit передают измененный стоп-лосс и значения тейк-профита в функцию OrderModify(). Если вы планируете использовать время истечения ордера для отложенных ордеров, вы можете использовать OrderExpiration(). В противном случае просто используйте 0.</p><p>Хотя этот метод добавляет несколько дополнительных шагов, мы рекомендуем вам использовать этот метод размещения стоп-лоссов и фиксации прибыли для рыночных ордеров в ваших советниках, чтобы обеспечить их совместимость со всеми брокерами. Этот метод также обладает тем преимуществом, что позволяет нам размещать точный стоп-лосс и фиксировать цены без влияния проскальзывания.</p><h2><span id="Izmenenie_ceny_dla_otlozennyh_orderov">Изменение цены для отложенных ордеров</span></h2><p>Функцию OrderModify() также можно использовать для изменения цены отложенного ордера. Если цена отложенного ордера уже была достигнута и ордер был исполнен, он больше не является отложенным ордером и его нельзя изменить.</p><p>Мы будем использовать переменную NewPendingPrice для представления цены ордера. Предположим, что цена уже рассчитана и действительна. Вот как мы изменяем цену отложенного ордера:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">OrderSelect<span class="br0">(</span>Ticket<span class="sy0">,</span>SELECT_BY_TICKET<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>NewPendingPrice <span class="sy0">!=</span> OrderOpenPrice<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>bool TicketMod <span class="sy0">=</span> OrderModify<span class="br0">(</span>Ticket<span class="sy0">,</span>NewPendingPrice<span class="sy0">,</span>OrderStopLoss<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span> OrderTakeProfit<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Сначала мы получаем информацию об ордере, используя OrderSelect(). Таким образом, мы можем передать неизменный стоп-лосс и зафиксировать цены в функции OrderModify(). Перед изменением ордера мы проверяем, что наша новая цена отложенного ордера не совпадает с текущей ценой отложенного ордера.</p><p>Для OrderModify() мы указываем тикет ордера, новую цену, сохраненную в NewPendingPrice, и неизменные значения стоп-лосса и тейк-профита, представленные OrderStopLoss() и OrderTakeProfit().</p><h2><span id="Proverka_cen_dla_orderov">Проверка цен для ордеров</span></h2><p>Стоп-лосс, тейк-профит и цены отложенного ордера должны находиться на минимальном расстоянии от цен Bid и Ask. Если цена стоп-ордера или отложенного ордера слишком близка к текущей цене, возникнет ошибка, и ордер не будет размещен. Это одна из самых распространенных ошибок, и ее легко можно предотвратить, если трейдер будет устанавливать свои стопы и отложенные ордера на достаточном расстоянии от цены.</p><p>Но в периоды быстрого движения цены действительные цены стоп-лосса могут быть признаны недействительными за счет расширения спредов. Разные брокеры имеют разные уровни стопов, поэтому стоп-лосс, действительный для одного брокера, может быть слишком близким для другого. Некоторые торговые системы устанавливают цены стопов и отложенных ордеров на основании значений индикатора, максимумов или минимумов цены или другого метода расчета, когда минимальное расстояние не может быть гарантировано.</p><p>По этим причинам всегда необходимо убедиться, что цена стоп-лосса, тейк-профита или отложенного ордера действительна и не находится слишком близко к текущей рыночной цене.</p><h2><span id="Urovni_stopov">Уровни стопов</span></h2><p>Уровень стопа — это количество пунктов от текущей цены Bid или Ask, на которое могут быть выставлены стопы и отложенные ордера. Для большинства брокеров уровень стопа составляет примерно 3-4 пункта. У ECN-брокеров обычно очень узкие уровни стопов, в то время как у других брокеров, таких как Alpari, более широкие уровни стопов (не менее 8 пунктов).</p><p><img loading="lazy" src="https://rublogtrader.rar.su/wp-content/uploads/2020/06/stops.png" alt="уровень стопов" width="354" height="360" class="alignnone size-full wp-image-14306" srcset="https://rublogtrader.rar.su/wp-content/uploads/2020/06/stops.png 354w, https://rublogtrader.rar.su/wp-content/uploads/2020/06/stops-295x300.png 295w" sizes="(max-width: 354px) 100vw, 354px"></p><p>По обе стороны от этой ценовой линии находятся границы, обозначенные уровнями стопов. Стоп-лосс, тейк-профит и отложенные ордера должны быть размещены за пределами этих границ.</p><p>Функция MarketInfo() с параметром MODE_STOPLEVEL используется для получения уровня стопа. Уровень остановки выражается как целое число, и его нужно будет преобразовать в дробное значение с помощью Point.</p><p>Для 4-значных котировок со стоп-уровнем в 3 пункта функция MarketInfo() с MODE_STOPLEVEL вернет 3. Для 5-значных котировок со стоп-уровнем в 3 пункта MarketInfo() вернет 30 из-за дополнительного десятичного числа. Вот код для извлечения уровня стопов и преобразования его в десятичное значение:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">double</span> StopLevel <span class="sy0">=</span> MarketInfo <span class="br0">(</span>Symbol <span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span> MODE_STOPLEVEL<span class="br0">)</span> <span class="sy0">*</span> Point<span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Обратите внимание, что мы используем предопределенную переменную Point вместо функции PipPoint(), которую мы создали ранее. Это потому, что нам нужно умножить уровень стопа на фактическое значение Point. Для валюты из 4 цифр Point составит 0,0001, а для валюты из 5 цифр — 0,00001. Если уровень стопа составляет 3 пункта, как показано выше, то дробное значение будет 0,0003.</p><p>Теперь, когда мы выяснили, как найти уровень стопа, нам нужно рассчитать минимальное и максимальное значения для нашего стоп-лосса, тейк-профита и отложенного ордера. Мы делаем это, добавляя или вычитая уровень стопа из наших текущих цен Bid и Ask.</p><p>Следующий код рассчитывает минимально допустимую цену для тейк-профита на покупку, стоп-лосс на продажу, стоп-ордер на покупку или лимитный ордер на продажу. Мы будем использовать значение StopLevel, которое мы рассчитали выше.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">double</span> UpperStopLevel <span class="sy0">=</span> Ask <span class="sy0">+</span> StopLevel<span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Если наша цена Ask составляет 1,4650, а StopLevel равен 0,0003 пункта, как рассчитано выше, минимальная цена уровня стопа будет 1,4653. Если мы размещаем тейк-профит на покупку с этим ордером, то он должен быть выше этой цены.</p><p>Следующий код рассчитывает максимально допустимую цену для тейк-профита на продажу, стоп-лосс на покупку, стоп-ордер на продажу или лимитного ордера на продажу. Обратите внимание, что мы просто используем Bid вместо Ask и вычитаем вместо добавления.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">double</span> LowerStopLevel <span class="sy0">=</span> Bid ​​<span class="sy0">-</span> StopLevel<span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Перед размещением ордера используйте приведенные выше значения UpperStopLevel и LowerStopLevel, чтобы проверить стоп-лосс, тейк-профит и цены отложенного ордера. Имейте в виду, что цены могут быстро меняться, и вам нужно, чтобы ваши фактические стопы, прибыль и отложенные ордера находились далеко за пределами данных уровней.</p><h2><span id="Proverka_cen_dla_stop-lossa_i_tejk-profita">Проверка цен для стоп-лосса и тейк-профита</span></h2><p>Минимальный тейк-профит в пунктах будет равен цене открытия ордера, плюс или минус уровень стопа. Если уровень стопа составляет 3 пункта, а цена открытия ордера — 1.4500, цена тейк-профита для ордера на покупку должна быть выше 1.4503.</p><p>Минимальный стоп-лосс в пунктах для рыночного ордера будет включать текущий спред, поэтому минимальный стоп-лосс будет больше минимального тейк-профита. Например, если уровень стопа составляет 3 пункта, спред составляет 2 пункта, а цена открытия ордера составляет 1,4500, стоп-лосс для ордера на покупку на рынке должен быть ниже 1,4495.</p><p>Это не относится к отложенным ордерам, поэтому при проверке стоп-лосса для отложенных ордеров указывать спред не обязательно. Таким образом, если вы выставляете отложенный ордер на 1.4500, а уровень стопа составляет 3 пункта, то стоп-лосс можно разместить в любом месте ниже 1.4497.</p><p>Вот пример, где мы проверяем стоп-лосс и тейк-профит для ордера на покупку, чтобы убедиться, что цены действительны. Если цена стоп-лосс или тейк-профит недействительна, мы автоматически настроим ее так, чтобы она находилась в нескольких пунктах за пределами уровня стопа.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">double</span> MinStop <span class="sy0">=</span> <span class="nu0">5</span> <span class="sy0">*</span> UsePoint<span class="sy0">;</span><span class="kw1">if</span> <span class="br0">(</span>BuyStopLoss<span class="sy0">&gt;</span> LowerStopLevel<span class="br0">)</span> BuyStopLoss <span class="sy0">=</span> LowerStopLevel <span class="sy0">-</span> MinStop<span class="sy0">;</span> <span class="kw1">if</span> <span class="br0">(</span>BuyTakeProfit <span class="sy0">&lt;</span>UpperStopLevel<span class="br0">)</span> BuyTakeProfit <span class="sy0">=</span> UpperStopLevel <span class="sy0">+</span> MinStop<span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Переменная MinStop добавляет или вычитает 5 пунктов от уровня стопа, чтобы гарантировать, что наши проверенные цены не станут недействительными из-за проскальзывания. Вы можете отрегулировать это значение для обеспечения достаточного минимального уровня или даже использовать внешнюю переменную для корректировки этой суммы.</p><p>Вторая строка сравнивает наш стоп-лосс с нашим LowerStopLevel. Если стоп-лосс больше нашего нижнего стоп-уровня, мы знаем, что стоп-лосс недействителен. В этом случае мы корректируем стоп-лосс на несколько пунктов ниже нашего уровня. Третья строка делает то же самое для нашего тейк-профита.</p><p>Чтобы проверить стоп-лосс и тейк-профит для ордера на продажу, мы просто изменим расчеты:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">if</span> <span class="br0">(</span>SellTakeProfit<span class="sy0">&gt;</span> LowerStopLevel<span class="br0">)</span> SellTakeProfit <span class="sy0">=</span> LowerStopLevel <span class="sy0">-</span> MinStop<span class="sy0">;</span> <span class="kw1">if</span> <span class="br0">(</span>SellStopLoss <span class="sy0">&lt;</span>UpperStopLevel<span class="br0">)</span> SellStopLoss <span class="sy0">=</span> UpperStopLevel <span class="sy0">+</span> MinStop<span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Вместо автоматической корректировки недопустимой цены вы также можете отобразить сообщение об ошибке и остановить выполнение советника. Таким образом, пользователь должен будет перенастроить свой стоп-лосс или тейк-профит перед продолжением. Вот пример того, как это можно сделать:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">    <span class="kw1">if</span> <span class="br0">(</span>BuyStopLoss <span class="sy0">&gt;</span> LowerStopLevel<span class="br0">)</span> <span class="br0">{</span>Alert <span class="br0">(</span>«Стоп<span class="sy0">-</span>лосс слишком мал<span class="sy0">!</span>»<span class="br0">)</span><span class="sy0">;</span><span class="kw1">return</span> <span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Если рассчитанный стоп-лосс выше уровня стопа и, следовательно, находится слишком близок к цене, функция Alert() отобразит всплывающее сообщение для пользователя. Оператор возврата выходит из текущей функции и гарантирует, что ордер не будет размещен.</p><p>Также может быть полезно печатать сообщение в журнал:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">if</span><span class="br0">(</span>BuyStopLoss <span class="sy0">&gt;</span> LowerStopLevel<span class="br0">)</span> <span class="br0">{</span>BuyStopLoss <span class="sy0">=</span> LowerStopLevel <span class="sy0">-</span> MinStop<span class="sy0">;</span>Print<span class="br0">(</span><span class="st0">&quot;Стоп-лосс был автоматически настроен.&quot;</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span></pre></div></div></div></div></div></div></div><h2><span id="Proverka_ceny_dla_otlozennyh_orderov">Проверка цены для отложенных ордеров</span></h2><p>Вот как мы проверяем цену отложенного ордера для стоп-ордера на покупку или продажу. Переменная PendingPrice хранит цену отложенного ордера:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">if</span> <span class="br0">(</span>PendingPrice <span class="sy0">&lt;</span> UpperStopLevel<span class="br0">)</span> PendingPrice <span class="sy0">=</span> UpperStopLevel <span class="sy0">+</span> MinStop<span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Обратите внимание на то, что логика здесь идентична приведенному выше коду, который проверяет цену на покупку и тейк-профит, а также цену на продажу. А вот код для проверки цены отложенного ордера для стоп-ордера на продажу или ордера на покупку:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">if</span> <span class="br0">(</span>PendingPrice <span class="sy0">&gt;</span> UpperStopLevel<span class="br0">)</span> PendingPrice <span class="sy0">=</span> UpperStopLevel <span class="sy0">-</span> MinStop<span class="sy0">;</span></pre></div></div></div></div></div></div></div><div class='code-block code-block-center code-block-4 ai-viewport-3'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader2" rel="nofollow" target="_blank"><img src="/b/pamm_landing_banner_300x250_ru_.gif"/></a></div><div class='code-block code-block-center code-block-8 ai-viewport-1'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader2" rel="nofollow" target="_blank"><img src="https://advertising-blog.qqit.ru/rublogtrader.rar.su/pamm_landing_banner_970x250_ru_1.gif"/></a></div><h2><span id="Rasscet_razmera_lota">Рассчет размера лота</span></h2><p>Помимо выбора подходящего уровня стоп-лосса и тейк-профита, использование подходящего размера лота является одним из лучших инструментов управления рисками. Задать размер лота можно так же просто, как объявить внешнюю переменную или использовать фиксированный размера лота для каждого ордера. Мы рассмотрим более сложный метод, который вычисляет размер лота на основе максимальной суммы, которую вы готовы потерять за сделку.</p><p>Чрезмерное кредитное плечо — один из главных убийц депозитов трейдеров. Использование размеров лотов, которые слишком велики по отношению к вашему эквити, может легко уничтожить вашу учетную запись.</p><p>Рекомендуется рисковать не более 2-3% своего капитала за сделку. Максимальная сумма, которую вы можете потерять за сделку, должна составлять не более 2-3% от вашего счета.</p><h2><span id="Upravlenie_kapitalom">Управление капиталом</span></h2><p>Чтобы рассчитать размер лота с помощью этого метода, нам нужно указать процент используемых средств и стоп-лосс в пунктах. Мы будем использовать внешнюю переменную EquityPercent, чтобы установить процент использования капитала. Мы предполагаем, что используется стоп-лосс в 50 пипсов.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw2">extern</span> <span class="kw4">double</span> EquityPercent <span class="sy0">=</span> <span class="nu0">2</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Во-первых, нам нужно рассчитать сумму капитала, указанную EquityPercent. Если у нас есть баланс в размере 10 000 долларов США, и мы используем 2% нашего капитала, тогда расчет будет следующим:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">double</span> RiskAmount <span class="sy0">=</span> AccountEquity <span class="br0">(</span><span class="br0">)</span> <span class="sy0">*</span> <span class="br0">(</span>EquityPercent <span class="sy0">/</span> <span class="nu0">100</span><span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>AccountEquity() — это MQL-функция, которая возвращает текущий баланс счета. Мы делим EquityPercent на 100, чтобы получить дробное значение (0,02). Затем мы умножаем его на AccountEquity(), чтобы вычислить сумму используемого капитала. 2% от 10000 долларов — это 200 долларов, и они будут храниться в переменной RiskAmount.</p><p>Далее мы должны найти значение тика. Это прибыль на пункт, если мы торговали одним лотом желаемой валюты. Например, если мы торгуем 1 лотом EURUSD на стандартном счете (лоты по 100 тыс.), прибыль за пункт составит 10 долларов. На мини-счете (10 000 лотов) прибыль за пункт будет 1 доллар.</p><p>Мы можем использовать функцию MarketInfo() с параметром MODE_TICKVALUE, чтобы получить прибыль за пункт для указанной валюты. Значение тика должно быть указано в пунктах, поэтому, если мы торгуем на брокере с дробным количеством пунктов (3 или 5 десятичных знаков), мы должны умножить значение тика на 10.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">double</span> TickValue <span class="sy0">=</span> MarketInfo <span class="br0">(</span>Symbol <span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span> MODE_TICKVALUE<span class="br0">)</span><span class="sy0">;</span> <span class="kw1">if</span> <span class="br0">(</span>Point <span class="sy0">==</span> <span class="nu16">0.001</span> <span class="sy0">||</span> Point <span class="sy0">==</span> <span class="nu16">0.00001</span><span class="br0">)</span> TickValue <span class="sy0">*</span> <span class="sy0">=</span> <span class="nu0">10</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Предполагая, что мы торгуем на стандартном счете, значение тика для EURUSD будет равно 10. Это будет сохранено в переменной TickValue. Если это брокер с пятизначными котировками, то TickValue будет равен 1. Нам нужно умножить это значение на 10, чтобы сделать его эквивалентным одному пункту. Если переменная Point указывает, что валюта имеет 3 или 5 десятичных знаков, то значение TickValue будет умножено на 10, чтобы сделать его равным значению 2 или 4 десятичных знаков.</p><p>Следующим шагом является расчет размера нашего лота. Сначала мы делим RiskAmount на StopLoss. Это даст нам нашу прибыль за тик для данного ордера. 200 долларов, разделенные на наш стоп-лосс в 50, дадут нам 4 доллара. Теперь все, что нам нужно сделать, это разделить это значение на TickValue, чтобы получить размер лота:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">double</span> CalcLots <span class="sy0">=</span> <span class="br0">(</span>RiskAmount <span class="sy0">/</span> StopLoss<span class="br0">)</span> <span class="sy0">/</span> TickValue<span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Наш расчетный размер лота на стандартном счете составит 0,4 лота. На мини-счете рассчитанный размер лота составит 4 лота. Это значение хранится в переменной CalcLots.</p><p>Если вы используете правильное управление капиталом, процент капитала, который вы используете, будет постоянным. (1-2% для консервативного риска, до 5% для более высокого риска). С другой стороны, ваш стоп-лосс будет меняться в зависимости от выбранного таймфрейма и вашей торговой системы. Размер лота будет также будет варьироваться в зависимости от размера вашего стоп-лосса.</p><p>Фиксированный стоп-лосс приведет к увеличению размера лота, что обеспечит большую выгоду, если ваш ордер достигнет тейк-профита. С другой стороны, если вы используете большой стоп-лосс, размер вашего лота будет достаточно маленьким. Этот метод лучше всего выиграет от использования довольно узких стопов или больших значений тейк-профита.</p><p>Нам нужно иметь возможность выбирать между расчетом размера лота или использованием фиксированного размера лота. Давайте используем внешнюю логическую переменную DynamicLotSize для включения и выключения расчета размера лота:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="co1">// Внешние переменные</span><span class="kw2">extern</span> bool DynamicLotSize <span class="sy0">=</span> <span class="kw2">true</span><span class="sy0">;</span><span class="kw2">extern</span> <span class="kw4">double</span> EquityPercent <span class="sy0">=</span> <span class="nu0">2</span><span class="sy0">;</span><span class="kw2">extern</span> <span class="kw4">double</span> FixedLotSize <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">,</span><span class="nu0">1</span><span class="sy0">;</span>&nbsp;<span class="co1">// Запуск функции </span><span class="kw1">if</span> <span class="br0">(</span>DynamicLotSize <span class="sy0">==</span> <span class="kw2">true</span><span class="br0">)</span> <span class="br0">{</span><span class="kw4">double</span> RiskAmount <span class="sy0">=</span> AccountEquity <span class="br0">(</span><span class="br0">)</span> <span class="sy0">*</span> <span class="br0">(</span>EquityPercent <span class="sy0">/</span> <span class="nu0">100</span><span class="br0">)</span><span class="sy0">;</span><span class="kw4">double</span> TickValue <span class="sy0">=</span> MarketInfo <span class="br0">(</span>Symbol <span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span> MODE_TICKVALUE<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span> <span class="br0">(</span>Digits <span class="sy0">==</span> <span class="nu0">3</span> <span class="sy0">||</span> Digits <span class="sy0">==</span> <span class="nu0">5</span><span class="br0">)</span> TickValue <span class="sy0">*</span> <span class="sy0">=</span> <span class="nu0">10</span><span class="sy0">;</span><span class="kw4">double</span> CalcLots <span class="sy0">=</span> <span class="br0">(</span>RiskAmount <span class="sy0">/</span> StopLoss<span class="br0">)</span> <span class="sy0">/</span> TickValue<span class="sy0">;</span> <span class="kw4">double</span> LotSize <span class="sy0">=</span> CalcLots<span class="sy0">;</span><span class="br0">}</span><span class="kw1">else</span> LotSize <span class="sy0">=</span> FixedLotSize<span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Если для DynamicLotSize установлено значение true, мы рассчитаем размер лота на основании стоп-лосса и присвоим это значение переменной LotSize. Если DynamicLotSize имеет значение false, мы просто назначаем значение FixedLotSize для LotSize. Переменная LotSize будет передана в функцию OrderSend() в качестве размера лота для выбранного ордера.</p><h2><span id="Proverka_razmera_lota">Проверка размера лота</span></h2><p>Так же, как стоп-лосс, тейк-профит и цены отложенного ордера, размер лота также должен быть проверен, чтобы убедиться, что он приемлем для вашего брокера. Это означает, что размер вашего лота не должен быть слишком большим или слишком маленьким, и его не следует указывать в микролотах (0,01), если ваш брокер их не поддерживает. Вам также следует нормализовать размер вашего лота до соответствующего десятичного знака.</p><p>Давайте сначала проверим минимальный и максимальный размер лота. Функция MarketInfo(), использующая параметры MODE_MINLOT и MODE_MAXLOT, будет использоваться для сравнения размера текущего лота с минимальным и максимальным размером лота. Если размер лота недействителен, он будет автоматически изменен до минимального или максимального.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">if</span> <span class="br0">(</span>LotSize <span class="sy0">&lt;</span> MarketInfo <span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span> MODE_MINLOT<span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>LotSize <span class="sy0">=</span> MarketInfo <span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span> MODE_MINLOT<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span><span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">(</span>LotSize <span class="sy0">&gt;</span> MarketInfo <span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span> MODE_MAXLOT<span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>LotSize <span class="sy0">=</span> MarketInfo <span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span> MODE_MAXLOT<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Мы просто сравниваем значение LotSize, наш расчетный или фиксированный размер лота с минимальным и максимальным размером лота. Если LotSize меньше минимального размера лота или превышает максимальный размер лота, ему будет назначено соответствующее минимальное или максимальное значение.</p><p>Если вы попытаетесь использовать размер микро-лота для брокера, который разрешает только мини-лоты, вы получите ошибку, и сделка не будет размещена.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">if</span> <span class="br0">(</span>MarketInfo <span class="br0">(</span>Symbol <span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span> MODE_LOTSTEP<span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">)</span> <span class="br0">{</span>LotSize <span class="sy0">=</span> NormalizeDouble <span class="br0">(</span>LotSize<span class="sy0">,</span> <span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span> <span class="kw1">else</span> LotSize <span class="sy0">=</span> NormalizeDouble <span class="br0">(</span>LotSize<span class="sy0">,</span> <span class="nu0">2</span><span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Функция NormalizeDouble() округляет значение LotSize до количества цифр, указанного во втором аргументе. В первой строке, если размер шага равен 0,1 и указывает, что брокер использует только мини-лоты, LotSize будет округлен до одного десятичного знака. В противном случае, LotSize будет округлен до 2 десятичных знаков.</p><p>Если в будущем вы столкнетесь с брокером, который допускает размеры лотов до трех знаков после запятой, то вы можете легко изменить приведенный выше код, чтобы проверить это. Но на данный момент практически каждый брокер MetaTrader использует одно или два десятичных знака для определения размера лота.</p><h2><span id="Kontekst_torgovli">Контекст торговли</span></h2><p>В MetaTrader есть единый поток исполнения сделок для советников. Это означает, что только один эксперт может торговать одновременно, независимо от того, сколько экспертов работает в терминале. Перед началом любых торговых операций мы должны проверить, используется ли поток исполнения сделки в настоящее время.</p><p>Функция IsTradeContextBusy() вернет true, если поток исполнения сделки занят. Мы будем вызывать эту функцию непосредственно перед вызовом любых торговых функций, включая OrderSend(), OrderClose(), OrderDelete() или OrderModify().</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">while</span><span class="br0">(</span>IsTradeContextBusy<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> Sleep<span class="br0">(</span><span class="nu0">10</span><span class="br0">)</span><span class="sy0">;</span><span class="kw4">int</span> Ticket <span class="sy0">=</span> OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_BUY<span class="sy0">,</span>LotSize<span class="sy0">,</span>Ask<span class="sy0">,</span>UseSlippage<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span> <span class="st0">&quot;Buy Order&quot;</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Green<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Мы используем цикл while для оценки IsTradeContextBusy(). Если функция возвращает true, указывая, что поток исполнения сделки занят, советник будет остановлен в течение 10 миллисекунд. Цикл while будет выполняться до тех пор, пока IsTradeContextBus () вернет true. Как только поток торговли освобождается, торговля возобновляется.</p><p>Если советник пытается торговать, когда поток выполнения сделки занят, возникает ошибка 147: «торговый контекст занят».</p><h2><span id="Obnovlenie_zadannyh_peremennyh">Обновление заданных переменных</span></h2><p>Значения предопределенных переменных, таких как Bid и Ask, устанавливаются, когда советник начинает свою работу. Время, необходимое для выполнения кода советника, очень мало и может измеряться в миллисекундах. Но когда вы учитываете задержки ответа торгового сервера и тот факт, что цены могут меняться очень быстро, важно, чтобы вы всегда использовали самые актуальные цены.</p><p>Функция RefreshRates() обновляет содержимое предопределенных переменных с последними ценами с сервера. Рекомендуется вызывать эту функцию каждый раз, когда вы используете переменные Bid или Ask, особенно после заключения сделки.</p><p>Обратите внимание, что если вы получаете цену с помощью функции MarketInfo(), нет необходимости использовать RefreshRates().</p><h2><span id="Obrabotka_osibok">Обработка ошибок</span></h2><p>При размещении, изменении или закрытии ордеров могут возникать ошибки из-за неверных торговых параметров, реквотов или проблем с сервером. Когда ошибки возникают, мы должны предупредить пользователя об ошибке и записать любую соответствующую информацию для устранения неполадок.</p><p>Мы проверяем возможные ошибки, проверяя вывод таких функций, как OrderSend(), OrderModify() и OrderClose(). Если функция не завершилась успешно, функция вернет -1 для OrderSend() или false для OrderModify() и OrderClose().</p><p>В этом разделе мы создадим процедуру обработки ошибок для функции OrderSend(). Если возвращаемое значение OrderSend() равно -1, мы запустим процедуру обработки ошибок, чтобы отобразить предупреждение для пользователя и распечатать соответствующий торговый параметр и информацию о цене в торговый журнал.</p><p>Сначала мы должны сначала получить код ошибки. Это делается с помощью функции GetLastError(). Нам нужно сохранить возвращаемое значение GetLastError() в переменной, потому что после вызова GetLastError() код ошибки будет очищен, а следующий вызов GetLastError() вернет 0. Мы объявим глобальную переменную с именем ErrorCode и используем ее для хранения значения GetLastError().</p><p>Далее нам нужно получить некоторую информацию об ошибке. Включаемый файл stdlib.mqh содержит функцию ErrorDescription(). Эта функция возвращает строку с описанием ошибки. Это на самом деле не очень наглядно, но лучше, чем ничего. Нам нужно добавить оператор #include для stdlib.mqh сверху нашего файла.</p><p>Затем мы распечатаем предупреждение на экране пользователя с помощью встроенной функции Alert(). Эта информация также будет напечатана в журнале. Предупреждение будет содержать код ошибки, описание ошибки и краткое описание операции, которую мы только что попытались выполнить. Таким образом, вы будете точно знать, в каком разделе вашей программы возникла ошибка.</p><p>Наконец, мы распечатаем соответствующую информацию о цене в журнале с помощью функции Print(). Наряду с текущими ценами Bid и Ask мы будем включать параметры торговли, такие как размер лота и цена ордера.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="co1">// Препроцессор</span><span class="co2">#include &lt;stdlib.mqh&gt;</span>&nbsp;<span class="co1">// Глобальные переменные</span><span class="kw4">int</span> ErrorCode<span class="sy0">;</span>&nbsp;<span class="co1">// Размещение ордеров</span><span class="kw4">int</span> Ticket <span class="sy0">=</span> OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_BUYSTOP<span class="sy0">,</span>LotSize<span class="sy0">,</span>PendingPrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="st0">&quot;Buy Stop ордер&quot;</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Green<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>Ticket <span class="sy0">==</span> <span class="sy0">-</span><span class="nu0">1</span><span class="br0">)</span> <span class="br0">{</span>ErrorCode <span class="sy0">=</span> GetLastError<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>string ErrDesc <span class="sy0">=</span> ErrorDescription<span class="br0">(</span>ErrorCode<span class="br0">)</span><span class="sy0">;</span>string ErrAlert <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Open Buy Stop ордер - ошибка &quot;</span><span class="sy0">,</span> ErrorCode<span class="sy0">,</span><span class="st0">&quot;: &quot;</span><span class="sy0">,</span>ErrDesc<span class="br0">)</span><span class="sy0">;</span>        Alert<span class="br0">(</span>ErrAlert<span class="br0">)</span><span class="sy0">;</span>string ErrLog <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Bid: &quot;</span><span class="sy0">,</span>Bid<span class="sy0">,</span><span class="st0">&quot; Ask: &quot;</span><span class="sy0">,</span>Ask<span class="sy0">,</span><span class="st0">&quot; Price: &quot;</span><span class="sy0">,</span> PendingPrice<span class="sy0">,</span><span class="st0">&quot; Lots: &quot;</span><span class="sy0">,</span>LotSize<span class="br0">)</span><span class="sy0">;</span>        Print<span class="br0">(</span>ErrLog<span class="br0">)</span><span class="sy0">;</span>      <span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Вверху мы включаем файл stdlib.mqh. Мы добавляем глобальную переменную ErrorCode для хранения нашего кода ошибки. OrderSend() размещает стоп-ордер на покупку. Если функция не работает, выполняется наш код обработки ошибок.</p><p>Сначала мы сохраняем значение GetLastError() в ErrorCode. Затем мы вызываем функцию ErrorDescription(), используя ErrorCode в качестве аргумента. Далее мы используем функцию StringConcatenate() для создания предупреждающего сообщения, которое хранится в строковой переменной ErrAlert.</p><p>StringConcatenate() — это MQL-функция, которая позволяет создавать сложные строки с использованием переменных и констант. Каждый строковый элемент, который должен быть соединен вместе, разделен запятой. Попробуйте ввести приведенные выше примеры в MetaEditor, чтобы просмотреть его с подсветкой синтаксиса.</p><p>Вы также можете объединять строки, комбинируя их со знаком плюс (+). Использование StringConcatenate() понятнее и эффективнее, но если вы хотите просто объединить короткую строку, используйте знак плюс для объединения строковых констант и переменных:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">string PlusCat <span class="sy0">=</span> <span class="st0">&quot;Текущая цена Ask &quot;</span><span class="sy0">+</span>Ask<span class="sy0">;</span><span class="co1">// Пример вывода: текущая цена Ask 1.4320</span></pre></div></div></div></div></div></div></div><p>Функция Alert() отображает всплывающее окно на рабочем столе пользователя, содержащее содержимое переменной ErrAlert.</p><p>Мы создаем еще одну строку с нашими ценовыми и торговыми параметрами и сохраняем ее в переменной ErrLog, которую мы передаем в функцию Print(). Print() печатает содержимое аргумента функции в журнал экспертов. Журнал экспертов можно просмотреть на вкладке «Эксперты» в окне «Терминал» или на вкладке «Журнал» в окне «Тестер», если вы используете тестер стратегий.</p><p><img loading="lazy" src="https://rublogtrader.rar.su/wp-content/uploads/2020/06/alert.png" alt="Сообщение" width="886" height="454" class="alignnone size-full wp-image-14310" srcset="https://rublogtrader.rar.su/wp-content/uploads/2020/06/alert.png 886w, https://rublogtrader.rar.su/wp-content/uploads/2020/06/alert-300x154.png 300w, https://rublogtrader.rar.su/wp-content/uploads/2020/06/alert-700x359.png 700w, https://rublogtrader.rar.su/wp-content/uploads/2020/06/alert-768x394.png 768w" sizes="(max-width: 886px) 100vw, 886px"></p><p>Вот содержимое журнала. Первая строка — это вывод функции Alert(). Вторая строка — это вывод функции Print(). Обратите внимание на ошибку, «неверный объем сделки» и тот факт, что размер лота, указанный в журнале, равен 0. В этом случае проблема заключается в том, что размер лота является недопустимым.</p><p>Вы можете создать аналогичные процедуры обработки ошибок и для других функций, особенно для функций OrderModify() и OrderClose(). Вы также можете создавать более сложные процедуры обработки ошибок, которые предоставляют настраиваемые сообщения об ошибках на основе кода ошибки, или выполнять другие действия.</p><p>Например, если вы получили ошибку 130: «Недопустимые стопы», вы можете отобразить сообщение, например «Недопустимый стоп-лосс или тейк-профит».</p><h2><span id="Soedinaem_vse_vmeste">Соединяем все вместе</span></h2><p>Добавим все функции, которые мы рассмотрели в этом разделе, к простому советнику, который мы создали ранее. Мы добавим модификацию ордера, проверку уровня стопа, проверку контекста сделки, обновление предопределенной переменной и размер лота.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="co2">#property copyright &quot;Александр Паркер&quot;</span><span class="co2">#include &lt;stdlib.mqh&gt;</span>&nbsp;<span class="co1">// Внешние переменные</span><span class="kw2">extern</span> bool DynamicLotSize <span class="sy0">=</span> <span class="kw2">true</span><span class="sy0">;</span> <span class="kw2">extern</span> <span class="kw4">double</span> EquityPercent <span class="sy0">=</span> <span class="nu0">2</span><span class="sy0">;</span> <span class="kw2">extern</span> <span class="kw4">double</span> FixedLotSize <span class="sy0">=</span> <span class="nu16">0.1</span><span class="sy0">;</span><span class="kw2">extern</span> <span class="kw4">double</span> StopLoss <span class="sy0">=</span> <span class="nu0">50</span><span class="sy0">;</span> <span class="kw2">extern</span> <span class="kw4">double</span> TakeProfit <span class="sy0">=</span> <span class="nu0">100</span><span class="sy0">;</span><span class="kw2">extern</span> <span class="kw4">int</span> Slippage <span class="sy0">=</span> <span class="nu0">5</span><span class="sy0">;</span> <span class="kw2">extern</span> <span class="kw4">int</span> MagicNumber <span class="sy0">=</span> <span class="nu0">123</span><span class="sy0">;</span><span class="kw2">extern</span> <span class="kw4">int</span> FastMAPeriod <span class="sy0">=</span> <span class="nu0">10</span><span class="sy0">;</span> <span class="kw2">extern</span> <span class="kw4">int</span> SlowMAPeriod <span class="sy0">=</span> <span class="nu0">20</span><span class="sy0">;</span>&nbsp;<span class="co1">// Глобальные переменные</span><span class="kw4">int</span> BuyTicket<span class="sy0">;</span><span class="kw4">int</span> SellTicket<span class="sy0">;</span><span class="kw4">double</span> UsePoint<span class="sy0">;</span><span class="kw4">int</span> UseSlippage<span class="sy0">;</span><span class="kw4">int</span> ErrorCode<span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Мы добавили оператор #include для файла stdlib.mqh, который содержит функцию ErrorDescription() для наших процедур обработки ошибок. Мы добавили три внешние переменные для определения размера лота и глобальную переменную для кода ошибки.</p><p>Следующий код идет в начале функции start():</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="co1">// Скользящие средние</span><span class="kw4">double</span> FastMA <span class="sy0">=</span> iMA<span class="br0">(</span>NULL<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>FastMAPeriod<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span> <span class="kw4">double</span> SlowMA <span class="sy0">=</span> iMA<span class="br0">(</span>NULL<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>SlowMAPeriod<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>&nbsp; <span class="co1">// Размер лота</span>    <span class="kw1">if</span><span class="br0">(</span>DynamicLotSize <span class="sy0">==</span> <span class="kw2">true</span><span class="br0">)</span><span class="br0">{</span><span class="kw4">double</span> RiskAmount <span class="sy0">=</span> AccountEquity<span class="br0">(</span><span class="br0">)</span> <span class="sy0">*</span> <span class="br0">(</span>EquityPercent <span class="sy0">/</span> <span class="nu0">100</span><span class="br0">)</span><span class="sy0">;</span> <span class="kw4">double</span> TickValue <span class="sy0">=</span> MarketInfo<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MODE_TICKVALUE<span class="br0">)</span><span class="sy0">;</span> <span class="kw1">if</span><span class="br0">(</span>Point <span class="sy0">==</span> <span class="nu16">0.001</span> <span class="sy0">||</span> Point <span class="sy0">==</span> <span class="nu16">0.00001</span><span class="br0">)</span> TickValue <span class="sy0">*=</span> <span class="nu0">10</span><span class="sy0">;</span> <span class="kw4">double</span> CalcLots <span class="sy0">=</span> <span class="br0">(</span>RiskAmount <span class="sy0">/</span> StopLoss<span class="br0">)</span> <span class="sy0">/</span> TickValue<span class="sy0">;</span> <span class="kw4">double</span> LotSize <span class="sy0">=</span> CalcLots<span class="sy0">;</span>      <span class="br0">}</span> <span class="kw1">else</span> LotSize <span class="sy0">=</span> FixedLotSize<span class="sy0">;</span>&nbsp;    <span class="co1">// Проверка размера лота</span>    <span class="kw1">if</span><span class="br0">(</span>LotSize <span class="sy0">&lt;</span> MarketInfo<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MODE_MINLOT<span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>        LotSize <span class="sy0">=</span> MarketInfo<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MODE_MINLOT<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span> <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>LotSize <span class="sy0">&gt;</span> MarketInfo<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MODE_MAXLOT<span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>        LotSize <span class="sy0">=</span> MarketInfo<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MODE_MAXLOT<span class="br0">)</span><span class="sy0">;</span>      <span class="br0">}</span>&nbsp;<span class="kw1">if</span><span class="br0">(</span>MarketInfo<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MODE_LOTSTEP<span class="br0">)</span> <span class="sy0">==</span> <span class="nu16">0.1</span><span class="br0">)</span> <span class="br0">{</span>        LotSize <span class="sy0">=</span> NormalizeDouble<span class="br0">(</span>LotSize<span class="sy0">,</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>      <span class="br0">}</span> <span class="kw1">else</span> LotSize <span class="sy0">=</span> NormalizeDouble<span class="br0">(</span>LotSize<span class="sy0">,</span><span class="nu0">2</span><span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Расчет размера лота и код подтверждения со страницы 51 добавляются в начало нашей функции.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="co1">// Ордер на покупку</span><span class="kw1">if</span><span class="br0">(</span>FastMA <span class="sy0">&gt;</span> SlowMA <span class="sy0">&amp;&amp;</span> BuyTicket <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>&nbsp;<span class="co1">// Закрытие ордера</span>&nbsp;OrderSelect<span class="br0">(</span>SellTicket<span class="sy0">,</span>SELECT_BY_TICKET<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>OrderCloseTime<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> SellTicket <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span><span class="kw4">double</span> CloseLots <span class="sy0">=</span> OrderLots<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>             <span class="kw1">while</span><span class="br0">(</span>IsTradeContextBusy<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> Sleep<span class="br0">(</span><span class="nu0">10</span><span class="br0">)</span><span class="sy0">;</span>             RefreshRates<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><span class="kw4">double</span> ClosePrice <span class="sy0">=</span> Ask<span class="sy0">;</span>bool Closed <span class="sy0">=</span> OrderClose<span class="br0">(</span>SellTicket<span class="sy0">,</span>CloseLots<span class="sy0">,</span>ClosePrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Обработка ошибок</span>    <span class="kw1">if</span><span class="br0">(</span>Closed <span class="sy0">==</span> <span class="kw2">false</span><span class="br0">)</span> <span class="br0">{</span>         ErrorCode <span class="sy0">=</span> GetLastError<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>         string ErrDesc <span class="sy0">=</span> ErrorDescription<span class="br0">(</span>ErrorCode<span class="br0">)</span><span class="sy0">;</span>string ErrAlert <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Close Sell Order - Error &quot;</span><span class="sy0">,</span> ErrorCode<span class="sy0">,</span><span class="st0">&quot;: &quot;</span><span class="sy0">,</span>ErrDesc<span class="br0">)</span><span class="sy0">;</span>         Alert<span class="br0">(</span>ErrAlert<span class="br0">)</span><span class="sy0">;</span>string ErrLog <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Ask: &quot;</span><span class="sy0">,</span>Ask<span class="sy0">,</span><span class="st0">&quot; Lots: &quot;</span><span class="sy0">,</span>LotSize<span class="sy0">,</span> <span class="st0">&quot; Ticket: &quot;</span><span class="sy0">,</span>SellTicket<span class="br0">)</span><span class="sy0">;</span>         Print<span class="br0">(</span>ErrLog<span class="br0">)</span><span class="sy0">;</span>       <span class="br0">}</span><span class="br0">}</span>&nbsp;<span class="co1">// Ордер на покупку</span><span class="kw1">while</span><span class="br0">(</span>IsTradeContextBusy<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> Sleep<span class="br0">(</span><span class="nu0">10</span><span class="br0">)</span><span class="sy0">;</span>RefreshRates<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>BuyTicket <span class="sy0">=</span> OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_BUY<span class="sy0">,</span>LotSize<span class="sy0">,</span>Ask<span class="sy0">,</span>UseSlippage<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span> <span class="st0">&quot;Buy Order&quot;</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Green<span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Обработка ошибок</span><span class="kw1">if</span><span class="br0">(</span>BuyTicket <span class="sy0">==</span> <span class="sy0">-</span><span class="nu0">1</span><span class="br0">)</span> <span class="br0">{</span>ErrorCode <span class="sy0">=</span> GetLastError<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>ErrDesc <span class="sy0">=</span> ErrorDescription<span class="br0">(</span>ErrorCode<span class="br0">)</span><span class="sy0">;</span>ErrAlert <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Open Buy Order - Error &quot;</span><span class="sy0">,</span>ErrorCode<span class="sy0">,</span><span class="st0">&quot;: &quot;</span><span class="sy0">,</span>ErrDesc<span class="br0">)</span><span class="sy0">;</span> Alert<span class="br0">(</span>ErrAlert<span class="br0">)</span><span class="sy0">;</span>ErrLog <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Ask: &quot;</span><span class="sy0">,</span>Ask<span class="sy0">,</span><span class="st0">&quot; Lots: &quot;</span><span class="sy0">,</span>LotSize<span class="br0">)</span><span class="sy0">;</span>    Print<span class="br0">(</span>ErrLog<span class="br0">)</span><span class="sy0">;</span>  <span class="br0">}</span>&nbsp;<span class="co1">// Изменение ордера</span><span class="kw1">else</span>  <span class="br0">{</span>    OrderSelect<span class="br0">(</span>BuyTicket<span class="sy0">,</span>SELECT_BY_TICKET<span class="br0">)</span><span class="sy0">;</span>    <span class="kw4">double</span> OpenPrice <span class="sy0">=</span> OrderOpenPrice<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>&nbsp;    <span class="co1">// Расчет уровня стопа</span>    <span class="kw4">double</span> StopLevel <span class="sy0">=</span> MarketInfo<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MODE_STOPLEVEL<span class="br0">)</span> <span class="sy0">*</span> Point<span class="sy0">;</span>RefreshRates<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><span class="kw4">double</span> UpperStopLevel <span class="sy0">=</span> Ask <span class="sy0">+</span> StopLevel<span class="sy0">;</span> <span class="kw4">double</span> LowerStopLevel <span class="sy0">=</span> Bid <span class="sy0">-</span> StopLevel<span class="sy0">;</span>    <span class="kw4">double</span> MinStop <span class="sy0">=</span> <span class="nu0">5</span> <span class="sy0">*</span> UsePoint<span class="sy0">;</span>&nbsp;<span class="co1">// Расчет стоп-лосса и тейк-профита</span>&nbsp;<span class="kw1">if</span><span class="br0">(</span>StopLoss <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> BuyStopLoss <span class="sy0">=</span> OpenPrice <span class="sy0">-</span> <span class="br0">(</span>StopLoss <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span> <span class="kw1">if</span><span class="br0">(</span>TakeProfit <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> BuyTakeProfit <span class="sy0">=</span> OpenPrice <span class="sy0">+</span> <span class="br0">(</span>TakeProfit <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Подтверждение стоп-лосса и тейк-профита</span>&nbsp;<span class="kw1">if</span><span class="br0">(</span>BuyStopLoss <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> BuyStopLoss <span class="sy0">&gt;</span> LowerStopLevel<span class="br0">)</span> <span class="br0">{</span>BuyStopLoss <span class="sy0">=</span> LowerStopLevel <span class="sy0">-</span> MinStop<span class="sy0">;</span><span class="br0">}</span>&nbsp;<span class="kw1">if</span><span class="br0">(</span>BuyTakeProfit <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> BuyTakeProfit <span class="sy0">&lt;</span> UpperStopLevel<span class="br0">)</span>  <span class="br0">{</span>    BuyTakeProfit <span class="sy0">=</span> UpperStopLevel <span class="sy0">+</span> MinStop<span class="sy0">;</span>  <span class="br0">}</span>&nbsp;<span class="co1">// Модификация ордера</span><span class="kw1">if</span><span class="br0">(</span>IsTradeContextBusy<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> Sleep<span class="br0">(</span><span class="nu0">10</span><span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>BuyStopLoss <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">||</span> BuyTakeProfit <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>     bool TicketMod <span class="sy0">=</span> OrderModify<span class="br0">(</span>BuyTicket<span class="sy0">,</span>OpenPrice<span class="sy0">,</span>BuyStopLoss<span class="sy0">,</span>       BuyTakeProfit<span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>&nbsp;     <span class="co1">// Обработка ошибок</span>     <span class="kw1">if</span><span class="br0">(</span>TicketMod <span class="sy0">==</span> <span class="kw2">false</span><span class="br0">)</span><span class="br0">{</span>ErrorCode <span class="sy0">=</span> GetLastError<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>ErrDesc <span class="sy0">=</span> ErrorDescription<span class="br0">(</span>ErrorCode<span class="br0">)</span><span class="sy0">;</span>ErrAlert <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Modify Buy Order - Error &quot;</span><span class="sy0">,</span>ErrorCode<span class="sy0">,</span><span class="st0">&quot;: &quot;</span><span class="sy0">,</span>ErrDesc<span class="br0">)</span><span class="sy0">;</span> Alert<span class="br0">(</span>ErrAlert<span class="br0">)</span><span class="sy0">;</span>ErrLog <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Ask: &quot;</span><span class="sy0">,</span>Ask<span class="sy0">,</span><span class="st0">&quot; Bid: &quot;</span><span class="sy0">,</span>Bid<span class="sy0">,</span><span class="st0">&quot; Ticket: &quot;</span><span class="sy0">,</span> BuyTicket<span class="sy0">,</span><span class="st0">&quot; Stop: &quot;</span><span class="sy0">,</span>BuyStopLoss<span class="sy0">,</span><span class="st0">&quot; Profit: &quot;</span><span class="sy0">,</span>BuyTakeProfit<span class="br0">)</span><span class="sy0">;</span>    Print<span class="br0">(</span>ErrLog<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span>SellTicket <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Оставшаяся часть нашего кода содержит блок размещения ордеров на продажу, а также функции PipPoint() и GetSlippage().</p><p>Обратите внимание, что мы добавили функцию IsTradeContextBusy() перед каждой торговой операцией. Мы используем RefreshRates() перед каждым указанием переменных Bid или Ask, чтобы убедиться, что мы всегда используем самые последние цены.</p><p>Мы начнем с выбора предыдущего тикета на продажу и закрытия его с помощью OrderClose(). Если функция завершается ошибкой, запускается блок обработки ошибок. Далее мы открываем ордер на покупку с помощью OrderSend(). Если функция завершается ошибкой, запускается блок обработки ошибок. В противном случае мы продолжаем к блоку модификации ордера.</p><p>Мы выбираем ордер, который был только что размещен, используя OrderSelect(), и назначаем цену открытия ордера переменной OpenPrice. Затем мы рассчитываем уровень стопа и цены верхнего и нижнего уровня стопа. Затем мы рассчитываем наш стоп-лосс и тейк-профит, проверяем их и, наконец, модифицируем ордер с помощью OrderModify().</p><p>Вот как мы модифицируем код для отложенного ордера на покупку:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="co1">// Закрытие ордера</span>&nbsp;OrderSelect<span class="br0">(</span>SellTicket<span class="sy0">,</span>SELECT_BY_TICKET<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>OrderCloseTime<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> SellTicket <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_SELL<span class="br0">)</span> <span class="br0">{</span><span class="kw4">double</span> CloseLots <span class="sy0">=</span> OrderLots<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="kw1">while</span><span class="br0">(</span>IsTradeContextBusy<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> Sleep<span class="br0">(</span><span class="nu0">10</span><span class="br0">)</span><span class="sy0">;</span>RefreshRates<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><span class="kw4">double</span> ClosePrice <span class="sy0">=</span> Ask<span class="sy0">;</span>bool Closed <span class="sy0">=</span> OrderClose<span class="br0">(</span>SellTicket<span class="sy0">,</span>CloseLots<span class="sy0">,</span>ClosePrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Обработка ошибок</span>&nbsp;<span class="kw1">if</span><span class="br0">(</span>Closed <span class="sy0">==</span> <span class="kw2">false</span><span class="br0">)</span> <span class="br0">{</span>ErrorCode <span class="sy0">=</span> GetLastError<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>string ErrDesc <span class="sy0">=</span> ErrorDescription<span class="br0">(</span>ErrorCode<span class="br0">)</span><span class="sy0">;</span>string ErrAlert <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Close Sell Order - Error &quot;</span><span class="sy0">,</span>ErrorCode<span class="sy0">,</span> <span class="st0">&quot;: &quot;</span><span class="sy0">,</span>ErrDesc<span class="br0">)</span><span class="sy0">;</span>             Alert<span class="br0">(</span>ErrAlert<span class="br0">)</span><span class="sy0">;</span>string ErrLog <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Ask: &quot;</span><span class="sy0">,</span>Ask<span class="sy0">,</span><span class="st0">&quot; Lots: &quot;</span><span class="sy0">,</span>LotSize<span class="sy0">,</span> <span class="st0">&quot; Ticket: &quot;</span><span class="sy0">,</span>SellTicket<span class="br0">)</span><span class="sy0">;</span>             Print<span class="br0">(</span>ErrLog<span class="br0">)</span><span class="sy0">;</span>         <span class="br0">}</span><span class="br0">}</span>&nbsp;<span class="co1">// Удаление ордера</span>    <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>OrderCloseTime<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> SellTicket <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_SELLSTOP<span class="br0">)</span>      <span class="br0">{</span>        bool Deleted <span class="sy0">=</span> OrderDelete<span class="br0">(</span>SellTicket<span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span>        <span class="kw1">if</span><span class="br0">(</span>Deleted <span class="sy0">==</span> <span class="kw2">true</span><span class="br0">)</span> SellTicket <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>&nbsp;<span class="co1">// Обработка ошибок</span>        <span class="kw1">if</span><span class="br0">(</span>Deleted <span class="sy0">==</span> <span class="kw2">false</span><span class="br0">)</span>          <span class="br0">{</span>             ErrorCode <span class="sy0">=</span> GetLastError<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>             ErrDesc <span class="sy0">=</span> ErrorDescription<span class="br0">(</span>ErrorCode<span class="br0">)</span><span class="sy0">;</span>ErrAlert <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Delete Sell Stop Order - Error &quot;</span><span class="sy0">,</span>ErrorCode<span class="sy0">,</span> <span class="st0">&quot;: &quot;</span><span class="sy0">,</span>ErrDesc<span class="br0">)</span><span class="sy0">;</span>             Alert<span class="br0">(</span>ErrAlert<span class="br0">)</span><span class="sy0">;</span>ErrLog <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Ask: &quot;</span><span class="sy0">,</span>Ask<span class="sy0">,</span><span class="st0">&quot; Ticket: &quot;</span><span class="sy0">,</span>SellTicket<span class="br0">)</span><span class="sy0">;</span>             Print<span class="br0">(</span>ErrLog<span class="br0">)</span><span class="sy0">;</span>          <span class="br0">}</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Мы добавили код для удаления отложенных ордеров с помощью OrderDelete() после функции OrderClose(). Тип ордера предыдущего ордера на продажу определяет, какая функция используется для закрытия ордера.</p><p>Основное различие между следующим кодом и кодом рыночного ордера заключается в том, что у нас нет блока модификации ордера. Нет необходимости размещать стоп-лосс и тейк-профит отдельно для отложенных ордеров. Поэтому мы рассчитаем стоп-лосс и тейк-профит перед размещением ордера с помощью OrderSend().</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">&nbsp;<span class="co1">// Расчет уровня стопа</span>&nbsp;<span class="kw4">double</span> StopLevel <span class="sy0">=</span> MarketInfo<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MODE_STOPLEVEL<span class="br0">)</span> <span class="sy0">*</span> Point<span class="sy0">;</span>RefreshRates<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><span class="kw4">double</span> UpperStopLevel <span class="sy0">=</span> Ask <span class="sy0">+</span> StopLevel<span class="sy0">;</span><span class="kw4">double</span> MinStop <span class="sy0">=</span> <span class="nu0">5</span> <span class="sy0">*</span> UsePoint<span class="sy0">;</span>&nbsp;<span class="co1">// Расчет цены отложенного ордера</span>&nbsp;<span class="kw4">double</span> PendingPrice <span class="sy0">=</span> High<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">+</span> <span class="br0">(</span>PendingPips <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>PendingPrice <span class="sy0">&lt;</span> UpperStopLevel<span class="br0">)</span> PendingPrice <span class="sy0">=</span> UpperStopLevel <span class="sy0">+</span> MinStop<span class="sy0">;</span>&nbsp;<span class="co1">// Расчет стоп-лосса и тейк-профита</span><span class="kw1">if</span><span class="br0">(</span>StopLoss <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> BuyStopLoss <span class="sy0">=</span> PendingPrice <span class="sy0">-</span> <span class="br0">(</span>StopLoss <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span> <span class="kw1">if</span><span class="br0">(</span>TakeProfit <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> BuyTakeProfit <span class="sy0">=</span> PendingPrice <span class="sy0">+</span> <span class="br0">(</span>TakeProfit <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Проверка стоп-лосса и тейк-профита</span>&nbsp;UpperStopLevel <span class="sy0">=</span> PendingPrice <span class="sy0">+</span> StopLevel<span class="sy0">;</span> <span class="kw4">double</span> LowerStopLevel <span class="sy0">=</span> PendingPrice – StopLevel<span class="sy0">;</span>    <span class="kw1">if</span><span class="br0">(</span>BuyStopLoss <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> BuyStopLoss <span class="sy0">&gt;</span> LowerStopLevel<span class="br0">)</span>      <span class="br0">{</span>BuyStopLoss <span class="sy0">=</span> LowerStopLevel <span class="sy0">-</span> MinStop<span class="sy0">;</span> <span class="br0">}</span>    <span class="kw1">if</span><span class="br0">(</span>BuyTakeProfit  <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> BuyTakeProfit <span class="sy0">&lt;</span> UpperStopLevel<span class="br0">)</span>      <span class="br0">{</span>         BuyTakeProfit <span class="sy0">=</span> UpperStopLevel <span class="sy0">+</span> MinStop<span class="sy0">;</span>      <span class="br0">}</span>&nbsp;<span class="co1">// Размещение отложенного ордера</span>&nbsp;    <span class="kw1">if</span><span class="br0">(</span>IsTradeContextBusy<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> Sleep<span class="br0">(</span><span class="nu0">10</span><span class="br0">)</span><span class="sy0">;</span>BuyTicket <span class="sy0">=</span> OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_BUYSTOP<span class="sy0">,</span>LotSize<span class="sy0">,</span>PendingPrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span> BuyStopLoss<span class="sy0">,</span>BuyTakeProfit<span class="sy0">,</span><span class="st0">&quot;Buy Stop Order&quot;</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Green<span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Обработка ошибок</span>&nbsp;<span class="kw1">if</span><span class="br0">(</span>BuyTicket <span class="sy0">==</span> <span class="sy0">-</span><span class="nu0">1</span><span class="br0">)</span><span class="br0">{</span>ErrorCode <span class="sy0">=</span> GetLastError<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>ErrDesc <span class="sy0">=</span> ErrorDescription<span class="br0">(</span>ErrorCode<span class="br0">)</span><span class="sy0">;</span>ErrAlert <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Open Buy Stop Order - Error &quot;</span><span class="sy0">,</span>ErrorCode<span class="sy0">,</span> <span class="st0">&quot;: &quot;</span><span class="sy0">,</span>ErrDesc<span class="br0">)</span><span class="sy0">;</span>        Alert<span class="br0">(</span>ErrAlert<span class="br0">)</span><span class="sy0">;</span>ErrLog <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Ask: &quot;</span><span class="sy0">,</span>Ask<span class="sy0">,</span><span class="st0">&quot; Lots: &quot;</span><span class="sy0">,</span>LotSize<span class="sy0">,</span><span class="st0">&quot; Price: &quot;</span><span class="sy0">,</span>PendingPrice<span class="sy0">,</span> <span class="st0">&quot; Stop: &quot;</span><span class="sy0">,</span>BuyStopLoss<span class="sy0">,</span><span class="st0">&quot; Profit: &quot;</span><span class="sy0">,</span>BuyTakeProfit<span class="br0">)</span><span class="sy0">;</span>        Print<span class="br0">(</span>ErrLog<span class="br0">)</span><span class="sy0">;</span>      <span class="br0">}</span>SellTicket <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Сначала рассчитаем верхний уровень стопа. Затем мы рассчитываем и проверяем цену нашего отложенного ордера, которая хранится в PendingPrice. Затем мы пересчитываем UpperStopLevel и вычисляем LowerStopLevel так, чтобы они были размещены относительно цены отложенного ордера. Обратите внимание, что нам не нужно использовать цены Ask или Bid или цифру в спреде при проверке стоп-лосса и цены тейк-профита.</p><p>Наконец, мы выставляем наш отложенный ордер с помощью OrderSend(), размещая стоп-лосс и тейк-профит. У нас есть стандартная функция обработки ошибок для обработки ошибок при размещении ордера.</p></div><div class='code-block code-block-center code-block-5 ai-viewport-1'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader2" rel="nofollow" target="_blank"><img src="https://advertising-blog.qqit.ru/rublogtrader.rar.su/pamm_landing_banner_970x250_ru_1.gif"/></a></div><div class='code-block code-block-center code-block-6 ai-viewport-2 ai-viewport-3'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader2" rel="nofollow" target="_blank"><img src="/b/pamm_landing_banner_300x250_ru_.gif"/></a></div><div class="share"> Поделиться: <a href="https://telete.in/share/url?url=https://rublogtrader.rar.su/prodvinutoe-razmeshhenie-orderov/" target="_blank"><i class="icon-04"></i></a> <a href="http://vkontakte.ru/share.php?url=https://rublogtrader.rar.su/prodvinutoe-razmeshhenie-orderov/" target="_blank"><i class="icon-01"></i></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://rublogtrader.rar.su/prodvinutoe-razmeshhenie-orderov/" target="_blank"><i class="icon-09"></i></a> <a href="https://connect.ok.ru/offer?url=https://rublogtrader.rar.su/prodvinutoe-razmeshhenie-orderov/" target="_blank"><i class="icon-02"></i></a> <a href="https://twitter.com/intent/tweet?url=https://rublogtrader.rar.su/prodvinutoe-razmeshhenie-orderov/" target="_blank"><i class="icon-03"></i></a></div><div class="subsc4"> <a href="/torgovyj-algoritm-po-trejdingu-buy/">Мой торговый алгоритм по трейдингу</a></div><div class="subsc4"> <a href="/algoritm-torgovli-akcijami/">Мой алгоритм торговли акциями</a></div><div class="subsc4"> <a href="/moj-algoritm-vybora-akcij/">Мой алгоритм выбора акций по мультипликаторам</a></div><div class="subsc4"> Скачайте приложение Блог Трейдера в App Store<br><br> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader3" rel="nofollow" target="_blank"><img src="https://advertising-blog.qqit.ru/rublogtrader.rar.su/appstore.png" width="200"/></a></div><div class="title"><a href="https://rublogtrader.rar.su/mql4/" rel="category tag">MQL4</a></div><section YuzoPluginPro class="wp-yuzo yzp-wrapper  yzp-id-12792 yzp-template-list-default-l yzp-layout-list yzp-without-excerpt yzp-without-meta yzp-aspect-ratio-1-1 yzp-mobile-columns-2 yzp-tablet-columns-2 yzp-desktop-columns-2" data-version="6.2.3"  data-id="12792"  data-type="s" data-level="3" ><ul class='yzp-container' ><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='10828' data-n='1'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/kommentarii-v-mql4/'   >Комментарии в MQL4: чем они могут быть полезны?</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='11018' data-n='2'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/cena-otkrytija-zakrytija-maksimuma-i-minimuma-svechej-v-mql4/'   >Цена открытия, закрытия, максимума и минимума свечей в MQL4</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='11089' data-n='3'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/kak-opredelit-peresechenie-linij-dvuh-indikatorov-na-mql4/'   >Как определить пересечение линий двух индикаторов на MQL4?</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='11567' data-n='4'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/operacija-operand-znak-operacii-i-vyrazhenie-osnova-jazyka-mql4/'   >Операция, операнд, знак операции и выражение – основа языка MQL4</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='11334' data-n='5'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/kak-vypolnit-kakuju-libo-zadachu-pri-otkrytii-novoj-svechi-na-mql4/'   >Как выполнить какую–либо задачу при открытии новой свечи на MQL4?</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='11605' data-n='6'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/oscilljator-stohastik-pishem-kod-sovetnika-i-razbiraem-ego/'   >Осциллятор стохастик: пишем код советника и разбираем его</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='10885' data-n='7'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/operatory-v-mql4/'   >Операторы в MQL4: как их использовать в программе?</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='11494' data-n='8'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/sovetnik-kotoryj-torguet-po-peresecheniju-skolzjashhih-srednih/'   >Советник, который торгует по пересечению скользящих средних</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='11642' data-n='9'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/kak-vypolnit-chast-koda-tolko-odin-raz-za-svechu-na-mql4/'   >Как выполнить часть кода только один раз за свечу на MQL4?</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='14366' data-n='10'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/polzovatelskie-indikatory-i-skripty/'   >Пользовательские индикаторы и скрипты на MQL4: примеры кода</a></div></div></li></ul></section></div></div></article><div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 no-pad"><div id="comments" class="comments-area"><div id="respond" class="comment-respond"> <span id="reply-title" class="h4 comment-reply-title">Добавить комментарий <small><a rel="nofollow" id="cancel-comment-reply-link" href="/prodvinutoe-razmeshhenie-orderov/#respond" style="display:none;">Отменить ответ</a></small></span><form action="https://rublogtrader.rar.su/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><p class="comment-notes"><span id="email-notes">Ваш адрес email не будет опубликован.</span></p><p class="comment-form-comment"><label for="comment">Комментарий</label><textarea style="display:none;" id="comment" name="comment" cols="45" rows="8" maxlength="65525" ></textarea><textarea id="real-comment" name="real-comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Имя</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p><p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Отправить комментарий" /> <input type='hidden' name='comment_post_ID' value='14305' id='comment_post_ID' /> <input type='hidden' name='comment_parent' id='comment_parent' value='0' /></p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="a34da0d4b6" /></p><p style="display: none !important;"><label>&#916;<textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100"></textarea></label><input type="hidden" id="ak_js" name="ak_js" value="182"/><script>document.getElementById( "ak_js" ).setAttribute( "value", ( new Date() ).getTime() );</script></p></form></div></div></div></main></div></div></div></div><div class="spu-bg" id="spu-bg-16205"></div><div class="spu-box  spu-centered spu-total- " id="spu-16205" data-box-id="16205" data-trigger="seconds" data-trigger-number="5" data-spuanimation="fade" data-tconvert-cookie="d" data-tclose-cookie="d" data-dconvert-cookie="999" data-dclose-cookie="30" data-nconvert-cookie="spu_conversion_16205" data-nclose-cookie="spu_closing_16205" data-test-mode="0" data-auto-hide="0" data-close-on-conversion="1" data-bgopa="0.5" data-total="" style="left:-99999px !important;right:auto;" data-width="600" ><div class="spu-content"><p><a href="https://www.instaglobe.net/ru/pamm_trading?x=trdblogpam&#038;utm_source=tradeblog.net&#038;utm_campaign=pamm" target="_blank" rel="noopener"><img src="https://rublogtrader.rar.su/wp-content/uploads/2021/12/700_400_Popup.jpg" alt="" width="700" height="400" class="alignnone size-full wp-image-16207" /></a></p></div> <span class="spu-close spu-close-popup top_right"><i class="spu-icon spu-icon-close"></i></span> <span class="spu-timer"></span></div><div id="fb-root" class=" fb_reset"></div><div id="shiftnav-toggle-main" class="shiftnav-toggle-main-align-center shiftnav-toggle-style-full_bar shiftnav-togglebar-gap-on shiftnav-toggle-edge-left shiftnav-toggle-icon-bars shiftnav--hide-scroll-down"   ><button id="shiftnav-toggle-main-button" class="shiftnav-toggle shiftnav-toggle-shiftnav-main shiftnav-toggle-burger" tabindex="1" data-shiftnav-target="shiftnav-main" aria-label="Toggle Menu"><i class="fa fa-bars"></i></button><div class="shiftnav-main-toggle-content shiftnav-toggle-main-block"><a href="https://traderblog.net">Блог трейдера</a></div><div class="shiftnav-main-toggle-content-after"> <a class="shiftnav-searchbar-toggle  shiftnav-toggle-main-block shiftnav-toggle-main-ontop" tabindex="1"><i class="fa fa-search"></i></a><div class="shiftnav-searchbar-drop"><form role="search" method="get" class="shiftnav-searchform" action="https://rublogtrader.rar.su/"> <input type="text" placeholder="Search..." value="" name="s" class="shiftnav-search-input" /> <input type="submit" class="shiftnav-search-submit" value="&#xf002;" /></form></div></div></div><div class="shiftnav shiftnav-nojs shiftnav-shiftnav-main shiftnav-left-edge shiftnav-skin-none shiftnav-transition-standard" id="shiftnav-main" data-shiftnav-id="shiftnav-main"><div class="shiftnav-inner"><nav class="shiftnav-nav"><ul id="menu-menu-2" class="shiftnav-menu shiftnav-targets-default shiftnav-targets-text-default shiftnav-targets-icon-default"><li id="menu-item-14441" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-14441 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/forex/">Форекс</a></li><li id="menu-item-14442" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-14442 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/trading/">Трейдинг</a></li><li id="menu-item-10795" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-10795 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/technical-analysis/">Технический анализ</a></li><li id="menu-item-10797" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-10797 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/indicators/">Индикаторы</a></li><li id="menu-item-10798" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-10798 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/prajs-jekshen/">Прайс экшен</a></li><li id="menu-item-16043" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-16043 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/investing/">Инвестиции</a></li><li id="menu-item-16238" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-16238 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/crypto/">Крипто</a></li></ul></nav> <button class="shiftnav-sr-close shiftnav-sr-only shiftnav-sr-only-focusable"> &times; Close Panel </button></div></div><div style="display: none;" id="nxsFavNotice"><div id="nxsFavNoticeCnt">Posting....</div></div><div id="wpfront-scroll-top-container"> <img src="https://rublogtrader.rar.su/wp-content/uploads/2019/03/scroll-3.png" alt="" /></div> <script type="text/javascript">function wpfront_scroll_top_init() {                if (typeof wpfront_scroll_top === "function" && typeof jQuery !== "undefined") {                    wpfront_scroll_top({"scroll_offset":3000,"button_width":60,"button_height":60,"button_opacity":0.9,"button_fade_duration":200,"scroll_duration":400,"location":1,"marginX":250,"marginY":20,"hide_iframe":false,"auto_hide":false,"auto_hide_after":2,"button_action":"top","button_action_element_selector":"","button_action_container_selector":"html, body","button_action_element_offset":0});                } else {                    setTimeout(wpfront_scroll_top_init, 100);                }            }            wpfront_scroll_top_init();</script> <script type='text/javascript' id='yuzo-js-js-extra'>var yuzo_vars = {"ajaxurl":"https:\/\/traderblog.net\/wp-admin\/admin-ajax.php","post_id":"14305","url":"https%3A%2F%2Ftraderblog.net%2Fprodvinutoe-razmeshhenie-orderov%2F","where_is":"single|singular","nonce":"7e9956422c","nonce2":"98ebd05f15","off_views":"0","off_views_logged":"1","is_logged":"0","allows_to_count_visits":"1","disabled_counter":"0","level_article":"medium"};</script> <script type='text/javascript' id='spu-public-js-extra'>var spuvar = {"is_admin":"","disable_style":"","ajax_mode":"","ajax_url":"https:\/\/traderblog.net\/wp-admin\/admin-ajax.php","ajax_mode_url":"https:\/\/traderblog.net\/?spu_action=spu_load","pid":"14305","is_front_page":"","is_category":"","site_url":"https:\/\/traderblog.net","is_archive":"","is_search":"","is_preview":"","seconds_confirmation_close":"5"};var spuvar_social = [];</script> <script type='text/javascript' id='shiftnav-js-extra'>var shiftnav_data = {"shift_body":"off","shift_body_wrapper":"","lock_body":"on","lock_body_x":"off","open_current":"off","collapse_accordions":"off","scroll_panel":"off","breakpoint":"1120","v":"1.7.0.1","pro":"1","touch_off_close":"on","scroll_offset":"100","disable_transforms":"off","close_on_target_click":"off","scroll_top_boundary":"50","process_uber_segments":"on"};</script> <script>ai_front = {"insertion_before":"BEFORE","insertion_after":"AFTER","insertion_prepend":"PREPEND CONTENT","insertion_append":"APPEND CONTENT","insertion_replace_content":"REPLACE CONTENT","insertion_replace_element":"REPLACE ELEMENT","visible":"VISIBLE","hidden":"HIDDEN","fallback":"FALLBACK","automatically_placed":"Automatically placed by AdSense Auto ads code","cancel":"Cancel","use":"Use","add":"Add","parent":"Parent","cancel_element_selection":"Cancel element selection","select_parent_element":"Select parent element","css_selector":"CSS selector","use_current_selector":"Use current selector","element":"ELEMENT","path":"PATH","selector":"SELECTOR"};function b2a(a){var b,c=0,l=0,f="",g=[];if(!a)return a;do{var e=a.charCodeAt(c++);var h=a.charCodeAt(c++);var k=a.charCodeAt(c++);var d=e<<16|h<<8|k;e=63&d>>18;h=63&d>>12;k=63&d>>6;d&=63;g[l++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)}while(c<a.length);return f=g.join(""),b=a.length%3,(b?f.slice(0,b-3):f)+"===".slice(b||3)}function a2b(a){var b,c,l,f={},g=0,e=0,h="",k=String.fromCharCode,d=a.length;for(b=0;64>b;b++)f["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(b)]=b;for(c=0;d>c;c++)for(b=f[a.charAt(c)],g=(g<<6)+b,e+=6;8<=e;)((l=255&g>>>(e-=8))||d-2>c)&&(h+=k(l));return h}b64e=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(b,a){return String.fromCharCode("0x"+a)}))};b64d=function(a){return decodeURIComponent(atob(a).split("").map(function(a){return"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)}).join(""))};(function(a){if("function"===typeof define&&define.amd){define(a);var c=!0}"object"===typeof exports&&(module.exports=a(),c=!0);if(!c){var d=window.Cookies,b=window.Cookies=a();b.noConflict=function(){window.Cookies=d;return b}}})(function(){function a(){for(var d=0,b={};d<arguments.length;d++){var f=arguments[d],e;for(e in f)b[e]=f[e]}return b}function c(d){function b(){}function f(h,k,g){if("undefined"!==typeof document){g=a({path:"/"},b.defaults,g);"number"===typeof g.expires&&(g.expires=new Date(1*new Date+864E5*g.expires));g.expires=g.expires?g.expires.toUTCString():"";try{var l=JSON.stringify(k);/^[\{\[]/.test(l)&&(k=l)}catch(p){}k=d.write?d.write(k,h):encodeURIComponent(String(k)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent);h=encodeURIComponent(String(h)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);l="";for(var n in g)g[n]&&(l+="; "+n,!0!==g[n]&&(l+="="+g[n].split(";")[0]));return document.cookie=h+"="+k+l}}function e(h,k){if("undefined"!==typeof document){for(var g={},l=document.cookie?document.cookie.split("; "):[],n=0;n<l.length;n++){var p=l[n].split("="),m=p.slice(1).join("=");k||'"'!==m.charAt(0)||(m=m.slice(1,-1));try{var q=p[0].replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent);m=(d.read||d)(m,q)||m.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent);if(k)try{m=JSON.parse(m)}catch(r){}g[q]=m;if(h===q)break}catch(r){}}return h?g[h]:g}}b.set=f;b.get=function(h){return e(h,!1)};b.getJSON=function(h){return e(h,!0)};b.remove=function(h,k){f(h,"",a(k,{expires:-1}))};b.defaults={};b.withConverter=c;return b}return c(function(){})});AiCookies=Cookies.noConflict();ai_check_block=function(a){if(null==a)return!0;var c=AiCookies.getJSON("aiBLOCKS");ai_debug_cookie_status="";null==c&&(c={});"undefined"!==typeof ai_delay_showing_pageviews&&(c.hasOwnProperty(a)||(c[a]={}),c[a].hasOwnProperty("d")||(c[a].d=ai_delay_showing_pageviews));if(c.hasOwnProperty(a))for(var d in c[a]){if("x"==d){var b="",f=document.querySelectorAll('span[data-ai-block="'+a+'"]')[0];"aiHash"in f.dataset&&(b=f.dataset.aiHash);f="";c[a].hasOwnProperty("h")&&(f=c[a].h);var e=new Date;e=c[a][d]-Math.round(e.getTime()/1E3);if(0<e&&f==b)return ai_debug_cookie_status=a="closed for "+e+" s = "+Math.round(1E4*e/3600/24)/1E4+" days",!1;ai_set_cookie(a,"x","");c[a].hasOwnProperty("i")||c[a].hasOwnProperty("c")||ai_set_cookie(a,"h","")}else if("d"==d){if(0!=c[a][d])return ai_debug_cookie_status=a="delayed for "+c[a][d]+" pageviews",!1}else if("i"==d){b="";f=document.querySelectorAll('span[data-ai-block="'+a+'"]')[0];"aiHash"in f.dataset&&(b=f.dataset.aiHash);f="";c[a].hasOwnProperty("h")&&(f=c[a].h);if(0==c[a][d]&&f==b)return ai_debug_cookie_status=a="max impressions reached",!1;if(0>c[a][d]&&f==b){e=new Date;e=-c[a][d]-Math.round(e.getTime()/1E3);if(0<e)return ai_debug_cookie_status=a="max imp. reached ("+Math.round(1E4*e/24/3600)/1E4+" days = "+e+" s)",!1;ai_set_cookie(a,"i","");c[a].hasOwnProperty("c")||c[a].hasOwnProperty("x")||ai_set_cookie(a,"h","")}}if("ipt"==d&&0==c[a][d]&&(e=new Date,b=Math.round(e.getTime()/1E3),e=c[a].it-b,0<e))return ai_debug_cookie_status=a="max imp. per time reached ("+Math.round(1E4*e/24/3600)/1E4+" days = "+e+" s)",!1;if("c"==d){b="";f=document.querySelectorAll('span[data-ai-block="'+a+'"]')[0];"aiHash"in f.dataset&&(b=f.dataset.aiHash);f="";c[a].hasOwnProperty("h")&&(f=c[a].h);if(0==c[a][d]&&f==b)return ai_debug_cookie_status=a="max clicks reached",!1;if(0>c[a][d]&&f==b){e=new Date;e=-c[a][d]-Math.round(e.getTime()/1E3);if(0<e)return ai_debug_cookie_status=a="max clicks reached ("+Math.round(1E4*e/24/3600)/1E4+" days = "+e+" s)",!1;ai_set_cookie(a,"c","");c[a].hasOwnProperty("i")||c[a].hasOwnProperty("x")||ai_set_cookie(a,"h","")}}if("cpt"==d&&0==c[a][d]&&(e=new Date,b=Math.round(e.getTime()/1E3),e=c[a].ct-b,0<e))return ai_debug_cookie_status=a="max clicks per time reached ("+Math.round(1E4*e/24/3600)/1E4+" days = "+e+" s)",!1}ai_debug_cookie_status="OK";return!0};ai_check_and_insert_block=function(a,c){if(null==a)return!0;var d=document.getElementsByClassName(c);if(d.length){d=d[0];var b=d.closest(".code-block");if(ai_check_block(a)){if(ai_insert_code(d),b){var f=b.querySelectorAll(".ai-debug-block");b&&f.length&&(b.classList.remove("ai-list-block"),b.classList.remove("ai-list-block-ip"),b.style.visibility="",b.classList.contains("ai-remove-position")&&(b.style.position=""))}}else{f=d.closest("div[data-ai]");if(null!=f&&"undefined"!=typeof f.getAttribute("data-ai")){var e=JSON.parse(b64d(f.getAttribute("data-ai")));"undefined"!==typeof e&&e.constructor===Array&&(e[1]="",f.setAttribute("data-ai",b64e(JSON.stringify(e))))}f=b.querySelectorAll(".ai-debug-block");b&&f.length&&(b.classList.remove("ai-list-block"),b.classList.remove("ai-list-block-ip"),b.style.visibility="",b.classList.contains("ai-remove-position")&&(b.style.position=""))}d.classList.remove(c)}d=document.querySelectorAll("."+c+"-dbg");b=0;for(f=d.length;b<f;b++)e=d[b],e.querySelector(".ai-status").textContent=ai_debug_cookie_status,e.querySelector(".ai-cookie-data").textContent=ai_get_cookie_text(a),e.classList.remove(c+"-dbg")};function ai_load_cookie(){var a=AiCookies.getJSON("aiBLOCKS");null==a&&(a={});return a}function ai_get_cookie(a,c){var d="",b=ai_load_cookie();b.hasOwnProperty(a)&&b[a].hasOwnProperty(c)&&(d=b[a][c]);return d}function ai_set_cookie(a,c,d){var b=ai_load_cookie();if(""===d){if(b.hasOwnProperty(a)){delete b[a][c];a:{c=b[a];for(f in c)if(c.hasOwnProperty(f)){var f=!1;break a}f=!0}f&&delete b[a]}}else b.hasOwnProperty(a)||(b[a]={}),b[a][c]=d;0===Object.keys(b).length&&b.constructor===Object?AiCookies.remove("aiBLOCKS"):AiCookies.set("aiBLOCKS",b,{expires:365,path:"/"});return b}ai_get_cookie_text=function(a){var c=AiCookies.getJSON("aiBLOCKS");null==c&&(c={});return c.hasOwnProperty(a)?JSON.stringify(c[a]).replace(/"/g,"").replace("{","").replace("}",""):""};ai_insert=function(d,l,v){for(var p=-1!=l.indexOf(":eq")?jQuery(l):document.querySelectorAll(l),t=0,y=p.length;t<y;t++){var b=p[t];selector_string=b.hasAttribute("id")?"#"+b.getAttribute("id"):b.hasAttribute("class")?"."+b.getAttribute("class").replace(RegExp(" ","g"),"."):"";var u=document.createElement("div");u.innerHTML=v;var m=u.getElementsByClassName("ai-selector-counter")[0];null!=m&&(m.innerText=t+1);m=u.getElementsByClassName("ai-debug-name ai-main")[0];if(null!=m){var k="";"before"==d?k=ai_front.insertion_before:"after"==d?k=ai_front.insertion_after:"prepend"==d?k=ai_front.insertion_prepend:"append"==d?k=ai_front.insertion_append:"replace-content"==d?k=ai_front.insertion_replace_content:"replace-element"==d&&(k=ai_front.insertion_replace_element);-1==selector_string.indexOf(".ai-viewports")&&(m.innerText=k+" "+l+" ("+b.tagName.toLowerCase()+selector_string+")")}m=document.createRange();k=!0;try{var w=m.createContextualFragment(u.innerHTML)}catch(r){k=!1}"before"==d?k?b.parentNode.insertBefore(w,b):jQuery(u.innerHTML).insertBefore(jQuery(b)):"after"==d?k?b.parentNode.insertBefore(w,b.nextSibling):jQuery(u.innerHTML).insertBefore(jQuery(b.nextSibling)):"prepend"==d?k?b.insertBefore(w,b.firstChild):jQuery(u.innerHTML).insertBefore(jQuery(b.firstChild)):"append"==d?k?b.insertBefore(w,null):jQuery(u.innerHTML).appendTo(jQuery(b)):"replace-content"==d?(b.innerHTML="",k?b.insertBefore(w,null):jQuery(u.innerHTML).appendTo(jQuery(b))):"replace-element"==d&&(k?b.parentNode.insertBefore(w,b):jQuery(u.innerHTML).insertBefore(jQuery(b)),b.parentNode.removeChild(b))}};ai_insert_code=function(d){function l(m,k){return null==m?!1:m.classList?m.classList.contains(k):-1<(" "+m.className+" ").indexOf(" "+k+" ")}function v(m,k){null!=m&&(m.classList?m.classList.add(k):m.className+=" "+k)}function p(m,k){null!=m&&(m.classList?m.classList.remove(k):m.className=m.className.replace(new RegExp("(^|\\b)"+k.split(" ").join("|")+"(\\b|$)","gi")," "))}if("undefined"!=typeof d){var t=!1;if(l(d,"no-visibility-check")||d.offsetWidth||d.offsetHeight||d.getClientRects().length){t=d.getAttribute("data-code");var y=d.getAttribute("data-insertion"),b=d.getAttribute("data-selector");if(null!=t)if(null!=y&&null!=b){if(-1!=b.indexOf(":eq")?jQuery(b).length:document.querySelectorAll(b).length)ai_insert(y,b,b64d(t)),p(d,"ai-viewports")}else{y=document.createRange();b=!0;try{var u=y.createContextualFragment(b64d(t))}catch(m){b=!1}b?d.parentNode.insertBefore(u,d.nextSibling):jQuery(b64d(t)).insertBefore(jQuery(d.nextSibling));p(d,"ai-viewports")}t=!0}else u=d.previousElementSibling,l(u,"ai-debug-bar")&&l(u,"ai-debug-script")&&(p(u,"ai-debug-script"),v(u,"ai-debug-viewport-invisible")),p(d,"ai-viewports");return t}};ai_insert_list_code=function(d){var l=document.getElementsByClassName(d)[0];if("undefined"!=typeof l){var v=ai_insert_code(l),p=l.closest("div.code-block");if(p){v||p.removeAttribute("data-ai");var t=p.querySelectorAll(".ai-debug-block");p&&t.length&&(p.classList.remove("ai-list-block"),p.classList.remove("ai-list-block-ip"),p.style.visibility="",p.classList.contains("ai-remove-position")&&(p.style.position=""))}l.classList.remove(d);v&&ai_process_elements()}};ai_insert_viewport_code=function(d){var l=document.getElementsByClassName(d)[0];"undefined"!=typeof l&&(ai_insert_code(l),l.classList.remove(d),ai_process_elements())};ai_insert_code_by_class=function(d){var l=document.getElementsByClassName(d)[0];"undefined"!=typeof l&&(ai_insert_code(l),l.classList.remove(d))};ai_insert_client_code=function(d,l){var v=document.getElementsByClassName(d)[0];if("undefined"!=typeof v){var p=v.getAttribute("data-code");null!=p&&ai_check_block()&&ai_check_and_insert_block()&&(v.setAttribute("data-code",p.substring(Math.floor(l/19))),ai_insert_code_by_class(d),v.remove())}};ai_process_elements_active=!1;function ai_process_elements(){ai_process_elements_active||setTimeout(function(){ai_process_elements_active=!1;"function"==typeof ai_process_rotations&&ai_process_rotations();"function"==typeof ai_process_lists&&ai_process_lists(jQuery(".ai-list-data"));"function"==typeof ai_process_ip_addresses&&ai_process_ip_addresses(jQuery(".ai-ip-data"));"function"==typeof ai_adb_process_blocks&&ai_adb_process_blocks()},5);ai_process_elements_active=!0}var Arrive=function(d,l,v){function p(r,c,e){b.addMethod(c,e,r.unbindEvent);b.addMethod(c,e,r.unbindEventWithSelectorOrCallback);b.addMethod(c,e,r.unbindEventWithSelectorAndCallback)}function t(r){r.arrive=k.bindEvent;p(k,r,"unbindArrive");r.leave=w.bindEvent;p(w,r,"unbindLeave")}if(d.MutationObserver&&"undefined"!==typeof HTMLElement){var y=0,b=function(){var r=HTMLElement.prototype.matches||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector;return{matchesSelector:function(c,e){return c instanceof HTMLElement&&r.call(c,e)},addMethod:function(c,e,f){var a=c[e];c[e]=function(){if(f.length==arguments.length)return f.apply(this,arguments);if("function"==typeof a)return a.apply(this,arguments)}},callCallbacks:function(c,e){e&&e.options.onceOnly&&1==e.firedElems.length&&(c=[c[0]]);for(var f=0,a;a=c[f];f++)a&&a.callback&&a.callback.call(a.elem,a.elem);e&&e.options.onceOnly&&1==e.firedElems.length&&e.me.unbindEventWithSelectorAndCallback.call(e.target,e.selector,e.callback)},checkChildNodesRecursively:function(c,e,f,a){for(var g=0,h;h=c[g];g++)f(h,e,a)&&a.push({callback:e.callback,elem:h}),0<h.childNodes.length&&b.checkChildNodesRecursively(h.childNodes,e,f,a)},mergeArrays:function(c,e){var f={},a;for(a in c)c.hasOwnProperty(a)&&(f[a]=c[a]);for(a in e)e.hasOwnProperty(a)&&(f[a]=e[a]);return f},toElementsArray:function(c){"undefined"===typeof c||"number"===typeof c.length&&c!==d||(c=[c]);return c}}}(),u=function(){var r=function(){this._eventsBucket=[];this._beforeRemoving=this._beforeAdding=null};r.prototype.addEvent=function(c,e,f,a){c={target:c,selector:e,options:f,callback:a,firedElems:[]};this._beforeAdding&&this._beforeAdding(c);this._eventsBucket.push(c);return c};r.prototype.removeEvent=function(c){for(var e=this._eventsBucket.length-1,f;f=this._eventsBucket[e];e--)c(f)&&(this._beforeRemoving&&this._beforeRemoving(f),(f=this._eventsBucket.splice(e,1))&&f.length&&(f[0].callback=null))};r.prototype.beforeAdding=function(c){this._beforeAdding=c};r.prototype.beforeRemoving=function(c){this._beforeRemoving=c};return r}(),m=function(r,c){var e=new u,f=this,a={fireOnAttributesModification:!1};e.beforeAdding(function(g){var h=g.target;if(h===d.document||h===d)h=document.getElementsByTagName("html")[0];var n=new MutationObserver(function(x){c.call(this,x,g)});var q=r(g.options);n.observe(h,q);g.observer=n;g.me=f});e.beforeRemoving(function(g){g.observer.disconnect()});this.bindEvent=function(g,h,n){h=b.mergeArrays(a,h);for(var q=b.toElementsArray(this),x=0;x<q.length;x++)e.addEvent(q[x],g,h,n)};this.unbindEvent=function(){var g=b.toElementsArray(this);e.removeEvent(function(h){for(var n=0;n<g.length;n++)if(this===v||h.target===g[n])return!0;return!1})};this.unbindEventWithSelectorOrCallback=function(g){var h=b.toElementsArray(this);e.removeEvent("function"===typeof g?function(n){for(var q=0;q<h.length;q++)if((this===v||n.target===h[q])&&n.callback===g)return!0;return!1}:function(n){for(var q=0;q<h.length;q++)if((this===v||n.target===h[q])&&n.selector===g)return!0;return!1})};this.unbindEventWithSelectorAndCallback=function(g,h){var n=b.toElementsArray(this);e.removeEvent(function(q){for(var x=0;x<n.length;x++)if((this===v||q.target===n[x])&&q.selector===g&&q.callback===h)return!0;return!1})};return this},k=new function(){function r(f,a,g){return b.matchesSelector(f,a.selector)&&(f._id===v&&(f._id=y++),-1==a.firedElems.indexOf(f._id))?(a.firedElems.push(f._id),!0):!1}var c={fireOnAttributesModification:!1,onceOnly:!1,existing:!1};k=new m(function(f){var a={attributes:!1,childList:!0,subtree:!0};f.fireOnAttributesModification&&(a.attributes=!0);return a},function(f,a){f.forEach(function(g){var h=g.addedNodes,n=g.target,q=[];null!==h&&0<h.length?b.checkChildNodesRecursively(h,a,r,q):"attributes"===g.type&&r(n,a,q)&&q.push({callback:a.callback,elem:n});b.callCallbacks(q,a)})});var e=k.bindEvent;k.bindEvent=function(f,a,g){"undefined"===typeof g?(g=a,a=c):a=b.mergeArrays(c,a);var h=b.toElementsArray(this);if(a.existing){for(var n=[],q=0;q<h.length;q++)for(var x=h[q].querySelectorAll(f),z=0;z<x.length;z++)n.push({callback:g,elem:x[z]});if(a.onceOnly&&n.length)return g.call(n[0].elem,n[0].elem);setTimeout(b.callCallbacks,1,n)}e.call(this,f,a,g)};return k},w=new function(){function r(f,a){return b.matchesSelector(f,a.selector)}var c={};w=new m(function(){return{childList:!0,subtree:!0}},function(f,a){f.forEach(function(g){g=g.removedNodes;var h=[];null!==g&&0<g.length&&b.checkChildNodesRecursively(g,a,r,h);b.callCallbacks(h,a)})});var e=w.bindEvent;w.bindEvent=function(f,a,g){"undefined"===typeof g?(g=a,a=c):a=b.mergeArrays(c,a);e.call(this,f,a,g)};return w};l&&t(l.fn);t(HTMLElement.prototype);t(NodeList.prototype);t(HTMLCollection.prototype);t(HTMLDocument.prototype);t(Window.prototype);l={};p(k,l,"unbindAllArrive");p(w,l,"unbindAllLeave");return l}}(window,"undefined"===typeof jQuery?null:jQuery,void 0);var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,k){a.raw=k;return a};$jscomp.arrayIteratorImpl=function(a){var k=0;return function(){return k<a.length?{done:!1,value:a[k++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var k="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return k?k.call(a):$jscomp.arrayIterator(a)};jQuery(function(a){function k(e){e=e.match(E);return null!=e&&1<e.length&&"string"===typeof e[1]&&0<e[1].length?e[1].toLowerCase():null}function z(e){try{var h=Date.parse(e);isNaN(h)&&(h=null)}catch(J){h=null}if(null==h&&e.includes(" ")){e=e.split(" ");try{h=Date.parse(e[0]);if(e[1].includes(":")){var F=e[1].split(":");h+=1E3*(3600*parseInt(F[0])+60*parseInt(F[1])+parseInt(F[2]))}isNaN(h)&&(h=null)}catch(J){h=null}}return h}function n(){(jQuery("#ai-iab-tcf-bar").length||jQuery(".ai-list-manual").length)&&"function"==typeof __tcfapi&&"function"==typeof ai_load_blocks&&"undefined"==typeof ai_iab_tcf_callback_installed&&(__tcfapi("addEventListener",2,function(e,h){h&&"useractioncomplete"===e.eventStatus&&(ai_tcData=e,ai_load_blocks(),jQuery("#ai-iab-tcf-status").text("DATA LOADED"),jQuery("#ai-iab-tcf-bar").addClass("status-ok").removeClass("status-error"))}),ai_iab_tcf_callback_installed=!0)}Array.prototype.includes||(Array.prototype.includes=function(e){return!!~this.indexOf(e)});var E=/:\/\/(.[^/:]+)/i;ai_process_lists=function(e){function h(d,b,g){if(0==d.length){if("!@!"==g)return!0;b!=g&&("true"==g.toLowerCase()?g=!0:"false"==g.toLowerCase()&&(g=!1));return b==g}if("object"!=typeof b&&"array"!=typeof b)return!1;var f=d[0];d=d.slice(1);if("*"==f)for(b=$jscomp.makeIterator(Object.entries(b)),f=b.next();!f.done;f=b.next()){if(f=$jscomp.makeIterator(f.value),f.next(),f=f.next().value,h(d,f,g))return!0}else if(f in b)return h(d,b[f],g);return!1}function F(d,b,g){if("object"!=typeof d||-1==b.indexOf("["))return!1;b=b.replace(/]| /gi,"").split("[");return h(b,d,g)}function J(){"function"==typeof __tcfapi&&(a("#ai-iab-tcf-status").text("DETECTED"),__tcfapi("getTCData",2,function(d,b){b?(a("#ai-iab-tcf-bar").addClass("status-ok"),"tcloaded"==d.eventStatus||"useractioncomplete"==d.eventStatus?(ai_tcData=d,d.gdprApplies?a("#ai-iab-tcf-status").text("DATA LOADED"):jQuery("#ai-iab-tcf-status").text("GDPR DOES NOT APPLY"),a("#ai-iab-tcf-bar").addClass("status-ok").removeClass("status-error"),setTimeout(function(){ai_process_lists()},10)):"cmpuishown"==d.eventStatus&&(ai_cmpuishown=!0,a("#ai-iab-tcf-status").text("CMP UI SHOWN"),a("#ai-iab-tcf-bar").addClass("status-ok").removeClass("status-error"))):(a("#ai-iab-tcf-status").text("__tcfapi getTCData failed"),a("#ai-iab-tcf-bar").removeClass("status-ok").addClass("status-error"))}))}function P(d){"function"==typeof __tcfapi?("undefined"==typeof ai_iab_tcf_callback_installed&&n(),"undefined"==typeof ai_tcData_requested&&(ai_tcData_requested=!0,J(),url_parameters_need_tcData=!0)):d&&(a("#ai-iab-tcf-bar").addClass("status-error").removeClass("status-ok"),a("#ai-iab-tcf-status").text("MISSING: __tcfapi function not found"))}e=null==e?a("div.ai-list-data, meta.ai-list-data"):e.filter(".ai-list-data");if(e.length){e.removeClass("ai-list-data");var G=document.cookie.split(";");G.forEach(function(d,b){G[b]=d.trim()});var Q=getAllUrlParams(window.location.search);if(null!=Q.referrer)var r=Q.referrer;else r=document.referrer,""!=r&&(r=k(r));var K=window.navigator.userAgent,L=K.toLowerCase();if("undefined"!==typeof MobileDetect)var R=new MobileDetect(K);e.each(function(){var d=a(this).closest("div.code-block"),b=!0,g=a(this).attr("referer-list");if("undefined"!=typeof g){g=b64d(g).split(",");var f=a(this).attr("referer-list-type"),l=!1;a.each(g,function(t,c){if(""==c)return!0;if("*"==c.charAt(0))if("*"==c.charAt(c.length-1)){if(c=c.substr(1,c.length-2),-1!=r.indexOf(c))return l=!0,!1}else{if(c=c.substr(1),r.substr(-c.length)==c)return l=!0,!1}else if("*"==c.charAt(c.length-1)){if(c=c.substr(0,c.length-1),0==r.indexOf(c))return l=!0,!1}else if("#"==c){if(""==r)return l=!0,!1}else if(c==r)return l=!0,!1});switch(f){case "B":l&&(b=!1);break;case "W":l||(b=!1)}}if(b&&(g=a(this).attr("client-list"),"undefined"!=typeof g&&"undefined"!==typeof R))switch(g=b64d(g).split(","),f=a(this).attr("client-list-type"),l=!1,a.each(g,function(t,c){if(""==c)return!0;if("*"==c.charAt(0))if("*"==c.charAt(c.length-1)){if(c=c.substr(1,c.length-2).toLowerCase(),-1!=L.indexOf(c))return l=!0,!1}else{if(c=c.substr(1).toLowerCase(),L.substr(-c.length)==c)return l=!0,!1}else if("*"==c.charAt(c.length-1)){if(c=c.substr(0,c.length-1).toLowerCase(),0==L.indexOf(c))return l=!0,!1}else if(R.is(c))return l=!0,!1}),f){case "B":l&&(b=!1);break;case "W":l||(b=!1)}var M=g=!1;if(b&&(f=a(this).attr("parameter-list"),"undefined"!=typeof f)){f=b64d(f).split(",");var u=a(this).attr("parameter-list-type"),S=[];G.forEach(function(t){t=t.split("=");try{var c=JSON.parse(decodeURIComponent(t[1]))}catch(T){c=decodeURIComponent(t[1])}S[t[0]]=c});var w=!1,H=a(this);a.each(f,function(t,c){var T=c.split("&&");a.each(T,function(X,m){var x=!0;m=m.trim();"!!"==m.substring(0,2)&&(x=!1,m=m.substring(2));var p=m,y="!@!",U=-1!=m.indexOf("["),V=(0==m.indexOf("tcf-v2")||0==m.indexOf("euconsent-v2"))&&-1!=m.indexOf("[");-1!=m.indexOf("=")&&(y=m.split("="),p=y[0],y=y[1],U=-1!=p.indexOf("["),V=(0==p.indexOf("tcf-v2")||0==p.indexOf("euconsent-v2"))&&-1!=p.indexOf("["));if(V)a("#ai-iab-tcf-bar").show(),"object"==typeof ai_tcData?(a("#ai-iab-tcf-bar").addClass("status-ok"),p=p.replace(/]| /gi,"").split("["),p.shift(),w=(p=h(p,ai_tcData,y))?x:!x):(H.addClass("ai-list-data"),M=!0,"function"==typeof __tcfapi?P(!1):"undefined"==typeof ai_tcData_retrying&&(ai_tcData_retrying=!0,setTimeout(function(){P(!0)},200)));else if(U)w=(p=F(S,p,y))?x:!x;else{var N=!1;"!@!"==y?G.every(function(W){return W.split("=")[0]==m?(N=!0,!1):!0}):N=-1!=G.indexOf(m);w=N?x:!x}if(!w)return!1});if(w)return!1});switch(u){case "B":w&&(b=!1);break;case "W":w||(b=!1)}a(this).hasClass("ai-list-manual")&&(b?(H.removeClass("ai-list-data"),H.removeClass("ai-list-manual")):(g=!0,H.addClass("ai-list-data")));if(!g&&!M&&(f=a(this).data("debug-info"),"undefined"!=typeof f&&(f=a("."+f),0!=f.length))){var q=f.parent();q.hasClass("ai-debug-info")&&q.remove()}}q=a(this).prevAll(".ai-debug-bar.ai-debug-lists");f=""==r?"#":r;q.find(".ai-debug-name.ai-list-info").text(f).attr("title",K);q.find(".ai-debug-name.ai-list-status").text(b?ai_front.visible:ai_front.hidden);f=!1;if(b){u=a(this).attr("scheduling-start");var A=a(this).attr("scheduling-end"),B=a(this).attr("scheduling-days");if("undefined"!=typeof u&&"undefined"!=typeof A&&"undefined"!=typeof B){f=!0;var O=parseInt(a(this).attr("scheduling-fallback")),v=parseInt(a(this).attr("gmt"));u=z(b64d(u))+v;A=z(b64d(A))+v;B=b64d(B).split(",");q=a(this).attr("scheduling-type");var C=(new Date).getTime()+v,I=new Date(C),D=I.getDay();0==D?D=6:D--;v=C>=u&&C<A&&B.includes(D.toString());switch(q){case "B":v=!v}v||(b=!1);I=I.toISOString().split(".")[0].replace("T"," ");q=a(this).prevAll(".ai-debug-bar.ai-debug-scheduling");q.find(".ai-debug-name.ai-scheduling-info").text(I+" "+D+" current_time:"+C.toString()+"  start_date:"+u.toString()+" ="+(C>=u).toString()+" end_date:"+A.toString()+" =:"+(C<A).toString()+" days:"+B.toString()+" =:"+B.includes(D.toString()).toString());q.find(".ai-debug-name.ai-scheduling-status").text(b?ai_front.visible:ai_front.hidden);b||0==O||(q.removeClass("ai-debug-scheduling").addClass("ai-debug-fallback"),q.find(".ai-debug-name.ai-scheduling-status").text(ai_front.fallback+"="+O))}}if(g||M)return!0;a(this).css({visibility:"",position:"",width:"",height:"","z-index":""});b?(d.css({visibility:""}),d.hasClass("ai-remove-position")&&d.css({position:""}),"undefined"!=typeof a(this).data("code")&&(b=b64d(a(this).data("code")),0!=a(this).closest("head").length?(a(this).after(b),a(this).remove()):a(this).append(b),ai_process_element(this))):f&&!v&&0!=O?(d.css({visibility:""}),d.hasClass("ai-remove-position")&&d.css({position:""}),a(this).next(".ai-fallback").removeClass("ai-fallback"),"undefined"!=typeof a(this).data("fallback-code")?(b=b64d(a(this).data("fallback-code")),a(this).append(b),ai_process_element(this)):(a(this).hide(),d.find(".ai-debug-block").length||d.hide()),b=d.attr("data-ai"),"undefined"!==typeof b&&!1!==b&&(b=a(this).attr("fallback-tracking"),"undefined"!==typeof b&&!1!==b&&d.attr("data-ai",b))):(a(this).hide(),d.find(".ai-debug-block").length||d.hide(),d.removeAttr("data-ai").removeClass("ai-track"),d.find(".ai-debug-block").length?(d.css({visibility:""}).removeClass("ai-close"),d.hasClass("ai-remove-position")&&d.css({position:""})):d.hide());a(this).attr("data-code","");a(this).attr("data-fallback-code","");d.removeClass("ai-list-block")})}};a(document).ready(function(e){setTimeout(function(){ai_process_lists();setTimeout(function(){n()},50);if("function"==typeof ai_load_blocks)jQuery(document).on("cmplzEnableScripts",function(h){"all"===h.consentLevel&&ai_load_blocks()});jQuery("#ai-iab-tcf-bar").click(function(){AiCookies.remove("euconsent-v2",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("__lxG__consent__v2",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("__lxG__consent__v2_daisybit",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("__lxG__consent__v2_gdaisybit",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("cmplz_marketing",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("cmplz_stats",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("complianz_consent_status",{path:"/",domain:"."+window.location.hostname});jQuery("#ai-iab-tcf-status").text("COOKIE DELETED")})},5)})});function ai_process_element(a){setTimeout(function(){"function"==typeof ai_process_rotations_in_element&&ai_process_rotations_in_element(a);"function"==typeof ai_process_lists&&ai_process_lists(jQuery(".ai-list-data",a));"function"==typeof ai_process_ip_addresses&&ai_process_ip_addresses(jQuery(".ai-ip-data",a));"function"==typeof ai_adb_process_blocks&&ai_adb_process_blocks(a)},5)}function getAllUrlParams(a){var k=a?a.split("?")[1]:window.location.search.slice(1);a={};if(k){k=k.split("#")[0];k=k.split("&");for(var z=0;z<k.length;z++){var n=k[z].split("="),E=void 0,e=n[0].replace(/\[\d*\]/,function(h){E=h.slice(1,-1);return""});n="undefined"===typeof n[1]?"":n[1];e=e.toLowerCase();n=n.toLowerCase();a[e]?("string"===typeof a[e]&&(a[e]=[a[e]]),"undefined"===typeof E?a[e].push(n):a[e][E]=n):a[e]=n}}return a};jQuery(function(a){function t(g,c){c||(c=window.location.href);g=g.replace(/[\[\]]/g,"\\$&");var e=(new RegExp("[?&]"+g+"(=([^&#]*)|&|#|$)")).exec(c);return e?e[2]?decodeURIComponent(e[2].replace(/\+/g," ")):"":null}function u(g){g.removeClass("ai-ip-data");var c=!1;if(""!=ai_ip_data){try{var e=JSON.parse(ai_ip_data),h=e[0],l=e[1],n=e[2],p=e[3]}catch(d){return}var q=h+", "+l;null!=n&&null!=p&&(q=q+":"+n+":"+p);null==n&&(n="");null==p&&(p="");null!=e&&g.each(function(){var d=a(this).closest("div.code-block");c=!0;var f=a(this).attr("ip-addresses");if("undefined"!=typeof f){f=f.split(",");var r=a(this).attr("ip-address-list"),k=!1;a.each(f,function(v,b){if("*"==b.charAt(0))if("*"==b.charAt(b.length-1)){if(b=b.substr(1,b.length-2),-1!=h.indexOf(b))return k=!0,!1}else{if(b=b.substr(1),h.substr(-b.length)==b)return k=!0,!1}else if("*"==b.charAt(b.length-1)){if(b=b.substr(0,b.length-1),0==h.indexOf(b))return k=!0,!1}else if("#"==b){if(""==h)return k=!0,!1}else if(b==h)return k=!0,!1});switch(r){case "B":k&&(c=!1);break;case "W":k||(c=!1)}}if(c&&(f=a(this).attr("countries"),"undefined"!=typeof f))switch(f=f.split(","),r=a(this).attr("country-list"),k=!1,a.each(f,function(v,b){var m=b.trim().split(":");if(null==m[1]||""==n)m[1]="";if(null==m[2]||""==p)m[2]="";var w=m.join(":").toUpperCase();m=(l+":"+(""==m[1]?"":n)+":"+(""==m[2]?"":p)).toUpperCase();if(w==m)return k=!0,!1}),r){case "B":k&&(c=!1);break;case "W":k||(c=!1)}a(this).css({visibility:"",position:"",width:"",height:"","z-index":""});f=a(this).prev(".ai-debug-bar");f.find(".ai-debug-name.ai-ip-country").text(q);f.find(".ai-debug-name.ai-ip-status").text(c?ai_front.visible:ai_front.hidden);c?(d.css({visibility:""}),d.hasClass("ai-remove-position")&&d.css({position:""}),"undefined"!=typeof a(this).data("code")&&(f=b64d(a(this).data("code")),0!=a(this).closest("head").length?(a(this).after(f),a(this).remove()):a(this).append(f),a(this).attr("data-code",""),ai_process_element(this))):(a(this).hide(),d.find(".ai-debug-block").length||d.hide(),d.removeAttr("data-ai"),d.find(".ai-debug-block")?(d.css({visibility:""}).removeClass("ai-close"),d.hasClass("ai-remove-position")&&d.css({position:""}),"undefined"!=typeof a(this).data("code")&&(d.removeClass("ai-list-block"),d.prev().hasClass("ai-debug-info")&&d.prev().remove())):d.hide());d.removeClass("ai-list-block-ip")})}}ai_process_ip_addresses=function(g){g=null==g?a("div.ai-ip-data, meta.ai-ip-data"):g.filter(".ai-ip-data");if(g.length)if("undefined"!=typeof ai_ip_data)u(g);else if("undefined"==typeof ai_ip_data_requested){ai_ip_data_requested=!0;var c="/wp-admin/admin-ajax.php?action=ai_ajax&ip-data=ip-address-country-city&ai_check=e25a7b7809&ver="+((new Date).getTime()+"-"+Math.round(1E5*Math.random())),e=t("ai-debug-ip-address");null!=e&&(c+="&ai-debug-ip-address="+e);e=t("ai-debug-country");null!=e&&(c+="&ai-debug-country="+e);a.get(c,function(h){ai_ip_data=h;if(""==h){var l="Ajax request returned empty data, geo-targeting disabled";console.error(l);"undefined"!=typeof ai_js_errors&&ai_js_errors.push([l,c,0])}else try{JSON.parse(h)}catch(n){l="Ajax call returned invalid data, geo-targeting disabled",console.error(l,h),"undefined"!=typeof ai_js_errors&&ai_js_errors.push([l,c,0])}u(g)}).fail(function(h,l,n){a("div.ai-ip-data").each(function(){a(this).css({display:"none",visibility:"",position:"",width:"",height:"","z-index":""}).removeClass("ai-ip-data").hide()})})}};a(document).ready(function(g){setTimeout(function(){ai_process_ip_addresses()},5)})});function ai_process_element(a){setTimeout(function(){"function"==typeof ai_process_rotations_in_element&&ai_process_rotations_in_element(a);"function"==typeof ai_process_lists&&ai_process_lists(jQuery(".ai-list-data",a));"function"==typeof ai_process_ip_addresses&&ai_process_ip_addresses(jQuery(".ai-ip-data",a));"function"==typeof ai_adb_process_blocks&&ai_adb_process_blocks(a)},5)};ai_run_865958812113 = function(){ai_document_write=document.write;document.write=function(a){"interactive"==document.readyState?(console.error("document.write called after page load: ",a),"undefined"!=typeof ai_js_errors&&ai_js_errors.push(["document.write called after page load",a,0])):ai_document_write.call(document,a)};ai_insert ('after', '.lwptoc', b64d ('PGRpdiBjbGFzcz0nY29kZS1ibG9jayBjb2RlLWJsb2NrLWRlZmF1bHQgY29kZS1ibG9jay0xMCBhaS12aWV3cG9ydC0zJz4KPGEgaHJlZj0iL2luc3RhLyIgcmVsPSJub2ZvbGxvdyIgdGFyZ2V0PSJfYmxhbmsiPjxpbWcgc3JjPSIvYi9wYW1tX2xhbmRpbmdfYmFubmVyXzMwMHgyNTBfcnVfLmdpZiIvPjwvYT4KPC9kaXY+Cg=='));};if (document.readyState === 'complete' || (document.readyState !== 'loading' && !document.documentElement.doScroll)) ai_run_865958812113 (); else document.addEventListener ('DOMContentLoaded', ai_run_865958812113);ai_js_code = true;</script> </body></html>