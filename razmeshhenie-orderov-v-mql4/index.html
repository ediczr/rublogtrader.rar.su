<!DOCTYPE html><html lang="ru-RU" prefix="og: http://ogp.me/ns#"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1' /><link media="all" href="https://rublogtrader.rar.su/wp-content/cache/autoptimize/css/autoptimize_a956534720ee1514d6564ed8c0f433d5.css" rel="stylesheet" /><title>Размещение ордеров в MQL4: как открывать и закрывать ордера?</title><meta name="description" content="Все про размещение ордеров на MQL4: типы ордеров, функции для открытия и закрытия ордеров, получение информации об ордерах. Код советника." /><meta property="og:locale" content="ru_RU" /><meta property="og:type" content="article" /><meta property="og:title" content="Размещение ордеров в MQL4: как открывать и закрывать ордера?" /><meta property="og:description" content="Все про размещение ордеров на MQL4: типы ордеров, функции для открытия и закрытия ордеров, получение информации об ордерах. Код советника." /><meta property="og:url" content="https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/" /><meta property="og:site_name" content="Блог трейдера" /><meta property="article:published_time" content="2020-06-09T10:36:55+00:00" /><meta property="article:modified_time" content="2020-06-09T13:30:23+00:00" /><meta property="og:image" content="https://rublogtrader.rar.su/wp-content/uploads/2020/06/razmeshhenie-orderov-v-mql4-kak-otkryvat-i-zakryvat-ordera.jpg" /><meta property="og:image:width" content="1200" /><meta property="og:image:height" content="630" /><meta property="og:image:type" content="image/jpeg" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:creator" content="@traderblog_net" /><meta name="twitter:site" content="@traderblog_net" /><meta name="twitter:label1" content="Написано автором" /><meta name="twitter:data1" content="Александр Паркер" /><meta name="twitter:label2" content="Примерное время для чтения" /><meta name="twitter:data2" content="7 минут" /> <script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://rublogtrader.rar.su/#website","url":"https://rublogtrader.rar.su/","name":"\u0411\u043b\u043e\u0433 \u0442\u0440\u0435\u0439\u0434\u0435\u0440\u0430","description":"My WordPress Blog","publisher":{"@id":"https://rublogtrader.rar.su/#/schema/person/28382f0e81820f364e345a97d4203238"},"potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://rublogtrader.rar.su/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"ru-RU"},{"@type":"ImageObject","@id":"https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/#primaryimage","inLanguage":"ru-RU","url":"https://rublogtrader.rar.su/wp-content/uploads/2020/06/razmeshhenie-orderov-v-mql4-kak-otkryvat-i-zakryvat-ordera.jpg","contentUrl":"https://rublogtrader.rar.su/wp-content/uploads/2020/06/razmeshhenie-orderov-v-mql4-kak-otkryvat-i-zakryvat-ordera.jpg","width":1200,"height":630,"caption":"\u0420\u0430\u0437\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u043e\u0440\u0434\u0435\u0440\u043e\u0432 \u0432 MQL4: \u043a\u0430\u043a \u043e\u0442\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u0438 \u0437\u0430\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u043e\u0440\u0434\u0435\u0440\u0430?"},{"@type":"WebPage","@id":"https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/#webpage","url":"https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/","name":"\u0420\u0430\u0437\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u043e\u0440\u0434\u0435\u0440\u043e\u0432 \u0432 MQL4: \u043a\u0430\u043a \u043e\u0442\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u0438 \u0437\u0430\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u043e\u0440\u0434\u0435\u0440\u0430?","isPartOf":{"@id":"https://rublogtrader.rar.su/#website"},"primaryImageOfPage":{"@id":"https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/#primaryimage"},"datePublished":"2020-06-09T10:36:55+00:00","dateModified":"2020-06-09T13:30:23+00:00","description":"\u0412\u0441\u0435 \u043f\u0440\u043e \u0440\u0430\u0437\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u043e\u0440\u0434\u0435\u0440\u043e\u0432 \u043d\u0430 MQL4: \u0442\u0438\u043f\u044b \u043e\u0440\u0434\u0435\u0440\u043e\u0432, \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0434\u043b\u044f \u043e\u0442\u043a\u0440\u044b\u0442\u0438\u044f \u0438 \u0437\u0430\u043a\u0440\u044b\u0442\u0438\u044f \u043e\u0440\u0434\u0435\u0440\u043e\u0432, \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u043e\u0431 \u043e\u0440\u0434\u0435\u0440\u0430\u0445. \u041a\u043e\u0434 \u0441\u043e\u0432\u0435\u0442\u043d\u0438\u043a\u0430.","breadcrumb":{"@id":"https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/#breadcrumb"},"inLanguage":"ru-RU","potentialAction":[{"@type":"ReadAction","target":["https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/"]}]},{"@type":"BreadcrumbList","@id":"https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"\u0413\u043b\u0430\u0432\u043d\u0430\u044f \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0430","item":"https://rublogtrader.rar.su/"},{"@type":"ListItem","position":2,"name":"\u0420\u0430\u0437\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u043e\u0440\u0434\u0435\u0440\u043e\u0432 \u0432 MQL4: \u043a\u0430\u043a \u043e\u0442\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u0438 \u0437\u0430\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u043e\u0440\u0434\u0435\u0440\u0430?"}]},{"@type":"Article","@id":"https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/#article","isPartOf":{"@id":"https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/#webpage"},"author":{"@id":"https://rublogtrader.rar.su/#/schema/person/28382f0e81820f364e345a97d4203238"},"headline":"\u0420\u0430\u0437\u043c\u0435\u0449\u0435\u043d\u0438\u0435 \u043e\u0440\u0434\u0435\u0440\u043e\u0432 \u0432 MQL4: \u043a\u0430\u043a \u043e\u0442\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u0438 \u0437\u0430\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u043e\u0440\u0434\u0435\u0440\u0430?","datePublished":"2020-06-09T10:36:55+00:00","dateModified":"2020-06-09T13:30:23+00:00","mainEntityOfPage":{"@id":"https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/#webpage"},"wordCount":514,"commentCount":1,"publisher":{"@id":"https://rublogtrader.rar.su/#/schema/person/28382f0e81820f364e345a97d4203238"},"image":{"@id":"https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/#primaryimage"},"thumbnailUrl":"https://rublogtrader.rar.su/wp-content/uploads/2020/06/razmeshhenie-orderov-v-mql4-kak-otkryvat-i-zakryvat-ordera.jpg","articleSection":["MQL4"],"inLanguage":"ru-RU","potentialAction":[{"@type":"CommentAction","name":"Comment","target":["https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/#respond"]}]},{"@type":["Person","Organization"],"@id":"https://rublogtrader.rar.su/#/schema/person/28382f0e81820f364e345a97d4203238","name":"\u0410\u043b\u0435\u043a\u0441\u0430\u043d\u0434\u0440 \u041f\u0430\u0440\u043a\u0435\u0440","image":{"@type":"ImageObject","@id":"https://rublogtrader.rar.su/#personlogo","inLanguage":"ru-RU","url":"https://rublogtrader.rar.su/wp-content/uploads/2019/06/cosmopolis-100x100.png","contentUrl":"https://rublogtrader.rar.su/wp-content/uploads/2019/06/cosmopolis-100x100.png","width":100,"height":100,"caption":"\u0410\u043b\u0435\u043a\u0441\u0430\u043d\u0434\u0440 \u041f\u0430\u0440\u043a\u0435\u0440"},"logo":{"@id":"https://rublogtrader.rar.su/#personlogo"},"description":"\u0421\u043e\u0437\u0434\u0430\u0442\u0435\u043b\u044c \u0438 \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440 \u0441\u0430\u0439\u0442\u0430 traderblog.net.","sameAs":["https://rublogtrader.rar.su/"]}]}</script> <link rel="alternate" type="application/rss+xml" title="Блог трейдера &raquo; Лента" href="https://rublogtrader.rar.su/feed/" /> <script type='text/javascript' src='https://rublogtrader.rar.su/wp-includes/js/jquery/jquery.min.js' id='jquery-core-js'></script> <link rel="https://api.w.org/" href="https://rublogtrader.rar.su/wp-json/" /><link rel="alternate" type="application/json" href="https://rublogtrader.rar.su/wp-json/wp/v2/posts/14296" />   <link rel="icon" type="image/png" sizes="32x32" href="/favicon32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon16.png"><link rel="apple-touch-icon" sizes="180x180" href="/appleicon.png">  <!-- Yandex.Metrika counter --><script type="text/javascript" > (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)}; m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)}) (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym"); ym(87171221, "init", { clickmap:true, trackLinks:true, accurateTrackBounce:true, webvisor:true });</script><noscript><div><img src="https://mc.yandex.ru/watch/87171221" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter --></head><body ><div id="page" class="site"><header id="masthead" class="site-header"><div class="row"><div class="col-xs-12 site-header-col"><div class="site-branding"><p class="site-title"><a href="/" rel="home">Блог трейдера</a></p></div><nav id="site-navigation" class="main-navigation"> <button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">Меню</button><div class="menu-menu-container"><ul id="primary-menu" class="menu"><li id="menu-item-14443" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-14443"><a href="https://rublogtrader.rar.su/forex/">Форекс</a></li><li id="menu-item-14444" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-14444"><a href="https://rublogtrader.rar.su/trading/">Трейдинг</a></li><li id="menu-item-12561" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12561"><a href="https://rublogtrader.rar.su/technical-analysis/">Технический анализ</a></li><li id="menu-item-12560" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12560"><a href="https://rublogtrader.rar.su/indicators/">Индикаторы</a></li><li id="menu-item-12559" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12559"><a href="https://rublogtrader.rar.su/prajs-jekshen/">Прайс экшен</a></li><li id="menu-item-15892" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-15892"><a href="https://rublogtrader.rar.su/investing/">Инвестиции</a></li><li id="menu-item-16239" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-16239"><a href="https://rublogtrader.rar.su/crypto/">Крипто</a></li></ul></div></nav></div></div></header><div class='code-block code-block-center code-block-2 ai-viewport-1'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader1" rel="nofollow" target="_blank"><img src="https://advertising-blog.qqit.ru/rublogtrader.rar.su/468x60.gif"/></a></div><div id="content" class="site-content"><div class="row row--index"><div class="col-xs-12"><div id="primary" class="content-area"><main id="main" class="site-main" role="main"><article id="post-14296" class="post-14296 post type-post status-publish format-standard has-post-thumbnail hentry category-mql4"><div class="row no-pad"><div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 no-pad"><header class="entry-header"><h1 class="entry-title">Размещение ордеров в MQL4: как открывать и закрывать ордера?</h1><div class="entry-meta"><a href="https://rublogtrader.rar.su/mql4/" rel="category tag">MQL4</a> | 09.06.2020 | <i class="icon-07"></i> 2491</div></header><div class="entry-content"> <img src="" style="float:right;" align="right"><p>Как трейдер, вы, вероятно, уже знакомы с ценами Bid и Ask. Но вы можете не знать об их роли в размещении ордеров. Очень важно использовать правильную цену при открытии или закрытии ордеров.<br> <span id="more-14296"></span><br> Цена Bid — это то, что вы видите на графиках MetaTrader. Цена Ask, как правило, всего на несколько пунктов выше цены Bid. Разница между Bid и Ask заключается в <a href="https://rublogtrader.rar.su/spread-na-foreks/">спреде</a>, который представляет собой комиссию брокера за размещение ордера.</p><p>Цена Ask — это цена, по которой мы открываем ордера на покупку и закрываем ордера на продажу. Цена Bid — это цена, по которой мы открываем ордера на продажу и закрываем ордера на покупку.</p><div class="lwptoc lwptoc-autoWidth lwptoc-baseItems lwptoc-transparent lwptoc-notInherit" data-smooth-scroll="1" data-smooth-scroll-offset="24"><div class="lwptoc_i"><div class="lwptoc_items lwptoc_items-visible"><div class="lwptoc_itemWrap"><div class="lwptoc_item"> <a href="#Tipy_orderov"> <span class="lwptoc_item_label">Типы ордеров</span> </a></div><div class="lwptoc_item"> <a href="#Process_razmesenia_orderov"> <span class="lwptoc_item_label">Процесс размещения ордеров</span> </a></div><div class="lwptoc_item"> <a href="#Funkcia_OrderSend"> <span class="lwptoc_item_label">Функция OrderSend()</span> </a></div><div class="lwptoc_item"> <a href="#Razmesenie_rynocnogo_ordera"> <span class="lwptoc_item_label">Размещение рыночного ордера</span> </a></div><div class="lwptoc_item"> <a href="#Razmesenie_otlozennogo_stop-ordera"> <span class="lwptoc_item_label">Размещение отложенного стоп-ордера</span> </a></div><div class="lwptoc_item"> <a href="#Razmesenie_otlozennogo_limitnogo_ordera"> <span class="lwptoc_item_label">Размещение отложенного лимитного ордера</span> </a></div><div class="lwptoc_item"> <a href="#Rasscet_stop-lossa_i_tejk-profita"> <span class="lwptoc_item_label">Рассчет стоп-лосса и тейк-профита</span> </a></div><div class="lwptoc_item"> <a href="#Rasscet_v_punktah"> <span class="lwptoc_item_label">Рассчет в пунктах</span> </a></div><div class="lwptoc_item"> <a href="#Point"> <span class="lwptoc_item_label">Point</span> </a></div><div class="lwptoc_item"> <a href="#Proskalzyvanie_i_Point"> <span class="lwptoc_item_label">Проскальзывание и Point</span> </a></div><div class="lwptoc_item"> <a href="#Proskalzyvanie_i_Point_kak_globalnye_peremennye"> <span class="lwptoc_item_label">Проскальзывание и Point как глобальные переменные</span> </a></div><div class="lwptoc_item"> <a href="#MarketInfo"> <span class="lwptoc_item_label">MarketInfo()</span> </a></div><div class="lwptoc_item"> <a href="#Rascet_stop-lossa"> <span class="lwptoc_item_label">Расчет стоп-лосса</span> </a></div><div class="lwptoc_item"> <a href="#Rascet_tejk-profita"> <span class="lwptoc_item_label">Расчет тейк-профита</span> </a></div><div class="lwptoc_item"> <a href="#Alternativnyj_metod_rasceta_stop-lossa"> <span class="lwptoc_item_label">Альтернативный метод расчета стоп-лосса</span> </a></div><div class="lwptoc_item"> <a href="#Polucenie_informacii_ob_ordere"> <span class="lwptoc_item_label">Получение информации об ордере</span> </a></div><div class="lwptoc_item"> <a href="#OrderSelect"> <span class="lwptoc_item_label">OrderSelect()</span> </a></div><div class="lwptoc_item"> <a href="#Zakrytie_orderov"> <span class="lwptoc_item_label">Закрытие ордеров</span> </a></div><div class="lwptoc_item"> <a href="#OrderClose"> <span class="lwptoc_item_label">OrderClose()</span> </a></div><div class="lwptoc_item"> <a href="#OrderDelete"> <span class="lwptoc_item_label">OrderDelete()</span> </a></div><div class="lwptoc_item"> <a href="#Primer_koda_prostogo_sovetnika"> <span class="lwptoc_item_label">Пример кода простого советника</span> </a></div><div class="lwptoc_item"> <a href="#Ispolzovanie_otlozennyh_orderov"> <span class="lwptoc_item_label">Использование отложенных ордеров</span> </a></div></div></div></div></div><div class='code-block code-block-center code-block-3 ai-viewport-1'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader2" rel="nofollow" target="_blank"><img src="https://advertising-blog.qqit.ru/rublogtrader.rar.su/pamm_landing_banner_970x250_ru_1.gif"/></a></div><h2><span id="Tipy_orderov">Типы ордеров</span></h2><p>В MetaTrader можно разместить три типа ордеров: рыночные, стоповые и лимитные ордера. Рыночные ордера являются наиболее распространенными. Рыночный ордер немедленно открывает позицию по текущей цене Bid или Ask.</p><p>При размещении рыночного ордера мы должны указать цену открытия. Если указанная цена открытия устарела из-за быстро меняющегося рынка или задержки в выполнении кода советника, терминал попытается разместить ордер по текущей рыночной цене, если он находится в пределах максимально допустимого проскальзывания.</p><p>Если вы разместите рыночный ордер с помощью диалогового окна «Новый ордер» в MetaTrader, в нижней части вы увидите настройку «Включить максимальное отклонение от котировочной цены». Когда этот флажок установлен, вы можете указать максимальное отклонение в пунктах. Это максимально допустимое проскальзывание.</p><p>Если текущая цена выходит за пределы указанной цены открытия плюс или минус проскальзывание, произойдет ошибка реквота, и ордер не будет размещен. Возможно, вы замечали это, когда пытались разместить рыночный ордер на быстро движущемся рынке. Обратите внимание, что брокеры ECN/STP не используют параметр проскальзывания и всегда будут открывать рыночные ордера по текущей цене.</p><p>Отложенные ордера — это запрос на открытие рыночного ордера по определенной цене. Стоп-ордер на покупку размещается выше текущей цены, а стоп-ордер на продажу размещается ниже текущей цены. Ожидается, что цена в конечном итоге вырастет или упадет до данного уровня и продолжит движение в этом направлении, что приведет к получению прибыли.</p><p>Лимитный ордер противоположен стоп-ордеру. Лимитный ордер на покупку размещается ниже текущей цены, а лимитный ордер на продажу — выше текущей цены. Ожидается, что цена вырастет или упадет до этого уровня, сработает ордер, а затем цена развернется. Лимитные ордера не очень часто используются в автоматической торговле.</p><p>Также для отложенных ордеров может быть установлено время истечения. Если ордер не исполнен до определенного времени, он автоматически удаляется.</p><h2><span id="Process_razmesenia_orderov">Процесс размещения ордеров</span></h2><p>Процесс размещения ордера на MQL состоит из нескольких этапов. Для начала мы должны определить:</p><ul><li>Тип размещаемого ордера — покупка или продажа. Будет ли это стоп, рыночный или лимитный ордер.</li><li>Валютная пара для торговли — график, к которому прикреплен советник.</li><li>Размер лота. Это может быть фиксированный размер лота или тот, который рассчитывается с помощью процедуры управления капиталом.</li><li>Цена открытия ордера. Для рыночных ордеров это будет текущая цена Bid или Ask. Для отложенных ордеров цена открытия должна быть на минимальном расстоянии от текущей цены и должна быть выше или ниже текущей цены, как того требует тип ордера.</li><li>Цена стоп-лосса. Стоп-лосс может быть предопределенной ценой, значением индикатора, фиксированным числом пунктов от цены открытия ордера или может быть динамически рассчитан с использованием процедуры управления рисками. Стоп-лосс можно разместить вместе с ордером или добавить к ордеру позже.</li><li>Цена тейк-профита. Обычно это фиксированное количество пунктов от цены открытия ордера, хотя его можно рассчитать и другими методами. Тейк-профит можно разместить в самом ордере или добавить позже.</li><li>Идентификаторы ордера — комментарий к ордеру или «магическое число», которое идентифицирует ордер как размещенный конкретным советником.</li><li>Дополнительная цена истечения для отложенных ордеров, если брокер поддерживает эту возможность.</li></ul><h2><span id="Funkcia_OrderSend">Функция OrderSend()</span></h2><p>Функция OrderSend() используется для размещения ордеров на MQL. Ее синтаксис выглядит следующим образом:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">int</span> OrderSend<span class="br0">(</span>string Symbol<span class="sy0">,</span> <span class="kw4">int</span> Type<span class="sy0">,</span> <span class="kw4">double</span> Lots<span class="sy0">,</span> <span class="kw4">double</span> Price<span class="sy0">,</span> <span class="kw4">int</span> Slippage<span class="sy0">,</span> <span class="kw4">double</span> StopLoss<span class="sy0">,</span> <span class="kw4">double</span> TakeProfit<span class="sy0">,</span> string Comment <span class="sy0">=</span> NULL<span class="sy0">,</span> <span class="kw4">int</span> MagicNumber <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">,</span> datetime Expiration <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">,</span> color Arrow <span class="sy0">=</span> CLR_NONE<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><ul><li><strong>Symbol</strong> — строка, представляющая валютную пару для торговли, например, GBPUSD. Функция Symbol() используется для определения валютной пары текущего графика.</li><li><strong>Type</strong> — тип размещаемого ордера: покупка или продажа, рынок, стоп или лимит. Это целочисленное значение, представленное следующими константами:<br> — OP_BUY — рыночный ордер на покупку (целое значение 0).<br> — OP_SELL — Продать рыночный ордер (целое значение 1).<br> — OP_BUYSTOP — стоп-ордер на покупку (целое значение 2).<br> — OP_SELLSTOP — стоп ордер на продажу (целое значение 3).<br> — OP_BUYLIMIT — лимитный ордер на покупку (целочисленное значение 4).<br> — OP_SELLLIMIT — лимитный ордер на продажу (целое значение 5).</li><li><strong>Lots</strong> — количество лотов для торговли. Вы можете указать мини-лоты (0.1) или микро-лоты (0.01).</li><li><strong>Price</strong> — цена, по которой открывается ордер. Для ордера на покупку по рынку это будет цена Ask. Для ордера на продажу, это будет цена Bid. Для отложенных ордеров это будет любая действительная цена, которая выше или ниже текущей цены.</li><li><strong>Slippage</strong> — максимальное проскальзывание в пунктах. Брокеры, которые не используют проскальзывание, будут игнорировать этот параметр.</li><li><strong>StopLoss</strong> — цена стоп-лосса. Для ордера на покупку цена стоп-лосс будет ниже цены открытия ордера, а для ордера на продажу выше. Если установлено значение 0, стоп-лосс не будет использоваться.</li><li><strong>TakeProfit</strong> — цена тейк-профита. Для ордера на покупку тейк-профит будет выше цены открытия ордера, а для ордера на продажу — ниже. Если установлено значение 0, тейк-профит не будет использоваться.</li><li><strong>Comment</strong> — необязательная строка, которая будет служить комментарием к ордеру. Комментарии отображаются на вкладке Торговля в окне терминала. Комментарии к ордеру также можно использовать в качестве идентификатора.</li><li><strong>MagicNumber</strong> — необязательное целочисленное значение, которое будет определять порядок размещения конкретного советника. Настоятельно рекомендуется его использовать.</li><li><strong>Expiration</strong> — необязательный срок действия отложенных ордеров.</li><li><strong>color Arrow</strong> — необязательный цвет для стрелки, которая будет отображаться на графике с указанием цены и времени открытия.</li></ul><p>Функция OrderSend() возвращает номер заявки только что размещенного ордера. Если ордер не был выставлен из-за ошибки, возвращаемое значение будет -1.</p><p>Мы можем сохранить тикет ордера в глобальную или статическую переменную для последующего использования. Если ордер не был размещен из-за ошибки, мы можем проанализировать ошибку и предпринять соответствующия действия на основании возвращаемого кода ошибки.</p><h2><span id="Razmesenie_rynocnogo_ordera">Размещение рыночного ордера</span></h2><p>Рассмотрим пример рыночного ордера на покупку. Предположим, что переменные LotSize, Slippage, BuyStopLoss, BuyTakeProfit и MagicNumber уже рассчитаны и являются действительными.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_BUY<span class="sy0">,</span>LotSize<span class="sy0">,</span>Ask<span class="sy0">,</span>Slippage<span class="sy0">,</span>BuyStopLoss<span class="sy0">,</span>BuyTakeProfit<span class="sy0">,</span><span class="st0">&quot;Ордер на покупку&quot;</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Green<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Функция Symbol() возвращает текущий символ графика.</p><p>OP_BUY указывает, что это рыночный ордер на покупку.</p><p>Ask — это предопределенная переменная в MQL, в которой хранится самая последняя цитата Ask.</p><p>Slippage устанавливается с помощью внешней переменной. Если ваш брокер использует 4-значные котировки (2 значные для пар с йеной), 1 пункт будет равен 1 пункту. Однако, если ваш брокер предлагает 3-х и 5-ти значные котировки, то 1 пункт будет равен 0,1 пункта. В этом случае вам необходимо добавить дополнительный ноль в конец Slippage.</p><p>Мы добавили комментарий «Ордер на покупку» к этому ордеру.</p><p>Поскольку для рыночных ордеров нет срока действия, параметр Expiration равен 0.</p><p>Наконец, мы указываем цветовую константу Green, чтобы нарисовать зеленую стрелку на графике.</p><p>Вот пример ордера на продажу, используя те же параметры, что и выше:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_SELL<span class="sy0">,</span>LotSize<span class="sy0">,</span>Bid<span class="sy0">,</span>Slippage<span class="sy0">,</span>SellStopLoss<span class="sy0">,</span>SellTakeProfit<span class="sy0">,</span><span class="st0">&quot;Ордер на продажу&quot;</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Мы используем OP_SELL в качестве типа ордера, чтобы указать ордер на продажу.</p><p>Мы используем Bid в качестве цены открытия ордера, чтобы отразить тот факт, что ордера на продажу открываются по цене Bid.</p><p>«Ордер на продажу» — это наш комментарий к ордеру.</p><p>Мы используем красный цвет в качестве цвета стрелки, чтобы отличать ордера на покупку.</p><h2><span id="Razmesenie_otlozennogo_stop-ordera">Размещение отложенного стоп-ордера</span></h2><p>Разница между отложенными ордерами и рыночными ордерами заключается в том, что цена открытия ордера будет отличаться от текущей рыночной цены. Значения стоп-лосс и тейк-профит должны быть рассчитаны относительно цены открытия отложенного ордера.</p><p>В этих примерах мы будем использовать переменную PendingPrice для цены отложенного ордера. Ее можно рассчитать на основании нашего торгового алгоритма или в качестве внешнего параметра.</p><p>Для стоп-ордера на покупку PendingPrice должен быть больше текущей цены Ask. Предположим, что BuyStopLoss и BuyTakeProfit были правильно рассчитаны относительно PendingPrice.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_BUYSTOP<span class="sy0">,</span>LotSize<span class="sy0">,</span>PendingPrice<span class="sy0">,</span>Slippage<span class="sy0">,</span>BuyStopLoss<span class="sy0">,</span> BuyTakeProfit<span class="sy0">,</span><span class="st0">&quot;Ордер buy-stop&quot;</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Green<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Обратите внимание, что мы используем OP_BUYSTOP для указания стоп-ордера на покупку и PendingPrice для цены открытия нашего ордера.</p><p>Для стоп-ордера на продажу PendingPrice должен быть меньше текущей цены Bid. В этом примере мы добавим время истечения ордера, используя переменную Expiration. Время истечения должно быть больше текущего времени сервера. Вот пример размещения ордера Sell Stop:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_SELLSTOP<span class="sy0">,</span>LotSize<span class="sy0">,</span>PendingPrice<span class="sy0">,</span>Slippage<span class="sy0">,</span>SellStopLoss<span class="sy0">,</span> SellTakeProfit<span class="sy0">,</span><span class="st0">&quot;Sell Stop ордер&quot;</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span>Expiration<span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><h2><span id="Razmesenie_otlozennogo_limitnogo_ordera">Размещение отложенного лимитного ордера</span></h2><p>Лимитные ордера аналогичны стоп-ордерам, за исключением того, что цена отложенного ордера является обратной относительно текущей цены и типа ордера. Для лимитных заявок на покупку цена отложенного ордера должна быть меньше текущей цены Bid. Вот пример лимитного ордера на покупку:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_BUYLIMIT<span class="sy0">,</span>LotSize<span class="sy0">,</span>PendingPrice<span class="sy0">,</span>Slippage<span class="sy0">,</span>BuyStopLoss<span class="sy0">,</span> BuyTakeProfit<span class="sy0">,</span><span class="st0">&quot;Buy Limit Order&quot;</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Green<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Обратите внимание, что мы использовали OP_BUYLIMIT, чтобы указать лимитный ордер на покупку. В остальном наши параметры идентичны параметрам для стоп-ордеров.</p><p>Для лимитного ордера на продажу цена отложенного ордера должна быть больше текущей цены Ask. Вот пример ордера на продажу:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_SELLLIMIT<span class="sy0">,</span>LotSize<span class="sy0">,</span>PendingPrice<span class="sy0">,</span>Slippage<span class="sy0">,</span>SellStopLoss<span class="sy0">,</span> SellTakeProfit<span class="sy0">,</span><span class="st0">&quot;Sell Limit Order&quot;</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span>Expiration<span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><h2><span id="Rasscet_stop-lossa_i_tejk-profita">Рассчет стоп-лосса и тейк-профита</span></h2><p>Есть несколько способов расчитать стоп-лосс и тейк-профит. Самый распространенный — указать количество пунктов от цены открытия ордера, чтобы разместить стоп. Например, если мы установили стоп-лосс в 50 пунктов, это означает, что цена стоп-лосс будет в 50 пунктов от цены открытия нашего ордера.</p><p>Мы также можем использовать значение индикатора, внешний параметр или какой-либо другой тип расчета цены. Все, что нам нужно будет сделать, это убедиться, что цена стоп-лосс или тейк-профит действительна.</p><h2><span id="Rasscet_v_punktah">Рассчет в пунктах</span></h2><p>Для этого, наиболее распространенного метода расчета стопов, мы будем использовать внешнюю переменную, в которой пользователь указывает количество пунктов для стоп-лосса и тейк-профита. Затем мы рассчитываем стопы относительно цены открытия ордера.</p><p>Для ордеров на покупку, цена открытия будет Ask, а для ордеров на продажу, цена открытия будет Bid. Для отложенных стоп-ордеров и лимитных ордеров мы назначаем действительную цену открытия, которая будет отличается от текущей рыночной цены. Мы назначим соответствующую цену переменной OpenPrice.</p><p>Вот внешние переменные, которые мы будем использовать для наших настроек стоп-лосса и тейк-профита:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw2">extern</span> <span class="kw4">int</span> StopLoss <span class="sy0">=</span> <span class="nu0">50</span><span class="sy0">;</span><span class="kw2">extern</span> <span class="kw4">int</span> TakeProfit <span class="sy0">=</span> <span class="nu0">100</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>В этом примере мы установили стоп-лосс в 50 пунктов и тейк-профит в 100 пунктов. Вы, вероятно, видели настройки, подобные этим, в советниках, которые уже использовали.</p><p>Чтобы рассчитать наш стоп-лосс, нам нужно добавить или вычесть 50 пунктов из цены открытия нашего ордера. Во-первых, нам нужно преобразовать целочисленное значение 50 в дробное значение, которое мы будем использовать для добавления или вычитания из цены открытия. Для пар с йеной 50 пунктов равны 0,50. Для всех остальных пар это будет 0,0050.</p><p>Чтобы преобразовать целое число в соответствующее дробное значение, нам нужно умножить нашу внешнюю переменную StopLoss на Point.</p><h2><span id="Point">Point</span></h2><p>Point — это предопределенная переменная в MQL, которая возвращает наименьшую цену валюты в зависимости от количества десятичных знаков. Для валютной пары с 4 десятичными знаками Point равен 0,0001. Для пар с йеной это значение равно 0,01.</p><p>Давайте рассчитаем стоп-лосс для ордера на покупку. Мы назначим текущую цену Ask для OpenPrice и используем ее в качестве цены открытия ордера. Далее проверим, что StopLoss больше нуля. Если это так, мы умножим стоп-лосс на Point. Затем мы вычтем полученное значение из OpenPrice. Результат будет сохранен в переменной BuyStopLoss.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">double</span> OpenPrice <span class="sy0">=</span> Ask<span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>StopLoss <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> BuyStopLoss <span class="sy0">=</span> OpenPrice – <span class="br0">(</span>StopLoss <span class="sy0">*</span> Point<span class="br0">)</span><span class="sy0">;</span> <span class="co1">// 1.4600 - (50 * 0.0001) = 1.4550</span></pre></div></div></div></div></div></div></div><p>Если StopLoss не больше нуля, то BuyStopLoss инициализируется со значением 0, и стоп-лосс не будет размещен вместе с ордером. Предполагая, что Point равен 0,0001, если цена открытия ордера равна 1,4600, а наш стоп-лосс равен 50 пунктам, тогда цена стоп-лосса для ордера на покупку составит 1,4600 — (0,0050) = 1,4550.</p><p>Если наш брокер использует пятизначные котировки, то в нашем примере выше Point будет равен 0,00001.</p><p>Если мы используем значение пункта 0,00001 в нашем примере расчета стоп-лосса, стоп-лосс будет рассчитываться как 5 пунктов от цены открытия, а не 50 пипсов. Чтобы получить правильное значение, мы должны добавить дополнительный ноль к нашей настройке стоп-лосса, то есть StopLoss = 500.</p><p>Вместо того чтобы требовать от пользователя добавлять дополнительный ноль к своим стоп-лоссам и настройкам тейк-профита, мы создадим функцию, которая всегда будет возвращать 0,01 или 0,0001 независимо от того, использует ли брокер пятизначные котировки. Мы назовем эту функцию PipPoint, потому что она всегда будет возвращать значение Point, равное одному пункту.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">double</span> PipPoint<span class="br0">(</span>string Currency<span class="br0">)</span> <span class="br0">{</span><span class="kw4">int</span> CalcDigits <span class="sy0">=</span> MarketInfo<span class="br0">(</span>Currency<span class="sy0">,</span>MODE_DIGITS<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>CalcDigits <span class="sy0">==</span> <span class="nu0">2</span> <span class="sy0">||</span> CalcDigits <span class="sy0">==</span> <span class="nu0">3</span><span class="br0">)</span> <span class="kw4">double</span> CalcPoint <span class="sy0">=</span> <span class="nu16">0.01</span><span class="sy0">;</span><span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>CalcDigits <span class="sy0">==</span> <span class="nu0">4</span> <span class="sy0">||</span> CalcDigits <span class="sy0">==</span> <span class="nu0">5</span><span class="br0">)</span> CalcPoint <span class="sy0">=</span> <span class="nu16">0.0001</span><span class="sy0">;</span><span class="kw1">return</span><span class="br0">(</span>CalcPoint<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Строковый аргумент Currency является символом валютной пары, для которой мы хотим получить Point. Функция MarketInfo() с параметром MODE_DIGITS возвращает количество десятичных разрядов для данной пары. Оператор if-else назначает соответствующее значение точки переменной CalcPoint в зависимости от количества цифр.</p><p>Вот пример использования этой функции. Мы будем использовать текущую пару графиков большую часть времени, поэтому мы передадим функцию Symbol() в качестве аргумента. Это вернет значение Point для текущего графика.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">double</span> UsePoint <span class="sy0">=</span> PipPoint<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Вот несколько примеров:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">double</span> UsePoint <span class="sy0">=</span> PipPoint <span class="br0">(</span>EURUSD<span class="br0">)</span><span class="sy0">;</span> <span class="co1">// Результат 0.0001</span><span class="kw4">double</span> UsePoint <span class="sy0">=</span> PipPoint <span class="br0">(</span>USDJPY<span class="br0">)</span><span class="sy0">;</span> <span class="co1">// Результат 0,01</span></pre></div></div></div></div></div></div></div><p>Мы будем использовать эту функцию, чтобы найти значение единственного пункта в оставшейся части этой книги. Как мы показали, переменная Point не будет работать корректно на брокерах с пятизначными котировками при расчете стоимости одного пункта. Вы никогда не можете предполагать, что советник будет использоваться только на 2-х и 4-х значном брокере, поэтому необходимо автоматически определять значение пункта для одного пункта с помощью функции PipPoint().</p><h2><span id="Proskalzyvanie_i_Point">Проскальзывание и Point</span></h2><p>Давайте создадим функцию для определения размера проскальзывания. Как упоминалось ранее, для брокера с пятизначными котировками параметр проскальзывания для функции OrderSend() необходимо увеличить в 10 раз, чтобы получить правильное значение.</p><p>Следующая функция автоматически установит параметр проскальзывания на количество пунктов, указанное внешним параметром Slippage:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">int</span> GetSlippage<span class="br0">(</span>string Currency<span class="sy0">,</span> <span class="kw4">int</span> SlippagePips<span class="br0">)</span> <span class="br0">{</span><span class="kw4">int</span> CalcDigits <span class="sy0">=</span> MarketInfo<span class="br0">(</span>Currency<span class="sy0">,</span>MODE_DIGITS<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>CalcDigits <span class="sy0">==</span> <span class="nu0">2</span> <span class="sy0">||</span> CalcDigits <span class="sy0">==</span> <span class="nu0">4</span><span class="br0">)</span> <span class="kw4">double</span> CalcSlippage <span class="sy0">=</span> SlippagePips<span class="sy0">;</span> <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>CalcDigits <span class="sy0">==</span> <span class="nu0">3</span> <span class="sy0">||</span> CalcDigits <span class="sy0">==</span> <span class="nu0">5</span><span class="br0">)</span> CalcSlippage <span class="sy0">=</span> SlippagePips <span class="sy0">*</span> <span class="nu0">10</span><span class="sy0">;</span> <span class="kw1">return</span><span class="br0">(</span>CalcSlippage<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Мы передаем символ валюты и параметр внешнего проскальзывания в качестве аргументов. Если валюта использует 2 или 4 цифры, мы используем аргумент SlippagePips в качестве параметра проскальзывания. Если валюта использует 3 или 5 цифр, мы умножаем SlippagePips на 10. Вот как мы используем эту функцию в OrderSend():</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="co1">// Внешние параметры</span><span class="kw2">extern</span> <span class="kw4">int</span> Slippage <span class="sy0">=</span> <span class="nu0">5</span><span class="sy0">;</span>&nbsp;<span class="co1">// Размещение оредра</span>OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_BUY<span class="sy0">,</span>LotSize<span class="sy0">,</span>Ask<span class="sy0">,</span>GetSlippage<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>Slippage<span class="br0">)</span><span class="sy0">,</span>BuyStopLoss<span class="sy0">,</span>BuyTakeProfit<span class="sy0">,</span><span class="st0">&quot;Ордер на покупку&quot;</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Green<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>В этом примере проскальзывание будет составлять 5 пунктов, а параметр проскальзывания будет автоматически корректироваться в зависимости от количества цифр в котировке валюты.</p><h2><span id="Proskalzyvanie_i_Point_kak_globalnye_peremennye">Проскальзывание и Point как глобальные переменные</span></h2><p>Недостатком использования функции для возврата значения Point или проскальзывания является дополнительная типизация, необходимая для аргументов функции. Поэтому мы создадим глобальные переменные, в которых будут храниться соответствующие значения Point и проскальзывания для нашей валютной пары, и будем использовать их в любое время, когда нам понадобятся эти значения.</p><p>Поскольку эти значения никогда не изменяются во время выполнения программы, мы вычислим эти значения в функции init(). Предположим, что внешняя переменная Slippage уже присутствует:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="co1">// Глобальные переменные</span><span class="kw4">double</span> UsePoint<span class="sy0">;</span><span class="kw4">int</span> UseSlippage<span class="sy0">;</span>&nbsp;<span class="kw4">int</span> init<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>UsePoint <span class="sy0">=</span> PipPoint<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>UseSlippage <span class="sy0">=</span> GetSlippage<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>Slippage<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Отныне мы будем использовать UsePoint и UseSlippage для ссылки на эти значения. Код выше предполагает, что ваш советник выставляет ордера только на один торговый инструмент.</p><div class='code-block code-block-center code-block-4 ai-viewport-3'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader2" rel="nofollow" target="_blank"><img src="/b/pamm_landing_banner_300x250_ru_.gif"/></a></div><div class='code-block code-block-center code-block-8 ai-viewport-1'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader2" rel="nofollow" target="_blank"><img src="https://advertising-blog.qqit.ru/rublogtrader.rar.su/pamm_landing_banner_970x250_ru_1.gif"/></a></div><h2><span id="MarketInfo">MarketInfo()</span></h2><p>Мы использовали функцию MarketInfo(), чтобы получить значение Point и количество цифр в котировке валюты. Функция MarketInfo() имеет множество применений, и вы будете использовать ее для получения необходимой информации о ценах. Вот синтаксис для функции MarketInfo():</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">double</span> MarketInfo<span class="br0">(</span>string Symbol<span class="sy0">,</span> <span class="kw4">int</span> RequestType<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Аргумент Symbol — это просто символ валюты, для которого вы хотите получить информацию. Для текущего символа графика можно использовать функцию Symbol(). Для других символов вам нужно указать символ валюты, например, EURJPY.</p><p>RequestType — это целочисленная константа, представляющая информацию, которую вы запрашиваете у функции. Вот список наиболее полезных констант MarketInfo(). Полный список можно найти в справочнике по MQL.</p><ul><li>MODE_POINT — значение Point. Например, 0,01 или 0,00001.</li><li>MODE_DIGITS — количество десятичных знаков в цене. Будет 2 или 3 для пар иен и 4 или 5 для всех остальных пар.</li><li>MODE_SPREAD — текущий спред. Например, 3 пункта (или 30 для брокера с дробным числом пунктов).</li><li>MODE_STOPLEVEL — уровень стоп-лосса. Например, 3 пункта (или 30 для брокера с дробным числом пунктов).</li></ul><p>Эти идентификаторы обычно используются при проверке информации о ценах в другой валюте или в любом месте, где символ может отличаться от текущего символа графика:</p><ul><li>MODE_BID — текущая цена Bid.</li><li>MODE_ASK — текущая цена Ask.</li><li>MODE_LOW — минимум текущего бара выбранного символа.</li><li>MODE_HIGH — максимум текущего бара выбранного символа.</li></ul><h2><span id="Rascet_stop-lossa">Расчет стоп-лосса</span></h2><p>Теперь, когда мы определили правильное значение пункта, пришло время вычислить наш стоп-лосс. Для ордеров на покупку стоп-лосс будет ниже цены открытия ордера, а для ордеров на продажу стоп-лосс будет выше цены открытия ордера.</p><p>Вот наш предыдущий расчет стоп-лосса ордера на покупку с добавленной переменной UsePoint. Обратите внимание, что мы присвоили цену Ask переменной OpenPrice:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">double</span> OpenPrice <span class="sy0">=</span> Ask<span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>StopLoss <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> BuyStopLoss <span class="sy0">=</span> OpenPrice – <span class="br0">(</span>StopLoss <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>А вот расчет для ордера на продажу. Обратите внимание, что мы назначили цену Bid для OpenPrice, и мы просто добавляем вместо вычитания:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">double</span> OpenPrice <span class="sy0">=</span> Bid<span class="sy0">;</span><span class="kw1">if</span> <span class="br0">(</span>StopLoss<span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> SellStopLoss <span class="sy0">=</span> OpenPrice <span class="sy0">+</span> <span class="br0">(</span>StopLoss <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Для отложенных ордеров стоп-лосс будет рассчитываться относительно цены отложенного ордера. В этом случае используйте переменную OpenPrice для хранения цены отложенного ордера вместо текущей рыночной цены. Логика будет идентична приведенным выше примерам.</p><h2><span id="Rascet_tejk-profita">Расчет тейк-профита</span></h2><p>Расчет цены тейк-профита аналогичен расчету стоп-лосса, за исключением того, что мы меняем местами сложение и вычитание. Для ордера на покупку цена тейк-профита будет выше цены открытия ордера, а для ордера на продажу цена тейк-профита будет ниже цены открытия ордера. Предположим, что соответствующая цена была назначена OpenPrice:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">if</span><span class="br0">(</span>TakeProfit <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> BuyTakeProfit <span class="sy0">=</span> OpenPrice <span class="sy0">+</span> <span class="br0">(</span>TakeProfit <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span> <span class="kw1">if</span><span class="br0">(</span>TakeProfit <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> SellTakeProfit <span class="sy0">=</span> OpenPrice <span class="sy0">-</span> <span class="br0">(</span>TakeProfit <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><h2><span id="Alternativnyj_metod_rasceta_stop-lossa">Альтернативный метод расчета стоп-лосса</span></h2><p>Есть и другие способы определения стоп-лосса и тейк-профита. Например, недавний максимум или минимум, или значение индикатора можно использовать для определения стоп-лосса.</p><p>Допустим, мы используем торговую систему, которая размещает стоп-лосс на 2 пункта ниже минимума текущего бара. Мы используем предопределенный ценовой массив Low[], чтобы получить минимум бара. Low[0] — это минимум текущего бара, Low[1] — это минимум предыдущего бара и так далее.</p><p>Как только мы определили минимум текущего бара, мы умножим 2 на UsePoint, чтобы получить десятичное значение, и вычтем это из нашего минимума:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">double</span> BuyStopLoss <span class="sy0">=</span> Low<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">-</span> <span class="br0">(</span><span class="nu0">2</span> <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Таким образом, если минимум бара составляет 1,4760, стоп-лосс будет размещен на 1,4758.</p><p>Возможно, вы хотите разместить свой стоп-лосс на самом низком минимуме за последнее число баров. Для этого есть встроенная в MetaTrader функция. iLowest() возвращает значение, указывающее бар с самым низким значением в указанном временном диапазоне.</p><p>Вот пример того, как мы будем использовать iLowest ), чтобы найти самый низкий минимум из последних 10 баров:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">int</span> CountBars <span class="sy0">=</span> <span class="nu0">10</span><span class="sy0">;</span><span class="kw4">int</span> LowestShift <span class="sy0">=</span> iLowest<span class="br0">(</span>NULL<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>MODE_LOW<span class="sy0">,</span>CountBars<span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span><span class="kw4">double</span> BuyStopLoss <span class="sy0">=</span> Low<span class="br0">[</span>LowestShift<span class="br0">]</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Первым параметром iLowest() является символ валюты — NULL означает, что мы используем текущий символ. Многие функции в MQL используют строковую константу NULL для ссылки на текущий символ. Вторым параметром является период графика — 0 относится к текущему графика.</p><p>MODE_LOW — это целочисленная константа, которая задает массив низких цен. Другими словами, мы ищем самый низкий минимум из последних CountBars. Например, если бы мы хотели найти самое низкое закрытие, мы бы использовали MODE_CLOSE.</p><p>CountBars — это количество баров, которые мы хотим найти, в данном случае 10. Наконец, последний параметр — это наше начальное местоположение. 0 — текущий бар Чтобы начать с предыдущего бара, посчитайте назад от текущего бара — предыдущий бар равен 1, до этого — 2 и т. д.</p><p>Выходные данные функции iLowest() представляют собой целое число, указывающее обратное смещение бара с самым низким значением в ценовом ряду. В приведенном выше примере, если iLowest() возвращает 6, это означает, что самый низкий минимум равен 6 барам назад. Мы храним это значение в переменной LowestShift. Чтобы найти фактическую цену, мы просто получаем значение цены Low [LowestShift] или, другими словами, Low [6].</p><p>Если вы хотите рассчитать стоп-лосс для ордера на продажу, используя этот метод, функция iHighest() работает так же. Ссылаясь на пример выше, мы бы использовали MODE_HIGH для параметра массива рядов.</p><p>Вот пример использования индикатора. Допустим, у нас есть скользящее среднее, и мы хотим использовать линию скользящего среднего в качестве нашего стоп-лосса. Мы будем использовать переменную MA для представления значения скользящей средней для текущего бара. Все, что вам нужно сделать, это присвоить текущее значение скользящей средней стоп-лоссу:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">double</span> BuyStopLoss <span class="sy0">=</span> MA<span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Если линия скользящего среднего в настоящее время находится на уровне 1.6894, то это и будет наш стоп-лосс.</p><h2><span id="Polucenie_informacii_ob_ordere">Получение информации об ордере</span></h2><p>После того, как мы успешно разместили ордер, нам нужно получить некоторую информацию об ордере, если мы хотим изменить или закрыть его. Мы делаем это с помощью функции OrderSelect(). Чтобы использовать OrderSelect(), мы можем либо использовать номер ордера, либо пройтись по всем открытым ордерам и выбрать каждый из них по порядку.</p><p>После того, как мы выбрали ордер с помощью OrderSelect(), мы можем использовать различные функции ордера для возврата информации о ордере, включая текущий стоп-лосс, тейк-профит, цену открытия ордера, цену закрытия и многое другое.</p><h2><span id="OrderSelect">OrderSelect()</span></h2><p>Вот синтаксис для функции OrderSelect():</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">bool OrderSelect<span class="br0">(</span><span class="kw4">int</span> Index<span class="sy0">,</span> <span class="kw4">int</span> Select<span class="sy0">,</span> <span class="kw4">int</span> Pool <span class="sy0">=</span> MODE_TRADES<span class="br0">)</span></pre></div></div></div></div></div></div></div><ul><li><strong>Index</strong> — это либо номер заявки по ордеру, который мы хотим выбрать, либо позиция среди ордеров. Параметр Select укажет, какой из них мы используем.</li><li><strong>Select</strong> — константа, указывающая, является ли параметр Index номером заявки или позицией среди ордеров:<br> — ECT SELECT_BY_TICKET — значение параметра Index является номером ордера.<br> — SELECT_BY_POS — значение параметра Index является позицией среди ордеров.</li><li><strong>Pool</strong> — необязательная константа, обозначающая пул ордеров: отложенные/открытые ордера или закрытые ордера.<br> — MODE_TRADES — по умолчанию мы перебираем пул открытых в данный момент ордеров.<br> — MODE_HISTORY — перебираем пул закрытых заказов (историю).</li></ul><p>Если функция OrderSelect() успешно находит ордер, возвращаемое значение будет истинным, в противном случае возвращаемое значение будет ложным.</p><p>Вот пример функции OrderSelect(), использующей номер ордера. Переменная Ticket должна содержать действительный тикет ордера:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">OrderSelect<span class="br0">(</span>Ticket<span class="sy0">,</span>SELECT_BY_TICKET<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>После вызова функции OrderSelect() мы можем использовать любую из функций информации об ордере. Полный список функций, которые можно использовать с OrderSelect (), можно найти в Справочнике по MQL в разделе Торговые функции. Вот список наиболее часто используемых функций:</p><ul><li>OrderSymbol() — символ инструмента, на котором был размещен выбранный ордер.</li><li>OrderType() — тип ордера выбранного ордера: покупка или продажа; рынок, стоп или лимит.</li><li>OrderOpenPrice() — цена открытия выбранного ордера.</li><li>OrderLots() — размер лота выбранного ордера.</li><li>OrderStopLoss() — цена стоп-лосса выбранного ордера.</li><li>OrderTakeProfit() — цена тейк-профита выбранного ордера.</li><li>OrderTicket() — номер выбранного ордера. Обычно используется при циклическом переборе ордеров с параметром SELECT_BY_POS.</li><li>OrderMagicNumber() — магический номер выбранного ордера. При циклическом переборе ордеров нам нужно использовать этот параметр для определения ордеров, выставленных нашим советником.</li><li>OrderComment() — комментарий, который был размещен вместе с ордером. Может быть использовано как вторичный идентификатор ордера.</li><li>OrderClosePrice() — цена закрытия выбранного ордера. Ордер должен быть уже закрыт (то есть представлен в пуле истории ордеров).</li><li>OrderOpenTime() — время открытия выбранного ордера.</li><li>OrderCloseTime() — время закрытия выбранного ордера.</li><li>OrderProfit() — возвращает прибыль (в валюте депозита) для выбранного ордера.</li></ul><p>Нам нужно будет использовать OrderSelect() перед закрытием или изменением ордера.</p><h2><span id="Zakrytie_orderov">Закрытие ордеров</span></h2><p>Когда мы закрываем рыночный ордер, мы выходим из сделки по текущей рыночной цене. Для ордеров на покупку мы закрываем по цене Bid, а для ордеров на продажу мы закрываем по Ask. Для отложенных ордеров мы просто удаляем ордер.</p><h2><span id="OrderClose">OrderClose()</span></h2><p>Мы закрываем рыночные ордера с помощью функции OrderClose().</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">bool OrderClose<span class="br0">(</span><span class="kw4">int</span> Ticket<span class="sy0">,</span> <span class="kw4">double</span> Lots<span class="sy0">,</span> <span class="kw4">double</span> Price<span class="sy0">,</span> <span class="kw4">int</span> Slippage<span class="sy0">,</span> color Arrow<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><ul><li><strong>Ticket</strong> — номер тикета рыночного ордера на закрытие.</li><li><strong>Lots</strong> — количество лотов для закрытия. Большинство брокеров допускают частичное закрытие.</li><li><strong>Price</strong> — предпочтительная цена для закрытия сделки. Для ордеров на покупку это будет текущая цена Bid, а для ордеров на продажу текущая цена Ask.</li><li><strong>Slippage</strong> — допустимое проскальзывание от цены закрытия в пунктах.</li><li><strong>color</strong> — цветовая константа для закрывающей стрелки. Если цвет не указан, стрелка не будет нарисована.</li></ul><p>Вы можете закрыть часть сделки, указав частичный размер лота. Например, если у вас есть открытая сделка с размером лота 2,00 и вы хотите закрыть половину сделки, укажите 1 лот для аргумента Lots. Обратите внимание, что не все брокеры поддерживают частичное закрытие.</p><p>Следующий пример закрывает ордер на покупку на рынке:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">OrderSelect<span class="br0">(</span>CloseTicket<span class="sy0">,</span>SELECT_BY_TICKET<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>OrderCloseTime<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_BUY<span class="br0">)</span> <span class="br0">{</span><span class="kw4">double</span> CloseLots <span class="sy0">=</span> OrderLots<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="kw4">double</span> ClosePrice <span class="sy0">=</span> Bid<span class="sy0">;</span>bool Closed <span class="sy0">=</span> OrderClose<span class="br0">(</span>CloseTicket<span class="sy0">,</span>CloseLots<span class="sy0">,</span>ClosePrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Переменная CloseTicket — это номер ордера, который мы хотим закрыть. Функция OrderSelect() выбирает ордер и позволяет нам получить о нем информацию. Мы используем OrderCloseTime(), чтобы проверить время закрытия ордера, и чтобы увидеть, был ли ордер уже закрыт. Если OrderCloseTime() возвращает 0, то мы знаем, что ордер еще не закрыт.</p><p>Нам также необходимо проверить тип ордера, так как тип ордера определяет его цену закрытия. Функция OrderType() возвращает целое число, указывающее на тип ордера. Если это рыночный ордер на покупку, обозначенный OP_BUY, мы продолжим закрывать ордер.</p><p>Затем мы получаем размер лота ордера с помощью OrderLots() и сохраняем это значение в CloseLots. Мы назначаем текущую цену Bid для ClosePrice. Затем мы вызываем функцию OrderClose(), чтобы закрыть наш ордер.</p><p>Мы задаем наш параметр Slippage с помощью UseSlippage и указываем красную стрелку. Возвращаемое логическое значение сохраняется в переменной Closed. Если ордер был успешно закрыт, значение Closed будет true, в противном случае — false.</p><p>Чтобы закрыть ордер на продажу, все, что вам нужно сделать, это изменить тип ордера на OP_SELL и назначить текущую цену Ask для ClosePrice:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">if</span> <span class="br0">(</span>OrderCloseTime <span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> OrderType <span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_SELL<span class="br0">)</span> <span class="br0">{</span><span class="kw4">double</span> CloseLots <span class="sy0">=</span> OrderLots <span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="kw4">double</span> ClosePrice <span class="sy0">=</span> Ask<span class="sy0">;</span>bool Closed <span class="sy0">=</span> OrderClose <span class="br0">(</span>CloseTicket<span class="sy0">,</span> CloseLots<span class="sy0">,</span> ClosePrice<span class="sy0">,</span> UseSlippage<span class="sy0">,</span> Red<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><h2><span id="OrderDelete">OrderDelete()</span></h2><p>Существует отдельная функция для закрытия отложенных ордеров — OrderDelete(). У этой функции есть два аргумента: номер ордера и цвет стрелки.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">OrderSelect<span class="br0">(</span>CloseTicket<span class="sy0">,</span>SELECT_BY_TICKET<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>OrderCloseTime<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_BUYSTOP<span class="br0">)</span> <span class="br0">{</span>    bool Deleted <span class="sy0">=</span> OrderDelete<span class="br0">(</span>CloseTicket<span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Нам нужно проверить тип ордера, чтобы убедиться, что это отложенный ордер. Константы типа отложенного ордера: OP_BUYSTOP, OP_SELLSTOP, OP_BUYLIMIT и OP_SELLLIMIT. Чтобы закрыть другие типы отложенных ордеров, просто измените тип ордера.</p><h2><span id="Primer_koda_prostogo_sovetnika">Пример кода простого советника</span></h2><p>Давайте посмотрим, как код, который мы обсудили, будет работать в советнике. Наш советник будет основан на пересечении скользящих средних. Ордер на покупку открывается, когда скользящая средняя за 10 периодов будет больше скользящей средней за 20 периодов. Когда скользящая средняя за 10 периодов меньше скользящей средней за 20 периодов, открывается ордер на продажу.</p><p>Советник будет чередовать открытие ордеров на покупку и продажу. Ордера будут закрыты, когда ордер будет открыт в обратном направлении, либо по стоп-лоссу или тейк-профиту. Мы будем использовать глобальные переменные BuyTicket и SellTicket для хранения последнего ордера. При открытии нового ордера тикет последнего заказа очищается. Это предотвращает открытие нескольких последовательных ордеров.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="co2">#property copyright &quot;Александр Паркер&quot;</span><span class="co1">// Внешние переменные </span><span class="kw2">extern</span> <span class="kw4">double</span> LotSize <span class="sy0">=</span> <span class="nu16">0.1</span><span class="sy0">;</span><span class="kw2">extern</span> <span class="kw4">double</span> StopLoss <span class="sy0">=</span> <span class="nu0">50</span><span class="sy0">;</span><span class="kw2">extern</span> <span class="kw4">double</span> TakeProfit <span class="sy0">=</span> <span class="nu0">100</span><span class="sy0">;</span>&nbsp;<span class="kw2">extern</span> <span class="kw4">int</span> Slippage <span class="sy0">=</span> <span class="nu0">5</span><span class="sy0">;</span> <span class="kw2">extern</span> <span class="kw4">int</span> MagicNumber <span class="sy0">=</span> <span class="nu0">123</span><span class="sy0">;</span>&nbsp;<span class="kw2">extern</span> <span class="kw4">int</span> FastMAPeriod <span class="sy0">=</span> <span class="nu0">10</span><span class="sy0">;</span><span class="kw2">extern</span> <span class="kw4">int</span> SlowMAPeriod <span class="sy0">=</span> <span class="nu0">20</span><span class="sy0">;</span>&nbsp;<span class="co1">// Глобальные переменные</span><span class="kw4">int</span> BuyTicket<span class="sy0">;</span><span class="kw4">int</span> SellTicket<span class="sy0">;</span><span class="kw4">double</span> UsePoint<span class="sy0">;</span><span class="kw4">int</span> UseSlippage<span class="sy0">;</span>&nbsp;<span class="co1">// Функция init</span><span class="kw4">int</span> init<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>UsePoint <span class="sy0">=</span> PipPoint<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>UseSlippage <span class="sy0">=</span> GetSlippage<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>Slippage<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span>&nbsp;<span class="co1">// Функция start</span><span class="kw4">int</span> start<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>&nbsp;<span class="co1">// Скользящая средняя</span><span class="kw4">double</span> FastMA <span class="sy0">=</span> iMA<span class="br0">(</span>NULL<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>FastMAPeriod<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span> <span class="kw4">double</span> SlowMA <span class="sy0">=</span> iMA<span class="br0">(</span>NULL<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>SlowMAPeriod<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Ордер на покупку</span><span class="kw1">if</span><span class="br0">(</span>FastMA <span class="sy0">&gt;</span> SlowMA <span class="sy0">&amp;&amp;</span> BuyTicket <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>OrderSelect<span class="br0">(</span>SellTicket<span class="sy0">,</span>SELECT_BY_TICKET<span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Закрытие ордера</span><span class="kw1">if</span><span class="br0">(</span>OrderCloseTime<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> SellTicket <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span><span class="kw4">double</span> CloseLots <span class="sy0">=</span> OrderLots<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="kw4">double</span> ClosePrice <span class="sy0">=</span> Ask<span class="sy0">;</span>bool Closed <span class="sy0">=</span> OrderClose<span class="br0">(</span>SellTicket<span class="sy0">,</span>CloseLots<span class="sy0">,</span>ClosePrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>&nbsp;<span class="kw4">double</span> OpenPrice <span class="sy0">=</span> Ask<span class="sy0">;</span>&nbsp;<span class="co1">// Рассчет стоп-лосса и тейк-профита</span>&nbsp;<span class="kw1">if</span><span class="br0">(</span>StopLoss <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> BuyStopLoss <span class="sy0">=</span> OpenPrice <span class="sy0">-</span> <span class="br0">(</span>StopLoss <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>TakeProfit <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> BuyTakeProfit <span class="sy0">=</span> OpenPrice <span class="sy0">+</span> <span class="br0">(</span>TakeProfit <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Открытие ордера на покупку</span>BuyTicket <span class="sy0">=</span> OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_BUY<span class="sy0">,</span>LotSize<span class="sy0">,</span>OpenPrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span>BuyStopLoss<span class="sy0">,</span>BuyTakeProfit<span class="sy0">,</span><span class="st0">&quot;Ордер на покупку&quot;</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Green<span class="br0">)</span><span class="sy0">;</span>SellTicket <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="br0">}</span>&nbsp;<span class="co1">// Ордер на продажу</span><span class="kw1">if</span><span class="br0">(</span>FastMA <span class="sy0">&lt;</span> SlowMA <span class="sy0">&amp;&amp;</span> SellTicket <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>OrderSelect<span class="br0">(</span>BuyTicket<span class="sy0">,</span>SELECT_BY_TICKET<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>OrderCloseTime<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> BuyTicket <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>CloseLots <span class="sy0">=</span> OrderLots<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> ClosePrice <span class="sy0">=</span> Bid<span class="sy0">;</span>Closed <span class="sy0">=</span> OrderClose<span class="br0">(</span>BuyTicket<span class="sy0">,</span>CloseLots<span class="sy0">,</span>ClosePrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>OpenPrice <span class="sy0">=</span> Bid<span class="sy0">;</span>&nbsp;<span class="kw1">if</span><span class="br0">(</span>StopLoss <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> SellStopLoss <span class="sy0">=</span> OpenPrice <span class="sy0">+</span> <span class="br0">(</span>StopLoss <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span> <span class="kw1">if</span><span class="br0">(</span>TakeProfit <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> SellTakeProfit <span class="sy0">=</span> OpenPrice <span class="sy0">-</span> <span class="br0">(</span>TakeProfit <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span>SellTicket <span class="sy0">=</span> OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_SELL<span class="sy0">,</span>LotSize<span class="sy0">,</span>OpenPrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span> SellStopLoss<span class="sy0">,</span>SellTakeProfit<span class="sy0">,</span><span class="st0">&quot;Ордер на продажу&quot;</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span>BuyTicket <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="br0">}</span><span class="kw1">return</span><span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>&nbsp; <span class="co1">// Функция Pip Point</span>    <span class="kw4">double</span> PipPoint<span class="br0">(</span>string Currency<span class="br0">)</span> <span class="br0">{</span><span class="kw4">int</span> CalcDigits <span class="sy0">=</span> MarketInfo<span class="br0">(</span>Currency<span class="sy0">,</span>MODE_DIGITS<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>CalcDigits <span class="sy0">==</span> <span class="nu0">2</span> <span class="sy0">||</span> CalcDigits <span class="sy0">==</span> <span class="nu0">3</span><span class="br0">)</span> <span class="kw4">double</span> CalcPoint <span class="sy0">=</span> <span class="nu16">0.01</span><span class="sy0">;</span> <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>CalcDigits <span class="sy0">==</span> <span class="nu0">4</span> <span class="sy0">||</span> CalcDigits <span class="sy0">==</span> <span class="nu0">5</span><span class="br0">)</span> CalcPoint <span class="sy0">=</span> <span class="nu16">0.0001</span><span class="sy0">;</span> <span class="kw1">return</span><span class="br0">(</span>CalcPoint<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span>&nbsp;<span class="co1">// Проскальзывание</span><span class="kw4">int</span> GetSlippage<span class="br0">(</span>string Currency<span class="sy0">,</span> <span class="kw4">int</span> SlippagePips<span class="br0">)</span> <span class="br0">{</span><span class="kw4">int</span> CalcDigits <span class="sy0">=</span> MarketInfo<span class="br0">(</span>Currency<span class="sy0">,</span>MODE_DIGITS<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>CalcDigits <span class="sy0">==</span> <span class="nu0">2</span> <span class="sy0">||</span> CalcDigits <span class="sy0">==</span> <span class="nu0">4</span><span class="br0">)</span> <span class="kw4">double</span> CalcSlippage <span class="sy0">=</span> SlippagePips<span class="sy0">;</span> <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>CalcDigits <span class="sy0">==</span> <span class="nu0">3</span> <span class="sy0">||</span> CalcDigits <span class="sy0">==</span> <span class="nu0">5</span><span class="br0">)</span> CalcSlippage <span class="sy0">=</span> SlippagePips <span class="sy0">*</span> <span class="nu0">10</span><span class="sy0">;</span> <span class="kw1">return</span><span class="br0">(</span>CalcSlippage<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Мы объявляем BuyTicket и SellTicket как глобальные переменные — таким образом тикет ордера сохраняется между выполнениями программы. Мы могли бы также объявить их как статические переменные в функции start().</p><p>Мы добавим UsePoint и UseSlippage в качестве глобальных переменных и подсчитаем их значения. Наша функция init() запускается первой. Мы вызываем функции PipPoint() и GetSlippage() (объявленные внизу файла) и присваиваем возвращаемые значения нашим глобальным переменным. Мы будем использовать их при ссылках на значения Point или проскальзывания в остальной части нашего советника.</p><p>Далее идет функция start(). Функция iMA() вычисляет скользящее среднее. Переменная FastMA содержит 10-периодное скользящее среднее, которое устанавливается с помощью переменной FastMAPeriod. Переменная SlowMA — это скользящее среднее за 20 периодов, установленное с помощью SlowMAPeriod. Все остальное установлено по умолчанию.</p><p>Мы используем оператор if для определения условий открытия ордеров. Если текущая скользящая средняя за 10 периодов (FastMA) больше, чем скользящая средняя за 20 периодов (SlowMA), и если BuyTicket равен 0, мы открываем ордер на покупку.</p><p>Прежде чем открыть ордер на покупку, закроем текущий ордер на продажу, если он существует. Мы используем OrderSelect(), чтобы получить текущий SellTicket. Если время закрытия ордера равно 0 (указывает на то, что ордер еще не был закрыт), а SellTicket больше 0 (указывает на то, что SellTicket, вероятно, действителен), мы продолжим и закроем ордер на продажу.</p><h2><span id="Ispolzovanie_otlozennyh_orderov">Использование отложенных ордеров</span></h2><p>Давайте изменим наш советник, чтобы использовать отложенные ордера. Мы будем использовать стоп-ордера в этом примере. Когда быстрая скользящая средняя больше, чем медленная, мы разместим ордер на покупку на 10 пунктов выше текущего максимума. Когда верно обратное, мы разместим стоп-ордер на продажу на 10 пунктов ниже текущего минимума. Давайте объявим внешнюю переменную для настройки этого параметра, которая называется PendingPips.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw2">extern</span> <span class="kw4">int</span> PendingPips <span class="sy0">=</span> <span class="nu0">10</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Мы добавляем функцию OrderDelete() в наш блок ордеров на покупку и продажу, чтобы закрыть все незакрыте отложенные ордера. Нам нужно проверить тип ордера, указанного в SellTicket, чтобы убедиться, что мы используем правильную функцию для закрытия ордера.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">OrderSelect<span class="br0">(</span>SellTicket<span class="sy0">,</span>SELECT_BY_TICKET<span class="br0">)</span><span class="sy0">;</span><span class="co1">// Закрытие ордера</span><span class="kw1">if</span><span class="br0">(</span>OrderCloseTime<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> SellTicket <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_SELL<span class="br0">)</span> <span class="br0">{</span><span class="kw4">double</span> CloseLots <span class="sy0">=</span> OrderLots<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="kw4">double</span> ClosePrice <span class="sy0">=</span> Ask<span class="sy0">;</span>bool Closed <span class="sy0">=</span> OrderClose<span class="br0">(</span>SellTicket<span class="sy0">,</span>CloseLots<span class="sy0">,</span>ClosePrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>Closed <span class="sy0">==</span> <span class="kw2">true</span><span class="br0">)</span> SellTicket <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="br0">}</span>&nbsp;<span class="co1">// Удаление ордера</span><span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>OrderCloseTime<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> SellTicket <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_SELLSTOP<span class="br0">)</span> <span class="br0">{</span>        bool Deleted <span class="sy0">=</span> OrderDelete<span class="br0">(</span>SellTicket<span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span>        <span class="kw1">if</span><span class="br0">(</span>Deleted <span class="sy0">==</span> <span class="kw2">true</span><span class="br0">)</span> SellTicket <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Мы используем OrderType(), чтобы проверить, является ли выбранный ордер на продажу рыночным или стоп-ордером. Если это рыночный ордер, мы закрываем его с помощью OrderClose(). Если это отложенный ордер, мы закрываем его с помощью OrderDelete().</p><p>Вот наш расчет цены отложенного ордера. Мы просто конвертируем PendingPips в дробное значение с помощью UsePoint и добавляем его к текущей цене закрытия. Мы будем хранить это значение в переменной PendingPrice. Далее мы рассчитываем стоп-лосс и тейк-профит относительно цены нашего отложенного ордера. Наконец, мы выставляем наш отложенный ордер с помощью OrderSend(), сохраняя результат сделки в переменной BuyTicket:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">double</span> PendingPrice <span class="sy0">=</span> Close<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">+</span> <span class="br0">(</span>PendingPips <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>StopLoss <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> BuyStopLoss <span class="sy0">=</span> PendingPrice <span class="sy0">-</span> <span class="br0">(</span>StopLoss <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>TakeProfit <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> BuyTakeProfit <span class="sy0">=</span> PendingPrice <span class="sy0">+</span> <span class="br0">(</span>TakeProfit <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span>BuyTicket <span class="sy0">=</span> OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_BUYSTOP<span class="sy0">,</span>LotSize<span class="sy0">,</span>PendingPrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span> BuyStopLoss<span class="sy0">,</span>BuyTakeProfit<span class="sy0">,</span><span class="st0">&quot;Buy стоп ордер&quot;</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Green<span class="br0">)</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Код ниже показывает изменения для стоп-ордера на продажу:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1">OrderSelect<span class="br0">(</span>BuyTicket<span class="sy0">,</span>SELECT_BY_TICKET<span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Закрытие ордера</span><span class="kw1">if</span><span class="br0">(</span>OrderCloseTime<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> BuyTicket <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_BUY<span class="br0">)</span> <span class="br0">{</span>CloseLots <span class="sy0">=</span> OrderLots<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> ClosePrice <span class="sy0">=</span> Bid<span class="sy0">;</span>Closed <span class="sy0">=</span> OrderClose<span class="br0">(</span>BuyTicket<span class="sy0">,</span>CloseLots<span class="sy0">,</span>ClosePrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>Closed <span class="sy0">==</span> <span class="kw2">true</span><span class="br0">)</span> BuyTicket <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="br0">}</span>&nbsp;<span class="co1">// Удаление ордера</span><span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>OrderCloseTime<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> BuyTicket <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_BUYSTOP<span class="br0">)</span> <span class="br0">{</span>Closed <span class="sy0">=</span> OrderDelete<span class="br0">(</span>BuyTicket<span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span> <span class="kw1">if</span><span class="br0">(</span>Closed <span class="sy0">==</span> <span class="kw2">true</span><span class="br0">)</span> BuyTicket <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span><span class="br0">}</span>&nbsp;PendingPrice <span class="sy0">=</span> Close<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">-</span> <span class="br0">(</span>PendingPips <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span><span class="kw4">double</span> SellStopLoss <span class="sy0">=</span> PendingPrice <span class="sy0">+</span> <span class="br0">(</span>StopLoss <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span> <span class="kw4">double</span> SellTakeProfit <span class="sy0">=</span> PendingPrice <span class="sy0">-</span> <span class="br0">(</span>TakeProfit <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span>SellTicket <span class="sy0">=</span> OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_SELLSTOP<span class="sy0">,</span>LotSize<span class="sy0">,</span>PendingPrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span> SellStopLoss<span class="sy0">,</span>SellTakeProfit<span class="sy0">,</span><span class="st0">&quot;Ордер на продажу&quot;</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span>BuyTicket <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Полный код советника:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="co2">#property copyright &quot;Александр Паркер&quot;</span>&nbsp;<span class="co1">// Внешние переменные</span><span class="kw2">extern</span> <span class="kw4">double</span> LotSize <span class="sy0">=</span> <span class="nu16">0.1</span><span class="sy0">;</span><span class="kw2">extern</span> <span class="kw4">double</span> StopLoss <span class="sy0">=</span> <span class="nu0">50</span><span class="sy0">;</span><span class="kw2">extern</span> <span class="kw4">double</span> TakeProfit <span class="sy0">=</span> <span class="nu0">100</span><span class="sy0">;</span><span class="kw2">extern</span> <span class="kw4">int</span> PendingPips <span class="sy0">=</span> <span class="nu0">10</span><span class="sy0">;</span>&nbsp;<span class="kw2">extern</span> <span class="kw4">int</span> Slippage <span class="sy0">=</span> <span class="nu0">5</span><span class="sy0">;</span> <span class="kw2">extern</span> <span class="kw4">int</span> MagicNumber <span class="sy0">=</span> <span class="nu0">123</span><span class="sy0">;</span>&nbsp;<span class="kw2">extern</span> <span class="kw4">int</span> FastMAPeriod <span class="sy0">=</span> <span class="nu0">10</span><span class="sy0">;</span><span class="kw2">extern</span> <span class="kw4">int</span> SlowMAPeriod <span class="sy0">=</span> <span class="nu0">20</span><span class="sy0">;</span>&nbsp;<span class="co1">// Глобальные переменные</span><span class="kw4">int</span> BuyTicket<span class="sy0">;</span><span class="kw4">int</span> SellTicket<span class="sy0">;</span><span class="kw4">double</span> UsePoint<span class="sy0">;</span><span class="kw4">int</span> UseSlippage<span class="sy0">;</span>&nbsp;<span class="co1">// Init функция</span><span class="kw4">int</span> init<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>UsePoint <span class="sy0">=</span> PipPoint<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>UseSlippage <span class="sy0">=</span> GetSlippage<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>Slippage<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span>&nbsp;<span class="co1">// Start функция</span><span class="kw4">int</span> start<span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span><span class="co1">// Скользящие средние</span><span class="kw4">double</span> FastMA <span class="sy0">=</span> iMA<span class="br0">(</span>NULL<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>FastMAPeriod<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span> <span class="kw4">double</span> SlowMA <span class="sy0">=</span> iMA<span class="br0">(</span>NULL<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>SlowMAPeriod<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Ордер на покупку</span><span class="kw1">if</span><span class="br0">(</span>FastMA <span class="sy0">&gt;</span> SlowMA <span class="sy0">&amp;&amp;</span> BuyTicket <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>OrderSelect<span class="br0">(</span>SellTicket<span class="sy0">,</span>SELECT_BY_TICKET<span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Закрытие ордера</span><span class="kw1">if</span><span class="br0">(</span>OrderCloseTime<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> SellTicket <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_SELL<span class="br0">)</span> <span class="br0">{</span><span class="kw4">double</span> CloseLots <span class="sy0">=</span> OrderLots<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="kw4">double</span> ClosePrice <span class="sy0">=</span> Ask<span class="sy0">;</span>bool Closed <span class="sy0">=</span> OrderClose<span class="br0">(</span>SellTicket<span class="sy0">,</span>CloseLots<span class="sy0">,</span>ClosePrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>&nbsp;<span class="co1">// Удаление ордера</span><span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>OrderCloseTime<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> SellTicket <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_SELLSTOP<span class="br0">)</span> <span class="br0">{</span>bool Deleted <span class="sy0">=</span> OrderDelete<span class="br0">(</span>SellTicket<span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span>&nbsp;<span class="kw4">double</span> PendingPrice <span class="sy0">=</span> High<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">+</span> <span class="br0">(</span>PendingPips <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Расчет стоп-лосса и тейк-профита</span><span class="kw1">if</span><span class="br0">(</span>StopLoss <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> BuyStopLoss <span class="sy0">=</span> PendingPrice <span class="sy0">-</span> <span class="br0">(</span>StopLoss <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span> <span class="kw1">if</span><span class="br0">(</span>TakeProfit <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> BuyTakeProfit <span class="sy0">=</span> PendingPrice <span class="sy0">+</span> <span class="br0">(</span>TakeProfit <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Ордер на покупку</span>BuyTicket <span class="sy0">=</span> OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_BUYSTOP<span class="sy0">,</span>LotSize<span class="sy0">,</span>PendingPrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span>BuyStopLoss<span class="sy0">,</span>BuyTakeProfit<span class="sy0">,</span><span class="st0">&quot;Buy Stop ордер&quot;</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Green<span class="br0">)</span><span class="sy0">;</span>SellTicket <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="br0">}</span>&nbsp;<span class="co1">// Ордер на продажу</span><span class="kw1">if</span><span class="br0">(</span>FastMA <span class="sy0">&lt;</span> SlowMA <span class="sy0">&amp;&amp;</span> SellTicket <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>OrderSelect<span class="br0">(</span>BuyTicket<span class="sy0">,</span>SELECT_BY_TICKET<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>OrderCloseTime<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> BuyTicket <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_BUY<span class="br0">)</span> <span class="br0">{</span>CloseLots <span class="sy0">=</span> OrderLots<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> ClosePrice <span class="sy0">=</span> Bid<span class="sy0">;</span>Closed <span class="sy0">=</span> OrderClose<span class="br0">(</span>BuyTicket<span class="sy0">,</span>CloseLots<span class="sy0">,</span>ClosePrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span><span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>OrderCloseTime<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> SellTicket <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_BUYSTOP<span class="br0">)</span> <span class="br0">{</span>Deleted <span class="sy0">=</span> OrderDelete<span class="br0">(</span>SellTicket<span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>PendingPrice <span class="sy0">=</span> Low<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> <span class="sy0">-</span> <span class="br0">(</span>PendingPips <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>StopLoss <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> SellStopLoss <span class="sy0">=</span> PendingPrice <span class="sy0">+</span> <span class="br0">(</span>StopLoss <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span> <span class="kw1">if</span><span class="br0">(</span>TakeProfit <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="kw4">double</span> SellTakeProfit <span class="sy0">=</span> PendingPrice <span class="sy0">-</span> <span class="br0">(</span>TakeProfit <span class="sy0">*</span> UsePoint<span class="br0">)</span><span class="sy0">;</span>SellTicket <span class="sy0">=</span> OrderSend<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OP_SELLSTOP<span class="sy0">,</span>LotSize<span class="sy0">,</span>PendingPrice<span class="sy0">,</span>UseSlippage<span class="sy0">,</span> SellStopLoss<span class="sy0">,</span>SellTakeProfit<span class="sy0">,</span><span class="st0">&quot;Sell Stop ордер&quot;</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span>BuyTicket <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> <span class="br0">}</span><span class="kw1">return</span><span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span>&nbsp;<span class="co1">// Pip Point функция</span><span class="kw4">double</span> PipPoint<span class="br0">(</span>string Currency<span class="br0">)</span><span class="br0">{</span><span class="kw4">int</span> CalcDigits <span class="sy0">=</span> MarketInfo<span class="br0">(</span>Currency<span class="sy0">,</span>MODE_DIGITS<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>CalcDigits <span class="sy0">==</span> <span class="nu0">2</span> <span class="sy0">||</span> CalcDigits <span class="sy0">==</span> <span class="nu0">3</span><span class="br0">)</span> <span class="kw4">double</span> CalcPoint <span class="sy0">=</span> <span class="nu16">0.01</span><span class="sy0">;</span><span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>CalcDigits <span class="sy0">==</span> <span class="nu0">4</span> <span class="sy0">||</span> CalcDigits <span class="sy0">==</span> <span class="nu0">5</span><span class="br0">)</span> CalcPoint <span class="sy0">=</span> <span class="nu16">0.0001</span><span class="sy0">;</span> <span class="kw1">return</span><span class="br0">(</span>CalcPoint<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span>&nbsp;<span class="co1">// GetSlippage функция</span><span class="kw4">int</span> GetSlippage<span class="br0">(</span>string Currency<span class="sy0">,</span> <span class="kw4">int</span> SlippagePips<span class="br0">)</span> <span class="br0">{</span><span class="kw4">int</span> CalcDigits <span class="sy0">=</span> MarketInfo<span class="br0">(</span>Currency<span class="sy0">,</span>MODE_DIGITS<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>CalcDigits <span class="sy0">==</span> <span class="nu0">2</span> <span class="sy0">||</span> CalcDigits <span class="sy0">==</span> <span class="nu0">4</span><span class="br0">)</span> <span class="kw4">double</span> CalcSlippage <span class="sy0">=</span> SlippagePips<span class="sy0">;</span> <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>CalcDigits <span class="sy0">==</span> <span class="nu0">3</span> <span class="sy0">||</span> CalcDigits <span class="sy0">==</span> <span class="nu0">5</span><span class="br0">)</span> CalcSlippage <span class="sy0">=</span> SlippagePips <span class="sy0">*</span> <span class="nu0">10</span><span class="sy0">;</span> <span class="kw1">return</span><span class="br0">(</span>CalcSlippage<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span></pre></div></div></div></div></div></div></div></div><div class='code-block code-block-center code-block-5 ai-viewport-1'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader2" rel="nofollow" target="_blank"><img src="https://advertising-blog.qqit.ru/rublogtrader.rar.su/pamm_landing_banner_970x250_ru_1.gif"/></a></div><div class='code-block code-block-center code-block-6 ai-viewport-2 ai-viewport-3'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader2" rel="nofollow" target="_blank"><img src="/b/pamm_landing_banner_300x250_ru_.gif"/></a></div><div class="share"> Поделиться: <a href="https://telete.in/share/url?url=https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/" target="_blank"><i class="icon-04"></i></a> <a href="http://vkontakte.ru/share.php?url=https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/" target="_blank"><i class="icon-01"></i></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/" target="_blank"><i class="icon-09"></i></a> <a href="https://connect.ok.ru/offer?url=https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/" target="_blank"><i class="icon-02"></i></a> <a href="https://twitter.com/intent/tweet?url=https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/" target="_blank"><i class="icon-03"></i></a></div><div class="subsc4"> <a href="/torgovyj-algoritm-po-trejdingu-buy/">Мой торговый алгоритм по трейдингу</a></div><div class="subsc4"> <a href="/algoritm-torgovli-akcijami/">Мой алгоритм торговли акциями</a></div><div class="subsc4"> <a href="/moj-algoritm-vybora-akcij/">Мой алгоритм выбора акций по мультипликаторам</a></div><div class="subsc4"> Скачайте приложение Блог Трейдера в App Store<br><br> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader3" rel="nofollow" target="_blank"><img src="https://advertising-blog.qqit.ru/rublogtrader.rar.su/appstore.png" width="200"/></a></div><div class="title"><a href="https://rublogtrader.rar.su/mql4/" rel="category tag">MQL4</a></div><section YuzoPluginPro class="wp-yuzo yzp-wrapper  yzp-id-12792 yzp-template-list-default-l yzp-layout-list yzp-without-excerpt yzp-without-meta yzp-aspect-ratio-1-1 yzp-mobile-columns-2 yzp-tablet-columns-2 yzp-desktop-columns-2" data-version="6.2.3"  data-id="12792"  data-type="s" data-level="3" ><ul class='yzp-container' ><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='10898' data-n='1'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/funkcii-v-mql4/'   >Функции в MQL4: что они из себя представляют и как их использовать?</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='11409' data-n='2'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/konstanty-v-mql4/'   >Константы в MQL4 – составные части программы</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='12120' data-n='3'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/proverjaem-ceny-dlja-stop-lossa-i-tejk-profita-v-mql4/'   >Проверяем цены для стоп–лосса и тейк–профита в MQL4</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='14331' data-n='4'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/uslovija-ispolnenija-orderov/'   >Условия исполнения ордеров и работа с индикаторами в MQL4</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='11605' data-n='5'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/oscilljator-stohastik-pishem-kod-sovetnika-i-razbiraem-ego/'   >Осциллятор стохастик: пишем код советника и разбираем его</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='10969' data-n='6'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/massivy-v-mql4/'   >Массивы в MQL4: что они из себя представляют?</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='12812' data-n='7'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/torgovyj-sovetnik-na-mql4/'   >Торговый советник на MQL4: учимся программировать с нуля</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='11342' data-n='8'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/kak-vybrat-order-i-poluchit-o-nem-informaciju-s-pomoshhju-mql4/'   >Как выбрать ордер и получить о нем информацию с помощью MQL4?</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='10682' data-n='9'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/mql4-osnovy-jazyka/'   >MQL4: основы языка, типы программ и примеры использования</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='11882' data-n='10'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/rasschityvaem-razmer-pozicii-s-pomoshhju-mql4/'   >Рассчитываем размер позиции с помощью MQL4</a></div></div></li></ul></section></div></div></article><div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 no-pad"><div id="comments" class="comments-area"><div class="comments-title"> Комментарии (1)</div><ol class="comment-list"><li id="comment-656" class="comment even thread-even depth-1"><article id="div-comment-656" class="comment-body"><footer class="comment-meta"><div class="comment-author vcard"> <b class="fn">Алексей</b><span class="says">:</span></div><div class="comment-metadata"> <a href="https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/#comment-656"><time datetime="2021-03-06T21:42:26+03:00">06.03.2021 в 21:42</time></a></div></footer><div class="comment-content"><p>Добрый вечер! Нашел небольшую неточность во втором скрипте. Там не происходит закрытие buy ордеров ввиду опечатки при открытии sell ордеров. Там используется глобальная переменная не BuyTicket, а SellTicket</p></div><div class="reply"><a rel='nofollow' class='comment-reply-link' href='#comment-656' data-commentid="656" data-postid="14296" data-belowelement="div-comment-656" data-respondelement="respond" data-replyto="Комментарий к записи Алексей" aria-label='Комментарий к записи Алексей'>Ответить</a></div></article></li></ol><div id="respond" class="comment-respond"> <span id="reply-title" class="h4 comment-reply-title">Добавить комментарий <small><a rel="nofollow" id="cancel-comment-reply-link" href="/razmeshhenie-orderov-v-mql4/#respond" style="display:none;">Отменить ответ</a></small></span><form action="https://rublogtrader.rar.su/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><p class="comment-notes"><span id="email-notes">Ваш адрес email не будет опубликован.</span></p><p class="comment-form-comment"><label for="comment">Комментарий</label><textarea style="display:none;" id="comment" name="comment" cols="45" rows="8" maxlength="65525" ></textarea><textarea id="real-comment" name="real-comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Имя</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p><p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Отправить комментарий" /> <input type='hidden' name='comment_post_ID' value='14296' id='comment_post_ID' /> <input type='hidden' name='comment_parent' id='comment_parent' value='0' /></p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="392f7c3284" /></p><p style="display: none !important;"><label>&#916;<textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100"></textarea></label><input type="hidden" id="ak_js" name="ak_js" value="7"/><script>document.getElementById( "ak_js" ).setAttribute( "value", ( new Date() ).getTime() );</script></p></form></div></div></div></main></div></div></div></div><div class="spu-bg" id="spu-bg-16205"></div><div class="spu-box  spu-centered spu-total- " id="spu-16205" data-box-id="16205" data-trigger="seconds" data-trigger-number="5" data-spuanimation="fade" data-tconvert-cookie="d" data-tclose-cookie="d" data-dconvert-cookie="999" data-dclose-cookie="30" data-nconvert-cookie="spu_conversion_16205" data-nclose-cookie="spu_closing_16205" data-test-mode="0" data-auto-hide="0" data-close-on-conversion="1" data-bgopa="0.5" data-total="" style="left:-99999px !important;right:auto;" data-width="600" ><div class="spu-content"><p><a href="https://www.instaglobe.net/ru/pamm_trading?x=trdblogpam&#038;utm_source=tradeblog.net&#038;utm_campaign=pamm" target="_blank" rel="noopener"><img src="https://rublogtrader.rar.su/wp-content/uploads/2021/12/700_400_Popup.jpg" alt="" width="700" height="400" class="alignnone size-full wp-image-16207" /></a></p></div> <span class="spu-close spu-close-popup top_right"><i class="spu-icon spu-icon-close"></i></span> <span class="spu-timer"></span></div><div id="fb-root" class=" fb_reset"></div><div id="shiftnav-toggle-main" class="shiftnav-toggle-main-align-center shiftnav-toggle-style-full_bar shiftnav-togglebar-gap-on shiftnav-toggle-edge-left shiftnav-toggle-icon-bars shiftnav--hide-scroll-down"   ><button id="shiftnav-toggle-main-button" class="shiftnav-toggle shiftnav-toggle-shiftnav-main shiftnav-toggle-burger" tabindex="1" data-shiftnav-target="shiftnav-main" aria-label="Toggle Menu"><i class="fa fa-bars"></i></button><div class="shiftnav-main-toggle-content shiftnav-toggle-main-block"><a href="https://traderblog.net">Блог трейдера</a></div><div class="shiftnav-main-toggle-content-after"> <a class="shiftnav-searchbar-toggle  shiftnav-toggle-main-block shiftnav-toggle-main-ontop" tabindex="1"><i class="fa fa-search"></i></a><div class="shiftnav-searchbar-drop"><form role="search" method="get" class="shiftnav-searchform" action="https://rublogtrader.rar.su/"> <input type="text" placeholder="Search..." value="" name="s" class="shiftnav-search-input" /> <input type="submit" class="shiftnav-search-submit" value="&#xf002;" /></form></div></div></div><div class="shiftnav shiftnav-nojs shiftnav-shiftnav-main shiftnav-left-edge shiftnav-skin-none shiftnav-transition-standard" id="shiftnav-main" data-shiftnav-id="shiftnav-main"><div class="shiftnav-inner"><nav class="shiftnav-nav"><ul id="menu-menu-2" class="shiftnav-menu shiftnav-targets-default shiftnav-targets-text-default shiftnav-targets-icon-default"><li id="menu-item-14441" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-14441 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/forex/">Форекс</a></li><li id="menu-item-14442" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-14442 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/trading/">Трейдинг</a></li><li id="menu-item-10795" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-10795 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/technical-analysis/">Технический анализ</a></li><li id="menu-item-10797" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-10797 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/indicators/">Индикаторы</a></li><li id="menu-item-10798" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-10798 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/prajs-jekshen/">Прайс экшен</a></li><li id="menu-item-16043" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-16043 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/investing/">Инвестиции</a></li><li id="menu-item-16238" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-16238 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/crypto/">Крипто</a></li></ul></nav> <button class="shiftnav-sr-close shiftnav-sr-only shiftnav-sr-only-focusable"> &times; Close Panel </button></div></div><div style="display: none;" id="nxsFavNotice"><div id="nxsFavNoticeCnt">Posting....</div></div><div id="wpfront-scroll-top-container"> <img src="https://rublogtrader.rar.su/wp-content/uploads/2019/03/scroll-3.png" alt="" /></div> <script type="text/javascript">function wpfront_scroll_top_init() {                if (typeof wpfront_scroll_top === "function" && typeof jQuery !== "undefined") {                    wpfront_scroll_top({"scroll_offset":3000,"button_width":60,"button_height":60,"button_opacity":0.9,"button_fade_duration":200,"scroll_duration":400,"location":1,"marginX":250,"marginY":20,"hide_iframe":false,"auto_hide":false,"auto_hide_after":2,"button_action":"top","button_action_element_selector":"","button_action_container_selector":"html, body","button_action_element_offset":0});                } else {                    setTimeout(wpfront_scroll_top_init, 100);                }            }            wpfront_scroll_top_init();</script> <script type='text/javascript' id='yuzo-js-js-extra'>var yuzo_vars = {"ajaxurl":"https:\/\/traderblog.net\/wp-admin\/admin-ajax.php","post_id":"14296","url":"https%3A%2F%2Ftraderblog.net%2Frazmeshhenie-orderov-v-mql4%2F","where_is":"single|singular","nonce":"7e9956422c","nonce2":"98ebd05f15","off_views":"0","off_views_logged":"1","is_logged":"0","allows_to_count_visits":"1","disabled_counter":"0","level_article":"medium"};</script> <script type='text/javascript' id='spu-public-js-extra'>var spuvar = {"is_admin":"","disable_style":"","ajax_mode":"","ajax_url":"https:\/\/traderblog.net\/wp-admin\/admin-ajax.php","ajax_mode_url":"https:\/\/traderblog.net\/?spu_action=spu_load","pid":"14296","is_front_page":"","is_category":"","site_url":"https:\/\/traderblog.net","is_archive":"","is_search":"","is_preview":"","seconds_confirmation_close":"5"};var spuvar_social = [];</script> <script type='text/javascript' id='shiftnav-js-extra'>var shiftnav_data = {"shift_body":"off","shift_body_wrapper":"","lock_body":"on","lock_body_x":"off","open_current":"off","collapse_accordions":"off","scroll_panel":"off","breakpoint":"1120","v":"1.7.0.1","pro":"1","touch_off_close":"on","scroll_offset":"100","disable_transforms":"off","close_on_target_click":"off","scroll_top_boundary":"50","process_uber_segments":"on"};</script> <script>ai_front = {"insertion_before":"BEFORE","insertion_after":"AFTER","insertion_prepend":"PREPEND CONTENT","insertion_append":"APPEND CONTENT","insertion_replace_content":"REPLACE CONTENT","insertion_replace_element":"REPLACE ELEMENT","visible":"VISIBLE","hidden":"HIDDEN","fallback":"FALLBACK","automatically_placed":"Automatically placed by AdSense Auto ads code","cancel":"Cancel","use":"Use","add":"Add","parent":"Parent","cancel_element_selection":"Cancel element selection","select_parent_element":"Select parent element","css_selector":"CSS selector","use_current_selector":"Use current selector","element":"ELEMENT","path":"PATH","selector":"SELECTOR"};function b2a(a){var b,c=0,l=0,f="",g=[];if(!a)return a;do{var e=a.charCodeAt(c++);var h=a.charCodeAt(c++);var k=a.charCodeAt(c++);var d=e<<16|h<<8|k;e=63&d>>18;h=63&d>>12;k=63&d>>6;d&=63;g[l++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)}while(c<a.length);return f=g.join(""),b=a.length%3,(b?f.slice(0,b-3):f)+"===".slice(b||3)}function a2b(a){var b,c,l,f={},g=0,e=0,h="",k=String.fromCharCode,d=a.length;for(b=0;64>b;b++)f["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(b)]=b;for(c=0;d>c;c++)for(b=f[a.charAt(c)],g=(g<<6)+b,e+=6;8<=e;)((l=255&g>>>(e-=8))||d-2>c)&&(h+=k(l));return h}b64e=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(b,a){return String.fromCharCode("0x"+a)}))};b64d=function(a){return decodeURIComponent(atob(a).split("").map(function(a){return"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)}).join(""))};(function(a){if("function"===typeof define&&define.amd){define(a);var c=!0}"object"===typeof exports&&(module.exports=a(),c=!0);if(!c){var d=window.Cookies,b=window.Cookies=a();b.noConflict=function(){window.Cookies=d;return b}}})(function(){function a(){for(var d=0,b={};d<arguments.length;d++){var f=arguments[d],e;for(e in f)b[e]=f[e]}return b}function c(d){function b(){}function f(h,k,g){if("undefined"!==typeof document){g=a({path:"/"},b.defaults,g);"number"===typeof g.expires&&(g.expires=new Date(1*new Date+864E5*g.expires));g.expires=g.expires?g.expires.toUTCString():"";try{var l=JSON.stringify(k);/^[\{\[]/.test(l)&&(k=l)}catch(p){}k=d.write?d.write(k,h):encodeURIComponent(String(k)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent);h=encodeURIComponent(String(h)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);l="";for(var n in g)g[n]&&(l+="; "+n,!0!==g[n]&&(l+="="+g[n].split(";")[0]));return document.cookie=h+"="+k+l}}function e(h,k){if("undefined"!==typeof document){for(var g={},l=document.cookie?document.cookie.split("; "):[],n=0;n<l.length;n++){var p=l[n].split("="),m=p.slice(1).join("=");k||'"'!==m.charAt(0)||(m=m.slice(1,-1));try{var q=p[0].replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent);m=(d.read||d)(m,q)||m.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent);if(k)try{m=JSON.parse(m)}catch(r){}g[q]=m;if(h===q)break}catch(r){}}return h?g[h]:g}}b.set=f;b.get=function(h){return e(h,!1)};b.getJSON=function(h){return e(h,!0)};b.remove=function(h,k){f(h,"",a(k,{expires:-1}))};b.defaults={};b.withConverter=c;return b}return c(function(){})});AiCookies=Cookies.noConflict();ai_check_block=function(a){if(null==a)return!0;var c=AiCookies.getJSON("aiBLOCKS");ai_debug_cookie_status="";null==c&&(c={});"undefined"!==typeof ai_delay_showing_pageviews&&(c.hasOwnProperty(a)||(c[a]={}),c[a].hasOwnProperty("d")||(c[a].d=ai_delay_showing_pageviews));if(c.hasOwnProperty(a))for(var d in c[a]){if("x"==d){var b="",f=document.querySelectorAll('span[data-ai-block="'+a+'"]')[0];"aiHash"in f.dataset&&(b=f.dataset.aiHash);f="";c[a].hasOwnProperty("h")&&(f=c[a].h);var e=new Date;e=c[a][d]-Math.round(e.getTime()/1E3);if(0<e&&f==b)return ai_debug_cookie_status=a="closed for "+e+" s = "+Math.round(1E4*e/3600/24)/1E4+" days",!1;ai_set_cookie(a,"x","");c[a].hasOwnProperty("i")||c[a].hasOwnProperty("c")||ai_set_cookie(a,"h","")}else if("d"==d){if(0!=c[a][d])return ai_debug_cookie_status=a="delayed for "+c[a][d]+" pageviews",!1}else if("i"==d){b="";f=document.querySelectorAll('span[data-ai-block="'+a+'"]')[0];"aiHash"in f.dataset&&(b=f.dataset.aiHash);f="";c[a].hasOwnProperty("h")&&(f=c[a].h);if(0==c[a][d]&&f==b)return ai_debug_cookie_status=a="max impressions reached",!1;if(0>c[a][d]&&f==b){e=new Date;e=-c[a][d]-Math.round(e.getTime()/1E3);if(0<e)return ai_debug_cookie_status=a="max imp. reached ("+Math.round(1E4*e/24/3600)/1E4+" days = "+e+" s)",!1;ai_set_cookie(a,"i","");c[a].hasOwnProperty("c")||c[a].hasOwnProperty("x")||ai_set_cookie(a,"h","")}}if("ipt"==d&&0==c[a][d]&&(e=new Date,b=Math.round(e.getTime()/1E3),e=c[a].it-b,0<e))return ai_debug_cookie_status=a="max imp. per time reached ("+Math.round(1E4*e/24/3600)/1E4+" days = "+e+" s)",!1;if("c"==d){b="";f=document.querySelectorAll('span[data-ai-block="'+a+'"]')[0];"aiHash"in f.dataset&&(b=f.dataset.aiHash);f="";c[a].hasOwnProperty("h")&&(f=c[a].h);if(0==c[a][d]&&f==b)return ai_debug_cookie_status=a="max clicks reached",!1;if(0>c[a][d]&&f==b){e=new Date;e=-c[a][d]-Math.round(e.getTime()/1E3);if(0<e)return ai_debug_cookie_status=a="max clicks reached ("+Math.round(1E4*e/24/3600)/1E4+" days = "+e+" s)",!1;ai_set_cookie(a,"c","");c[a].hasOwnProperty("i")||c[a].hasOwnProperty("x")||ai_set_cookie(a,"h","")}}if("cpt"==d&&0==c[a][d]&&(e=new Date,b=Math.round(e.getTime()/1E3),e=c[a].ct-b,0<e))return ai_debug_cookie_status=a="max clicks per time reached ("+Math.round(1E4*e/24/3600)/1E4+" days = "+e+" s)",!1}ai_debug_cookie_status="OK";return!0};ai_check_and_insert_block=function(a,c){if(null==a)return!0;var d=document.getElementsByClassName(c);if(d.length){d=d[0];var b=d.closest(".code-block");if(ai_check_block(a)){if(ai_insert_code(d),b){var f=b.querySelectorAll(".ai-debug-block");b&&f.length&&(b.classList.remove("ai-list-block"),b.classList.remove("ai-list-block-ip"),b.style.visibility="",b.classList.contains("ai-remove-position")&&(b.style.position=""))}}else{f=d.closest("div[data-ai]");if(null!=f&&"undefined"!=typeof f.getAttribute("data-ai")){var e=JSON.parse(b64d(f.getAttribute("data-ai")));"undefined"!==typeof e&&e.constructor===Array&&(e[1]="",f.setAttribute("data-ai",b64e(JSON.stringify(e))))}f=b.querySelectorAll(".ai-debug-block");b&&f.length&&(b.classList.remove("ai-list-block"),b.classList.remove("ai-list-block-ip"),b.style.visibility="",b.classList.contains("ai-remove-position")&&(b.style.position=""))}d.classList.remove(c)}d=document.querySelectorAll("."+c+"-dbg");b=0;for(f=d.length;b<f;b++)e=d[b],e.querySelector(".ai-status").textContent=ai_debug_cookie_status,e.querySelector(".ai-cookie-data").textContent=ai_get_cookie_text(a),e.classList.remove(c+"-dbg")};function ai_load_cookie(){var a=AiCookies.getJSON("aiBLOCKS");null==a&&(a={});return a}function ai_get_cookie(a,c){var d="",b=ai_load_cookie();b.hasOwnProperty(a)&&b[a].hasOwnProperty(c)&&(d=b[a][c]);return d}function ai_set_cookie(a,c,d){var b=ai_load_cookie();if(""===d){if(b.hasOwnProperty(a)){delete b[a][c];a:{c=b[a];for(f in c)if(c.hasOwnProperty(f)){var f=!1;break a}f=!0}f&&delete b[a]}}else b.hasOwnProperty(a)||(b[a]={}),b[a][c]=d;0===Object.keys(b).length&&b.constructor===Object?AiCookies.remove("aiBLOCKS"):AiCookies.set("aiBLOCKS",b,{expires:365,path:"/"});return b}ai_get_cookie_text=function(a){var c=AiCookies.getJSON("aiBLOCKS");null==c&&(c={});return c.hasOwnProperty(a)?JSON.stringify(c[a]).replace(/"/g,"").replace("{","").replace("}",""):""};ai_insert=function(d,l,v){for(var p=-1!=l.indexOf(":eq")?jQuery(l):document.querySelectorAll(l),t=0,y=p.length;t<y;t++){var b=p[t];selector_string=b.hasAttribute("id")?"#"+b.getAttribute("id"):b.hasAttribute("class")?"."+b.getAttribute("class").replace(RegExp(" ","g"),"."):"";var u=document.createElement("div");u.innerHTML=v;var m=u.getElementsByClassName("ai-selector-counter")[0];null!=m&&(m.innerText=t+1);m=u.getElementsByClassName("ai-debug-name ai-main")[0];if(null!=m){var k="";"before"==d?k=ai_front.insertion_before:"after"==d?k=ai_front.insertion_after:"prepend"==d?k=ai_front.insertion_prepend:"append"==d?k=ai_front.insertion_append:"replace-content"==d?k=ai_front.insertion_replace_content:"replace-element"==d&&(k=ai_front.insertion_replace_element);-1==selector_string.indexOf(".ai-viewports")&&(m.innerText=k+" "+l+" ("+b.tagName.toLowerCase()+selector_string+")")}m=document.createRange();k=!0;try{var w=m.createContextualFragment(u.innerHTML)}catch(r){k=!1}"before"==d?k?b.parentNode.insertBefore(w,b):jQuery(u.innerHTML).insertBefore(jQuery(b)):"after"==d?k?b.parentNode.insertBefore(w,b.nextSibling):jQuery(u.innerHTML).insertBefore(jQuery(b.nextSibling)):"prepend"==d?k?b.insertBefore(w,b.firstChild):jQuery(u.innerHTML).insertBefore(jQuery(b.firstChild)):"append"==d?k?b.insertBefore(w,null):jQuery(u.innerHTML).appendTo(jQuery(b)):"replace-content"==d?(b.innerHTML="",k?b.insertBefore(w,null):jQuery(u.innerHTML).appendTo(jQuery(b))):"replace-element"==d&&(k?b.parentNode.insertBefore(w,b):jQuery(u.innerHTML).insertBefore(jQuery(b)),b.parentNode.removeChild(b))}};ai_insert_code=function(d){function l(m,k){return null==m?!1:m.classList?m.classList.contains(k):-1<(" "+m.className+" ").indexOf(" "+k+" ")}function v(m,k){null!=m&&(m.classList?m.classList.add(k):m.className+=" "+k)}function p(m,k){null!=m&&(m.classList?m.classList.remove(k):m.className=m.className.replace(new RegExp("(^|\\b)"+k.split(" ").join("|")+"(\\b|$)","gi")," "))}if("undefined"!=typeof d){var t=!1;if(l(d,"no-visibility-check")||d.offsetWidth||d.offsetHeight||d.getClientRects().length){t=d.getAttribute("data-code");var y=d.getAttribute("data-insertion"),b=d.getAttribute("data-selector");if(null!=t)if(null!=y&&null!=b){if(-1!=b.indexOf(":eq")?jQuery(b).length:document.querySelectorAll(b).length)ai_insert(y,b,b64d(t)),p(d,"ai-viewports")}else{y=document.createRange();b=!0;try{var u=y.createContextualFragment(b64d(t))}catch(m){b=!1}b?d.parentNode.insertBefore(u,d.nextSibling):jQuery(b64d(t)).insertBefore(jQuery(d.nextSibling));p(d,"ai-viewports")}t=!0}else u=d.previousElementSibling,l(u,"ai-debug-bar")&&l(u,"ai-debug-script")&&(p(u,"ai-debug-script"),v(u,"ai-debug-viewport-invisible")),p(d,"ai-viewports");return t}};ai_insert_list_code=function(d){var l=document.getElementsByClassName(d)[0];if("undefined"!=typeof l){var v=ai_insert_code(l),p=l.closest("div.code-block");if(p){v||p.removeAttribute("data-ai");var t=p.querySelectorAll(".ai-debug-block");p&&t.length&&(p.classList.remove("ai-list-block"),p.classList.remove("ai-list-block-ip"),p.style.visibility="",p.classList.contains("ai-remove-position")&&(p.style.position=""))}l.classList.remove(d);v&&ai_process_elements()}};ai_insert_viewport_code=function(d){var l=document.getElementsByClassName(d)[0];"undefined"!=typeof l&&(ai_insert_code(l),l.classList.remove(d),ai_process_elements())};ai_insert_code_by_class=function(d){var l=document.getElementsByClassName(d)[0];"undefined"!=typeof l&&(ai_insert_code(l),l.classList.remove(d))};ai_insert_client_code=function(d,l){var v=document.getElementsByClassName(d)[0];if("undefined"!=typeof v){var p=v.getAttribute("data-code");null!=p&&ai_check_block()&&ai_check_and_insert_block()&&(v.setAttribute("data-code",p.substring(Math.floor(l/19))),ai_insert_code_by_class(d),v.remove())}};ai_process_elements_active=!1;function ai_process_elements(){ai_process_elements_active||setTimeout(function(){ai_process_elements_active=!1;"function"==typeof ai_process_rotations&&ai_process_rotations();"function"==typeof ai_process_lists&&ai_process_lists(jQuery(".ai-list-data"));"function"==typeof ai_process_ip_addresses&&ai_process_ip_addresses(jQuery(".ai-ip-data"));"function"==typeof ai_adb_process_blocks&&ai_adb_process_blocks()},5);ai_process_elements_active=!0}var Arrive=function(d,l,v){function p(r,c,e){b.addMethod(c,e,r.unbindEvent);b.addMethod(c,e,r.unbindEventWithSelectorOrCallback);b.addMethod(c,e,r.unbindEventWithSelectorAndCallback)}function t(r){r.arrive=k.bindEvent;p(k,r,"unbindArrive");r.leave=w.bindEvent;p(w,r,"unbindLeave")}if(d.MutationObserver&&"undefined"!==typeof HTMLElement){var y=0,b=function(){var r=HTMLElement.prototype.matches||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector;return{matchesSelector:function(c,e){return c instanceof HTMLElement&&r.call(c,e)},addMethod:function(c,e,f){var a=c[e];c[e]=function(){if(f.length==arguments.length)return f.apply(this,arguments);if("function"==typeof a)return a.apply(this,arguments)}},callCallbacks:function(c,e){e&&e.options.onceOnly&&1==e.firedElems.length&&(c=[c[0]]);for(var f=0,a;a=c[f];f++)a&&a.callback&&a.callback.call(a.elem,a.elem);e&&e.options.onceOnly&&1==e.firedElems.length&&e.me.unbindEventWithSelectorAndCallback.call(e.target,e.selector,e.callback)},checkChildNodesRecursively:function(c,e,f,a){for(var g=0,h;h=c[g];g++)f(h,e,a)&&a.push({callback:e.callback,elem:h}),0<h.childNodes.length&&b.checkChildNodesRecursively(h.childNodes,e,f,a)},mergeArrays:function(c,e){var f={},a;for(a in c)c.hasOwnProperty(a)&&(f[a]=c[a]);for(a in e)e.hasOwnProperty(a)&&(f[a]=e[a]);return f},toElementsArray:function(c){"undefined"===typeof c||"number"===typeof c.length&&c!==d||(c=[c]);return c}}}(),u=function(){var r=function(){this._eventsBucket=[];this._beforeRemoving=this._beforeAdding=null};r.prototype.addEvent=function(c,e,f,a){c={target:c,selector:e,options:f,callback:a,firedElems:[]};this._beforeAdding&&this._beforeAdding(c);this._eventsBucket.push(c);return c};r.prototype.removeEvent=function(c){for(var e=this._eventsBucket.length-1,f;f=this._eventsBucket[e];e--)c(f)&&(this._beforeRemoving&&this._beforeRemoving(f),(f=this._eventsBucket.splice(e,1))&&f.length&&(f[0].callback=null))};r.prototype.beforeAdding=function(c){this._beforeAdding=c};r.prototype.beforeRemoving=function(c){this._beforeRemoving=c};return r}(),m=function(r,c){var e=new u,f=this,a={fireOnAttributesModification:!1};e.beforeAdding(function(g){var h=g.target;if(h===d.document||h===d)h=document.getElementsByTagName("html")[0];var n=new MutationObserver(function(x){c.call(this,x,g)});var q=r(g.options);n.observe(h,q);g.observer=n;g.me=f});e.beforeRemoving(function(g){g.observer.disconnect()});this.bindEvent=function(g,h,n){h=b.mergeArrays(a,h);for(var q=b.toElementsArray(this),x=0;x<q.length;x++)e.addEvent(q[x],g,h,n)};this.unbindEvent=function(){var g=b.toElementsArray(this);e.removeEvent(function(h){for(var n=0;n<g.length;n++)if(this===v||h.target===g[n])return!0;return!1})};this.unbindEventWithSelectorOrCallback=function(g){var h=b.toElementsArray(this);e.removeEvent("function"===typeof g?function(n){for(var q=0;q<h.length;q++)if((this===v||n.target===h[q])&&n.callback===g)return!0;return!1}:function(n){for(var q=0;q<h.length;q++)if((this===v||n.target===h[q])&&n.selector===g)return!0;return!1})};this.unbindEventWithSelectorAndCallback=function(g,h){var n=b.toElementsArray(this);e.removeEvent(function(q){for(var x=0;x<n.length;x++)if((this===v||q.target===n[x])&&q.selector===g&&q.callback===h)return!0;return!1})};return this},k=new function(){function r(f,a,g){return b.matchesSelector(f,a.selector)&&(f._id===v&&(f._id=y++),-1==a.firedElems.indexOf(f._id))?(a.firedElems.push(f._id),!0):!1}var c={fireOnAttributesModification:!1,onceOnly:!1,existing:!1};k=new m(function(f){var a={attributes:!1,childList:!0,subtree:!0};f.fireOnAttributesModification&&(a.attributes=!0);return a},function(f,a){f.forEach(function(g){var h=g.addedNodes,n=g.target,q=[];null!==h&&0<h.length?b.checkChildNodesRecursively(h,a,r,q):"attributes"===g.type&&r(n,a,q)&&q.push({callback:a.callback,elem:n});b.callCallbacks(q,a)})});var e=k.bindEvent;k.bindEvent=function(f,a,g){"undefined"===typeof g?(g=a,a=c):a=b.mergeArrays(c,a);var h=b.toElementsArray(this);if(a.existing){for(var n=[],q=0;q<h.length;q++)for(var x=h[q].querySelectorAll(f),z=0;z<x.length;z++)n.push({callback:g,elem:x[z]});if(a.onceOnly&&n.length)return g.call(n[0].elem,n[0].elem);setTimeout(b.callCallbacks,1,n)}e.call(this,f,a,g)};return k},w=new function(){function r(f,a){return b.matchesSelector(f,a.selector)}var c={};w=new m(function(){return{childList:!0,subtree:!0}},function(f,a){f.forEach(function(g){g=g.removedNodes;var h=[];null!==g&&0<g.length&&b.checkChildNodesRecursively(g,a,r,h);b.callCallbacks(h,a)})});var e=w.bindEvent;w.bindEvent=function(f,a,g){"undefined"===typeof g?(g=a,a=c):a=b.mergeArrays(c,a);e.call(this,f,a,g)};return w};l&&t(l.fn);t(HTMLElement.prototype);t(NodeList.prototype);t(HTMLCollection.prototype);t(HTMLDocument.prototype);t(Window.prototype);l={};p(k,l,"unbindAllArrive");p(w,l,"unbindAllLeave");return l}}(window,"undefined"===typeof jQuery?null:jQuery,void 0);var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,k){a.raw=k;return a};$jscomp.arrayIteratorImpl=function(a){var k=0;return function(){return k<a.length?{done:!1,value:a[k++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var k="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return k?k.call(a):$jscomp.arrayIterator(a)};jQuery(function(a){function k(e){e=e.match(E);return null!=e&&1<e.length&&"string"===typeof e[1]&&0<e[1].length?e[1].toLowerCase():null}function z(e){try{var h=Date.parse(e);isNaN(h)&&(h=null)}catch(J){h=null}if(null==h&&e.includes(" ")){e=e.split(" ");try{h=Date.parse(e[0]);if(e[1].includes(":")){var F=e[1].split(":");h+=1E3*(3600*parseInt(F[0])+60*parseInt(F[1])+parseInt(F[2]))}isNaN(h)&&(h=null)}catch(J){h=null}}return h}function n(){(jQuery("#ai-iab-tcf-bar").length||jQuery(".ai-list-manual").length)&&"function"==typeof __tcfapi&&"function"==typeof ai_load_blocks&&"undefined"==typeof ai_iab_tcf_callback_installed&&(__tcfapi("addEventListener",2,function(e,h){h&&"useractioncomplete"===e.eventStatus&&(ai_tcData=e,ai_load_blocks(),jQuery("#ai-iab-tcf-status").text("DATA LOADED"),jQuery("#ai-iab-tcf-bar").addClass("status-ok").removeClass("status-error"))}),ai_iab_tcf_callback_installed=!0)}Array.prototype.includes||(Array.prototype.includes=function(e){return!!~this.indexOf(e)});var E=/:\/\/(.[^/:]+)/i;ai_process_lists=function(e){function h(d,b,g){if(0==d.length){if("!@!"==g)return!0;b!=g&&("true"==g.toLowerCase()?g=!0:"false"==g.toLowerCase()&&(g=!1));return b==g}if("object"!=typeof b&&"array"!=typeof b)return!1;var f=d[0];d=d.slice(1);if("*"==f)for(b=$jscomp.makeIterator(Object.entries(b)),f=b.next();!f.done;f=b.next()){if(f=$jscomp.makeIterator(f.value),f.next(),f=f.next().value,h(d,f,g))return!0}else if(f in b)return h(d,b[f],g);return!1}function F(d,b,g){if("object"!=typeof d||-1==b.indexOf("["))return!1;b=b.replace(/]| /gi,"").split("[");return h(b,d,g)}function J(){"function"==typeof __tcfapi&&(a("#ai-iab-tcf-status").text("DETECTED"),__tcfapi("getTCData",2,function(d,b){b?(a("#ai-iab-tcf-bar").addClass("status-ok"),"tcloaded"==d.eventStatus||"useractioncomplete"==d.eventStatus?(ai_tcData=d,d.gdprApplies?a("#ai-iab-tcf-status").text("DATA LOADED"):jQuery("#ai-iab-tcf-status").text("GDPR DOES NOT APPLY"),a("#ai-iab-tcf-bar").addClass("status-ok").removeClass("status-error"),setTimeout(function(){ai_process_lists()},10)):"cmpuishown"==d.eventStatus&&(ai_cmpuishown=!0,a("#ai-iab-tcf-status").text("CMP UI SHOWN"),a("#ai-iab-tcf-bar").addClass("status-ok").removeClass("status-error"))):(a("#ai-iab-tcf-status").text("__tcfapi getTCData failed"),a("#ai-iab-tcf-bar").removeClass("status-ok").addClass("status-error"))}))}function P(d){"function"==typeof __tcfapi?("undefined"==typeof ai_iab_tcf_callback_installed&&n(),"undefined"==typeof ai_tcData_requested&&(ai_tcData_requested=!0,J(),url_parameters_need_tcData=!0)):d&&(a("#ai-iab-tcf-bar").addClass("status-error").removeClass("status-ok"),a("#ai-iab-tcf-status").text("MISSING: __tcfapi function not found"))}e=null==e?a("div.ai-list-data, meta.ai-list-data"):e.filter(".ai-list-data");if(e.length){e.removeClass("ai-list-data");var G=document.cookie.split(";");G.forEach(function(d,b){G[b]=d.trim()});var Q=getAllUrlParams(window.location.search);if(null!=Q.referrer)var r=Q.referrer;else r=document.referrer,""!=r&&(r=k(r));var K=window.navigator.userAgent,L=K.toLowerCase();if("undefined"!==typeof MobileDetect)var R=new MobileDetect(K);e.each(function(){var d=a(this).closest("div.code-block"),b=!0,g=a(this).attr("referer-list");if("undefined"!=typeof g){g=b64d(g).split(",");var f=a(this).attr("referer-list-type"),l=!1;a.each(g,function(t,c){if(""==c)return!0;if("*"==c.charAt(0))if("*"==c.charAt(c.length-1)){if(c=c.substr(1,c.length-2),-1!=r.indexOf(c))return l=!0,!1}else{if(c=c.substr(1),r.substr(-c.length)==c)return l=!0,!1}else if("*"==c.charAt(c.length-1)){if(c=c.substr(0,c.length-1),0==r.indexOf(c))return l=!0,!1}else if("#"==c){if(""==r)return l=!0,!1}else if(c==r)return l=!0,!1});switch(f){case "B":l&&(b=!1);break;case "W":l||(b=!1)}}if(b&&(g=a(this).attr("client-list"),"undefined"!=typeof g&&"undefined"!==typeof R))switch(g=b64d(g).split(","),f=a(this).attr("client-list-type"),l=!1,a.each(g,function(t,c){if(""==c)return!0;if("*"==c.charAt(0))if("*"==c.charAt(c.length-1)){if(c=c.substr(1,c.length-2).toLowerCase(),-1!=L.indexOf(c))return l=!0,!1}else{if(c=c.substr(1).toLowerCase(),L.substr(-c.length)==c)return l=!0,!1}else if("*"==c.charAt(c.length-1)){if(c=c.substr(0,c.length-1).toLowerCase(),0==L.indexOf(c))return l=!0,!1}else if(R.is(c))return l=!0,!1}),f){case "B":l&&(b=!1);break;case "W":l||(b=!1)}var M=g=!1;if(b&&(f=a(this).attr("parameter-list"),"undefined"!=typeof f)){f=b64d(f).split(",");var u=a(this).attr("parameter-list-type"),S=[];G.forEach(function(t){t=t.split("=");try{var c=JSON.parse(decodeURIComponent(t[1]))}catch(T){c=decodeURIComponent(t[1])}S[t[0]]=c});var w=!1,H=a(this);a.each(f,function(t,c){var T=c.split("&&");a.each(T,function(X,m){var x=!0;m=m.trim();"!!"==m.substring(0,2)&&(x=!1,m=m.substring(2));var p=m,y="!@!",U=-1!=m.indexOf("["),V=(0==m.indexOf("tcf-v2")||0==m.indexOf("euconsent-v2"))&&-1!=m.indexOf("[");-1!=m.indexOf("=")&&(y=m.split("="),p=y[0],y=y[1],U=-1!=p.indexOf("["),V=(0==p.indexOf("tcf-v2")||0==p.indexOf("euconsent-v2"))&&-1!=p.indexOf("["));if(V)a("#ai-iab-tcf-bar").show(),"object"==typeof ai_tcData?(a("#ai-iab-tcf-bar").addClass("status-ok"),p=p.replace(/]| /gi,"").split("["),p.shift(),w=(p=h(p,ai_tcData,y))?x:!x):(H.addClass("ai-list-data"),M=!0,"function"==typeof __tcfapi?P(!1):"undefined"==typeof ai_tcData_retrying&&(ai_tcData_retrying=!0,setTimeout(function(){P(!0)},200)));else if(U)w=(p=F(S,p,y))?x:!x;else{var N=!1;"!@!"==y?G.every(function(W){return W.split("=")[0]==m?(N=!0,!1):!0}):N=-1!=G.indexOf(m);w=N?x:!x}if(!w)return!1});if(w)return!1});switch(u){case "B":w&&(b=!1);break;case "W":w||(b=!1)}a(this).hasClass("ai-list-manual")&&(b?(H.removeClass("ai-list-data"),H.removeClass("ai-list-manual")):(g=!0,H.addClass("ai-list-data")));if(!g&&!M&&(f=a(this).data("debug-info"),"undefined"!=typeof f&&(f=a("."+f),0!=f.length))){var q=f.parent();q.hasClass("ai-debug-info")&&q.remove()}}q=a(this).prevAll(".ai-debug-bar.ai-debug-lists");f=""==r?"#":r;q.find(".ai-debug-name.ai-list-info").text(f).attr("title",K);q.find(".ai-debug-name.ai-list-status").text(b?ai_front.visible:ai_front.hidden);f=!1;if(b){u=a(this).attr("scheduling-start");var A=a(this).attr("scheduling-end"),B=a(this).attr("scheduling-days");if("undefined"!=typeof u&&"undefined"!=typeof A&&"undefined"!=typeof B){f=!0;var O=parseInt(a(this).attr("scheduling-fallback")),v=parseInt(a(this).attr("gmt"));u=z(b64d(u))+v;A=z(b64d(A))+v;B=b64d(B).split(",");q=a(this).attr("scheduling-type");var C=(new Date).getTime()+v,I=new Date(C),D=I.getDay();0==D?D=6:D--;v=C>=u&&C<A&&B.includes(D.toString());switch(q){case "B":v=!v}v||(b=!1);I=I.toISOString().split(".")[0].replace("T"," ");q=a(this).prevAll(".ai-debug-bar.ai-debug-scheduling");q.find(".ai-debug-name.ai-scheduling-info").text(I+" "+D+" current_time:"+C.toString()+"  start_date:"+u.toString()+" ="+(C>=u).toString()+" end_date:"+A.toString()+" =:"+(C<A).toString()+" days:"+B.toString()+" =:"+B.includes(D.toString()).toString());q.find(".ai-debug-name.ai-scheduling-status").text(b?ai_front.visible:ai_front.hidden);b||0==O||(q.removeClass("ai-debug-scheduling").addClass("ai-debug-fallback"),q.find(".ai-debug-name.ai-scheduling-status").text(ai_front.fallback+"="+O))}}if(g||M)return!0;a(this).css({visibility:"",position:"",width:"",height:"","z-index":""});b?(d.css({visibility:""}),d.hasClass("ai-remove-position")&&d.css({position:""}),"undefined"!=typeof a(this).data("code")&&(b=b64d(a(this).data("code")),0!=a(this).closest("head").length?(a(this).after(b),a(this).remove()):a(this).append(b),ai_process_element(this))):f&&!v&&0!=O?(d.css({visibility:""}),d.hasClass("ai-remove-position")&&d.css({position:""}),a(this).next(".ai-fallback").removeClass("ai-fallback"),"undefined"!=typeof a(this).data("fallback-code")?(b=b64d(a(this).data("fallback-code")),a(this).append(b),ai_process_element(this)):(a(this).hide(),d.find(".ai-debug-block").length||d.hide()),b=d.attr("data-ai"),"undefined"!==typeof b&&!1!==b&&(b=a(this).attr("fallback-tracking"),"undefined"!==typeof b&&!1!==b&&d.attr("data-ai",b))):(a(this).hide(),d.find(".ai-debug-block").length||d.hide(),d.removeAttr("data-ai").removeClass("ai-track"),d.find(".ai-debug-block").length?(d.css({visibility:""}).removeClass("ai-close"),d.hasClass("ai-remove-position")&&d.css({position:""})):d.hide());a(this).attr("data-code","");a(this).attr("data-fallback-code","");d.removeClass("ai-list-block")})}};a(document).ready(function(e){setTimeout(function(){ai_process_lists();setTimeout(function(){n()},50);if("function"==typeof ai_load_blocks)jQuery(document).on("cmplzEnableScripts",function(h){"all"===h.consentLevel&&ai_load_blocks()});jQuery("#ai-iab-tcf-bar").click(function(){AiCookies.remove("euconsent-v2",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("__lxG__consent__v2",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("__lxG__consent__v2_daisybit",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("__lxG__consent__v2_gdaisybit",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("cmplz_marketing",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("cmplz_stats",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("complianz_consent_status",{path:"/",domain:"."+window.location.hostname});jQuery("#ai-iab-tcf-status").text("COOKIE DELETED")})},5)})});function ai_process_element(a){setTimeout(function(){"function"==typeof ai_process_rotations_in_element&&ai_process_rotations_in_element(a);"function"==typeof ai_process_lists&&ai_process_lists(jQuery(".ai-list-data",a));"function"==typeof ai_process_ip_addresses&&ai_process_ip_addresses(jQuery(".ai-ip-data",a));"function"==typeof ai_adb_process_blocks&&ai_adb_process_blocks(a)},5)}function getAllUrlParams(a){var k=a?a.split("?")[1]:window.location.search.slice(1);a={};if(k){k=k.split("#")[0];k=k.split("&");for(var z=0;z<k.length;z++){var n=k[z].split("="),E=void 0,e=n[0].replace(/\[\d*\]/,function(h){E=h.slice(1,-1);return""});n="undefined"===typeof n[1]?"":n[1];e=e.toLowerCase();n=n.toLowerCase();a[e]?("string"===typeof a[e]&&(a[e]=[a[e]]),"undefined"===typeof E?a[e].push(n):a[e][E]=n):a[e]=n}}return a};jQuery(function(a){function t(g,c){c||(c=window.location.href);g=g.replace(/[\[\]]/g,"\\$&");var e=(new RegExp("[?&]"+g+"(=([^&#]*)|&|#|$)")).exec(c);return e?e[2]?decodeURIComponent(e[2].replace(/\+/g," ")):"":null}function u(g){g.removeClass("ai-ip-data");var c=!1;if(""!=ai_ip_data){try{var e=JSON.parse(ai_ip_data),h=e[0],l=e[1],n=e[2],p=e[3]}catch(d){return}var q=h+", "+l;null!=n&&null!=p&&(q=q+":"+n+":"+p);null==n&&(n="");null==p&&(p="");null!=e&&g.each(function(){var d=a(this).closest("div.code-block");c=!0;var f=a(this).attr("ip-addresses");if("undefined"!=typeof f){f=f.split(",");var r=a(this).attr("ip-address-list"),k=!1;a.each(f,function(v,b){if("*"==b.charAt(0))if("*"==b.charAt(b.length-1)){if(b=b.substr(1,b.length-2),-1!=h.indexOf(b))return k=!0,!1}else{if(b=b.substr(1),h.substr(-b.length)==b)return k=!0,!1}else if("*"==b.charAt(b.length-1)){if(b=b.substr(0,b.length-1),0==h.indexOf(b))return k=!0,!1}else if("#"==b){if(""==h)return k=!0,!1}else if(b==h)return k=!0,!1});switch(r){case "B":k&&(c=!1);break;case "W":k||(c=!1)}}if(c&&(f=a(this).attr("countries"),"undefined"!=typeof f))switch(f=f.split(","),r=a(this).attr("country-list"),k=!1,a.each(f,function(v,b){var m=b.trim().split(":");if(null==m[1]||""==n)m[1]="";if(null==m[2]||""==p)m[2]="";var w=m.join(":").toUpperCase();m=(l+":"+(""==m[1]?"":n)+":"+(""==m[2]?"":p)).toUpperCase();if(w==m)return k=!0,!1}),r){case "B":k&&(c=!1);break;case "W":k||(c=!1)}a(this).css({visibility:"",position:"",width:"",height:"","z-index":""});f=a(this).prev(".ai-debug-bar");f.find(".ai-debug-name.ai-ip-country").text(q);f.find(".ai-debug-name.ai-ip-status").text(c?ai_front.visible:ai_front.hidden);c?(d.css({visibility:""}),d.hasClass("ai-remove-position")&&d.css({position:""}),"undefined"!=typeof a(this).data("code")&&(f=b64d(a(this).data("code")),0!=a(this).closest("head").length?(a(this).after(f),a(this).remove()):a(this).append(f),a(this).attr("data-code",""),ai_process_element(this))):(a(this).hide(),d.find(".ai-debug-block").length||d.hide(),d.removeAttr("data-ai"),d.find(".ai-debug-block")?(d.css({visibility:""}).removeClass("ai-close"),d.hasClass("ai-remove-position")&&d.css({position:""}),"undefined"!=typeof a(this).data("code")&&(d.removeClass("ai-list-block"),d.prev().hasClass("ai-debug-info")&&d.prev().remove())):d.hide());d.removeClass("ai-list-block-ip")})}}ai_process_ip_addresses=function(g){g=null==g?a("div.ai-ip-data, meta.ai-ip-data"):g.filter(".ai-ip-data");if(g.length)if("undefined"!=typeof ai_ip_data)u(g);else if("undefined"==typeof ai_ip_data_requested){ai_ip_data_requested=!0;var c="/wp-admin/admin-ajax.php?action=ai_ajax&ip-data=ip-address-country-city&ai_check=e25a7b7809&ver="+((new Date).getTime()+"-"+Math.round(1E5*Math.random())),e=t("ai-debug-ip-address");null!=e&&(c+="&ai-debug-ip-address="+e);e=t("ai-debug-country");null!=e&&(c+="&ai-debug-country="+e);a.get(c,function(h){ai_ip_data=h;if(""==h){var l="Ajax request returned empty data, geo-targeting disabled";console.error(l);"undefined"!=typeof ai_js_errors&&ai_js_errors.push([l,c,0])}else try{JSON.parse(h)}catch(n){l="Ajax call returned invalid data, geo-targeting disabled",console.error(l,h),"undefined"!=typeof ai_js_errors&&ai_js_errors.push([l,c,0])}u(g)}).fail(function(h,l,n){a("div.ai-ip-data").each(function(){a(this).css({display:"none",visibility:"",position:"",width:"",height:"","z-index":""}).removeClass("ai-ip-data").hide()})})}};a(document).ready(function(g){setTimeout(function(){ai_process_ip_addresses()},5)})});function ai_process_element(a){setTimeout(function(){"function"==typeof ai_process_rotations_in_element&&ai_process_rotations_in_element(a);"function"==typeof ai_process_lists&&ai_process_lists(jQuery(".ai-list-data",a));"function"==typeof ai_process_ip_addresses&&ai_process_ip_addresses(jQuery(".ai-ip-data",a));"function"==typeof ai_adb_process_blocks&&ai_adb_process_blocks(a)},5)};ai_run_743297638225 = function(){ai_document_write=document.write;document.write=function(a){"interactive"==document.readyState?(console.error("document.write called after page load: ",a),"undefined"!=typeof ai_js_errors&&ai_js_errors.push(["document.write called after page load",a,0])):ai_document_write.call(document,a)};ai_insert ('after', '.lwptoc', b64d ('PGRpdiBjbGFzcz0nY29kZS1ibG9jayBjb2RlLWJsb2NrLWRlZmF1bHQgY29kZS1ibG9jay0xMCBhaS12aWV3cG9ydC0zJz4KPGEgaHJlZj0iL2luc3RhLyIgcmVsPSJub2ZvbGxvdyIgdGFyZ2V0PSJfYmxhbmsiPjxpbWcgc3JjPSIvYi9wYW1tX2xhbmRpbmdfYmFubmVyXzMwMHgyNTBfcnVfLmdpZiIvPjwvYT4KPC9kaXY+Cg=='));};if (document.readyState === 'complete' || (document.readyState !== 'loading' && !document.documentElement.doScroll)) ai_run_743297638225 (); else document.addEventListener ('DOMContentLoaded', ai_run_743297638225);ai_js_code = true;</script> </body></html>