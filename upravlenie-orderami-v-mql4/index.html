<!DOCTYPE html><html lang="ru-RU" prefix="og: http://ogp.me/ns#"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1' /><link media="all" href="https://rublogtrader.rar.su/wp-content/cache/autoptimize/css/autoptimize_a956534720ee1514d6564ed8c0f433d5.css" rel="stylesheet" /><title>Управление ордерами в MQL4: как модифицировать ордера?</title><meta name="description" content="Разбираем фунукции управления ордерами в MQL4. Как изменять ордера, устанавливать трейлинг-стоп и закрывать отдельные ордера." /><meta property="og:locale" content="ru_RU" /><meta property="og:type" content="article" /><meta property="og:title" content="Управление ордерами в MQL4: как модифицировать ордера?" /><meta property="og:description" content="Разбираем фунукции управления ордерами в MQL4. Как изменять ордера, устанавливать трейлинг-стоп и закрывать отдельные ордера." /><meta property="og:url" content="https://rublogtrader.rar.su/upravlenie-orderami-v-mql4/" /><meta property="og:site_name" content="Блог трейдера" /><meta property="article:published_time" content="2020-06-18T08:50:31+00:00" /><meta property="article:modified_time" content="2020-06-18T08:54:26+00:00" /><meta property="og:image" content="https://rublogtrader.rar.su/wp-content/uploads/2020/06/upravlenie-orderami-v-mql4-kak-modificirovat-ordera.jpg" /><meta property="og:image:width" content="1200" /><meta property="og:image:height" content="630" /><meta property="og:image:type" content="image/jpeg" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:creator" content="@traderblog_net" /><meta name="twitter:site" content="@traderblog_net" /><meta name="twitter:label1" content="Написано автором" /><meta name="twitter:data1" content="Александр Паркер" /> <script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://rublogtrader.rar.su/#website","url":"https://rublogtrader.rar.su/","name":"\u0411\u043b\u043e\u0433 \u0442\u0440\u0435\u0439\u0434\u0435\u0440\u0430","description":"My WordPress Blog","publisher":{"@id":"https://rublogtrader.rar.su/#/schema/person/28382f0e81820f364e345a97d4203238"},"potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://rublogtrader.rar.su/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"ru-RU"},{"@type":"ImageObject","@id":"https://rublogtrader.rar.su/upravlenie-orderami-v-mql4/#primaryimage","inLanguage":"ru-RU","url":"https://rublogtrader.rar.su/wp-content/uploads/2020/06/upravlenie-orderami-v-mql4-kak-modificirovat-ordera.jpg","contentUrl":"https://rublogtrader.rar.su/wp-content/uploads/2020/06/upravlenie-orderami-v-mql4-kak-modificirovat-ordera.jpg","width":1200,"height":630,"caption":"\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043e\u0440\u0434\u0435\u0440\u0430\u043c\u0438 \u0432 MQL4: \u043a\u0430\u043a \u043c\u043e\u0434\u0438\u0444\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0440\u0434\u0435\u0440\u0430?"},{"@type":"WebPage","@id":"https://rublogtrader.rar.su/upravlenie-orderami-v-mql4/#webpage","url":"https://rublogtrader.rar.su/upravlenie-orderami-v-mql4/","name":"\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043e\u0440\u0434\u0435\u0440\u0430\u043c\u0438 \u0432 MQL4: \u043a\u0430\u043a \u043c\u043e\u0434\u0438\u0444\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0440\u0434\u0435\u0440\u0430?","isPartOf":{"@id":"https://rublogtrader.rar.su/#website"},"primaryImageOfPage":{"@id":"https://rublogtrader.rar.su/upravlenie-orderami-v-mql4/#primaryimage"},"datePublished":"2020-06-18T08:50:31+00:00","dateModified":"2020-06-18T08:54:26+00:00","description":"\u0420\u0430\u0437\u0431\u0438\u0440\u0430\u0435\u043c \u0444\u0443\u043d\u0443\u043a\u0446\u0438\u0438 \u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u043e\u0440\u0434\u0435\u0440\u0430\u043c\u0438 \u0432 MQL4. \u041a\u0430\u043a \u0438\u0437\u043c\u0435\u043d\u044f\u0442\u044c \u043e\u0440\u0434\u0435\u0440\u0430, \u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0442\u044c \u0442\u0440\u0435\u0439\u043b\u0438\u043d\u0433-\u0441\u0442\u043e\u043f \u0438 \u0437\u0430\u043a\u0440\u044b\u0432\u0430\u0442\u044c \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0435 \u043e\u0440\u0434\u0435\u0440\u0430.","breadcrumb":{"@id":"https://rublogtrader.rar.su/upravlenie-orderami-v-mql4/#breadcrumb"},"inLanguage":"ru-RU","potentialAction":[{"@type":"ReadAction","target":["https://rublogtrader.rar.su/upravlenie-orderami-v-mql4/"]}]},{"@type":"BreadcrumbList","@id":"https://rublogtrader.rar.su/upravlenie-orderami-v-mql4/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"\u0413\u043b\u0430\u0432\u043d\u0430\u044f \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0430","item":"https://rublogtrader.rar.su/"},{"@type":"ListItem","position":2,"name":"\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043e\u0440\u0434\u0435\u0440\u0430\u043c\u0438 \u0432 MQL4: \u043a\u0430\u043a \u043c\u043e\u0434\u0438\u0444\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0440\u0434\u0435\u0440\u0430?"}]},{"@type":"Article","@id":"https://rublogtrader.rar.su/upravlenie-orderami-v-mql4/#article","isPartOf":{"@id":"https://rublogtrader.rar.su/upravlenie-orderami-v-mql4/#webpage"},"author":{"@id":"https://rublogtrader.rar.su/#/schema/person/28382f0e81820f364e345a97d4203238"},"headline":"\u0423\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043e\u0440\u0434\u0435\u0440\u0430\u043c\u0438 \u0432 MQL4: \u043a\u0430\u043a \u043c\u043e\u0434\u0438\u0444\u0438\u0446\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0440\u0434\u0435\u0440\u0430?","datePublished":"2020-06-18T08:50:31+00:00","dateModified":"2020-06-18T08:54:26+00:00","mainEntityOfPage":{"@id":"https://rublogtrader.rar.su/upravlenie-orderami-v-mql4/#webpage"},"wordCount":62,"commentCount":0,"publisher":{"@id":"https://rublogtrader.rar.su/#/schema/person/28382f0e81820f364e345a97d4203238"},"image":{"@id":"https://rublogtrader.rar.su/upravlenie-orderami-v-mql4/#primaryimage"},"thumbnailUrl":"https://rublogtrader.rar.su/wp-content/uploads/2020/06/upravlenie-orderami-v-mql4-kak-modificirovat-ordera.jpg","articleSection":["MQL4"],"inLanguage":"ru-RU","potentialAction":[{"@type":"CommentAction","name":"Comment","target":["https://rublogtrader.rar.su/upravlenie-orderami-v-mql4/#respond"]}]},{"@type":["Person","Organization"],"@id":"https://rublogtrader.rar.su/#/schema/person/28382f0e81820f364e345a97d4203238","name":"\u0410\u043b\u0435\u043a\u0441\u0430\u043d\u0434\u0440 \u041f\u0430\u0440\u043a\u0435\u0440","image":{"@type":"ImageObject","@id":"https://rublogtrader.rar.su/#personlogo","inLanguage":"ru-RU","url":"https://rublogtrader.rar.su/wp-content/uploads/2019/06/cosmopolis-100x100.png","contentUrl":"https://rublogtrader.rar.su/wp-content/uploads/2019/06/cosmopolis-100x100.png","width":100,"height":100,"caption":"\u0410\u043b\u0435\u043a\u0441\u0430\u043d\u0434\u0440 \u041f\u0430\u0440\u043a\u0435\u0440"},"logo":{"@id":"https://rublogtrader.rar.su/#personlogo"},"description":"\u0421\u043e\u0437\u0434\u0430\u0442\u0435\u043b\u044c \u0438 \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440 \u0441\u0430\u0439\u0442\u0430 traderblog.net.","sameAs":["https://rublogtrader.rar.su/"]}]}</script> <link rel="alternate" type="application/rss+xml" title="Блог трейдера &raquo; Лента" href="https://rublogtrader.rar.su/feed/" /> <script type='text/javascript' src='https://rublogtrader.rar.su/wp-includes/js/jquery/jquery.min.js' id='jquery-core-js'></script> <link rel="https://api.w.org/" href="https://rublogtrader.rar.su/wp-json/" /><link rel="alternate" type="application/json" href="https://rublogtrader.rar.su/wp-json/wp/v2/posts/14324" />   <link rel="icon" type="image/png" sizes="32x32" href="/favicon32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon16.png"><link rel="apple-touch-icon" sizes="180x180" href="/appleicon.png">  <!-- Yandex.Metrika counter --><script type="text/javascript" > (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)}; m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)}) (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym"); ym(87171221, "init", { clickmap:true, trackLinks:true, accurateTrackBounce:true, webvisor:true });</script><noscript><div><img src="https://mc.yandex.ru/watch/87171221" style="position:absolute; left:-9999px;" alt="" /></div></noscript><!-- /Yandex.Metrika counter --></head><body ><div id="page" class="site"><header id="masthead" class="site-header"><div class="row"><div class="col-xs-12 site-header-col"><div class="site-branding"><p class="site-title"><a href="/" rel="home">Блог трейдера</a></p></div><nav id="site-navigation" class="main-navigation"> <button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">Меню</button><div class="menu-menu-container"><ul id="primary-menu" class="menu"><li id="menu-item-14443" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-14443"><a href="https://rublogtrader.rar.su/forex/">Форекс</a></li><li id="menu-item-14444" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-14444"><a href="https://rublogtrader.rar.su/trading/">Трейдинг</a></li><li id="menu-item-12561" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12561"><a href="https://rublogtrader.rar.su/technical-analysis/">Технический анализ</a></li><li id="menu-item-12560" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12560"><a href="https://rublogtrader.rar.su/indicators/">Индикаторы</a></li><li id="menu-item-12559" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-12559"><a href="https://rublogtrader.rar.su/prajs-jekshen/">Прайс экшен</a></li><li id="menu-item-15892" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-15892"><a href="https://rublogtrader.rar.su/investing/">Инвестиции</a></li><li id="menu-item-16239" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-16239"><a href="https://rublogtrader.rar.su/crypto/">Крипто</a></li></ul></div></nav></div></div></header><div class='code-block code-block-center code-block-2 ai-viewport-1'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader1" rel="nofollow" target="_blank"><img src="https://advertising-blog.qqit.ru/rublogtrader.rar.su/468x60.gif"/></a></div><div id="content" class="site-content"><div class="row row--index"><div class="col-xs-12"><div id="primary" class="content-area"><main id="main" class="site-main" role="main"><article id="post-14324" class="post-14324 post type-post status-publish format-standard has-post-thumbnail hentry category-mql4"><div class="row no-pad"><div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 no-pad"><header class="entry-header"><h1 class="entry-title">Управление ордерами в MQL4: как модифицировать ордера?</h1><div class="entry-meta"><a href="https://rublogtrader.rar.su/mql4/" rel="category tag">MQL4</a> | 18.06.2020 | <i class="icon-07"></i> 1927</div></header><div class="entry-content"> <img src="" style="float:right;" align="right"><p>Мы будем использовать функцию OrderSelect(), а также операторы цикла, чтобы выполнить перебор ордеров и получить информацию о конкретном ордере. Этот метод будет использоваться для закрытия нескольких ордеров, добавления трейлинг-стопов, подсчета количества открытых ордеров и многого другого.<br> <span id="more-14324"></span></p><div class="lwptoc lwptoc-autoWidth lwptoc-baseItems lwptoc-transparent lwptoc-notInherit" data-smooth-scroll="1" data-smooth-scroll-offset="24"><div class="lwptoc_i"><div class="lwptoc_items lwptoc_items-visible"><div class="lwptoc_itemWrap"><div class="lwptoc_item"> <a href="#Operator_for"> <span class="lwptoc_item_label">Оператор for</span> </a></div><div class="lwptoc_item"> <a href="#Cikl_orderov"> <span class="lwptoc_item_label">Цикл ордеров</span> </a></div><div class="lwptoc_item"> <a href="#Podscet_orderov"> <span class="lwptoc_item_label">Подсчет ордеров</span> </a></div><div class="lwptoc_item"> <a href="#Zakrytie_neskolkih_orderov"> <span class="lwptoc_item_label">Закрытие нескольких ордеров</span> </a></div><div class="lwptoc_item"> <a href="#Trejling_stopy"> <span class="lwptoc_item_label">Трейлинг стопы</span> </a></div><div class="lwptoc_item"> <a href="#Minimalnaa_pribyl"> <span class="lwptoc_item_label">Минимальная прибыль</span> </a></div><div class="lwptoc_item"> <a href="#Perenos_stop-lossa_v_bezubytok"> <span class="lwptoc_item_label">Перенос стоп-лосса в безубыток</span> </a></div><div class="lwptoc_item"> <a href="#Obnovlenie_sovetnika"> <span class="lwptoc_item_label">Обновление советника</span> </a></div></div></div></div></div><div class='code-block code-block-center code-block-3 ai-viewport-1'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader2" rel="nofollow" target="_blank"><img src="https://advertising-blog.qqit.ru/rublogtrader.rar.su/pamm_landing_banner_970x250_ru_1.gif"/></a></div><h2><span id="Operator_for">Оператор for</span></h2><p>Оператор for используется для циклического прохождения через блок кода заданное количество раз. Мы объявляем целочисленную переменную для использования в качестве счетчика и присваиваем ей начальное значение. Далее мы указываем условие, которое заставит цикл работать. Мы также указываем выражение, с помощью которого увеличивается значение счетчика.</p><p>Вот пример цикла for:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">for</span><span class="br0">(</span><span class="kw4">int</span> Counter <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span> Counter <span class="sy0">&lt;=</span> <span class="nu0">3</span><span class="sy0">;</span> Counter<span class="sy0">++</span><span class="br0">)</span> <span class="br0">{</span>        <span class="co1">// Код для исполнения</span>      <span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Первое выражение, int Counter = 1, инициализирует нашу переменную Counter значением 1. Второе выражение Counter Оператор while</p><p>Оператор while — это более простой метод цикла в MQL. Цикл for лучше всего подходит, если вы точно знаете, сколько раз вы планируете выполнить цикл. Если вы не уверены в количестве итераций, тогда цикл while будет для вас более подходящим.</p><p>Вот пример цикла while:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">while</span> <span class="br0">(</span>Something <span class="sy0">==</span> <span class="kw2">true</span><span class="br0">)</span> <span class="br0">{</span><span class="co1">// Код цикла</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>В этом примере используется логическая переменная Something. Если Something равно true, цикл будет выполнен. Конечно, если значение Something никогда не изменится, цикл будет выполняться бесконечно. Таким образом, необходимо, чтобы в какой-то момент цикла возникло условие изменить значение Something. Как только это условие выполнено, цикл прекращает свое выполнение.</p><p>Вы также можете увеличить переменную, как если бы вы использовали оператор for:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">int</span> Counter <span class="sy0">=</span> <span class="nu0">1</span><span class="sy0">;</span> <span class="kw1">while</span><span class="br0">(</span>Counter <span class="sy0">&lt;=</span> <span class="nu0">3</span><span class="br0">)</span> <span class="br0">{</span>Counter<span class="sy0">++;</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><h2><span id="Cikl_orderov">Цикл ордеров</span></h2><p>Вот код, который мы будем использовать для перебора открытых ордеров:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">for</span><span class="br0">(</span>Counter <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> Counter <span class="sy0">&lt;=</span> OrdersTotal<span class="br0">(</span><span class="br0">)</span><span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span> Counter<span class="sy0">++</span><span class="br0">)</span> <span class="br0">{</span>OrderSelect<span class="br0">(</span>Counter<span class="sy0">,</span>SELECT_BY_POS<span class="br0">)</span><span class="sy0">;</span>        <span class="co1">// Условие</span>      <span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Мы установим значение Counter равным 0 и будем повторять цикл до тех пор, пока значение Counter не станет меньше или равно значению OrdersTotal() минус один. Счетчик будет увеличиваться на 1 после каждой итерации цикла.</p><p>OrdersTotal() — это функция, которая возвращает количество открытых в данный момент ордеров. Почему мы вычитаем 1 из значения OrdersTotal()?</p><p>Пул ордеров содержит все ордера, которые в данный момент открыты в нашем терминале, включая ордера, размещенные вручную, а также ордера, размещенные экспертами. Порядковые индексы нумеруются начиная с нуля. Если открыт один ордер, его индекс равен 0. Когда открывается второй ордер, его индекс равен 1. Если третий ордер открыт, его индекс будет равен 2 и т. д.</p><p>OrdersTotal() вернет количество открытых ордеров. В приведенном выше примере у нас открыто три ордера. Но так как наш индекс ордера начинается с 0, мы хотим, чтобы наша переменная counter считала только до 2. Значение Counter должно соответствовать нашим номерам индекса ордера, поэтому мы должны вычесть 1 из OrdersTotal().</p><p>Когда ордер в пуле открытых ордеров закрыт, у всех новых ордеров в пуле индексы ордеров будут уменьшены. Например, если ордер с индексом 0 закрыт, то ордер с индексом 1 становится индексом 0, а индекс ордера 2 становится индексом 1. Это важно, когда мы закрываем ордера, и мы вскоре рассмотрим это более подробно.</p><p>Возвращаясь к нашему циклу ордера: оператор OrderSelect() использует нашу переменную Counter в качестве индекса позиции ордера. Параметр SELECT_BY_POS указывает, что мы выбираем заказ по его позиции в пуле заказов, а не по номеру тикета.</p><p>Для первой итерации этого цикла Counter будет равен 0, и мы выберем самый старый ордер из пула ордеров, используя OrderSelect(). Затем мы можем просмотреть информацию о заказе, используя такие функции, как OrderTicket() или OrderStopLoss(), а также изменить или закрыть ордер по мере необходимости.</p><h2><span id="Podscet_orderov">Подсчет ордеров</span></h2><p>Часто очень полезно узнать, сколько ордеров открыл наш советник и какого они типа. Мы создадим несколько функций для подсчета текущего количества открытых ордеров в зависимости от типа ордера. Следующая функция подсчитает общее количество открытых ордеров:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">int</span> TotalOrderCount<span class="br0">(</span>string argSymbol<span class="sy0">,</span> <span class="kw4">int</span> argMagicNumber<span class="br0">)</span> <span class="br0">{</span><span class="kw4">int</span> OrderCount<span class="sy0">;</span><span class="kw1">for</span><span class="br0">(</span>Counter <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> Counter <span class="sy0">&lt;=</span> OrdersTotal<span class="br0">(</span><span class="br0">)</span><span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span> Counter<span class="sy0">++</span><span class="br0">)</span> <span class="br0">{</span>OrderSelect<span class="br0">(</span>Counter<span class="sy0">,</span>SELECT_BY_POS<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>OrderMagicNumber<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> argMagicNumber <span class="sy0">&amp;&amp;</span> OrderSymbol<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> argSymbol<span class="br0">)</span> <span class="br0">{</span>                 OrderCount<span class="sy0">++;</span>               <span class="br0">}</span>          <span class="br0">}</span>        <span class="kw1">return</span><span class="br0">(</span>OrderCount<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Мы назвали нашу функцию подсчета ордеров TotalOrderCount(). Она вернет целочисленное значение, указывающее, сколько ордеров было открыто в данный момент на указанном символе графика, совпадающем с магическим числом, которое мы передали в качестве аргумента функции.</p><p>Начнем с объявления переменной OrderCount. Поскольку мы не указали начальное значение, OrderCount будет инициализирован как 0.</p><p>Поскольку пул ордеров содержит все открытые ордера, в том числе размещенные другими советниками, нам необходимо определить, какие ордера были выставлены нашим советником. Сначала мы проверяем OrderSymbol() выбранного порядка и проверяем, соответствует ли он аргументу argSymbol. Мы проверяем магический номер на ордер.</p><p>Если OrderMagicNumber() совпадает с аргументом argMagicNumber, мы можем быть достаточно уверены, что этот ордер был размещен этим советником. При запуске нескольких советников на одном инструменте убедитесь, что вы используете уникальный магический номер в каждом советнике.</p><p>Если порядок соответствует как нашему магическому номеру, так и нашему символу графика, значение OrderCount будет увеличено на единицу. После прохождения всех ордеров мы возвращаем значение OrderCount вызывающей функции.</p><p>Вот пример того, как мы будем использовать это в коде:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">if</span> <span class="br0">(</span>TotalOrderCount <span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span> MagicNumber<span class="br0">)</span><span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> CloseOrders <span class="sy0">==</span> <span class="kw2">true</span><span class="br0">)</span> <span class="br0">{</span>         <span class="co1">// Закрыть все ордера</span>       <span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Если этот советник открыл ордера, и значение CloseOrders равно true, тогда будет запущен код внутри фигурных скобок, который закроет все открытые ордера.</p><p>Давайте изменим нашу процедуру подсчета ордеров, чтобы она учитывала только рыночные ордера на покупку:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">int</span> BuyMarketCount<span class="br0">(</span>string argSymbol<span class="sy0">,</span> <span class="kw4">int</span> argMagicNumber<span class="br0">)</span> <span class="br0">{</span><span class="kw4">int</span> OrderCount<span class="sy0">;</span><span class="kw1">for</span><span class="br0">(</span>Counter <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> Counter <span class="sy0">&lt;=</span> OrdersTotal<span class="br0">(</span><span class="br0">)</span><span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span> Counter<span class="sy0">++</span><span class="br0">)</span><span class="br0">{</span>OrderSelect<span class="br0">(</span>Counter<span class="sy0">,</span>SELECT_BY_POS<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>OrderMagicNumber<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> argMagicNumber <span class="sy0">&amp;&amp;</span> OrderSymbol<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> argSymbol <span class="sy0">&amp;&amp;</span> OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_BUY<span class="br0">)</span> <span class="br0">{</span>                 OrderCount<span class="sy0">++;</span>               <span class="br0">}</span>          <span class="br0">}</span>        <span class="kw1">return</span><span class="br0">(</span>OrderCount<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Код идентичен предыдущему, за исключением того, что мы добавили функцию OrderType() для проверки типа ордера. OP_BUY — это константа, которая указывает на рыночный ордер на покупку. Для подсчета других типов ордеров просто замените OP_BUY соответствующей константой типа ордера.</p><h2><span id="Zakrytie_neskolkih_orderov">Закрытие нескольких ордеров</span></h2><p>Чаще всего нам нужно закрыть несколько ордеров одного типа. Мы объединим наш цикл ордеров с нашими процедурами закрытия ордеров, чтобы закрыть несколько ордеров одновременно. Эта функция закроет все ордера на покупку, выставленные нашим советником:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">void</span> CloseAllBuyOrders<span class="br0">(</span>string argSymbol<span class="sy0">,</span> <span class="kw4">int</span> argMagicNumber<span class="sy0">,</span> <span class="kw4">int</span> argSlippage<span class="br0">)</span> <span class="br0">{</span><span class="kw1">for</span><span class="br0">(</span><span class="kw4">int</span> Counter <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> Counter <span class="sy0">&lt;=</span> OrdersTotal<span class="br0">(</span><span class="br0">)</span><span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span> Counter<span class="sy0">++</span><span class="br0">)</span> <span class="br0">{</span>OrderSelect<span class="br0">(</span>Counter<span class="sy0">,</span>SELECT_BY_POS<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>OrderMagicNumber<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> argMagicNumber <span class="sy0">&amp;&amp;</span> OrderSymbol<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> argSymbol <span class="sy0">&amp;&amp;</span> OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_BUY<span class="br0">)</span> <span class="br0">{</span>&nbsp;<span class="co1">// Закрытие ордера</span><span class="kw4">int</span> CloseTicket <span class="sy0">=</span> OrderTicket<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="kw4">double</span> CloseLots <span class="sy0">=</span> OrderLots<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><span class="kw1">while</span><span class="br0">(</span>IsTradeContextBusy<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> Sleep<span class="br0">(</span><span class="nu0">10</span><span class="br0">)</span><span class="sy0">;</span><span class="kw4">double</span> ClosePrice <span class="sy0">=</span> MarketInfo<span class="br0">(</span>argSymbol<span class="sy0">,</span>MODE_BID<span class="br0">)</span><span class="sy0">;</span>bool Closed <span class="sy0">=</span> OrderClose<span class="br0">(</span>CloseTicket<span class="sy0">,</span>CloseLots<span class="sy0">,</span>ClosePrice<span class="sy0">,</span>argSlippage<span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Обработка ошибок </span><span class="kw1">if</span><span class="br0">(</span>Closed <span class="sy0">==</span> <span class="kw2">false</span><span class="br0">)</span> <span class="br0">{</span>ErrorCode <span class="sy0">=</span> GetLastError<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>string ErrDesc <span class="sy0">=</span> ErrorDescription<span class="br0">(</span>ErrorCode<span class="br0">)</span><span class="sy0">;</span>string ErrAlert <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Close All Buy Orders - Error &quot;</span><span class="sy0">,</span> ErrorCode<span class="sy0">,</span><span class="st0">&quot;: &quot;</span><span class="sy0">,</span>ErrDesc<span class="br0">)</span><span class="sy0">;</span>       Alert<span class="br0">(</span>ErrAlert<span class="br0">)</span><span class="sy0">;</span>string ErrLog <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Bid: &quot;</span><span class="sy0">,</span> MarketInfo<span class="br0">(</span>argSymbol<span class="sy0">,</span>MODE_BID<span class="br0">)</span><span class="sy0">,</span><span class="st0">&quot; Ticket: &quot;</span><span class="sy0">,</span>CloseTicket<span class="sy0">,</span> <span class="st0">&quot; Price: &quot;</span><span class="sy0">,</span>ClosePrice<span class="br0">)</span><span class="sy0">;</span>       Print<span class="br0">(</span>ErrLog<span class="br0">)</span><span class="sy0">;</span>    <span class="br0">}</span><span class="kw1">else</span> Counter<span class="sy0">--;</span> <span class="br0">}</span><span class="br0">}</span><span class="br0">}</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Обратите внимание, что мы используем void в качестве типа данных функции.</p><p>Мы пройдемся по пулу ордеров и проверим каждый ордер, чтобы увидеть, нужно ли нам его закрыть. Если текущий ордер является рыночным ордером на покупку, как указано OP_BUY, и если он соответствует символу нашего графика и аргументам магического числа, мы приступим к закрытию ордера.</p><p>Мы вызываем функцию OrderTicket(), чтобы получить номер тикета для текущего ордера. Отсюда наш код идентичен коду закрытия рынка покупки в предыдущих главах. Обратите внимание на самое последнее утверждение: Counter—. Если ордер был закрыт должным образом, переменная Counter будет уменьшена на единицу.</p><p>Ранее мы объясняли, что при закрытии ордера у всех ордеров за ним их индексы уменьшаются на единицу. Если мы не уменьшаем переменную counter после закрытия ордера, последующие ордера будут пропущены.</p><p>Существует веская причина, по которой мы перебираем ордера от самых старых до самых новых: правила NFA, вступившие в силу летом 2009 года для американских брокеров, требуют, чтобы несколько ордеров, размещенных на одном и том же символе валюты, были закрыты в том порядке, в котором они были размещены. Это называется правилом FIFO (первым пришел, первым вышел). Циклические ордера от старых к новым гарантируют, что мы соблюдаем правило FIFO при закрытии ордеров.</p><p>Чтобы закрыть рыночные ордера на продажу с использованием вышеуказанного кода, просто измените тип ордера на OP_SELL, а ClosePrice — на цену Ask.</p><p>Давайте рассмотрим код для закрытия нескольких отложенных ордеров. Этот пример закроет все стоп-ордера. Разница между этим кодом и кодом для закрытия рыночных ордеров на покупку выше заключается в том, что мы указываем OP_BUYSTOP в качестве нашего типа ордера и используем OrderDelete() для закрытия ордеров.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">void</span> CloseAllBuyStopOrders<span class="br0">(</span>string argSymbol<span class="sy0">,</span> <span class="kw4">int</span> argMagicNumber<span class="sy0">,</span> <span class="kw4">int</span> argSlippage<span class="br0">)</span> <span class="br0">{</span><span class="kw1">for</span><span class="br0">(</span><span class="kw4">int</span> Counter <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> Counter <span class="sy0">&lt;=</span> OrdersTotal<span class="br0">(</span><span class="br0">)</span><span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span> Counter<span class="sy0">++</span><span class="br0">)</span> <span class="br0">{</span>OrderSelect<span class="br0">(</span>Counter<span class="sy0">,</span>SELECT_BY_POS<span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>OrderMagicNumber<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> argMagicNumber <span class="sy0">&amp;&amp;</span> OrderSymbol<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> argSymbol <span class="sy0">&amp;&amp;</span> OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_BUYSTOP<span class="br0">)</span> <span class="br0">{</span>&nbsp;<span class="co1">// Удаление ордера</span><span class="kw4">int</span> CloseTicket <span class="sy0">=</span> OrderTicket<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><span class="kw1">while</span><span class="br0">(</span>IsTradeContextBusy<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> Sleep<span class="br0">(</span><span class="nu0">10</span><span class="br0">)</span><span class="sy0">;</span>bool Closed <span class="sy0">=</span> OrderDelete<span class="br0">(</span>CloseTicket<span class="sy0">,</span>Red<span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Обработка ошибок </span><span class="kw1">if</span><span class="br0">(</span>Closed <span class="sy0">==</span> <span class="kw2">false</span><span class="br0">)</span> <span class="br0">{</span>ErrorCode <span class="sy0">=</span> GetLastError<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>string ErrDesc <span class="sy0">=</span> ErrorDescription<span class="br0">(</span>ErrorCode<span class="br0">)</span><span class="sy0">;</span>string ErrAlert <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Close All Buy Stop Orders&quot;</span><span class="sy0">,</span> <span class="st0">&quot; - Error &quot;</span><span class="sy0">,</span>ErrorCode<span class="sy0">,</span><span class="st0">&quot;: &quot;</span><span class="sy0">,</span>ErrDesc<span class="br0">)</span><span class="sy0">;</span>       Alert<span class="br0">(</span>ErrAlert<span class="br0">)</span><span class="sy0">;</span>string ErrLog <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Bid: &quot;</span><span class="sy0">,</span> MarketInfo<span class="br0">(</span>argSymbol<span class="sy0">,</span>MODE_BID<span class="br0">)</span><span class="sy0">,</span><span class="st0">&quot; Ask: &quot;</span><span class="sy0">,</span> MarketInfo<span class="br0">(</span>argSymbol<span class="sy0">,</span>MODE_ASK<span class="br0">)</span><span class="sy0">,</span><span class="st0">&quot; Ticket: &quot;</span><span class="sy0">,</span>CloseTicket<span class="br0">)</span><span class="sy0">;</span>       Print<span class="br0">(</span>ErrLog<span class="br0">)</span><span class="sy0">;</span>    <span class="br0">}</span><span class="kw1">else</span> Counter<span class="sy0">--;</span><span class="br0">}</span><span class="br0">}</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><div class='code-block code-block-center code-block-4 ai-viewport-3'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader2" rel="nofollow" target="_blank"><img src="/b/pamm_landing_banner_300x250_ru_.gif"/></a></div><div class='code-block code-block-center code-block-8 ai-viewport-1'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader2" rel="nofollow" target="_blank"><img src="https://advertising-blog.qqit.ru/rublogtrader.rar.su/pamm_landing_banner_970x250_ru_1.gif"/></a></div><h2><span id="Trejling_stopy">Трейлинг стопы</span></h2><p>Мы также можем использовать наш цикл ордеров для изменения нескольких ордеров. Типичным примером этого является трейлинг-стоп. Трейлинг-стоп перемещает стоп-лосс вверх или вниз по цене ордера, поскольку ордер получает прибыль. позволяет зафиксировать часть прибыли и обеспечить отличную защиту от потерь.</p><p>Трейлинг-стоп выражается как максимальное количество пунктов. Например, если ваш трейлинг-стоп составляет 50 пунктов, стоп-лосс никогда не будет более чем на 50 пунктов от вашей цены. Если цена развернется и прибыль снизится, стоп-лосс останется на том же уровне. Стоп движется только в направлении прибыли, а не наоборот.</p><p>При изменении трейлинг-стопа мы должны проверить, больше ли расстояние в пунктах между текущей ценой и текущим стоп-лоссом, чем трейлинг-стоп. Если это так, то стоп-лосс будет изменен таким образом, чтобы расстояние от текущей цены в пунктах было равно количеству пунктов в настройке трейлинг-стопа.</p><p>Трейлинг-стоп рассчитывается относительно цены закрытия, которая является ценой Bid для ордеров на покупку и Ask для ордеров на продажу.</p><p>Давайте рассмотрим код для модификации трейлинг-стопа. Сначала мы объявляем внешнюю переменную для нашего параметра трейлинг-стопа:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw2">extern</span> <span class="kw4">double</span> TrailingStop <span class="sy0">=</span> <span class="nu0">50</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Этот код проверяет все ордера на покупку и изменяет стоп-лосс при необходимости:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">for</span><span class="br0">(</span><span class="kw4">int</span> Counter <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> Counter <span class="sy0">&lt;=</span> OrdersTotal<span class="br0">(</span><span class="br0">)</span><span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span> Counter<span class="sy0">++</span><span class="br0">)</span> <span class="br0">{</span>OrderSelect<span class="br0">(</span>Counter<span class="sy0">,</span>SELECT_BY_POS<span class="br0">)</span><span class="sy0">;</span><span class="kw4">double</span> MaxStopLoss <span class="sy0">=</span> MarketInfo<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MODE_BID<span class="br0">)</span> <span class="sy0">-</span> <span class="br0">(</span>TrailingStop <span class="sy0">*</span> PipPoint<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>MaxStopLoss <span class="sy0">=</span> NormalizeDouble<span class="br0">(</span>MaxStopLoss<span class="sy0">,</span>MarketInfo<span class="br0">(</span>OrderSymbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MODE_DIGITS<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span><span class="kw4">double</span> CurrentStop <span class="sy0">=</span> NormalizeDouble<span class="br0">(</span>OrderStopLoss<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span> MarketInfo<span class="br0">(</span>OrderSymbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MODE_DIGITS<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Изменение оредра</span><span class="kw1">if</span><span class="br0">(</span>OrderMagicNumber<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> MagicNumber <span class="sy0">&amp;&amp;</span> OrderSymbol<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">&amp;&amp;</span> OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_BUY <span class="sy0">&amp;&amp;</span> CurrentStop <span class="sy0">&lt;</span> MaxStopLoss<span class="br0">)</span> <span class="br0">{</span>bool Trailed <span class="sy0">=</span> OrderModify<span class="br0">(</span>OrderTicket<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OrderOpenPrice<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MaxStopLoss<span class="sy0">,</span> OrderTakeProfit<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Обработка ошибок</span><span class="kw1">if</span><span class="br0">(</span>Trailed <span class="sy0">==</span> <span class="kw2">false</span><span class="br0">)</span> <span class="br0">{</span>ErrorCode <span class="sy0">=</span> GetLastError<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>string ErrDesc <span class="sy0">=</span> ErrorDescription<span class="br0">(</span>ErrorCode<span class="br0">)</span><span class="sy0">;</span>string ErrAlert <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Buy Trailing Stop - Error &quot;</span><span class="sy0">,</span> ErrorCode<span class="sy0">,</span><span class="st0">&quot;: &quot;</span><span class="sy0">,</span>ErrDesc<span class="br0">)</span><span class="sy0">;</span>  Alert<span class="br0">(</span>ErrAlert<span class="br0">)</span><span class="sy0">;</span>string ErrLog <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Bid: &quot;</span>MarketInfo<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MODE_BID<span class="br0">)</span><span class="sy0">,</span> <span class="st0">&quot; Ticket: &quot;</span><span class="sy0">,</span>CloseTicket<span class="sy0">,</span><span class="st0">&quot; Stop: &quot;</span><span class="sy0">,</span>OrderStopLoss<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span><span class="st0">&quot; Trail: &quot;</span><span class="sy0">,</span> MaxStopLoss<span class="br0">)</span><span class="sy0">;</span>  Print<span class="br0">(</span>ErrLog<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span><span class="br0">}</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>После выбора ордера с помощью OrderSelect() мы определяем максимальное расстояние стоп-лосса, вычитая нашу настройку трейлинг-стопа, умноженную на PipPoint() из текущей цены Bid. Это значение сохраняется в переменной MaxStopLoss.</p><p>Мы используем MQL-функцию NormalizeDouble() для округления переменной MaxStopLoss до правильного числа цифр после десятичной точки. Цены в MetaTrader могут быть указаны до восьми знаков после запятой. Используя NormalizeDouble(), мы округляем это до 4 или 5 цифр (2-3 цифры для пар JPY).</p><p>Затем мы извлекаем стоп-лосс текущего выбранного ордера и округляем его с помощью NormalizeDouble(). Мы присваиваем это значение переменной CurrentStop.</p><p>Затем мы проверяем, нужно ли изменить текущий ордер. Если магическое число, символ и тип ордера совпадают, а текущий стоп-лосс (CurrentStop) меньше, чем MaxStopLoss, мы модифицируем стоп-лосс ордера. Мы передаем переменную MaxStopLoss как наш новый стоп-лосс в функцию OrderModify().</p><p>Если функция OrderModify() выполняется с ошибкой, запускается процедура обработки ошибок, и информация о текущей цене, номер тикета, текущим стоп-лоссе и измененным стоп-лоссе будут выведены в журнал.</p><p>Вот условие для изменения ордера на продажу:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="co1">// Изменение оредра</span><span class="kw1">if</span><span class="br0">(</span>OrderMagicNumber<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> MagicNumber <span class="sy0">&amp;&amp;</span> OrderSymbol<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> Symbol<span class="br0">(</span><span class="br0">)</span> <span class="sy0">&amp;&amp;</span> OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_SELL <span class="sy0">&amp;&amp;</span> <span class="br0">(</span>CurrentStop <span class="sy0">&gt;</span> MaxStopLoss <span class="sy0">||</span> CurrentStop <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span><span class="br0">)</span></pre></div></div></div></div></div></div></div><p>Обратите внимание на условие (CurrentStop&gt; MaxStopLoss || CurrentStop == 0). Если стоп-лосс не размещен в ордере, то условие CurrentStop&gt; MaxStopLoss никогда не будет истинным, поскольку MaxStopLoss никогда не будет меньше нуля. Таким образом, мы добавляем условие ИЛИ, CurrentStop == 0.</p><p>Если стоп-лосс текущего ордера равен 0 (без стоп-лосса), то при условии выполнения остальных условий трейлинг-стоп будет размещен.</p><h2><span id="Minimalnaa_pribyl">Минимальная прибыль</span></h2><p>Давайте улучшим наш трейлинг-стоп, добавив минимальный уровень прибыли. В приведенном выше примере трейлинг-стоп сработает сразу. Если вы установили начальный стоп-лосс в 100 пунктов, а ваш трейлинг-стоп равен 50 пунктам, то стоп-лосс будет немедленно установлен на 50 пунктов, что сделает недействительным первоначальный стоп-лосс в 100 пунктов.</p><p>Добавление минимального уровня прибыли позволит вам установить начальный стоп-лосс, одновременно задерживая трейлинг-стоп, пока не будет достигнута указанная сумма прибыли. В этом примере давайте предположим, что при размещении ордера установлен начальный стоп-лосс в 100 пунктов. Мы используем трейлинг-стоп в 50 пунктов с минимальным уровнем прибыли в 50 пунктов. Когда прибыль по ордеру достигнет 50 пунктов, стоп-лосс будет скорректирован в безубыток.</p><p>Добавим внешнюю переменную для настройки минимальной прибыли:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw2">extern</span> <span class="kw4">int</span> TrailingStop <span class="sy0">=</span> <span class="nu0">50</span><span class="sy0">;</span><span class="kw2">extern</span> <span class="kw4">int</span> MinimumProfit <span class="sy0">=</span> <span class="nu0">50</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Следующая функция изменяет стоп-лосс для всех ордеров на покупку, проверяя минимальную прибыль:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw4">void</span> BuyTrailingStop<span class="br0">(</span>string argSymbol<span class="sy0">,</span> <span class="kw4">int</span> argTrailingStop<span class="sy0">,</span> <span class="kw4">int</span> argMinProfit<span class="sy0">,</span> <span class="kw4">int</span> argMagicNumber<span class="br0">)</span> <span class="br0">{</span><span class="kw1">for</span><span class="br0">(</span><span class="kw4">int</span> Counter <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> Counter <span class="sy0">&lt;=</span> OrdersTotal<span class="br0">(</span><span class="br0">)</span><span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span> Counter<span class="sy0">++</span><span class="br0">)</span> <span class="br0">{</span>OrderSelect<span class="br0">(</span>Counter<span class="sy0">,</span>SELECT_BY_POS<span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Рассчитываем максимальный стоп-лосс и тейк-профит</span><span class="kw4">double</span> MaxStopLoss <span class="sy0">=</span> MarketInfo<span class="br0">(</span>argSymbol<span class="sy0">,</span>MODE_BID<span class="br0">)</span> <span class="sy0">-</span> <span class="br0">(</span>TrailingStop <span class="sy0">*</span> PipPoint<span class="br0">(</span>argSymbol<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>MaxStopLoss <span class="sy0">=</span> NormalizeDouble<span class="br0">(</span>MaxStopLoss<span class="sy0">,</span> MarketInfo<span class="br0">(</span>OrderSymbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MODE_DIGITS<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span><span class="kw4">double</span> CurrentStop <span class="sy0">=</span> NormalizeDouble<span class="br0">(</span>OrderStopLoss<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span> MarketInfo<span class="br0">(</span>OrderSymbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MODE_DIGITS<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span><span class="kw4">double</span> PipsProfit <span class="sy0">=</span> MarketInfo<span class="br0">(</span>argSymbol<span class="sy0">,</span>MODE_BID<span class="br0">)</span> <span class="sy0">-</span> OrderOpenPrice<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span> <span class="kw4">double</span> MinProfit <span class="sy0">=</span> MinimumProfit <span class="sy0">*</span> PipPoint<span class="br0">(</span>argSymbol<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Изменяем стоп-лосс</span><span class="kw1">if</span><span class="br0">(</span>OrderMagicNumber<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> argMagicNumber <span class="sy0">&amp;&amp;</span> OrderSymbol<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> argSymbol <span class="sy0">&amp;&amp;</span> OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_BUY <span class="sy0">&amp;&amp;</span> CurrentStop <span class="sy0">&lt;</span> MaxStopLoss <span class="sy0">&amp;&amp;</span> PipsProfit <span class="sy0">&gt;=</span> MinProfit<span class="br0">)</span> <span class="br0">{</span>bool Trailed <span class="sy0">=</span> OrderModify<span class="br0">(</span>OrderTicket<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OrderOpenPrice<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MaxStopLoss<span class="sy0">,</span> OrderTakeProfit<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>&nbsp;<span class="co1">// Обработка ошибок</span><span class="kw1">if</span><span class="br0">(</span>Trailed <span class="sy0">==</span> <span class="kw2">false</span><span class="br0">)</span> <span class="br0">{</span>ErrorCode <span class="sy0">=</span> GetLastError<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>string ErrDesc <span class="sy0">=</span> ErrorDescription<span class="br0">(</span>ErrorCode<span class="br0">)</span><span class="sy0">;</span>string ErrAlert <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Buy Trailing Stop - Error &quot;</span><span class="sy0">,</span> ErrorCode<span class="sy0">,</span><span class="st0">&quot;: &quot;</span><span class="sy0">,</span>ErrDesc<span class="br0">)</span><span class="sy0">;</span>  Alert<span class="br0">(</span>ErrAlert<span class="br0">)</span><span class="sy0">;</span>string ErrLog <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Bid: &quot;</span><span class="sy0">,</span> MarketInfo<span class="br0">(</span>argSymbol<span class="sy0">,</span>MODE_BID<span class="br0">)</span><span class="sy0">,</span><span class="st0">&quot; Ticket: &quot;</span><span class="sy0">,</span>CloseTicket<span class="sy0">,</span> <span class="st0">&quot; Stop: &quot;</span><span class="sy0">,</span>OrderStopLoss<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span><span class="st0">&quot; Trail: &quot;</span><span class="sy0">,</span>MaxStopLoss<span class="br0">)</span><span class="sy0">;</span>  Print<span class="br0">(</span>ErrLog<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span><span class="br0">}</span><span class="br0">}</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Мы рассчитываем прибыль текущего ордера в пунктах, вычитая OrderOpenPrice() из текущей цены Bid и сохраняя ее в переменной PipsProfit. Мы сравниваем это значение с нашей минимальной прибылью, которая умножается на PipPoint() и сохраняется в переменной MinProfit.</p><p>Если текущая прибыль в пунктах PipsProfit больше или равна нашей минимальной прибыли MinProfit, и все остальные условия выполняются, стоп будет изменен.</p><h2><span id="Perenos_stop-lossa_v_bezubytok">Перенос стоп-лосса в безубыток</span></h2><p>Безубыточный стоп корректирует стоп-лосс в соответствии с ценой открытия ордера после достижения определенного уровня прибыли. Безубыточный стоп не зависит от вашего начального стоп-лосса и функции трейлинг-стопа.</p><p>Вот внешняя переменная для настройки уровня безубытка. Минимальная прибыль указана в пунктах.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw2">extern</span> <span class="kw4">double</span> BreakEvenProfit <span class="sy0">=</span> <span class="nu0">25</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Этот код будет изменять стоп-лосс на всех ордерах на покупку, если прибыль в пунктах равна или превышает BreakEvenProfit.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">for</span><span class="br0">(</span><span class="kw4">int</span> Counter <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> Counter <span class="sy0">&lt;=</span> OrdersTotal<span class="br0">(</span><span class="br0">)</span><span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span> Counter<span class="sy0">++</span><span class="br0">)</span> <span class="br0">{</span>OrderSelect<span class="br0">(</span>Counter<span class="sy0">,</span>SELECT_BY_POS<span class="br0">)</span><span class="sy0">;</span> RefreshRates<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><span class="kw4">double</span> PipsProfit <span class="sy0">=</span> Bid – OrderOpenPrice<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span><span class="kw4">double</span> MinProfit <span class="sy0">=</span> BreakEvenProfit <span class="sy0">*</span> PipPoint<span class="br0">(</span>OrderSymbol<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>OrderMagicNumber<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> MagicNumber <span class="sy0">&amp;&amp;</span> OrderSymbol<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> Symbol<span class="br0">(</span><span class="br0">)</span> <span class="sy0">&amp;&amp;</span> OrderType<span class="br0">(</span><span class="br0">)</span> <span class="sy0">==</span> OP_BUY <span class="sy0">&amp;&amp;</span> PipsProfit <span class="sy0">&gt;=</span> MinProfit<span class="sy0">&amp;&amp;</span> OrderOpenPrice<span class="br0">(</span><span class="br0">)</span> <span class="sy0">!=</span> OrderStopLoss<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>bool BreakEven <span class="sy0">=</span> OrderModify<span class="br0">(</span>OrderTicket<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OrderOpenPrice<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span> OrderOpenPrice<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>OrderTakeProfit<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span><span class="kw1">if</span><span class="br0">(</span>BreakEven <span class="sy0">==</span> <span class="kw2">false</span><span class="br0">)</span> <span class="br0">{</span>ErrorCode <span class="sy0">=</span> GetLastError<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>string ErrDesc <span class="sy0">=</span> ErrorDescription<span class="br0">(</span>ErrorCode<span class="br0">)</span><span class="sy0">;</span>string ErrAlert <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Buy Break Even - Error &quot;</span><span class="sy0">,</span> ErrorCode<span class="sy0">,</span><span class="st0">&quot;: &quot;</span><span class="sy0">,</span>ErrDesc<span class="br0">)</span><span class="sy0">;</span>  Alert<span class="br0">(</span>ErrAlert<span class="br0">)</span><span class="sy0">;</span>string ErrLog <span class="sy0">=</span> StringConcatenate<span class="br0">(</span><span class="st0">&quot;Bid: &quot;</span><span class="sy0">,</span>Bid<span class="sy0">,</span><span class="st0">&quot;, Ask: &quot;</span><span class="sy0">,</span>Ask<span class="sy0">,</span><span class="st0">&quot;, Ticket: &quot;</span><span class="sy0">,</span>CloseTicket<span class="sy0">,</span><span class="st0">&quot;, Stop: &quot;</span><span class="sy0">,</span>OrderStopLoss<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span><span class="st0">&quot;, Break: &quot;</span><span class="sy0">,</span> MinProfit<span class="br0">)</span><span class="sy0">;</span>  Print<span class="br0">(</span>ErrLog<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span><span class="br0">}</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Мы вычитаем цену открытия ордера из текущей цены Bid, чтобы рассчитать текущую прибыль в пунктах, далее сохраняем ее в PipsProfit. Рассчитываем минимальную прибыль в пунктах и сохраняем ее в MinProfit. Если PipsProfit больше или равен MinProfit, мы изменим стоп-лосс так, чтобы он равнялся цене открытия ордера.</p><p>Мы также проверяем, чтобы стоп-лосс еще не был установлен по цене безубытка. Если OrderOpenPrice () не равен OrderStopLoss(), то мы можем продолжить.</p><h2><span id="Obnovlenie_sovetnika">Обновление советника</span></h2><p>Давайте изменим функцию start() нашего советника, торгующего по скользящей средней, чтобы отразить новые функции, которые мы создали. Сначала мы проверим, есть ли открытые ордера на покупку, прежде чем открывать новые. Вместо того, чтобы закрывать один ордер на продажу, мы просто используем функцию, чтобы закрыть все ордера на продажу. Этот метод не требует от нас использовать тикет ордера.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="co1">// Ордер на покупку</span><span class="kw1">if</span><span class="br0">(</span>FastMA <span class="sy0">&gt;</span> SlowMA <span class="sy0">&amp;&amp;</span> BuyTicket <span class="sy0">==</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> BuyMarketCount<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MagicNumber<span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span><span class="kw1">if</span><span class="br0">(</span>SellMarketCount<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MagicNumber<span class="br0">)</span> <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span>  <span class="br0">{</span>    CloseAllSellOrders<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span>Slippage<span class="br0">)</span><span class="sy0">;</span>  <span class="br0">}</span>SellTicket <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>BuyTicket <span class="sy0">=</span> OpenBuyOrder<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>LotSize<span class="sy0">,</span>UseSlippage<span class="sy0">,</span>MagicNumber<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Мы использовали функцию BuyMarketCount(), чтобы получить количество открытых ордеров на покупку. Cохраним регистрацию BuyTicket, чтобы открывались только чередующиеся ордера на покупку / продажу.</p><p>Функция CloseAllSellOrders() закрывает все открытые ордера на продажу. Сначала мы проверяем SellMarketCount(), чтобы увидеть, есть ли ордера на продажу для закрытия. Эта функция не требует тикета ордера, в отличие от функции CloseSellOrder().</p><p>Остальной код размещения ордера на покупку такой же, как и раньше. Соответствующий код размещения ордера на продажу ниже:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="co1">// Ордер на продажу</span><span class="kw1">if</span><span class="br0">(</span>FastMA <span class="sy0">&lt;</span> SlowMA <span class="sy0">&amp;&amp;</span> SellTicket <span class="sy0">==</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> SellMarketCount<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MagicNumber<span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span><span class="br0">{</span><span class="kw1">if</span><span class="br0">(</span>BuyMarketCount<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MagicNumber<span class="br0">)</span> <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span><span class="br0">{</span>    CloseAllBuyOrders<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MagicNumber<span class="sy0">,</span>Slippage<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span>BuyTicket <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>SellTicket <span class="sy0">=</span> OpenSellOrder<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>LotSize<span class="sy0">,</span>UseSlippage<span class="sy0">,</span>MagicNumber<span class="br0">)</span><span class="sy0">;</span><span class="br0">}</span></pre></div></div></div></div></div></div></div><p>Далее давайте добавим функции трейлинг-стопа в наш ордер. Мы выполним процедуру трейлинг-стопа после размещения нашего ордера. Как и выше, мы будем проверять открытые ордера на покупку или продажу перед вызовом функции трейлинг-стопа. Добавим следующие внешние переменные в наш советник:</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw2">extern</span> <span class="kw4">int</span> TrailingStop <span class="sy0">=</span> <span class="nu0">50</span><span class="sy0">;</span><span class="kw2">extern</span> <span class="kw4">int</span> MinimumProfit <span class="sy0">=</span> <span class="nu0">50</span><span class="sy0">;</span></pre></div></div></div></div></div></div></div><p>Это код для проверки и изменения трейлинг-стопов. Обратите внимание, что мы проверяем, есть ли запись для настройки TrailingStop.</p><div class="wp-geshi-highlight-wrap5"><div class="wp-geshi-highlight-wrap4"><div class="wp-geshi-highlight-wrap3"><div class="wp-geshi-highlight-wrap2"><div class="wp-geshi-highlight-wrap"><div class="wp-geshi-highlight"><div class="c"><pre class="de1"><span class="kw1">if</span><span class="br0">(</span>BuyMarketCount<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MagicNumber<span class="br0">)</span> <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> TrailingStop <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>BuyTrailingStop<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>TrailingStop<span class="sy0">,</span>MinimumProfit<span class="sy0">,</span>MagicNumber<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span><span class="kw1">if</span><span class="br0">(</span>SellMarketCount<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>MagicNumber<span class="br0">)</span> <span class="sy0">&gt;</span> <span class="nu0">0</span> <span class="sy0">&amp;&amp;</span> TrailingStop <span class="sy0">&gt;</span> <span class="nu0">0</span><span class="br0">)</span> <span class="br0">{</span>SellTrailingStop<span class="br0">(</span>Symbol<span class="br0">(</span><span class="br0">)</span><span class="sy0">,</span>TrailingStop<span class="sy0">,</span>MinimumProfit<span class="sy0">,</span>MagicNumber<span class="br0">)</span><span class="sy0">;</span> <span class="br0">}</span></pre></div></div></div></div></div></div></div></div><div class='code-block code-block-center code-block-5 ai-viewport-1'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader2" rel="nofollow" target="_blank"><img src="https://advertising-blog.qqit.ru/rublogtrader.rar.su/pamm_landing_banner_970x250_ru_1.gif"/></a></div><div class='code-block code-block-center code-block-6 ai-viewport-2 ai-viewport-3'> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader2" rel="nofollow" target="_blank"><img src="/b/pamm_landing_banner_300x250_ru_.gif"/></a></div><div class="share"> Поделиться: <a href="https://telete.in/share/url?url=https://rublogtrader.rar.su/upravlenie-orderami-v-mql4/" target="_blank"><i class="icon-04"></i></a> <a href="http://vkontakte.ru/share.php?url=https://rublogtrader.rar.su/upravlenie-orderami-v-mql4/" target="_blank"><i class="icon-01"></i></a> <a href="https://www.facebook.com/sharer/sharer.php?u=https://rublogtrader.rar.su/upravlenie-orderami-v-mql4/" target="_blank"><i class="icon-09"></i></a> <a href="https://connect.ok.ru/offer?url=https://rublogtrader.rar.su/upravlenie-orderami-v-mql4/" target="_blank"><i class="icon-02"></i></a> <a href="https://twitter.com/intent/tweet?url=https://rublogtrader.rar.su/upravlenie-orderami-v-mql4/" target="_blank"><i class="icon-03"></i></a></div><div class="subsc4"> <a href="/torgovyj-algoritm-po-trejdingu-buy/">Мой торговый алгоритм по трейдингу</a></div><div class="subsc4"> <a href="/algoritm-torgovli-akcijami/">Мой алгоритм торговли акциями</a></div><div class="subsc4"> <a href="/moj-algoritm-vybora-akcij/">Мой алгоритм выбора акций по мультипликаторам</a></div><div class="subsc4"> Скачайте приложение Блог Трейдера в App Store<br><br> <a href="https://advertising-blog.qqit.ru/rublogtrader.rar.su/rublogtrader3" rel="nofollow" target="_blank"><img src="https://advertising-blog.qqit.ru/rublogtrader.rar.su/appstore.png" width="200"/></a></div><div class="title"><a href="https://rublogtrader.rar.su/mql4/" rel="category tag">MQL4</a></div><section YuzoPluginPro class="wp-yuzo yzp-wrapper  yzp-id-12792 yzp-template-list-default-l yzp-layout-list yzp-without-excerpt yzp-without-meta yzp-aspect-ratio-1-1 yzp-mobile-columns-2 yzp-tablet-columns-2 yzp-desktop-columns-2" data-version="6.2.3"  data-id="12792"  data-type="s" data-level="3" ><ul class='yzp-container' ><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='11334' data-n='1'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/kak-vypolnit-kakuju-libo-zadachu-pri-otkrytii-novoj-svechi-na-mql4/'   >Как выполнить какую–либо задачу при открытии новой свечи на MQL4?</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='11436' data-n='2'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/rasschityvaem-stop-loss-tejk-profit-i-proskalzyvanie-na-mql4/'   >Рассчитываем стоп–лосс, тейк–профит и проскальзывание на MQL4</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='14305' data-n='3'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/prodvinutoe-razmeshhenie-orderov/'   >Продвинутое размещение ордеров и управление ордерами в MQL4</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='11642' data-n='4'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/kak-vypolnit-chast-koda-tolko-odin-raz-za-svechu-na-mql4/'   >Как выполнить часть кода только один раз за свечу на MQL4?</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='11018' data-n='5'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/cena-otkrytija-zakrytija-maksimuma-i-minimuma-svechej-v-mql4/'   >Цена открытия, закрытия, максимума и минимума свечей в MQL4</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='10898' data-n='6'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/funkcii-v-mql4/'   >Функции в MQL4: что они из себя представляют и как их использовать?</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='14353' data-n='7'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/dopolnitelnye-vozmozhnosti-mql4/'   >Дополнительные возможности MQL4 в разработке советников</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='14296' data-n='8'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/razmeshhenie-orderov-v-mql4/'   >Размещение ордеров в MQL4: как открывать и закрывать ордера?</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='11239' data-n='9'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/kak-ogranichit-rabotu-sovetnika-v-zadannye-chasy-s-pomoshhju-mql4/'   >Как ограничить работу советника в заданные часы с помощью MQL4?</a></div></div></li><li class='yzp-wrap-item  esp-show-in-mobile esp-show-in-tablet esp-show-in-desktop' post-id='10969' data-n='10'><div class='yzp-item' ><div class='yzp-item-title'> <a class=''  href='https://rublogtrader.rar.su/massivy-v-mql4/'   >Массивы в MQL4: что они из себя представляют?</a></div></div></li></ul></section></div></div></article><div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-8 col-md-offset-2 no-pad"><div id="comments" class="comments-area"><div id="respond" class="comment-respond"> <span id="reply-title" class="h4 comment-reply-title">Добавить комментарий <small><a rel="nofollow" id="cancel-comment-reply-link" href="/upravlenie-orderami-v-mql4/#respond" style="display:none;">Отменить ответ</a></small></span><form action="https://rublogtrader.rar.su/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><p class="comment-notes"><span id="email-notes">Ваш адрес email не будет опубликован.</span></p><p class="comment-form-comment"><label for="comment">Комментарий</label><textarea style="display:none;" id="comment" name="comment" cols="45" rows="8" maxlength="65525" ></textarea><textarea id="real-comment" name="real-comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Имя</label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" /></p><p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Отправить комментарий" /> <input type='hidden' name='comment_post_ID' value='14324' id='comment_post_ID' /> <input type='hidden' name='comment_parent' id='comment_parent' value='0' /></p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="7a7eb56cb1" /></p><p style="display: none !important;"><label>&#916;<textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100"></textarea></label><input type="hidden" id="ak_js" name="ak_js" value="195"/><script>document.getElementById( "ak_js" ).setAttribute( "value", ( new Date() ).getTime() );</script></p></form></div></div></div></main></div></div></div></div><div class="spu-bg" id="spu-bg-16205"></div><div class="spu-box  spu-centered spu-total- " id="spu-16205" data-box-id="16205" data-trigger="seconds" data-trigger-number="5" data-spuanimation="fade" data-tconvert-cookie="d" data-tclose-cookie="d" data-dconvert-cookie="999" data-dclose-cookie="30" data-nconvert-cookie="spu_conversion_16205" data-nclose-cookie="spu_closing_16205" data-test-mode="0" data-auto-hide="0" data-close-on-conversion="1" data-bgopa="0.5" data-total="" style="left:-99999px !important;right:auto;" data-width="600" ><div class="spu-content"><p><a href="https://www.instaglobe.net/ru/pamm_trading?x=trdblogpam&#038;utm_source=tradeblog.net&#038;utm_campaign=pamm" target="_blank" rel="noopener"><img src="https://rublogtrader.rar.su/wp-content/uploads/2021/12/700_400_Popup.jpg" alt="" width="700" height="400" class="alignnone size-full wp-image-16207" /></a></p></div> <span class="spu-close spu-close-popup top_right"><i class="spu-icon spu-icon-close"></i></span> <span class="spu-timer"></span></div><div id="fb-root" class=" fb_reset"></div><div id="shiftnav-toggle-main" class="shiftnav-toggle-main-align-center shiftnav-toggle-style-full_bar shiftnav-togglebar-gap-on shiftnav-toggle-edge-left shiftnav-toggle-icon-bars shiftnav--hide-scroll-down"   ><button id="shiftnav-toggle-main-button" class="shiftnav-toggle shiftnav-toggle-shiftnav-main shiftnav-toggle-burger" tabindex="1" data-shiftnav-target="shiftnav-main" aria-label="Toggle Menu"><i class="fa fa-bars"></i></button><div class="shiftnav-main-toggle-content shiftnav-toggle-main-block"><a href="https://traderblog.net">Блог трейдера</a></div><div class="shiftnav-main-toggle-content-after"> <a class="shiftnav-searchbar-toggle  shiftnav-toggle-main-block shiftnav-toggle-main-ontop" tabindex="1"><i class="fa fa-search"></i></a><div class="shiftnav-searchbar-drop"><form role="search" method="get" class="shiftnav-searchform" action="https://rublogtrader.rar.su/"> <input type="text" placeholder="Search..." value="" name="s" class="shiftnav-search-input" /> <input type="submit" class="shiftnav-search-submit" value="&#xf002;" /></form></div></div></div><div class="shiftnav shiftnav-nojs shiftnav-shiftnav-main shiftnav-left-edge shiftnav-skin-none shiftnav-transition-standard" id="shiftnav-main" data-shiftnav-id="shiftnav-main"><div class="shiftnav-inner"><nav class="shiftnav-nav"><ul id="menu-menu-2" class="shiftnav-menu shiftnav-targets-default shiftnav-targets-text-default shiftnav-targets-icon-default"><li id="menu-item-14441" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-14441 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/forex/">Форекс</a></li><li id="menu-item-14442" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-14442 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/trading/">Трейдинг</a></li><li id="menu-item-10795" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-10795 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/technical-analysis/">Технический анализ</a></li><li id="menu-item-10797" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-10797 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/indicators/">Индикаторы</a></li><li id="menu-item-10798" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-10798 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/prajs-jekshen/">Прайс экшен</a></li><li id="menu-item-16043" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-16043 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/investing/">Инвестиции</a></li><li id="menu-item-16238" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-16238 shiftnav-depth-0"><a class="shiftnav-target"  href="https://rublogtrader.rar.su/crypto/">Крипто</a></li></ul></nav> <button class="shiftnav-sr-close shiftnav-sr-only shiftnav-sr-only-focusable"> &times; Close Panel </button></div></div><div style="display: none;" id="nxsFavNotice"><div id="nxsFavNoticeCnt">Posting....</div></div><div id="wpfront-scroll-top-container"> <img src="https://rublogtrader.rar.su/wp-content/uploads/2019/03/scroll-3.png" alt="" /></div> <script type="text/javascript">function wpfront_scroll_top_init() {                if (typeof wpfront_scroll_top === "function" && typeof jQuery !== "undefined") {                    wpfront_scroll_top({"scroll_offset":3000,"button_width":60,"button_height":60,"button_opacity":0.9,"button_fade_duration":200,"scroll_duration":400,"location":1,"marginX":250,"marginY":20,"hide_iframe":false,"auto_hide":false,"auto_hide_after":2,"button_action":"top","button_action_element_selector":"","button_action_container_selector":"html, body","button_action_element_offset":0});                } else {                    setTimeout(wpfront_scroll_top_init, 100);                }            }            wpfront_scroll_top_init();</script> <script type='text/javascript' id='yuzo-js-js-extra'>var yuzo_vars = {"ajaxurl":"https:\/\/traderblog.net\/wp-admin\/admin-ajax.php","post_id":"14324","url":"https%3A%2F%2Ftraderblog.net%2Fupravlenie-orderami-v-mql4%2F","where_is":"single|singular","nonce":"7e9956422c","nonce2":"98ebd05f15","off_views":"0","off_views_logged":"1","is_logged":"0","allows_to_count_visits":"1","disabled_counter":"0","level_article":"medium"};</script> <script type='text/javascript' id='spu-public-js-extra'>var spuvar = {"is_admin":"","disable_style":"","ajax_mode":"","ajax_url":"https:\/\/traderblog.net\/wp-admin\/admin-ajax.php","ajax_mode_url":"https:\/\/traderblog.net\/?spu_action=spu_load","pid":"14324","is_front_page":"","is_category":"","site_url":"https:\/\/traderblog.net","is_archive":"","is_search":"","is_preview":"","seconds_confirmation_close":"5"};var spuvar_social = [];</script> <script type='text/javascript' id='shiftnav-js-extra'>var shiftnav_data = {"shift_body":"off","shift_body_wrapper":"","lock_body":"on","lock_body_x":"off","open_current":"off","collapse_accordions":"off","scroll_panel":"off","breakpoint":"1120","v":"1.7.0.1","pro":"1","touch_off_close":"on","scroll_offset":"100","disable_transforms":"off","close_on_target_click":"off","scroll_top_boundary":"50","process_uber_segments":"on"};</script> <script>ai_front = {"insertion_before":"BEFORE","insertion_after":"AFTER","insertion_prepend":"PREPEND CONTENT","insertion_append":"APPEND CONTENT","insertion_replace_content":"REPLACE CONTENT","insertion_replace_element":"REPLACE ELEMENT","visible":"VISIBLE","hidden":"HIDDEN","fallback":"FALLBACK","automatically_placed":"Automatically placed by AdSense Auto ads code","cancel":"Cancel","use":"Use","add":"Add","parent":"Parent","cancel_element_selection":"Cancel element selection","select_parent_element":"Select parent element","css_selector":"CSS selector","use_current_selector":"Use current selector","element":"ELEMENT","path":"PATH","selector":"SELECTOR"};function b2a(a){var b,c=0,l=0,f="",g=[];if(!a)return a;do{var e=a.charCodeAt(c++);var h=a.charCodeAt(c++);var k=a.charCodeAt(c++);var d=e<<16|h<<8|k;e=63&d>>18;h=63&d>>12;k=63&d>>6;d&=63;g[l++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)}while(c<a.length);return f=g.join(""),b=a.length%3,(b?f.slice(0,b-3):f)+"===".slice(b||3)}function a2b(a){var b,c,l,f={},g=0,e=0,h="",k=String.fromCharCode,d=a.length;for(b=0;64>b;b++)f["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(b)]=b;for(c=0;d>c;c++)for(b=f[a.charAt(c)],g=(g<<6)+b,e+=6;8<=e;)((l=255&g>>>(e-=8))||d-2>c)&&(h+=k(l));return h}b64e=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(b,a){return String.fromCharCode("0x"+a)}))};b64d=function(a){return decodeURIComponent(atob(a).split("").map(function(a){return"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)}).join(""))};(function(a){if("function"===typeof define&&define.amd){define(a);var c=!0}"object"===typeof exports&&(module.exports=a(),c=!0);if(!c){var d=window.Cookies,b=window.Cookies=a();b.noConflict=function(){window.Cookies=d;return b}}})(function(){function a(){for(var d=0,b={};d<arguments.length;d++){var f=arguments[d],e;for(e in f)b[e]=f[e]}return b}function c(d){function b(){}function f(h,k,g){if("undefined"!==typeof document){g=a({path:"/"},b.defaults,g);"number"===typeof g.expires&&(g.expires=new Date(1*new Date+864E5*g.expires));g.expires=g.expires?g.expires.toUTCString():"";try{var l=JSON.stringify(k);/^[\{\[]/.test(l)&&(k=l)}catch(p){}k=d.write?d.write(k,h):encodeURIComponent(String(k)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent);h=encodeURIComponent(String(h)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);l="";for(var n in g)g[n]&&(l+="; "+n,!0!==g[n]&&(l+="="+g[n].split(";")[0]));return document.cookie=h+"="+k+l}}function e(h,k){if("undefined"!==typeof document){for(var g={},l=document.cookie?document.cookie.split("; "):[],n=0;n<l.length;n++){var p=l[n].split("="),m=p.slice(1).join("=");k||'"'!==m.charAt(0)||(m=m.slice(1,-1));try{var q=p[0].replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent);m=(d.read||d)(m,q)||m.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent);if(k)try{m=JSON.parse(m)}catch(r){}g[q]=m;if(h===q)break}catch(r){}}return h?g[h]:g}}b.set=f;b.get=function(h){return e(h,!1)};b.getJSON=function(h){return e(h,!0)};b.remove=function(h,k){f(h,"",a(k,{expires:-1}))};b.defaults={};b.withConverter=c;return b}return c(function(){})});AiCookies=Cookies.noConflict();ai_check_block=function(a){if(null==a)return!0;var c=AiCookies.getJSON("aiBLOCKS");ai_debug_cookie_status="";null==c&&(c={});"undefined"!==typeof ai_delay_showing_pageviews&&(c.hasOwnProperty(a)||(c[a]={}),c[a].hasOwnProperty("d")||(c[a].d=ai_delay_showing_pageviews));if(c.hasOwnProperty(a))for(var d in c[a]){if("x"==d){var b="",f=document.querySelectorAll('span[data-ai-block="'+a+'"]')[0];"aiHash"in f.dataset&&(b=f.dataset.aiHash);f="";c[a].hasOwnProperty("h")&&(f=c[a].h);var e=new Date;e=c[a][d]-Math.round(e.getTime()/1E3);if(0<e&&f==b)return ai_debug_cookie_status=a="closed for "+e+" s = "+Math.round(1E4*e/3600/24)/1E4+" days",!1;ai_set_cookie(a,"x","");c[a].hasOwnProperty("i")||c[a].hasOwnProperty("c")||ai_set_cookie(a,"h","")}else if("d"==d){if(0!=c[a][d])return ai_debug_cookie_status=a="delayed for "+c[a][d]+" pageviews",!1}else if("i"==d){b="";f=document.querySelectorAll('span[data-ai-block="'+a+'"]')[0];"aiHash"in f.dataset&&(b=f.dataset.aiHash);f="";c[a].hasOwnProperty("h")&&(f=c[a].h);if(0==c[a][d]&&f==b)return ai_debug_cookie_status=a="max impressions reached",!1;if(0>c[a][d]&&f==b){e=new Date;e=-c[a][d]-Math.round(e.getTime()/1E3);if(0<e)return ai_debug_cookie_status=a="max imp. reached ("+Math.round(1E4*e/24/3600)/1E4+" days = "+e+" s)",!1;ai_set_cookie(a,"i","");c[a].hasOwnProperty("c")||c[a].hasOwnProperty("x")||ai_set_cookie(a,"h","")}}if("ipt"==d&&0==c[a][d]&&(e=new Date,b=Math.round(e.getTime()/1E3),e=c[a].it-b,0<e))return ai_debug_cookie_status=a="max imp. per time reached ("+Math.round(1E4*e/24/3600)/1E4+" days = "+e+" s)",!1;if("c"==d){b="";f=document.querySelectorAll('span[data-ai-block="'+a+'"]')[0];"aiHash"in f.dataset&&(b=f.dataset.aiHash);f="";c[a].hasOwnProperty("h")&&(f=c[a].h);if(0==c[a][d]&&f==b)return ai_debug_cookie_status=a="max clicks reached",!1;if(0>c[a][d]&&f==b){e=new Date;e=-c[a][d]-Math.round(e.getTime()/1E3);if(0<e)return ai_debug_cookie_status=a="max clicks reached ("+Math.round(1E4*e/24/3600)/1E4+" days = "+e+" s)",!1;ai_set_cookie(a,"c","");c[a].hasOwnProperty("i")||c[a].hasOwnProperty("x")||ai_set_cookie(a,"h","")}}if("cpt"==d&&0==c[a][d]&&(e=new Date,b=Math.round(e.getTime()/1E3),e=c[a].ct-b,0<e))return ai_debug_cookie_status=a="max clicks per time reached ("+Math.round(1E4*e/24/3600)/1E4+" days = "+e+" s)",!1}ai_debug_cookie_status="OK";return!0};ai_check_and_insert_block=function(a,c){if(null==a)return!0;var d=document.getElementsByClassName(c);if(d.length){d=d[0];var b=d.closest(".code-block");if(ai_check_block(a)){if(ai_insert_code(d),b){var f=b.querySelectorAll(".ai-debug-block");b&&f.length&&(b.classList.remove("ai-list-block"),b.classList.remove("ai-list-block-ip"),b.style.visibility="",b.classList.contains("ai-remove-position")&&(b.style.position=""))}}else{f=d.closest("div[data-ai]");if(null!=f&&"undefined"!=typeof f.getAttribute("data-ai")){var e=JSON.parse(b64d(f.getAttribute("data-ai")));"undefined"!==typeof e&&e.constructor===Array&&(e[1]="",f.setAttribute("data-ai",b64e(JSON.stringify(e))))}f=b.querySelectorAll(".ai-debug-block");b&&f.length&&(b.classList.remove("ai-list-block"),b.classList.remove("ai-list-block-ip"),b.style.visibility="",b.classList.contains("ai-remove-position")&&(b.style.position=""))}d.classList.remove(c)}d=document.querySelectorAll("."+c+"-dbg");b=0;for(f=d.length;b<f;b++)e=d[b],e.querySelector(".ai-status").textContent=ai_debug_cookie_status,e.querySelector(".ai-cookie-data").textContent=ai_get_cookie_text(a),e.classList.remove(c+"-dbg")};function ai_load_cookie(){var a=AiCookies.getJSON("aiBLOCKS");null==a&&(a={});return a}function ai_get_cookie(a,c){var d="",b=ai_load_cookie();b.hasOwnProperty(a)&&b[a].hasOwnProperty(c)&&(d=b[a][c]);return d}function ai_set_cookie(a,c,d){var b=ai_load_cookie();if(""===d){if(b.hasOwnProperty(a)){delete b[a][c];a:{c=b[a];for(f in c)if(c.hasOwnProperty(f)){var f=!1;break a}f=!0}f&&delete b[a]}}else b.hasOwnProperty(a)||(b[a]={}),b[a][c]=d;0===Object.keys(b).length&&b.constructor===Object?AiCookies.remove("aiBLOCKS"):AiCookies.set("aiBLOCKS",b,{expires:365,path:"/"});return b}ai_get_cookie_text=function(a){var c=AiCookies.getJSON("aiBLOCKS");null==c&&(c={});return c.hasOwnProperty(a)?JSON.stringify(c[a]).replace(/"/g,"").replace("{","").replace("}",""):""};ai_insert=function(d,l,v){for(var p=-1!=l.indexOf(":eq")?jQuery(l):document.querySelectorAll(l),t=0,y=p.length;t<y;t++){var b=p[t];selector_string=b.hasAttribute("id")?"#"+b.getAttribute("id"):b.hasAttribute("class")?"."+b.getAttribute("class").replace(RegExp(" ","g"),"."):"";var u=document.createElement("div");u.innerHTML=v;var m=u.getElementsByClassName("ai-selector-counter")[0];null!=m&&(m.innerText=t+1);m=u.getElementsByClassName("ai-debug-name ai-main")[0];if(null!=m){var k="";"before"==d?k=ai_front.insertion_before:"after"==d?k=ai_front.insertion_after:"prepend"==d?k=ai_front.insertion_prepend:"append"==d?k=ai_front.insertion_append:"replace-content"==d?k=ai_front.insertion_replace_content:"replace-element"==d&&(k=ai_front.insertion_replace_element);-1==selector_string.indexOf(".ai-viewports")&&(m.innerText=k+" "+l+" ("+b.tagName.toLowerCase()+selector_string+")")}m=document.createRange();k=!0;try{var w=m.createContextualFragment(u.innerHTML)}catch(r){k=!1}"before"==d?k?b.parentNode.insertBefore(w,b):jQuery(u.innerHTML).insertBefore(jQuery(b)):"after"==d?k?b.parentNode.insertBefore(w,b.nextSibling):jQuery(u.innerHTML).insertBefore(jQuery(b.nextSibling)):"prepend"==d?k?b.insertBefore(w,b.firstChild):jQuery(u.innerHTML).insertBefore(jQuery(b.firstChild)):"append"==d?k?b.insertBefore(w,null):jQuery(u.innerHTML).appendTo(jQuery(b)):"replace-content"==d?(b.innerHTML="",k?b.insertBefore(w,null):jQuery(u.innerHTML).appendTo(jQuery(b))):"replace-element"==d&&(k?b.parentNode.insertBefore(w,b):jQuery(u.innerHTML).insertBefore(jQuery(b)),b.parentNode.removeChild(b))}};ai_insert_code=function(d){function l(m,k){return null==m?!1:m.classList?m.classList.contains(k):-1<(" "+m.className+" ").indexOf(" "+k+" ")}function v(m,k){null!=m&&(m.classList?m.classList.add(k):m.className+=" "+k)}function p(m,k){null!=m&&(m.classList?m.classList.remove(k):m.className=m.className.replace(new RegExp("(^|\\b)"+k.split(" ").join("|")+"(\\b|$)","gi")," "))}if("undefined"!=typeof d){var t=!1;if(l(d,"no-visibility-check")||d.offsetWidth||d.offsetHeight||d.getClientRects().length){t=d.getAttribute("data-code");var y=d.getAttribute("data-insertion"),b=d.getAttribute("data-selector");if(null!=t)if(null!=y&&null!=b){if(-1!=b.indexOf(":eq")?jQuery(b).length:document.querySelectorAll(b).length)ai_insert(y,b,b64d(t)),p(d,"ai-viewports")}else{y=document.createRange();b=!0;try{var u=y.createContextualFragment(b64d(t))}catch(m){b=!1}b?d.parentNode.insertBefore(u,d.nextSibling):jQuery(b64d(t)).insertBefore(jQuery(d.nextSibling));p(d,"ai-viewports")}t=!0}else u=d.previousElementSibling,l(u,"ai-debug-bar")&&l(u,"ai-debug-script")&&(p(u,"ai-debug-script"),v(u,"ai-debug-viewport-invisible")),p(d,"ai-viewports");return t}};ai_insert_list_code=function(d){var l=document.getElementsByClassName(d)[0];if("undefined"!=typeof l){var v=ai_insert_code(l),p=l.closest("div.code-block");if(p){v||p.removeAttribute("data-ai");var t=p.querySelectorAll(".ai-debug-block");p&&t.length&&(p.classList.remove("ai-list-block"),p.classList.remove("ai-list-block-ip"),p.style.visibility="",p.classList.contains("ai-remove-position")&&(p.style.position=""))}l.classList.remove(d);v&&ai_process_elements()}};ai_insert_viewport_code=function(d){var l=document.getElementsByClassName(d)[0];"undefined"!=typeof l&&(ai_insert_code(l),l.classList.remove(d),ai_process_elements())};ai_insert_code_by_class=function(d){var l=document.getElementsByClassName(d)[0];"undefined"!=typeof l&&(ai_insert_code(l),l.classList.remove(d))};ai_insert_client_code=function(d,l){var v=document.getElementsByClassName(d)[0];if("undefined"!=typeof v){var p=v.getAttribute("data-code");null!=p&&ai_check_block()&&ai_check_and_insert_block()&&(v.setAttribute("data-code",p.substring(Math.floor(l/19))),ai_insert_code_by_class(d),v.remove())}};ai_process_elements_active=!1;function ai_process_elements(){ai_process_elements_active||setTimeout(function(){ai_process_elements_active=!1;"function"==typeof ai_process_rotations&&ai_process_rotations();"function"==typeof ai_process_lists&&ai_process_lists(jQuery(".ai-list-data"));"function"==typeof ai_process_ip_addresses&&ai_process_ip_addresses(jQuery(".ai-ip-data"));"function"==typeof ai_adb_process_blocks&&ai_adb_process_blocks()},5);ai_process_elements_active=!0}var Arrive=function(d,l,v){function p(r,c,e){b.addMethod(c,e,r.unbindEvent);b.addMethod(c,e,r.unbindEventWithSelectorOrCallback);b.addMethod(c,e,r.unbindEventWithSelectorAndCallback)}function t(r){r.arrive=k.bindEvent;p(k,r,"unbindArrive");r.leave=w.bindEvent;p(w,r,"unbindLeave")}if(d.MutationObserver&&"undefined"!==typeof HTMLElement){var y=0,b=function(){var r=HTMLElement.prototype.matches||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector;return{matchesSelector:function(c,e){return c instanceof HTMLElement&&r.call(c,e)},addMethod:function(c,e,f){var a=c[e];c[e]=function(){if(f.length==arguments.length)return f.apply(this,arguments);if("function"==typeof a)return a.apply(this,arguments)}},callCallbacks:function(c,e){e&&e.options.onceOnly&&1==e.firedElems.length&&(c=[c[0]]);for(var f=0,a;a=c[f];f++)a&&a.callback&&a.callback.call(a.elem,a.elem);e&&e.options.onceOnly&&1==e.firedElems.length&&e.me.unbindEventWithSelectorAndCallback.call(e.target,e.selector,e.callback)},checkChildNodesRecursively:function(c,e,f,a){for(var g=0,h;h=c[g];g++)f(h,e,a)&&a.push({callback:e.callback,elem:h}),0<h.childNodes.length&&b.checkChildNodesRecursively(h.childNodes,e,f,a)},mergeArrays:function(c,e){var f={},a;for(a in c)c.hasOwnProperty(a)&&(f[a]=c[a]);for(a in e)e.hasOwnProperty(a)&&(f[a]=e[a]);return f},toElementsArray:function(c){"undefined"===typeof c||"number"===typeof c.length&&c!==d||(c=[c]);return c}}}(),u=function(){var r=function(){this._eventsBucket=[];this._beforeRemoving=this._beforeAdding=null};r.prototype.addEvent=function(c,e,f,a){c={target:c,selector:e,options:f,callback:a,firedElems:[]};this._beforeAdding&&this._beforeAdding(c);this._eventsBucket.push(c);return c};r.prototype.removeEvent=function(c){for(var e=this._eventsBucket.length-1,f;f=this._eventsBucket[e];e--)c(f)&&(this._beforeRemoving&&this._beforeRemoving(f),(f=this._eventsBucket.splice(e,1))&&f.length&&(f[0].callback=null))};r.prototype.beforeAdding=function(c){this._beforeAdding=c};r.prototype.beforeRemoving=function(c){this._beforeRemoving=c};return r}(),m=function(r,c){var e=new u,f=this,a={fireOnAttributesModification:!1};e.beforeAdding(function(g){var h=g.target;if(h===d.document||h===d)h=document.getElementsByTagName("html")[0];var n=new MutationObserver(function(x){c.call(this,x,g)});var q=r(g.options);n.observe(h,q);g.observer=n;g.me=f});e.beforeRemoving(function(g){g.observer.disconnect()});this.bindEvent=function(g,h,n){h=b.mergeArrays(a,h);for(var q=b.toElementsArray(this),x=0;x<q.length;x++)e.addEvent(q[x],g,h,n)};this.unbindEvent=function(){var g=b.toElementsArray(this);e.removeEvent(function(h){for(var n=0;n<g.length;n++)if(this===v||h.target===g[n])return!0;return!1})};this.unbindEventWithSelectorOrCallback=function(g){var h=b.toElementsArray(this);e.removeEvent("function"===typeof g?function(n){for(var q=0;q<h.length;q++)if((this===v||n.target===h[q])&&n.callback===g)return!0;return!1}:function(n){for(var q=0;q<h.length;q++)if((this===v||n.target===h[q])&&n.selector===g)return!0;return!1})};this.unbindEventWithSelectorAndCallback=function(g,h){var n=b.toElementsArray(this);e.removeEvent(function(q){for(var x=0;x<n.length;x++)if((this===v||q.target===n[x])&&q.selector===g&&q.callback===h)return!0;return!1})};return this},k=new function(){function r(f,a,g){return b.matchesSelector(f,a.selector)&&(f._id===v&&(f._id=y++),-1==a.firedElems.indexOf(f._id))?(a.firedElems.push(f._id),!0):!1}var c={fireOnAttributesModification:!1,onceOnly:!1,existing:!1};k=new m(function(f){var a={attributes:!1,childList:!0,subtree:!0};f.fireOnAttributesModification&&(a.attributes=!0);return a},function(f,a){f.forEach(function(g){var h=g.addedNodes,n=g.target,q=[];null!==h&&0<h.length?b.checkChildNodesRecursively(h,a,r,q):"attributes"===g.type&&r(n,a,q)&&q.push({callback:a.callback,elem:n});b.callCallbacks(q,a)})});var e=k.bindEvent;k.bindEvent=function(f,a,g){"undefined"===typeof g?(g=a,a=c):a=b.mergeArrays(c,a);var h=b.toElementsArray(this);if(a.existing){for(var n=[],q=0;q<h.length;q++)for(var x=h[q].querySelectorAll(f),z=0;z<x.length;z++)n.push({callback:g,elem:x[z]});if(a.onceOnly&&n.length)return g.call(n[0].elem,n[0].elem);setTimeout(b.callCallbacks,1,n)}e.call(this,f,a,g)};return k},w=new function(){function r(f,a){return b.matchesSelector(f,a.selector)}var c={};w=new m(function(){return{childList:!0,subtree:!0}},function(f,a){f.forEach(function(g){g=g.removedNodes;var h=[];null!==g&&0<g.length&&b.checkChildNodesRecursively(g,a,r,h);b.callCallbacks(h,a)})});var e=w.bindEvent;w.bindEvent=function(f,a,g){"undefined"===typeof g?(g=a,a=c):a=b.mergeArrays(c,a);e.call(this,f,a,g)};return w};l&&t(l.fn);t(HTMLElement.prototype);t(NodeList.prototype);t(HTMLCollection.prototype);t(HTMLDocument.prototype);t(Window.prototype);l={};p(k,l,"unbindAllArrive");p(w,l,"unbindAllLeave");return l}}(window,"undefined"===typeof jQuery?null:jQuery,void 0);var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,k){a.raw=k;return a};$jscomp.arrayIteratorImpl=function(a){var k=0;return function(){return k<a.length?{done:!1,value:a[k++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var k="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return k?k.call(a):$jscomp.arrayIterator(a)};jQuery(function(a){function k(e){e=e.match(E);return null!=e&&1<e.length&&"string"===typeof e[1]&&0<e[1].length?e[1].toLowerCase():null}function z(e){try{var h=Date.parse(e);isNaN(h)&&(h=null)}catch(J){h=null}if(null==h&&e.includes(" ")){e=e.split(" ");try{h=Date.parse(e[0]);if(e[1].includes(":")){var F=e[1].split(":");h+=1E3*(3600*parseInt(F[0])+60*parseInt(F[1])+parseInt(F[2]))}isNaN(h)&&(h=null)}catch(J){h=null}}return h}function n(){(jQuery("#ai-iab-tcf-bar").length||jQuery(".ai-list-manual").length)&&"function"==typeof __tcfapi&&"function"==typeof ai_load_blocks&&"undefined"==typeof ai_iab_tcf_callback_installed&&(__tcfapi("addEventListener",2,function(e,h){h&&"useractioncomplete"===e.eventStatus&&(ai_tcData=e,ai_load_blocks(),jQuery("#ai-iab-tcf-status").text("DATA LOADED"),jQuery("#ai-iab-tcf-bar").addClass("status-ok").removeClass("status-error"))}),ai_iab_tcf_callback_installed=!0)}Array.prototype.includes||(Array.prototype.includes=function(e){return!!~this.indexOf(e)});var E=/:\/\/(.[^/:]+)/i;ai_process_lists=function(e){function h(d,b,g){if(0==d.length){if("!@!"==g)return!0;b!=g&&("true"==g.toLowerCase()?g=!0:"false"==g.toLowerCase()&&(g=!1));return b==g}if("object"!=typeof b&&"array"!=typeof b)return!1;var f=d[0];d=d.slice(1);if("*"==f)for(b=$jscomp.makeIterator(Object.entries(b)),f=b.next();!f.done;f=b.next()){if(f=$jscomp.makeIterator(f.value),f.next(),f=f.next().value,h(d,f,g))return!0}else if(f in b)return h(d,b[f],g);return!1}function F(d,b,g){if("object"!=typeof d||-1==b.indexOf("["))return!1;b=b.replace(/]| /gi,"").split("[");return h(b,d,g)}function J(){"function"==typeof __tcfapi&&(a("#ai-iab-tcf-status").text("DETECTED"),__tcfapi("getTCData",2,function(d,b){b?(a("#ai-iab-tcf-bar").addClass("status-ok"),"tcloaded"==d.eventStatus||"useractioncomplete"==d.eventStatus?(ai_tcData=d,d.gdprApplies?a("#ai-iab-tcf-status").text("DATA LOADED"):jQuery("#ai-iab-tcf-status").text("GDPR DOES NOT APPLY"),a("#ai-iab-tcf-bar").addClass("status-ok").removeClass("status-error"),setTimeout(function(){ai_process_lists()},10)):"cmpuishown"==d.eventStatus&&(ai_cmpuishown=!0,a("#ai-iab-tcf-status").text("CMP UI SHOWN"),a("#ai-iab-tcf-bar").addClass("status-ok").removeClass("status-error"))):(a("#ai-iab-tcf-status").text("__tcfapi getTCData failed"),a("#ai-iab-tcf-bar").removeClass("status-ok").addClass("status-error"))}))}function P(d){"function"==typeof __tcfapi?("undefined"==typeof ai_iab_tcf_callback_installed&&n(),"undefined"==typeof ai_tcData_requested&&(ai_tcData_requested=!0,J(),url_parameters_need_tcData=!0)):d&&(a("#ai-iab-tcf-bar").addClass("status-error").removeClass("status-ok"),a("#ai-iab-tcf-status").text("MISSING: __tcfapi function not found"))}e=null==e?a("div.ai-list-data, meta.ai-list-data"):e.filter(".ai-list-data");if(e.length){e.removeClass("ai-list-data");var G=document.cookie.split(";");G.forEach(function(d,b){G[b]=d.trim()});var Q=getAllUrlParams(window.location.search);if(null!=Q.referrer)var r=Q.referrer;else r=document.referrer,""!=r&&(r=k(r));var K=window.navigator.userAgent,L=K.toLowerCase();if("undefined"!==typeof MobileDetect)var R=new MobileDetect(K);e.each(function(){var d=a(this).closest("div.code-block"),b=!0,g=a(this).attr("referer-list");if("undefined"!=typeof g){g=b64d(g).split(",");var f=a(this).attr("referer-list-type"),l=!1;a.each(g,function(t,c){if(""==c)return!0;if("*"==c.charAt(0))if("*"==c.charAt(c.length-1)){if(c=c.substr(1,c.length-2),-1!=r.indexOf(c))return l=!0,!1}else{if(c=c.substr(1),r.substr(-c.length)==c)return l=!0,!1}else if("*"==c.charAt(c.length-1)){if(c=c.substr(0,c.length-1),0==r.indexOf(c))return l=!0,!1}else if("#"==c){if(""==r)return l=!0,!1}else if(c==r)return l=!0,!1});switch(f){case "B":l&&(b=!1);break;case "W":l||(b=!1)}}if(b&&(g=a(this).attr("client-list"),"undefined"!=typeof g&&"undefined"!==typeof R))switch(g=b64d(g).split(","),f=a(this).attr("client-list-type"),l=!1,a.each(g,function(t,c){if(""==c)return!0;if("*"==c.charAt(0))if("*"==c.charAt(c.length-1)){if(c=c.substr(1,c.length-2).toLowerCase(),-1!=L.indexOf(c))return l=!0,!1}else{if(c=c.substr(1).toLowerCase(),L.substr(-c.length)==c)return l=!0,!1}else if("*"==c.charAt(c.length-1)){if(c=c.substr(0,c.length-1).toLowerCase(),0==L.indexOf(c))return l=!0,!1}else if(R.is(c))return l=!0,!1}),f){case "B":l&&(b=!1);break;case "W":l||(b=!1)}var M=g=!1;if(b&&(f=a(this).attr("parameter-list"),"undefined"!=typeof f)){f=b64d(f).split(",");var u=a(this).attr("parameter-list-type"),S=[];G.forEach(function(t){t=t.split("=");try{var c=JSON.parse(decodeURIComponent(t[1]))}catch(T){c=decodeURIComponent(t[1])}S[t[0]]=c});var w=!1,H=a(this);a.each(f,function(t,c){var T=c.split("&&");a.each(T,function(X,m){var x=!0;m=m.trim();"!!"==m.substring(0,2)&&(x=!1,m=m.substring(2));var p=m,y="!@!",U=-1!=m.indexOf("["),V=(0==m.indexOf("tcf-v2")||0==m.indexOf("euconsent-v2"))&&-1!=m.indexOf("[");-1!=m.indexOf("=")&&(y=m.split("="),p=y[0],y=y[1],U=-1!=p.indexOf("["),V=(0==p.indexOf("tcf-v2")||0==p.indexOf("euconsent-v2"))&&-1!=p.indexOf("["));if(V)a("#ai-iab-tcf-bar").show(),"object"==typeof ai_tcData?(a("#ai-iab-tcf-bar").addClass("status-ok"),p=p.replace(/]| /gi,"").split("["),p.shift(),w=(p=h(p,ai_tcData,y))?x:!x):(H.addClass("ai-list-data"),M=!0,"function"==typeof __tcfapi?P(!1):"undefined"==typeof ai_tcData_retrying&&(ai_tcData_retrying=!0,setTimeout(function(){P(!0)},200)));else if(U)w=(p=F(S,p,y))?x:!x;else{var N=!1;"!@!"==y?G.every(function(W){return W.split("=")[0]==m?(N=!0,!1):!0}):N=-1!=G.indexOf(m);w=N?x:!x}if(!w)return!1});if(w)return!1});switch(u){case "B":w&&(b=!1);break;case "W":w||(b=!1)}a(this).hasClass("ai-list-manual")&&(b?(H.removeClass("ai-list-data"),H.removeClass("ai-list-manual")):(g=!0,H.addClass("ai-list-data")));if(!g&&!M&&(f=a(this).data("debug-info"),"undefined"!=typeof f&&(f=a("."+f),0!=f.length))){var q=f.parent();q.hasClass("ai-debug-info")&&q.remove()}}q=a(this).prevAll(".ai-debug-bar.ai-debug-lists");f=""==r?"#":r;q.find(".ai-debug-name.ai-list-info").text(f).attr("title",K);q.find(".ai-debug-name.ai-list-status").text(b?ai_front.visible:ai_front.hidden);f=!1;if(b){u=a(this).attr("scheduling-start");var A=a(this).attr("scheduling-end"),B=a(this).attr("scheduling-days");if("undefined"!=typeof u&&"undefined"!=typeof A&&"undefined"!=typeof B){f=!0;var O=parseInt(a(this).attr("scheduling-fallback")),v=parseInt(a(this).attr("gmt"));u=z(b64d(u))+v;A=z(b64d(A))+v;B=b64d(B).split(",");q=a(this).attr("scheduling-type");var C=(new Date).getTime()+v,I=new Date(C),D=I.getDay();0==D?D=6:D--;v=C>=u&&C<A&&B.includes(D.toString());switch(q){case "B":v=!v}v||(b=!1);I=I.toISOString().split(".")[0].replace("T"," ");q=a(this).prevAll(".ai-debug-bar.ai-debug-scheduling");q.find(".ai-debug-name.ai-scheduling-info").text(I+" "+D+" current_time:"+C.toString()+"  start_date:"+u.toString()+" ="+(C>=u).toString()+" end_date:"+A.toString()+" =:"+(C<A).toString()+" days:"+B.toString()+" =:"+B.includes(D.toString()).toString());q.find(".ai-debug-name.ai-scheduling-status").text(b?ai_front.visible:ai_front.hidden);b||0==O||(q.removeClass("ai-debug-scheduling").addClass("ai-debug-fallback"),q.find(".ai-debug-name.ai-scheduling-status").text(ai_front.fallback+"="+O))}}if(g||M)return!0;a(this).css({visibility:"",position:"",width:"",height:"","z-index":""});b?(d.css({visibility:""}),d.hasClass("ai-remove-position")&&d.css({position:""}),"undefined"!=typeof a(this).data("code")&&(b=b64d(a(this).data("code")),0!=a(this).closest("head").length?(a(this).after(b),a(this).remove()):a(this).append(b),ai_process_element(this))):f&&!v&&0!=O?(d.css({visibility:""}),d.hasClass("ai-remove-position")&&d.css({position:""}),a(this).next(".ai-fallback").removeClass("ai-fallback"),"undefined"!=typeof a(this).data("fallback-code")?(b=b64d(a(this).data("fallback-code")),a(this).append(b),ai_process_element(this)):(a(this).hide(),d.find(".ai-debug-block").length||d.hide()),b=d.attr("data-ai"),"undefined"!==typeof b&&!1!==b&&(b=a(this).attr("fallback-tracking"),"undefined"!==typeof b&&!1!==b&&d.attr("data-ai",b))):(a(this).hide(),d.find(".ai-debug-block").length||d.hide(),d.removeAttr("data-ai").removeClass("ai-track"),d.find(".ai-debug-block").length?(d.css({visibility:""}).removeClass("ai-close"),d.hasClass("ai-remove-position")&&d.css({position:""})):d.hide());a(this).attr("data-code","");a(this).attr("data-fallback-code","");d.removeClass("ai-list-block")})}};a(document).ready(function(e){setTimeout(function(){ai_process_lists();setTimeout(function(){n()},50);if("function"==typeof ai_load_blocks)jQuery(document).on("cmplzEnableScripts",function(h){"all"===h.consentLevel&&ai_load_blocks()});jQuery("#ai-iab-tcf-bar").click(function(){AiCookies.remove("euconsent-v2",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("__lxG__consent__v2",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("__lxG__consent__v2_daisybit",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("__lxG__consent__v2_gdaisybit",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("cmplz_marketing",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("cmplz_stats",{path:"/",domain:"."+window.location.hostname});AiCookies.remove("complianz_consent_status",{path:"/",domain:"."+window.location.hostname});jQuery("#ai-iab-tcf-status").text("COOKIE DELETED")})},5)})});function ai_process_element(a){setTimeout(function(){"function"==typeof ai_process_rotations_in_element&&ai_process_rotations_in_element(a);"function"==typeof ai_process_lists&&ai_process_lists(jQuery(".ai-list-data",a));"function"==typeof ai_process_ip_addresses&&ai_process_ip_addresses(jQuery(".ai-ip-data",a));"function"==typeof ai_adb_process_blocks&&ai_adb_process_blocks(a)},5)}function getAllUrlParams(a){var k=a?a.split("?")[1]:window.location.search.slice(1);a={};if(k){k=k.split("#")[0];k=k.split("&");for(var z=0;z<k.length;z++){var n=k[z].split("="),E=void 0,e=n[0].replace(/\[\d*\]/,function(h){E=h.slice(1,-1);return""});n="undefined"===typeof n[1]?"":n[1];e=e.toLowerCase();n=n.toLowerCase();a[e]?("string"===typeof a[e]&&(a[e]=[a[e]]),"undefined"===typeof E?a[e].push(n):a[e][E]=n):a[e]=n}}return a};jQuery(function(a){function t(g,c){c||(c=window.location.href);g=g.replace(/[\[\]]/g,"\\$&");var e=(new RegExp("[?&]"+g+"(=([^&#]*)|&|#|$)")).exec(c);return e?e[2]?decodeURIComponent(e[2].replace(/\+/g," ")):"":null}function u(g){g.removeClass("ai-ip-data");var c=!1;if(""!=ai_ip_data){try{var e=JSON.parse(ai_ip_data),h=e[0],l=e[1],n=e[2],p=e[3]}catch(d){return}var q=h+", "+l;null!=n&&null!=p&&(q=q+":"+n+":"+p);null==n&&(n="");null==p&&(p="");null!=e&&g.each(function(){var d=a(this).closest("div.code-block");c=!0;var f=a(this).attr("ip-addresses");if("undefined"!=typeof f){f=f.split(",");var r=a(this).attr("ip-address-list"),k=!1;a.each(f,function(v,b){if("*"==b.charAt(0))if("*"==b.charAt(b.length-1)){if(b=b.substr(1,b.length-2),-1!=h.indexOf(b))return k=!0,!1}else{if(b=b.substr(1),h.substr(-b.length)==b)return k=!0,!1}else if("*"==b.charAt(b.length-1)){if(b=b.substr(0,b.length-1),0==h.indexOf(b))return k=!0,!1}else if("#"==b){if(""==h)return k=!0,!1}else if(b==h)return k=!0,!1});switch(r){case "B":k&&(c=!1);break;case "W":k||(c=!1)}}if(c&&(f=a(this).attr("countries"),"undefined"!=typeof f))switch(f=f.split(","),r=a(this).attr("country-list"),k=!1,a.each(f,function(v,b){var m=b.trim().split(":");if(null==m[1]||""==n)m[1]="";if(null==m[2]||""==p)m[2]="";var w=m.join(":").toUpperCase();m=(l+":"+(""==m[1]?"":n)+":"+(""==m[2]?"":p)).toUpperCase();if(w==m)return k=!0,!1}),r){case "B":k&&(c=!1);break;case "W":k||(c=!1)}a(this).css({visibility:"",position:"",width:"",height:"","z-index":""});f=a(this).prev(".ai-debug-bar");f.find(".ai-debug-name.ai-ip-country").text(q);f.find(".ai-debug-name.ai-ip-status").text(c?ai_front.visible:ai_front.hidden);c?(d.css({visibility:""}),d.hasClass("ai-remove-position")&&d.css({position:""}),"undefined"!=typeof a(this).data("code")&&(f=b64d(a(this).data("code")),0!=a(this).closest("head").length?(a(this).after(f),a(this).remove()):a(this).append(f),a(this).attr("data-code",""),ai_process_element(this))):(a(this).hide(),d.find(".ai-debug-block").length||d.hide(),d.removeAttr("data-ai"),d.find(".ai-debug-block")?(d.css({visibility:""}).removeClass("ai-close"),d.hasClass("ai-remove-position")&&d.css({position:""}),"undefined"!=typeof a(this).data("code")&&(d.removeClass("ai-list-block"),d.prev().hasClass("ai-debug-info")&&d.prev().remove())):d.hide());d.removeClass("ai-list-block-ip")})}}ai_process_ip_addresses=function(g){g=null==g?a("div.ai-ip-data, meta.ai-ip-data"):g.filter(".ai-ip-data");if(g.length)if("undefined"!=typeof ai_ip_data)u(g);else if("undefined"==typeof ai_ip_data_requested){ai_ip_data_requested=!0;var c="/wp-admin/admin-ajax.php?action=ai_ajax&ip-data=ip-address-country-city&ai_check=e25a7b7809&ver="+((new Date).getTime()+"-"+Math.round(1E5*Math.random())),e=t("ai-debug-ip-address");null!=e&&(c+="&ai-debug-ip-address="+e);e=t("ai-debug-country");null!=e&&(c+="&ai-debug-country="+e);a.get(c,function(h){ai_ip_data=h;if(""==h){var l="Ajax request returned empty data, geo-targeting disabled";console.error(l);"undefined"!=typeof ai_js_errors&&ai_js_errors.push([l,c,0])}else try{JSON.parse(h)}catch(n){l="Ajax call returned invalid data, geo-targeting disabled",console.error(l,h),"undefined"!=typeof ai_js_errors&&ai_js_errors.push([l,c,0])}u(g)}).fail(function(h,l,n){a("div.ai-ip-data").each(function(){a(this).css({display:"none",visibility:"",position:"",width:"",height:"","z-index":""}).removeClass("ai-ip-data").hide()})})}};a(document).ready(function(g){setTimeout(function(){ai_process_ip_addresses()},5)})});function ai_process_element(a){setTimeout(function(){"function"==typeof ai_process_rotations_in_element&&ai_process_rotations_in_element(a);"function"==typeof ai_process_lists&&ai_process_lists(jQuery(".ai-list-data",a));"function"==typeof ai_process_ip_addresses&&ai_process_ip_addresses(jQuery(".ai-ip-data",a));"function"==typeof ai_adb_process_blocks&&ai_adb_process_blocks(a)},5)};ai_run_359635261655 = function(){ai_document_write=document.write;document.write=function(a){"interactive"==document.readyState?(console.error("document.write called after page load: ",a),"undefined"!=typeof ai_js_errors&&ai_js_errors.push(["document.write called after page load",a,0])):ai_document_write.call(document,a)};ai_insert ('after', '.lwptoc', b64d ('PGRpdiBjbGFzcz0nY29kZS1ibG9jayBjb2RlLWJsb2NrLWRlZmF1bHQgY29kZS1ibG9jay0xMCBhaS12aWV3cG9ydC0zJz4KPGEgaHJlZj0iL2luc3RhLyIgcmVsPSJub2ZvbGxvdyIgdGFyZ2V0PSJfYmxhbmsiPjxpbWcgc3JjPSIvYi9wYW1tX2xhbmRpbmdfYmFubmVyXzMwMHgyNTBfcnVfLmdpZiIvPjwvYT4KPC9kaXY+Cg=='));};if (document.readyState === 'complete' || (document.readyState !== 'loading' && !document.documentElement.doScroll)) ai_run_359635261655 (); else document.addEventListener ('DOMContentLoaded', ai_run_359635261655);ai_js_code = true;</script> </body></html>